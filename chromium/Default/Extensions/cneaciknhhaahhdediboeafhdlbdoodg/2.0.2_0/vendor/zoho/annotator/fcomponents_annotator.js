function stackBlurImage(imageID,canvasID,radius,blurAlphaChannel){var img=document.getElementById(imageID),w=img.naturalWidth,h=img.naturalHeight,canvas=document.getElementById(canvasID);canvas.style.width=w+"px",canvas.style.height=h+"px",canvas.width=w,canvas.height=h;var context=canvas.getContext("2d");context.clearRect(0,0,w,h),context.drawImage(img,0,0),isNaN(radius)||1>radius||(blurAlphaChannel?stackBlurCanvasRGBA(canvasID,0,0,w,h,radius):stackBlurCanvasRGB(canvasID,0,0,w,h,radius))}function stackBlurCanvasRGBA(id,top_x,top_y,width,height,radius){if(!(isNaN(radius)||1>radius)){radius|=0;var imageData,canvas=document.getElementById(id),context=canvas.getContext("2d");try{try{imageData=context.getImageData(top_x,top_y,width,height)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),imageData=context.getImageData(top_x,top_y,width,height)}catch(e){throw new Error("unable to access local image data: "+e)}}}catch(e){throw new Error("unable to access image data: "+e)}var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,a_sum,r_out_sum,g_out_sum,b_out_sum,a_out_sum,r_in_sum,g_in_sum,b_in_sum,a_in_sum,pr,pg,pb,pa,rbs,pixels=imageData.data,div=radius+radius+1,widthMinus1=width-1,heightMinus1=height-1,radiusPlus1=radius+1,sumFactor=radiusPlus1*(radiusPlus1+1)/2,stackStart=new BlurStack,stack=stackStart;for(i=1;div>i;i++)if(stack=stack.next=new BlurStack,i==radiusPlus1)var stackEnd=stack;stack.next=stackStart;var stackIn=null,stackOut=null;yw=yi=0;var mul_sum=mul_table[radius],shg_sum=shg_table[radius];for(y=0;height>y;y++){for(r_in_sum=g_in_sum=b_in_sum=a_in_sum=r_sum=g_sum=b_sum=a_sum=0,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(i=1;radiusPlus1>i;i++)p=yi+((i>widthMinus1?widthMinus1:i)<<2),r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[p+1])*rbs,b_sum+=(stack.b=pb=pixels[p+2])*rbs,a_sum+=(stack.a=pa=pixels[p+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next;for(stackIn=stackStart,stackOut=stackEnd,x=0;width>x;x++)pixels[yi+3]=pa=a_sum*mul_sum>>shg_sum,0!=pa?(pa=255/pa,pixels[yi]=(r_sum*mul_sum>>shg_sum)*pa,pixels[yi+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[yi+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[yi]=pixels[yi+1]=pixels[yi+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=yw+((p=x+radius+1)<widthMinus1?p:widthMinus1)<<2,r_in_sum+=stackIn.r=pixels[p],g_in_sum+=stackIn.g=pixels[p+1],b_in_sum+=stackIn.b=pixels[p+2],a_in_sum+=stackIn.a=pixels[p+3],r_sum+=r_in_sum,g_sum+=g_in_sum,b_sum+=b_in_sum,a_sum+=a_in_sum,stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=4;yw+=width}for(x=0;width>x;x++){for(g_in_sum=b_in_sum=a_in_sum=r_in_sum=g_sum=b_sum=a_sum=r_sum=0,yi=x<<2,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(yp=width,i=1;radius>=i;i++)yi=yp+x<<2,r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[yi+1])*rbs,b_sum+=(stack.b=pb=pixels[yi+2])*rbs,a_sum+=(stack.a=pa=pixels[yi+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next,heightMinus1>i&&(yp+=width);for(yi=x,stackIn=stackStart,stackOut=stackEnd,y=0;height>y;y++)p=yi<<2,pixels[p+3]=pa=a_sum*mul_sum>>shg_sum,pa>0?(pa=255/pa,pixels[p]=(r_sum*mul_sum>>shg_sum)*pa,pixels[p+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[p+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[p]=pixels[p+1]=pixels[p+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2,r_sum+=r_in_sum+=stackIn.r=pixels[p],g_sum+=g_in_sum+=stackIn.g=pixels[p+1],b_sum+=b_in_sum+=stackIn.b=pixels[p+2],a_sum+=a_in_sum+=stackIn.a=pixels[p+3],stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=width}context.putImageData(imageData,top_x,top_y)}}function stackBlurCanvasRGB(id,top_x,top_y,width,height,radius){if(!(isNaN(radius)||1>radius)){radius|=0;var imageData,canvas=document.getElementById(id),context=canvas.getContext("2d");try{try{imageData=context.getImageData(top_x,top_y,width,height)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),imageData=context.getImageData(top_x,top_y,width,height)}catch(e){throw new Error("unable to access local image data: "+e)}}}catch(e){throw new Error("unable to access image data: "+e)}var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,r_out_sum,g_out_sum,b_out_sum,r_in_sum,g_in_sum,b_in_sum,pr,pg,pb,rbs,pixels=imageData.data,div=radius+radius+1,widthMinus1=width-1,heightMinus1=height-1,radiusPlus1=radius+1,sumFactor=radiusPlus1*(radiusPlus1+1)/2,stackStart=new BlurStack,stack=stackStart;for(i=1;div>i;i++)if(stack=stack.next=new BlurStack,i==radiusPlus1)var stackEnd=stack;stack.next=stackStart;var stackIn=null,stackOut=null;yw=yi=0;var mul_sum=mul_table[radius],shg_sum=shg_table[radius];for(y=0;height>y;y++){for(r_in_sum=g_in_sum=b_in_sum=r_sum=g_sum=b_sum=0,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack=stack.next;for(i=1;radiusPlus1>i;i++)p=yi+((i>widthMinus1?widthMinus1:i)<<2),r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[p+1])*rbs,b_sum+=(stack.b=pb=pixels[p+2])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,stack=stack.next;for(stackIn=stackStart,stackOut=stackEnd,x=0;width>x;x++)pixels[yi]=r_sum*mul_sum>>shg_sum,pixels[yi+1]=g_sum*mul_sum>>shg_sum,pixels[yi+2]=b_sum*mul_sum>>shg_sum,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,p=yw+((p=x+radius+1)<widthMinus1?p:widthMinus1)<<2,r_in_sum+=stackIn.r=pixels[p],g_in_sum+=stackIn.g=pixels[p+1],b_in_sum+=stackIn.b=pixels[p+2],r_sum+=r_in_sum,g_sum+=g_in_sum,b_sum+=b_in_sum,stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,stackOut=stackOut.next,yi+=4;yw+=width}for(x=0;width>x;x++){for(g_in_sum=b_in_sum=r_in_sum=g_sum=b_sum=r_sum=0,yi=x<<2,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack=stack.next;for(yp=width,i=1;radius>=i;i++)yi=yp+x<<2,r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[yi+1])*rbs,b_sum+=(stack.b=pb=pixels[yi+2])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,stack=stack.next,heightMinus1>i&&(yp+=width);for(yi=x,stackIn=stackStart,stackOut=stackEnd,y=0;height>y;y++)p=yi<<2,pixels[p]=r_sum*mul_sum>>shg_sum,pixels[p+1]=g_sum*mul_sum>>shg_sum,pixels[p+2]=b_sum*mul_sum>>shg_sum,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2,r_sum+=r_in_sum+=stackIn.r=pixels[p],g_sum+=g_in_sum+=stackIn.g=pixels[p+1],b_sum+=b_in_sum+=stackIn.b=pixels[p+2],stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,stackOut=stackOut.next,yi+=width}context.putImageData(imageData,top_x,top_y)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function RGBColor(color_string){this.ok=!1,"#"==color_string.charAt(0)&&(color_string=color_string.substr(1,6)),color_string=color_string.replace(/ /g,""),color_string=color_string.toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors)color_string==key&&(color_string=simple_colors[key]);for(var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}],i=0;i<color_defs.length;i++){var re=color_defs[i].re,processor=color_defs[i].process,bits=re.exec(color_string);bits&&(channels=processor(bits),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return 1==r.length&&(r="0"+r),1==g.length&&(g="0"+g),1==b.length&&(b="0"+b),"#"+r+g+b},this.getHelpXML=function(){for(var examples=new Array,i=0;i<color_defs.length;i++)for(var example=color_defs[i].example,j=0;j<example.length;j++)examples[examples.length]=example[j];for(var sc in simple_colors)examples[examples.length]=sc;var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++)try{var list_item=document.createElement("li"),list_color=new RGBColor(examples[i]),example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; color:"+list_color.toHex(),example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div),list_item.appendChild(list_item_value),xml.appendChild(list_item)}catch(e){}return xml}}function ZAlertDialog(){}var FComponents=function($){function setClientToken(srcURL){return srcURL&&(clientToken=srcURL.split("#")[1],clientToken&&(clientToken=clientToken.split("=")[1],document.cookie=options.clientTokenName+"="+clientToken+"; domain="+options.domain+"; path=/; secure")),clientToken}function requestIAMToken(props){options.serviceName=props.serviceName,options.domain=props.domain;var requestURL=options.clientTokenServiceURL;if("tokenpair.do"===requestURL){var locationInfo=window.location;requestURL=locationInfo.protocol+"//"+locationInfo.hostname+FComponents.option("contextPath")+requestURL}var accountsLoginURL=props.clientTokenReqURL+"client_auth=true&servicename="+props.serviceName+"&serviceurl="+requestURL,iframe=$("<iframe>").attr({id:"zfc-iam-clienttoken",src:accountsLoginURL,style:"display:none;"});iframe.appendTo("body"),iframe.load(function(){setClientToken(this.contentWindow.location.href)})}var options={webFontsHostName:location.protocol+"//webfonts.zohostatic.com/",csrfParamName:"fccsrf",csrfCookieName:"FC_CSRF_TOKEN",csrfRequestURL:void 0,contextPath:"fcomponents/",clientTokenIsEnabled:!1,clientTokenName:"x-uds-clitoken",clientTokenServiceParamName:"x-cli-service-name",serviceName:"ZohoWriter",clientTokenReqURL:"https://accounts.localzoho.com/login",clientTokenServiceURL:"tokenpair.do",service:"WR"},clientToken=void 0;return{getClientToken:function(){return clientToken},init:function(data){var domainArray=window.location.hostname.split(".");domainArray.length>2&&(domainArray.reverse().pop(),domainArray.reverse()),options.domain=domainArray.join(".");var csrfInit=!1;void 0!==data.csrfRequestURL&&""!==data.csrfRequestURL&&FCUtil.ajaxUtil(data.csrfRequestURL,"GET"),!data.csrfInitRequest||void 0!==data.csrfParamName&&""!==data.csrfParamName||(csrfInit=!0,data.csrfParamName=options.csrfParamName,data.csrfCookieName=options.csrfCookieName),options=$.extend({},options,data);var tokenInfo=options.clientToken;options.clientTokenIsEnabled!==!0||void 0!==tokenInfo&&""!==tokenInfo||FCUtil.ajaxUtil("getproperties.do","get","",{success:function(responseObj){"success"===responseObj.request&&requestIAMToken(responseObj)}}),csrfInit&&FCUtil.ajaxUtil("html/blank.html","get","","")},option:function(name,value){return value?void(options[name]=value):options[name]},getDriveInfo:function(opts){opts=opts||{};var product_type=opts.product_type||options.product_type,owner_id=opts.owner_id||options.owner_id;return product_type&&owner_id?"?product_type="+product_type+"&owner_id="+owner_id:""},setI18NKeys:function(keys){var keysJSON={};for(var key in keys){var keyArray=key.split("."),moduleName=keyArray[1],keyValue=keyArray.slice(2).join(".");keysJSON[moduleName]||(keysJSON[moduleName]={}),keysJSON[moduleName][keyValue]=keys[key]}ZComponents.setI18NKeys(keysJSON)}}}(jQuery),FCUtil=function($){function _getCSRFToken(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){var c=ca[i].trim();if(0===c.indexOf(name))return c.substring(name.length,c.length)}return""}return{ajaxUtil:function(requestURL,requestType,requestData,callbacks,optionObj,customURL){requestData=requestData||{},optionObj=optionObj||{},callbacks=callbacks||{},optionObj.responseType=optionObj.responseType?optionObj.responseType:"application/json","post"===requestType.toLowerCase()&&(requestData[FComponents.option("csrfParamName")]=this.getCSRFToken()),requestURL=customURL?requestURL:FComponents.option("contextPath")+requestURL,callbacks.errorNotified=!1;var requestObj=$.ajax({type:requestType,url:requestURL,data:requestData,beforeSend:function(xhrObject){callbacks.progress&&callbacks.progress(xhrObject)},fail:function(serverResponse){callbacks.fail&&!callbacks.errorNotified&&(callbacks.errorNotified=!0,callbacks.fail(serverResponse))},error:function(serverResponse){callbacks.fail&&!callbacks.errorNotified&&(callbacks.errorNotified=!0,callbacks.fail(serverResponse))},success:function(serverResponse){if(callbacks.success){var responseObj=serverResponse;"object"!=typeof responseObj&&"application/json"===optionObj.responseType&&(responseObj=$.parseJSON(serverResponse)),callbacks.success(responseObj)}}});return requestObj},commonKeys:{insert:"Insert",close:"Close",cancel:"Cancel"},getString:function(key,defaultKeys,stringArray){return this.getI18NString("fcommon",key,stringArray,defaultKeys||this.commonKeys)},getI18NString:function(moduleName,key,stringArray,defaultKeys){return stringArray=stringArray||[],ZComponents.getI18NText(moduleName,key,defaultKeys,stringArray)},removeProgressDialog:function(){$("#zfc-progress-dialog").remove()},showProgressDialog:function(msg,targetContainer,overlay){if(overlay===!0){var overlay=$("<div>").attr({id:"zfc-progress-dialog-overlay"}).appendTo("body");overlay.css({overflow:"scroll",position:"fixed",width:"100%",height:"100%","z-index":$.ui.dialog&&$.ui.dialog.zIndex?$.ui.dialog.zIndex:1e4,top:0,left:0});var loaderDialog=$("<div>").attr({id:"zfc-progress-dialog"}).appendTo(overlay)}else var loaderDialog=$("<div>").attr({id:"zfc-progress-dialog"}).appendTo("body");loaderDialog.css({height:targetContainer.outerHeight(),width:targetContainer.outerWidth(),left:targetContainer.offset().left,top:targetContainer.offset().top});var loaderSpan=$("<span>").attr({id:"zfc-dialog-loader","class":"ui-zfc-loader-circle"}).appendTo(loaderDialog),msgSpan=$("<span>").attr({"class":"zfc-dialog-loader-msg"}).appendTo(loaderDialog);msgSpan.text(msg),loaderDialog.animate({height:110,width:220,marginTop:100,marginLeft:targetContainer.outerWidth()/3},100,function(){var leftpos=(loaderDialog.outerWidth()-(loaderSpan.outerWidth()+msgSpan.width()+4))/2,toppos=(loaderDialog.outerHeight()-loaderSpan.outerHeight()-2)/2;loaderSpan.css({left:leftpos,top:toppos}),msgSpan.css({left:leftpos,top:toppos}),loaderSpan.fadeIn(50),msgSpan.fadeIn(100)})},showError:function(msg,msgContainer,renderTo,errorOptions,insertType){msg=""===msg||void 0===msg?FCUtil.getString("internalserver.label"):msg;var _errorBanner=msgContainer.find("#ui-fc-server-error");_errorBanner.length||(_errorBanner=$('<div id="ui-fc-server-error" class="ui-fc-server-error"><div class="zc-server-error"><span id="zc-server-error-close" title="'+FCUtil.getString("close","fcommon")+'" class="ui-zfc-icon ui-icon-closethick"></span><div class="zc-server-error-msg" id="zfc-server-error"></div> </div> </div>'),_errorBanner[void 0!==insertType?insertType:"insertBefore"](renderTo)),_errorBanner.find("#zfc-server-error").text(msg);var defaultErrorOptions={openDelay:200,closeDelay:200};if(errorOptions=$.extend({},defaultErrorOptions,errorOptions),_errorBanner.slideDown(errorOptions.openDelay,function(){errorOptions.onOpen&&errorOptions.onOpen(_errorBanner)}),errorOptions.autoCloseDelay){msgContainer.data("zfcAutoClose")&&clearTimeout(msgContainer.data("zfcAutoClose"));var zfcAutoClose=setTimeout(function(){_errorBanner.slideUp(errorOptions.closeDelay,function(){errorOptions.onAutoClose&&errorOptions.onAutoClose(_errorBanner)})},errorOptions.autoCloseDelay);msgContainer.data("zfcAutoClose",zfcAutoClose)}_errorBanner.find("#zc-server-error-close").off("click").on("click",function(){errorOptions.beforeClose&&errorOptions.beforeClose(_errorBanner),_errorBanner.slideUp(errorOptions.closeDelay,function(){errorOptions.onClose&&errorOptions.onClose(_errorBanner)})})},getCSRFToken:function(){return _getCSRFToken(FComponents.option("csrfCookieName"))},getCSRFCookie:function(name){return _getCSRFToken(name)}}}(jQuery),mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];!function(){function getSelectorSpecificity(selector){var typeCount=[0,0,0],findMatch=function(regex,type){var matches=selector.match(regex);null!=matches&&(typeCount[type]+=matches.length,selector=selector.replace(regex," "))};return selector=selector.replace(/:not\(([^\)]*)\)/g,"     $1 "),selector=selector.replace(/{[^]*/gm," "),findMatch(attributeRegex,1),findMatch(idRegex,0),findMatch(classRegex,1),findMatch(pseudoElementRegex,2),findMatch(pseudoClassWithBracketsRegex,1),findMatch(pseudoClassRegex,1),selector=selector.replace(/[\*\s\+>~]/g," "),selector=selector.replace(/[#\.]/g," "),findMatch(elementRegex,2),typeCount.join("")}function build(opts){var svg={opts:opts};svg.FRAMERATE=30,svg.MAX_VIRTUAL_PIXELS=3e4,svg.log=function(){},1==svg.opts.log&&"undefined"!=typeof console&&(svg.log=function(msg){console.log(msg)}),svg.init=function(ctx){var uniqueId=0;svg.UniqueId=function(){return uniqueId++,"canvg"+uniqueId},svg.Definitions={},svg.Styles={},svg.StylesSpecificity={},svg.Animations=[],svg.Images=[],svg.ctx=ctx,svg.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]||{width:0,height:0}},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(d){return null!=d&&"number"==typeof d?d:"x"==d?this.width():"y"==d?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},svg.init(),svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++)if(!svg.Images[i].loaded)return!1;return!0},svg.trim=function(s){return s.replace(/^\s+|\s+$/g,"")},svg.compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ")},svg.ajax=function(url){var AJAX;return AJAX=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),AJAX?(AJAX.open("GET",url,!1),AJAX.send(null),AJAX.responseText):null},svg.parseXml=function(xml){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var xmlDoc=new Windows.Data.Xml.Dom.XmlDocument,settings=new Windows.Data.Xml.Dom.XmlLoadSettings;return settings.prohibitDtd=!1,xmlDoc.loadXml(xml,settings),xmlDoc}if(window.DOMParser){var parser=new DOMParser;return parser.parseFromString(xml,"text/xml")}xml=xml.replace(/<!DOCTYPE svg[^>]*>/,"");var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");return xmlDoc.async="false",xmlDoc.loadXML(xml),xmlDoc},svg.Property=function(name,value){this.name=name,this.value=value},svg.Property.prototype.getValue=function(){return this.value},svg.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},svg.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var n=parseFloat(this.value);return(this.value+"").match(/%$/)&&(n/=100),n},svg.Property.prototype.valueOrDefault=function(def){return this.hasValue()?this.value:def},svg.Property.prototype.numValueOrDefault=function(def){return this.hasValue()?this.numValue():def},svg.Property.prototype.addOpacity=function(opacityProp){var newValue=this.value;if(null!=opacityProp.value&&""!=opacityProp.value&&"string"==typeof this.value){var color=new RGBColor(this.value);color.ok&&(newValue="rgba("+color.r+", "+color.g+", "+color.b+", "+opacityProp.numValue()+")")}return new svg.Property(this.name,newValue)},svg.Property.prototype.getDefinition=function(){var name=this.value.match(/#([^\)'"]+)/);return name&&(name=name[1]),name||(name=this.value),svg.Definitions[name]},svg.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},svg.Property.prototype.getFillStyleDefinition=function(e,opacityProp){var def=this.getDefinition();if(null!=def&&def.createGradient)return def.createGradient(svg.ctx,e,opacityProp);if(null!=def&&def.createPattern){if(def.getHrefAttribute().hasValue()){var pt=def.attribute("patternTransform");def=def.getHrefAttribute().getDefinition(),pt.hasValue()&&(def.attribute("patternTransform",!0).value=pt.value)}return def.createPattern(svg.ctx,e)}return null},svg.Property.prototype.getDPI=function(){return 96},svg.Property.prototype.getEM=function(viewPort){var em=12,fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);return fontSize.hasValue()&&(em=fontSize.toPixels(viewPort)),em},svg.Property.prototype.getUnits=function(){var s=this.value+"";return s.replace(/[0-9\.\-]/g,"")},svg.Property.prototype.toPixels=function(viewPort,processPercent){if(!this.hasValue())return 0;var s=this.value+"";if(s.match(/em$/))return this.numValue()*this.getEM(viewPort);if(s.match(/ex$/))return this.numValue()*this.getEM(viewPort)/2;if(s.match(/px$/))return this.numValue();if(s.match(/pt$/))return this.numValue()*this.getDPI(viewPort)*(1/72);if(s.match(/pc$/))return 15*this.numValue();if(s.match(/cm$/))return this.numValue()*this.getDPI(viewPort)/2.54;if(s.match(/mm$/))return this.numValue()*this.getDPI(viewPort)/25.4;if(s.match(/in$/))return this.numValue()*this.getDPI(viewPort);if(s.match(/%$/))return this.numValue()*svg.ViewPort.ComputeSize(viewPort);var n=this.numValue();return processPercent&&1>n?n*svg.ViewPort.ComputeSize(viewPort):n},svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/s$/)?1e3*this.numValue():(s.match(/ms$/),this.numValue())},svg.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/deg$/)?this.numValue()*(Math.PI/180):s.match(/grad$/)?this.numValue()*(Math.PI/200):s.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return svg.Property.prototype.toTextBaseline=function(){return this.hasValue()?textBaselineMapping[this.value]:null},svg.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=null!=inherit?this.Parse(inherit):this.CreateFont("","","","","",svg.ctx.font);return{fontFamily:fontFamily||f.fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var that=this;this.Parse=function(s){for(var f={},d=svg.trim(svg.compressSpaces(s||"")).split(" "),set={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},ff="",i=0;i<d.length;i++)set.fontStyle||-1==that.Styles.indexOf(d[i])?set.fontVariant||-1==that.Variants.indexOf(d[i])?set.fontWeight||-1==that.Weights.indexOf(d[i])?set.fontSize?"inherit"!=d[i]&&(ff+=d[i]):("inherit"!=d[i]&&(f.fontSize=d[i].split("/")[0]),set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=!0):("inherit"!=d[i]&&(f.fontWeight=d[i]),set.fontStyle=set.fontVariant=set.fontWeight=!0):("inherit"!=d[i]&&(f.fontVariant=d[i]),set.fontStyle=set.fontVariant=!0):("inherit"!=d[i]&&(f.fontStyle=d[i]),set.fontStyle=!0);return""!=ff&&(f.fontFamily=ff),f}},svg.ToNumberArray=function(s){for(var a=svg.trim(svg.compressSpaces((s||"").replace(/,/g," "))).split(" "),i=0;i<a.length;i++)a[i]=parseFloat(a[i]);return a},svg.Point=function(x,y){this.x=x,this.y=y},svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)},svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4],yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp,this.y=yp},svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1])},svg.CreatePath=function(s){for(var a=svg.ToNumberArray(s),path=[],i=0;i<a.length;i+=2)path.push(new svg.Point(a[i],a[i+1]));return path},svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(x,y){null!=x&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=x,this.x2=x),x<this.x1&&(this.x1=x),x>this.x2&&(this.x2=x)),null!=y&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=y,this.y2=y),y<this.y1&&(this.y1=y),y>this.y2&&(this.y2=y))},this.addX=function(x){this.addPoint(x,null)},this.addY=function(y){this.addPoint(null,y)},this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1),this.addPoint(bb.x2,bb.y2)},this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x),cp1y=p0y+2/3*(p1y-p0y),cp2x=cp1x+1/3*(p2x-p0x),cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y)},this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];for(this.addPoint(p0[0],p0[1]),this.addPoint(p3[0],p3[1]),i=0;1>=i;i++){var f=function(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i]},b=6*p0[i]-12*p1[i]+6*p2[i],a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i],c=3*p1[i]-3*p0[i];if(0!=a){var b2ac=Math.pow(b,2)-4*c*a;if(!(0>b2ac)){var t1=(-b+Math.sqrt(b2ac))/(2*a);t1>0&&1>t1&&(0==i&&this.addX(f(t1)),1==i&&this.addY(f(t1)));var t2=(-b-Math.sqrt(b2ac))/(2*a);t2>0&&1>t2&&(0==i&&this.addX(f(t2)),1==i&&this.addY(f(t2)))}}else{if(0==b)continue;var t=-c/b;t>0&&1>t&&(0==i&&this.addX(f(t)),1==i&&this.addY(f(t)))}}},this.isPointInBox=function(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2},this.addPoint(x1,y1),this.addPoint(x2,y2)},svg.Transform=function(v){var that=this;this.Type={},this.Type.translate=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.translate(this.p.x||0,this.p.y||0)},this.unapply=function(ctx){ctx.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property("angle",a[0]),this.cx=a[1]||0,this.cy=a[2]||0,this.apply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.unapply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(-1*this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]),p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(ctx){ctx.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(p){p.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(s){this.m=svg.ToNumberArray(s),this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(ctx){var a=this.m[0],b=this.m[2],c=this.m[4],d=this.m[1],e=this.m[3],f=this.m[5],g=0,h=0,i=1,det=1/(a*(e*i-f*h)-b*(d*i-f*g)+c*(d*h-e*g));ctx.transform(det*(e*i-f*h),det*(f*g-d*i),det*(c*h-b*i),det*(a*i-c*g),det*(b*f-c*e),det*(c*d-a*f))},this.applyToPoint=function(p){p.applyTransform(this.m)}},this.Type.SkewBase=function(s){this.base=that.Type.matrix,this.base(s),this.angle=new svg.Property("angle",s)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++)this.transforms[i].apply(ctx)},this.unapply=function(ctx){for(var i=this.transforms.length-1;i>=0;i--)this.transforms[i].unapply(ctx)},this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++)this.transforms[i].applyToPoint(p)};for(var data=svg.trim(svg.compressSpaces(v)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<data.length;i++){var type=svg.trim(data[i].split("(")[0]),s=data[i].split("(")[1].replace(")",""),transform=new this.Type[type](s);transform.type=type,this.transforms.push(transform)}},svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){aspectRatio=svg.compressSpaces(aspectRatio),aspectRatio=aspectRatio.replace(/^defer\s/,"");var align=aspectRatio.split(" ")[0]||"xMidYMid",meetOrSlice=aspectRatio.split(" ")[1]||"meet",scaleX=width/desiredWidth,scaleY=height/desiredHeight,scaleMin=Math.min(scaleX,scaleY),scaleMax=Math.max(scaleX,scaleY);"meet"==meetOrSlice&&(desiredWidth*=scaleMin,desiredHeight*=scaleMin),"slice"==meetOrSlice&&(desiredWidth*=scaleMax,desiredHeight*=scaleMax),refX=new svg.Property("refX",refX),refY=new svg.Property("refY",refY),refX.hasValue()&&refY.hasValue()?ctx.translate(-scaleMin*refX.toPixels("x"),-scaleMin*refY.toPixels("y")):(align.match(/^xMid/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width/2-desiredWidth/2,0),align.match(/YMid$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height/2-desiredHeight/2),align.match(/^xMax/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width-desiredWidth,0),align.match(/YMax$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height-desiredHeight)),"none"==align?ctx.scale(scaleX,scaleY):"meet"==meetOrSlice?ctx.scale(scaleMin,scaleMin):"slice"==meetOrSlice&&ctx.scale(scaleMax,scaleMax),ctx.translate(null==minX?0:-minX,null==minY?0:-minY)},svg.Element={},svg.EmptyProperty=new svg.Property("EMPTY",""),svg.Element.ElementBase=function(node){if(this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(name,createIfNotExists){var a=this.attributes[name];return null!=a?a:(1==createIfNotExists&&(a=new svg.Property(name,""),this.attributes[name]=a),a||svg.EmptyProperty)},this.getHrefAttribute=function(){for(var a in this.attributes)if("href"==a||a.match(/:href$/))return this.attributes[a];return svg.EmptyProperty},this.style=function(name,createIfNotExists,skipAncestors){var s=this.styles[name];if(null!=s)return s;var a=this.attribute(name);if(null!=a&&a.hasValue())return this.styles[name]=a,a;if(1!=skipAncestors){var p=this.parent;if(null!=p){var ps=p.style(name);if(null!=ps&&ps.hasValue())return ps}}return 1==createIfNotExists&&(s=new svg.Property(name,""),this.styles[name]=s),s||svg.EmptyProperty},this.render=function(ctx){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(ctx.save(),this.attribute("mask").hasValue()){var mask=this.attribute("mask").getDefinition();null!=mask&&mask.apply(ctx,this)}else if(this.style("filter").hasValue()){var filter=this.style("filter").getDefinition();null!=filter&&filter.apply(ctx,this)}else this.setContext(ctx),this.renderChildren(ctx),this.clearContext(ctx);ctx.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++)this.children[i].render(ctx)},this.addChild=function(childNode,create){var child=childNode;create&&(child=svg.CreateElement(childNode)),child.parent=this,"title"!=child.type&&this.children.push(child)},this.addStylesFromStyleDefinition=function(){for(var selector in svg.Styles)if("@"!=selector[0]&&matchesSelector(node,selector)){var styles=svg.Styles[selector],specificity=svg.StylesSpecificity[selector];if(null!=styles)for(var name in styles){var existingSpecificity=this.stylesSpecificity[name];"undefined"==typeof existingSpecificity&&(existingSpecificity="000"),specificity>existingSpecificity&&(this.styles[name]=styles[name],this.stylesSpecificity[name]=specificity)}}},null!=node&&1==node.nodeType){for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];this.attributes[attribute.nodeName]=new svg.Property(attribute.nodeName,attribute.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var styles=this.attribute("style").value.split(";"),i=0;i<styles.length;i++)if(""!=svg.trim(styles[i])){var style=styles[i].split(":"),name=svg.trim(style[0]),value=svg.trim(style[1]);this.styles[name]=new svg.Property(name,value)}this.attribute("id").hasValue()&&null==svg.Definitions[this.attribute("id").value]&&(svg.Definitions[this.attribute("id").value]=this);for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];if(1==childNode.nodeType&&this.addChild(childNode,!0),this.captureTextNodes&&(3==childNode.nodeType||4==childNode.nodeType)){var text=childNode.value||childNode.text||childNode.textContent||"";""!=svg.compressSpaces(text)&&this.addChild(new svg.Element.tspan(childNode),!1)}}}},svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.setContext=function(ctx){if(this.style("fill").isUrlDefinition()){var fs=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=fs&&(ctx.fillStyle=fs)}else if(this.style("fill").hasValue()){var fillStyle=this.style("fill");"currentColor"==fillStyle.value&&(fillStyle.value=this.style("color").value),"inherit"!=fillStyle.value&&(ctx.fillStyle="none"==fillStyle.value?"rgba(0,0,0,0)":fillStyle.value)}if(this.style("fill-opacity").hasValue()){var fillStyle=new svg.Property("fill",ctx.fillStyle);fillStyle=fillStyle.addOpacity(this.style("fill-opacity")),ctx.fillStyle=fillStyle.value}if(this.style("stroke").isUrlDefinition()){var fs=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=fs&&(ctx.strokeStyle=fs)}else if(this.style("stroke").hasValue()){var strokeStyle=this.style("stroke");"currentColor"==strokeStyle.value&&(strokeStyle.value=this.style("color").value),"inherit"!=strokeStyle.value&&(ctx.strokeStyle="none"==strokeStyle.value?"rgba(0,0,0,0)":strokeStyle.value)}if(this.style("stroke-opacity").hasValue()){var strokeStyle=new svg.Property("stroke",ctx.strokeStyle);strokeStyle=strokeStyle.addOpacity(this.style("stroke-opacity")),ctx.strokeStyle=strokeStyle.value}if(this.style("stroke-width").hasValue()){var newLineWidth=this.style("stroke-width").toPixels();ctx.lineWidth=0==newLineWidth?.001:newLineWidth}if(this.style("stroke-linecap").hasValue()&&(ctx.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(ctx.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(ctx.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var gaps=svg.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof ctx.setLineDash?ctx.setLineDash(gaps):"undefined"!=typeof ctx.webkitLineDash?ctx.webkitLineDash=gaps:"undefined"==typeof ctx.mozDash||1==gaps.length&&0==gaps[0]||(ctx.mozDash=gaps);var offset=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof ctx.lineDashOffset?ctx.lineDashOffset=offset:"undefined"!=typeof ctx.webkitLineDashOffset?ctx.webkitLineDashOffset=offset:"undefined"!=typeof ctx.mozDashOffset&&(ctx.mozDashOffset=offset)}if("undefined"!=typeof ctx.font&&(ctx.font=svg.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()){var transform=new svg.Transform(this.style("transform",!1,!0).value);transform.apply(ctx)}if(this.attribute("clip-path",!1,!0).hasValue()){var clip=this.attribute("clip-path",!1,!0).getDefinition();null!=clip&&clip.apply(ctx)}this.style("opacity").hasValue()&&(ctx.globalAlpha=this.style("opacity").numValue())}},svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase,svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.path=function(ctx){return null!=ctx&&ctx.beginPath(),new svg.BoundingBox},this.renderChildren=function(ctx){this.path(ctx),svg.Mouse.checkPath(this,ctx),""!=ctx.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?ctx.fill(this.style("fill-rule").value):ctx.fill()),""!=ctx.strokeStyle&&ctx.stroke();var markers=this.getMarkers();if(null!=markers){if(this.style("marker-start").isUrlDefinition()){var marker=this.style("marker-start").getDefinition();null!=marker&&marker.render(ctx,markers[0][0],markers[0][1])}if(this.style("marker-mid").isUrlDefinition()){var marker=this.style("marker-mid").getDefinition();if(null!=marker)for(var i=1;i<markers.length-1;i++)marker.render(ctx,markers[i][0],markers[i][1])}if(this.style("marker-end").isUrlDefinition()){var marker=this.style("marker-end").getDefinition();null!=marker&&marker.render(ctx,markers[markers.length-1][0],markers[markers.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseClearContext=this.clearContext,this.clearContext=function(ctx){this.baseClearContext(ctx),svg.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(ctx){ctx.strokeStyle="rgba(0,0,0,0)",ctx.lineCap="butt",ctx.lineJoin="miter",ctx.miterLimit=4,"undefined"!=typeof ctx.font&&"undefined"!=typeof window.getComputedStyle&&(ctx.font=window.getComputedStyle(ctx.canvas).getPropertyValue("font")),this.baseSetContext(ctx),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),ctx.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var width=svg.ViewPort.width(),height=svg.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");var x=0,y=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(x=-this.attribute("refX").toPixels("x"),y=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(ctx.beginPath(),ctx.moveTo(x,y),ctx.lineTo(width,y),ctx.lineTo(width,height),ctx.lineTo(x,height),ctx.closePath(),ctx.clip())}if(svg.ViewPort.SetCurrent(width,height),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute("refX").value,this.attribute("refY").value),svg.ViewPort.RemoveCurrent(),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.svg.prototype=new svg.Element.RenderedElementBase,svg.Element.rect=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y"),rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(ry=rx),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(rx=ry),rx=Math.min(rx,width/2),ry=Math.min(ry,height/2),null!=ctx&&(ctx.beginPath(),ctx.moveTo(x+rx,y),ctx.lineTo(x+width-rx,y),ctx.quadraticCurveTo(x+width,y,x+width,y+ry),ctx.lineTo(x+width,y+height-ry),ctx.quadraticCurveTo(x+width,y+height,x+width-rx,y+height),ctx.lineTo(x+rx,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-ry),ctx.lineTo(x,y+ry),ctx.quadraticCurveTo(x,y,x+rx,y),ctx.closePath()),new svg.BoundingBox(x,y,x+width,y+height)}},svg.Element.rect.prototype=new svg.Element.PathElementBase,svg.Element.circle=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=ctx&&(ctx.beginPath(),ctx.arc(cx,cy,r,0,2*Math.PI,!0),ctx.closePath()),new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r)}},svg.Element.circle.prototype=new svg.Element.PathElementBase,svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var KAPPA=4*((Math.sqrt(2)-1)/3),rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y"),cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y");return null!=ctx&&(ctx.beginPath(),ctx.moveTo(cx,cy-ry),ctx.bezierCurveTo(cx+KAPPA*rx,cy-ry,cx+rx,cy-KAPPA*ry,cx+rx,cy),ctx.bezierCurveTo(cx+rx,cy+KAPPA*ry,cx+KAPPA*rx,cy+ry,cx,cy+ry),ctx.bezierCurveTo(cx-KAPPA*rx,cy+ry,cx-rx,cy+KAPPA*ry,cx-rx,cy),ctx.bezierCurveTo(cx-rx,cy-KAPPA*ry,cx-KAPPA*rx,cy-ry,cx,cy-ry),ctx.closePath()),new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry)}},svg.Element.ellipse.prototype=new svg.Element.PathElementBase,svg.Element.line=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.getPoints=function(){return[new svg.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new svg.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(ctx){var points=this.getPoints();return null!=ctx&&(ctx.beginPath(),ctx.moveTo(points[0].x,points[0].y),ctx.lineTo(points[1].x,points[1].y)),new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y)},this.getMarkers=function(){var points=this.getPoints(),a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]]}},svg.Element.line.prototype=new svg.Element.PathElementBase,svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.points=svg.CreatePath(this.attribute("points").value),this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);null!=ctx&&(ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)bb.addPoint(this.points[i].x,this.points[i].y),null!=ctx&&ctx.lineTo(this.points[i].x,this.points[i].y);return bb},this.getMarkers=function(){for(var markers=[],i=0;i<this.points.length-1;i++)markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])]);return markers.push([this.points[this.points.length-1],markers[markers.length-1][1]]),markers}},svg.Element.polyline.prototype=new svg.Element.PathElementBase,svg.Element.polygon=function(node){this.base=svg.Element.polyline,this.base(node),this.basePath=this.path,this.path=function(ctx){var bb=this.basePath(ctx);return null!=ctx&&(ctx.lineTo(this.points[0].x,this.points[0].y),ctx.closePath()),bb}},svg.Element.polygon.prototype=new svg.Element.polyline,svg.Element.path=function(node){this.base=svg.Element.PathElementBase,this.base(node);var d=this.attribute("d").value;d=d.replace(/,/gm," ");for(var i=0;2>i;i++)d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");d=d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),d=d.replace(/([0-9])([+\-])/gm,"$1 $2");for(var i=0;2>i;i++)d=d.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");d=d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),d=svg.compressSpaces(d),d=svg.trim(d),this.PathParser=new function(d){this.tokens=d.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new svg.Point(0,0),this.control=new svg.Point(0,0),this.current=new svg.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)},this.getAsControlPoint=function(){var p=this.getPoint();return this.control=p,p},this.getAsCurrentPoint=function(){var p=this.getPoint();return this.current=p,p},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var p=new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return p},this.makeAbsolute=function(p){return this.isRelativeCommand()&&(p.x+=this.current.x,p.y+=this.current.y),p},this.addMarker=function(p,from,priorTo){null!=priorTo&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo)),this.addMarkerAngle(p,null==from?null:from.angleTo(p))},this.addMarkerAngle=function(p,a){this.points.push(p),this.angles.push(a)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++)if(null==this.angles[i])for(var j=i+1;j<this.angles.length;j++)if(null!=this.angles[j]){this.angles[i]=this.angles[j];break}return this.angles}}(d),this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox;for(null!=ctx&&ctx.beginPath();!pp.isEnd();)switch(pp.nextCommand(),pp.command){case"M":case"m":var p=pp.getAsCurrentPoint();for(pp.addMarker(p),bb.addPoint(p.x,p.y),null!=ctx&&ctx.moveTo(p.x,p.y),pp.start=pp.current;!pp.isCommandOrEnd();){var p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"L":case"l":for(;!pp.isCommandOrEnd();){var c=pp.current,p=pp.getAsCurrentPoint();pp.addMarker(p,c),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"H":case"h":for(;!pp.isCommandOrEnd();){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"V":case"v":for(;!pp.isCommandOrEnd();){var newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"C":case"c":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"S":case"s":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getReflectedControlPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"Q":case"q":for(;!pp.isCommandOrEnd();){var curr=pp.current,cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"T":case"t":for(;!pp.isCommandOrEnd();){var curr=pp.current,cntrl=pp.getReflectedControlPoint();pp.control=cntrl;var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"A":case"a":for(;!pp.isCommandOrEnd();){var curr=pp.current,rx=pp.getScalar(),ry=pp.getScalar(),xAxisRotation=pp.getScalar()*(Math.PI/180),largeArcFlag=pp.getScalar(),sweepFlag=pp.getScalar(),cp=pp.getAsCurrentPoint(),currp=new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2),l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);l>1&&(rx*=Math.sqrt(l),ry*=Math.sqrt(l));var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt((Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(currp.y,2)-Math.pow(ry,2)*Math.pow(currp.x,2))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));isNaN(s)&&(s=0);var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx),centp=new svg.Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y),m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))},r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))},a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))},a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]),u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry],v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry],ad=a(u,v);r(u,v)<=-1&&(ad=Math.PI),r(u,v)>=1&&(ad=0);var dir=1-sweepFlag?1:-1,ah=a1+dir*(ad/2),halfWay=new svg.Point(centp.x+rx*Math.cos(ah),centp.y+ry*Math.sin(ah));if(pp.addMarkerAngle(halfWay,ah-dir*Math.PI/2),pp.addMarkerAngle(cp,ah-dir*Math.PI),bb.addPoint(cp.x,cp.y),null!=ctx){var r=rx>ry?rx:ry,sx=rx>ry?1:rx/ry,sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y),ctx.rotate(xAxisRotation),ctx.scale(sx,sy),ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag),ctx.scale(1/sx,1/sy),ctx.rotate(-xAxisRotation),ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":null!=ctx&&ctx.closePath(),pp.current=pp.start}return bb},this.getMarkers=function(){for(var points=this.PathParser.getMarkerPoints(),angles=this.PathParser.getMarkerAngles(),markers=[],i=0;i<points.length;i++)markers.push([points[i],angles[i]]);return markers}},svg.Element.path.prototype=new svg.Element.PathElementBase,svg.Element.pattern=function(node){this.base=svg.Element.ElementBase,this.base(node),this.createPattern=function(ctx){var width=this.attribute("width").toPixels("x",!0),height=this.attribute("height").toPixels("y",!0),tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.width=new svg.Property("width",width+"px"),tempSvg.attributes.height=new svg.Property("height",height+"px"),tempSvg.attributes.transform=new svg.Property("transform",this.attribute("patternTransform").value),tempSvg.children=this.children;var c=document.createElement("canvas");c.width=width,c.height=height;var cctx=c.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&cctx.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var x=-1;1>=x;x++)for(var y=-1;1>=y;y++)cctx.save(),tempSvg.attributes.x=new svg.Property("x",x*c.width),tempSvg.attributes.y=new svg.Property("y",y*c.height),tempSvg.render(cctx),cctx.restore();var pattern=ctx.createPattern(c,"repeat");return pattern}},svg.Element.pattern.prototype=new svg.Element.ElementBase,svg.Element.marker=function(node){this.base=svg.Element.ElementBase,this.base(node),this.baseRender=this.render,this.render=function(ctx,point,angle){ctx.translate(point.x,point.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(angle),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(ctx.lineWidth,ctx.lineWidth),ctx.save();var tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.refX=new svg.Property("refX",this.attribute("refX").value),tempSvg.attributes.refY=new svg.Property("refY",this.attribute("refY").value),tempSvg.attributes.width=new svg.Property("width",this.attribute("markerWidth").value),tempSvg.attributes.height=new svg.Property("height",this.attribute("markerHeight").value),tempSvg.attributes.fill=new svg.Property("fill",this.attribute("fill").valueOrDefault("black")),tempSvg.attributes.stroke=new svg.Property("stroke",this.attribute("stroke").valueOrDefault("none")),tempSvg.children=this.children,tempSvg.render(ctx),ctx.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(-angle),ctx.translate(-point.x,-point.y)}},svg.Element.marker.prototype=new svg.Element.ElementBase,svg.Element.defs=function(node){this.base=svg.Element.ElementBase,this.base(node),this.render=function(){}},svg.Element.defs.prototype=new svg.Element.ElementBase,svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"stop"==child.type&&this.stops.push(child)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(stopsContainer){for(var i=0;i<this.attributesToInherit.length;i++){var attributeToInherit=this.attributesToInherit[i];!this.attribute(attributeToInherit).hasValue()&&stopsContainer.attribute(attributeToInherit).hasValue()&&(this.attribute(attributeToInherit,!0).value=stopsContainer.attribute(attributeToInherit).value)}},this.createGradient=function(ctx,element,parentOpacityProp){var stopsContainer=this;this.getHrefAttribute().hasValue()&&(stopsContainer=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(stopsContainer));var addParentOpacity=function(color){if(parentOpacityProp.hasValue()){var p=new svg.Property("color",color);return p.addOpacity(parentOpacityProp).value}return color},g=this.getGradient(ctx,element);if(null==g)return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length-1].color);for(var i=0;i<stopsContainer.stops.length;i++)g.addColorStop(stopsContainer.stops[i].offset,addParentOpacity(stopsContainer.stops[i].color));if(this.attribute("gradientTransform").hasValue()){var rootView=svg.ViewPort.viewPorts[0],rect=new svg.Element.rect;rect.attributes.x=new svg.Property("x",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.y=new svg.Property("y",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.width=new svg.Property("width",svg.MAX_VIRTUAL_PIXELS),rect.attributes.height=new svg.Property("height",svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g;group.attributes.transform=new svg.Property("transform",this.attribute("gradientTransform").value),group.children=[rect];var tempSvg=new svg.Element.svg;tempSvg.attributes.x=new svg.Property("x",0),tempSvg.attributes.y=new svg.Property("y",0),tempSvg.attributes.width=new svg.Property("width",rootView.width),tempSvg.attributes.height=new svg.Property("height",rootView.height),tempSvg.children=[group];var c=document.createElement("canvas");c.width=rootView.width,c.height=rootView.height;var tempCtx=c.getContext("2d");return tempCtx.fillStyle=g,tempSvg.render(tempCtx),tempCtx.createPattern(c,"no-repeat")}return g}},svg.Element.GradientBase.prototype=new svg.Element.ElementBase,svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(ctx,element){var bb="objectBoundingBox"==this.gradientUnits()?element.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var x1="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),y1="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),x2="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),y2="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return x1==x2&&y1==y2?null:ctx.createLinearGradient(x1,y1,x2,y2)}},svg.Element.linearGradient.prototype=new svg.Element.GradientBase,svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(ctx,element){var bb=element.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var cx="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),cy="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),fx=cx,fy=cy;this.attribute("fx").hasValue()&&(fx="objectBoundingBox"==this.gradientUnits()?bb.x()+bb.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(fy="objectBoundingBox"==this.gradientUnits()?bb.y()+bb.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var r="objectBoundingBox"==this.gradientUnits()?(bb.width()+bb.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return ctx.createRadialGradient(fx,fy,0,cx,cy,r)}},svg.Element.radialGradient.prototype=new svg.Element.GradientBase,svg.Element.stop=function(node){this.base=svg.Element.ElementBase,this.base(node),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var stopColor=this.style("stop-color",!0);""===stopColor.value&&(stopColor.value="#000"),this.style("stop-opacity").hasValue()&&(stopColor=stopColor.addOpacity(this.style("stop-opacity"))),this.color=stopColor.value},svg.Element.stop.prototype=new svg.Element.ElementBase,svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase,this.base(node),svg.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var attributeType=this.attribute("attributeType").value,attributeName=this.attribute("attributeName").value;return"CSS"==attributeType?this.parent.style(attributeName,!0):this.parent.attribute(attributeName,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(delta){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+delta;var updated=!1;if(this.begin<this.duration){var newValue=this.calcValue();if(this.attribute("type").hasValue()){var type=this.attribute("type").value;newValue=type+"("+newValue+")"}this.getProperty().value=newValue,updated=!0}return updated},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1),lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property("from",parseFloat(this.values.value[lb])),ret.to=new svg.Property("to",parseFloat(this.values.value[ub])),ret.progress=(p-lb)/(ub-lb)}else ret.from=this.from,ret.to=this.to;return ret}},svg.Element.AnimateBase.prototype=new svg.Element.ElementBase,svg.Element.animate=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress(),newValue=p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress;return newValue+this.initialUnits}},svg.Element.animate.prototype=new svg.Element.AnimateBase,svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress(),from=new RGBColor(p.from.value),to=new RGBColor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress,g=from.g+(to.g-from.g)*p.progress,b=from.b+(to.b-from.b)*p.progress;return"rgb("+parseInt(r,10)+","+parseInt(g,10)+","+parseInt(b,10)+")"}return this.attribute("from").value}},svg.Element.animateColor.prototype=new svg.Element.AnimateBase,svg.Element.animateTransform=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){for(var p=this.progress(),from=svg.ToNumberArray(p.from.value),to=svg.ToNumberArray(p.to.value),newValue="",i=0;i<from.length;i++)newValue+=from[i]+(to[i]-from[i])*p.progress+" ";return newValue}},svg.Element.animateTransform.prototype=new svg.Element.animate,svg.Element.font=function(node){this.base=svg.Element.ElementBase,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"font-face"==child.type?(this.fontFace=child,child.style("font-family").hasValue()&&(svg.Definitions[child.style("font-family").value]=this)):"missing-glyph"==child.type?this.missingGlyph=child:"glyph"==child.type&&(""!=child.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[child.unicode]&&(this.glyphs[child.unicode]=[]),this.glyphs[child.unicode][child.arabicForm]=child):this.glyphs[child.unicode]=child)}},svg.Element.font.prototype=new svg.Element.ElementBase,svg.Element.fontface=function(node){this.base=svg.Element.ElementBase,this.base(node),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},svg.Element.fontface.prototype=new svg.Element.ElementBase,svg.Element.missingglyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=0},svg.Element.missingglyph.prototype=new svg.Element.path,svg.Element.glyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},svg.Element.glyph.prototype=new svg.Element.path,svg.Element.text=function(node){this.captureTextNodes=!0,this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx);var textBaseline=this.style("dominant-baseline").toTextBaseline();null==textBaseline&&(textBaseline=this.style("alignment-baseline").toTextBaseline()),null!=textBaseline&&(ctx.textBaseline=textBaseline)},this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);return new svg.BoundingBox(x,y-fontSize,x+Math.floor(2*fontSize/3)*this.children[0].getText().length,y)},this.renderChildren=function(ctx){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(ctx,this,0);for(var i=0;i<this.children.length;i++)this.renderChild(ctx,this,i)},this.getAnchorDelta=function(ctx,parent,startI){var textAnchor=this.style("text-anchor").valueOrDefault("start");if("start"!=textAnchor){for(var width=0,i=startI;i<parent.children.length;i++){var child=parent.children[i];if(i>startI&&child.attribute("x").hasValue())break;width+=child.measureTextRecursive(ctx)}return-1*("end"==textAnchor?width:width/2)}return 0},this.renderChild=function(ctx,parent,i){var child=parent.children[i];child.attribute("x").hasValue()?(child.x=child.attribute("x").toPixels("x")+parent.getAnchorDelta(ctx,parent,i),child.attribute("dx").hasValue()&&(child.x+=child.attribute("dx").toPixels("x"))):(child.attribute("dx").hasValue()&&(parent.x+=child.attribute("dx").toPixels("x")),child.x=parent.x),parent.x=child.x+child.measureText(ctx),child.attribute("y").hasValue()?(child.y=child.attribute("y").toPixels("y"),child.attribute("dy").hasValue()&&(child.y+=child.attribute("dy").toPixels("y"))):(child.attribute("dy").hasValue()&&(parent.y+=child.attribute("dy").toPixels("y")),child.y=parent.y),parent.y=child.y,child.render(ctx);for(var i=0;i<child.children.length;i++)parent.renderChild(ctx,child,i)}},svg.Element.text.prototype=new svg.Element.RenderedElementBase,svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getGlyph=function(font,text,i){var c=text[i],glyph=null;if(font.isArabic){var arabicForm="isolated";(0==i||" "==text[i-1])&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="terminal"),i>0&&" "!=text[i-1]&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="medial"),i>0&&" "!=text[i-1]&&(i==text.length-1||" "==text[i+1])&&(arabicForm="initial"),"undefined"!=typeof font.glyphs[c]&&(glyph=font.glyphs[c][arabicForm],null==glyph&&"glyph"==font.glyphs[c].type&&(glyph=font.glyphs[c]))}else glyph=font.glyphs[c];return null==glyph&&(glyph=font.missingGlyph),glyph},this.renderChildren=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null==customFont)""!=ctx.fillStyle&&ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y),""!=ctx.strokeStyle&&ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);else{var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),fontStyle=this.parent.style("font-style").valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle),text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i),scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y),ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize,"italic"==fontStyle&&ctx.transform(1,0,.4,1,0,0),glyph.render(ctx),"italic"==fontStyle&&ctx.transform(1,0,-.4,1,0,0),ctx.lineWidth=lw,ctx.scale(1/scale,-1/scale),ctx.translate(-this.x,-this.y),this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm,"undefined"==typeof dx[i]||isNaN(dx[i])||(this.x+=dx[i])}}},this.getText=function(){},this.measureTextRecursive=function(ctx){for(var width=this.measureText(ctx),i=0;i<this.children.length;i++)width+=this.children[i].measureTextRecursive(ctx);return width},this.measureText=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null!=customFont){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),measure=0,text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);measure+=(glyph.horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm,"undefined"==typeof dx[i]||isNaN(dx[i])||(measure+=dx[i])}return measure}var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText)return 10*textToMeasure.length;ctx.save(),this.setContext(ctx);var width=ctx.measureText(textToMeasure).width;return ctx.restore(),width}},svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.tspan=function(node){this.captureTextNodes=!0,this.base=svg.Element.TextElementBase,this.base(node),this.text=svg.compressSpaces(node.value||node.text||node.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},svg.Element.tspan.prototype=new svg.Element.TextElementBase,svg.Element.tref=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.getText=function(){var element=this.getHrefAttribute().getDefinition();return null!=element?element.children[0].getText():void 0}},svg.Element.tref.prototype=new svg.Element.TextElementBase,svg.Element.a=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.hasText=node.childNodes.length>0;for(var i=0;i<node.childNodes.length;i++)3!=node.childNodes[i].nodeType&&(this.hasText=!1);this.text=this.hasText?node.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels("y"),this.x+this.measureText(ctx),this.y))}else if(this.children.length>0){var g=new svg.Element.g;g.children=this.children,g.parent=this,g.render(ctx)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){svg.ctx.canvas.style.cursor="pointer"}},svg.Element.a.prototype=new svg.Element.TextElementBase,svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase,this.base(node);var href=this.getHrefAttribute().value;if(""!=href){var isSvg=href.match(/\.svg$/);if(svg.Images.push(this),this.loaded=!1,isSvg)this.img=svg.ajax(href),this.loaded=!0;else{this.img=document.createElement("img"),1==svg.opts.useCORS&&(this.img.crossOrigin="Anonymous");var self=this;this.img.onload=function(){self.loaded=!0},this.img.onerror=function(){svg.log('ERROR: image "'+href+'" not found'),self.loaded=!0},this.img.src=href}this.renderChildren=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");0!=width&&0!=height&&(ctx.save(),isSvg?ctx.drawSvg(this.img,x,y,width,height):(ctx.translate(x,y),svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,width,this.img.width,height,this.img.height,0,0),ctx.drawImage(this.img,0,0)),ctx.restore())},this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");return new svg.BoundingBox(x,y,x+width,y+height)}}},svg.Element.image.prototype=new svg.Element.RenderedElementBase,svg.Element.g=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getBoundingBox=function(){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());return bb}},svg.Element.g.prototype=new svg.Element.RenderedElementBase,svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.render=function(){}},svg.Element.symbol.prototype=new svg.Element.RenderedElementBase,svg.Element.style=function(node){this.base=svg.Element.ElementBase,this.base(node);for(var css="",i=0;i<node.childNodes.length;i++)css+=node.childNodes[i].data;css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),css=svg.compressSpaces(css);for(var cssDefs=css.split("}"),i=0;i<cssDefs.length;i++)if(""!=svg.trim(cssDefs[i]))for(var cssDef=cssDefs[i].split("{"),cssClasses=cssDef[0].split(","),cssProps=cssDef[1].split(";"),j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(""!=cssClass){for(var props={},k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(":"),name=cssProps[k].substr(0,prop),value=cssProps[k].substr(prop+1,cssProps[k].length-prop);null!=name&&null!=value&&(props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value)))}if(svg.Styles[cssClass]=props,svg.StylesSpecificity[cssClass]=getSelectorSpecificity(cssClass),"@font-face"==cssClass)for(var fontFamily=props["font-family"].value.replace(/"/g,""),srcs=props.src.value.split(","),s=0;s<srcs.length;s++)if(srcs[s].indexOf('format("svg")')>0)for(var urlStart=srcs[s].indexOf("url"),urlEnd=srcs[s].indexOf(")",urlStart),url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6),doc=svg.parseXml(svg.ajax(url)),fonts=doc.getElementsByTagName("font"),f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font}}}},svg.Element.style.prototype=new svg.Element.ElementBase,svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.attribute("x").hasValue()&&ctx.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&ctx.translate(0,this.attribute("y").toPixels("y"))};var element=this.getHrefAttribute().getDefinition();this.path=function(ctx){null!=element&&element.path(ctx)},this.getBoundingBox=function(){return null!=element?element.getBoundingBox():void 0},this.renderChildren=function(ctx){if(null!=element){var tempSvg=element;"symbol"==element.type&&(tempSvg=new svg.Element.svg,tempSvg.type="svg",tempSvg.attributes.viewBox=new svg.Property("viewBox",element.attribute("viewBox").value),tempSvg.attributes.preserveAspectRatio=new svg.Property("preserveAspectRatio",element.attribute("preserveAspectRatio").value),tempSvg.attributes.overflow=new svg.Property("overflow",element.attribute("overflow").value),tempSvg.children=element.children),"svg"==tempSvg.type&&(this.attribute("width").hasValue()&&(tempSvg.attributes.width=new svg.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(tempSvg.attributes.height=new svg.Property("height",this.attribute("height").value)));var oldParent=tempSvg.parent;tempSvg.parent=null,tempSvg.render(ctx),tempSvg.parent=oldParent}}},svg.Element.use.prototype=new svg.Element.RenderedElementBase,svg.Element.mask=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");if(0==width&&0==height){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());var x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height())}var mask=element.attribute("mask").value;element.attribute("mask").value="";var cMask=document.createElement("canvas");cMask.width=x+width,cMask.height=y+height;var maskCtx=cMask.getContext("2d");this.renderChildren(maskCtx);var c=document.createElement("canvas");c.width=x+width,c.height=y+height;var tempCtx=c.getContext("2d");element.render(tempCtx),tempCtx.globalCompositeOperation="destination-in",tempCtx.fillStyle=maskCtx.createPattern(cMask,"no-repeat"),tempCtx.fillRect(0,0,x+width,y+height),ctx.fillStyle=tempCtx.createPattern(c,"no-repeat"),ctx.fillRect(0,0,x+width,y+height),element.attribute("mask").value=mask},this.render=function(){}},svg.Element.mask.prototype=new svg.Element.ElementBase,svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx){var oldBeginPath=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var oldClosePath=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},oldBeginPath.call(ctx);for(var i=0;i<this.children.length;i++){var child=this.children[i];if("undefined"!=typeof child.path){var transform=null;child.style("transform",!1,!0).hasValue()&&(transform=new svg.Transform(child.style("transform",!1,!0).value),transform.apply(ctx)),child.path(ctx),CanvasRenderingContext2D.prototype.closePath=oldClosePath,transform&&transform.unapply(ctx)}}oldClosePath.call(ctx),ctx.clip(),CanvasRenderingContext2D.prototype.beginPath=oldBeginPath,CanvasRenderingContext2D.prototype.closePath=oldClosePath},this.render=function(){}},svg.Element.clipPath.prototype=new svg.Element.ElementBase,svg.Element.filter=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var bb=element.getBoundingBox(),x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height()),filter=element.style("filter").value;element.style("filter").value="";for(var px=0,py=0,i=0;i<this.children.length;i++){var efd=this.children[i].extraFilterDistance||0;px=Math.max(px,efd),py=Math.max(py,efd)}var c=document.createElement("canvas");c.width=width+2*px,c.height=height+2*py;var tempCtx=c.getContext("2d");tempCtx.translate(-x+px,-y+py),element.render(tempCtx);for(var i=0;i<this.children.length;i++)"function"==typeof this.children[i].apply&&this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py);ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py),element.style("filter",!0).value=filter},this.render=function(){}},svg.Element.filter.prototype=new svg.Element.ElementBase,svg.Element.feMorphology=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(){}},svg.Element.feMorphology.prototype=new svg.Element.ElementBase,svg.Element.feComposite=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(){}},svg.Element.feComposite.prototype=new svg.Element.ElementBase,svg.Element.feColorMatrix=function(node){function imGet(img,x,y,width,height,rgba){return img[y*width*4+4*x+rgba]}function imSet(img,x,y,width,height,rgba,val){img[y*width*4+4*x+rgba]=val}function m(i,v){var mi=matrix[i];return mi*(0>mi?v-255:v)}this.base=svg.Element.ElementBase,this.base(node);var matrix=svg.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var s=matrix[0];matrix=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var a=matrix[0]*Math.PI/180,c=function(m1,m2,m3){return m1+Math.cos(a)*m2+Math.sin(a)*m3};matrix=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":matrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(ctx,x,y,width,height){for(var srcData=ctx.getImageData(0,0,width,height),y=0;height>y;y++)for(var x=0;width>x;x++){var r=imGet(srcData.data,x,y,width,height,0),g=imGet(srcData.data,x,y,width,height,1),b=imGet(srcData.data,x,y,width,height,2),a=imGet(srcData.data,x,y,width,height,3);imSet(srcData.data,x,y,width,height,0,m(0,r)+m(1,g)+m(2,b)+m(3,a)+m(4,1)),imSet(srcData.data,x,y,width,height,1,m(5,r)+m(6,g)+m(7,b)+m(8,a)+m(9,1)),imSet(srcData.data,x,y,width,height,2,m(10,r)+m(11,g)+m(12,b)+m(13,a)+m(14,1)),imSet(srcData.data,x,y,width,height,3,m(15,r)+m(16,g)+m(17,b)+m(18,a)+m(19,1))}ctx.clearRect(0,0,width,height),ctx.putImageData(srcData,0,0)}},svg.Element.feColorMatrix.prototype=new svg.Element.ElementBase,svg.Element.feGaussianBlur=function(node){this.base=svg.Element.ElementBase,this.base(node),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(ctx,x,y,width,height){return"undefined"==typeof stackBlurCanvasRGBA?void svg.log("ERROR: StackBlur.js must be included for blur to work"):(ctx.canvas.id=svg.UniqueId(),ctx.canvas.style.display="none",document.body.appendChild(ctx.canvas),stackBlurCanvasRGBA(ctx.canvas.id,x,y,width,height,this.blurRadius),void document.body.removeChild(ctx.canvas))}},svg.Element.feGaussianBlur.prototype=new svg.Element.ElementBase,svg.Element.title=function(){},svg.Element.title.prototype=new svg.Element.ElementBase,svg.Element.desc=function(){},svg.Element.desc.prototype=new svg.Element.ElementBase,svg.Element.MISSING=function(node){svg.log("ERROR: Element '"+node.nodeName+"' not yet implemented.")},svg.Element.MISSING.prototype=new svg.Element.ElementBase,svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,"");className=className.replace(/\-/g,"");var e=null;return e="undefined"!=typeof svg.Element[className]?new svg.Element[className](node):new svg.Element.MISSING(node),e.type=node.nodeName,e},svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url))},svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml))},svg.loadXmlDoc=function(ctx,dom){svg.init(ctx);var mapXY=function(p){for(var e=ctx.canvas;e;)p.x-=e.offsetLeft,p.y-=e.offsetTop,e=e.offsetParent;return window.scrollX&&(p.x+=window.scrollX),window.scrollY&&(p.y+=window.scrollY),p};1!=svg.opts.ignoreMouse&&(ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y)},ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y)});var e=svg.CreateElement(dom.documentElement);e.root=!0,e.addStylesFromStyleDefinition();var isFirstRender=!0,draw=function(){svg.ViewPort.Clear(),ctx.canvas.parentNode&&svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight),1!=svg.opts.ignoreDimensions&&(e.style("width").hasValue()&&(ctx.canvas.width=e.style("width").toPixels("x"),ctx.canvas.style.width=ctx.canvas.width+"px"),e.style("height").hasValue()&&(ctx.canvas.height=e.style("height").toPixels("y"),ctx.canvas.style.height=ctx.canvas.height+"px"));var cWidth=ctx.canvas.clientWidth||ctx.canvas.width,cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(1==svg.opts.ignoreDimensions&&e.style("width").hasValue()&&e.style("height").hasValue()&&(cWidth=e.style("width").toPixels("x"),cHeight=e.style("height").toPixels("y")),svg.ViewPort.SetCurrent(cWidth,cHeight),null!=svg.opts.offsetX&&(e.attribute("x",!0).value=svg.opts.offsetX),null!=svg.opts.offsetY&&(e.attribute("y",!0).value=svg.opts.offsetY),null!=svg.opts.scaleWidth||null!=svg.opts.scaleHeight){var xRatio=null,yRatio=null,viewBox=svg.ToNumberArray(e.attribute("viewBox").value);null!=svg.opts.scaleWidth&&(e.attribute("width").hasValue()?xRatio=e.attribute("width").toPixels("x")/svg.opts.scaleWidth:isNaN(viewBox[2])||(xRatio=viewBox[2]/svg.opts.scaleWidth)),null!=svg.opts.scaleHeight&&(e.attribute("height").hasValue()?yRatio=e.attribute("height").toPixels("y")/svg.opts.scaleHeight:isNaN(viewBox[3])||(yRatio=viewBox[3]/svg.opts.scaleHeight)),null==xRatio&&(xRatio=yRatio),null==yRatio&&(yRatio=xRatio),e.attribute("width",!0).value=svg.opts.scaleWidth,e.attribute("height",!0).value=svg.opts.scaleHeight,e.style("transform",!0,!0).value+=" scale("+1/xRatio+","+1/yRatio+")"}1!=svg.opts.ignoreClear&&ctx.clearRect(0,0,cWidth,cHeight),e.render(ctx),isFirstRender&&(isFirstRender=!1,"function"==typeof svg.opts.renderCallback&&svg.opts.renderCallback(dom))},waitingForImages=!0;svg.ImagesLoaded()&&(waitingForImages=!1,draw()),svg.intervalID=setInterval(function(){var needUpdate=!1;if(waitingForImages&&svg.ImagesLoaded()&&(waitingForImages=!1,needUpdate=!0),1!=svg.opts.ignoreMouse&&(needUpdate|=svg.Mouse.hasEvents()),1!=svg.opts.ignoreAnimation)for(var i=0;i<svg.Animations.length;i++)needUpdate|=svg.Animations[i].update(1e3/svg.FRAMERATE);"function"==typeof svg.opts.forceRedraw&&1==svg.opts.forceRedraw()&&(needUpdate=!0),needUpdate&&(draw(),svg.Mouse.runEvents())},1e3/svg.FRAMERATE)},svg.stop=function(){svg.intervalID&&clearInterval(svg.intervalID)},svg.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(x,y){this.events.push({type:"onclick",x:x,y:y,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(x,y){this.events.push({type:"onmousemove",x:x,y:y,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y)&&(this.eventElements[i]=element)}},this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];bb.isPointInBox(e.x,e.y)&&(this.eventElements[i]=element)}},this.runEvents=function(){svg.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++)for(var e=this.events[i],element=this.eventElements[i];element;)e.run(element),element=element.parent;this.events=[],this.eventElements=[]}},svg}this.canvg=function(target,s,opts){if(null!=target||null!=s||null!=opts){"string"==typeof target&&(target=document.getElementById(target)),null!=target.svg&&target.svg.stop();var svg=build(opts||{});(1!=target.childNodes.length||"OBJECT"!=target.childNodes[0].nodeName)&&(target.svg=svg);var ctx=target.getContext("2d");"undefined"!=typeof s.documentElement?svg.loadXmlDoc(ctx,s):"<"==s.substr(0,1)?svg.loadXml(ctx,s):svg.load(ctx,s)}else for(var svgTags=document.querySelectorAll("svg"),i=0;i<svgTags.length;i++){var svgTag=svgTags[i],c=document.createElement("canvas");c.width=svgTag.clientWidth,c.height=svgTag.clientHeight,svgTag.parentNode.insertBefore(c,svgTag),svgTag.parentNode.removeChild(svgTag);var div=document.createElement("div");div.appendChild(svgTag),canvg(c,div.innerHTML)}};var matchesSelector;"undefined"!=typeof Element.prototype.matches?matchesSelector=function(node,selector){return node.matches(selector)}:"undefined"!=typeof Element.prototype.webkitMatchesSelector?matchesSelector=function(node,selector){return node.webkitMatchesSelector(selector)}:"undefined"!=typeof Element.prototype.mozMatchesSelector?matchesSelector=function(node,selector){return node.mozMatchesSelector(selector)}:"undefined"!=typeof Element.prototype.msMatchesSelector?matchesSelector=function(node,selector){return node.msMatchesSelector(selector)}:"undefined"!=typeof Element.prototype.oMatchesSelector?matchesSelector=function(node,selector){return node.oMatchesSelector(selector)}:(("function"==typeof jQuery||"function"==typeof Zepto)&&(matchesSelector=function(node,selector){return $(node).is(selector)}),"undefined"==typeof matchesSelector&&(matchesSelector=Sizzle.matchesSelector));var attributeRegex=/(\[[^\]]+\])/g,idRegex=/(#[^\s\+>~\.\[:]+)/g,classRegex=/(\.[^\s\+>~\.\[:]+)/g,pseudoElementRegex=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,pseudoClassWithBracketsRegex=/(:[\w-]+\([^\)]*\))/gi,pseudoClassRegex=/(:[^\s\+>~\.\[:]+)/g,elementRegex=/([^\s\+>~\.\[:]+)/g}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh){canvg(this.canvas,s,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh})});var ZDOMUtil=function(){var elements=void 0;return{init:function(){elements={div:document.createElement("div")}},clone:function(elementName){return elements[elementName].cloneNode()}}}(window),ZComponents=function($){function getAttrSupport(){var ele=document.createElement("div"),supported=!1;return ele.addEventListener("DOMAttrModified",function(){supported=!0},!1),ele.setAttribute("class","zcomponents"),supported}var needToInit=!0,userAgent=navigator.userAgent.toLowerCase(),sourceDiv=document.createElement("div"),sourceText=document.createTextNode(" ");return{version:"3.2",isRTL:!1,selector:"data-ctype",userAgent:userAgent,DOMUtil:$,locale:navigator.language,zIndex:1e3,$document:$(document),$window:$(window),hasHandlebars:window.Handlebars?!0:!1,keys:{},localeInfo:{"en-US":{daysAbbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsAbbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],firstDayOfWeek:0,dateFormat:{"short":"M/d/yyyy",medium:"MMM d, yyyy","long":"MMMM d, yyyy",full:"dddd, MMMM d, yyyy"},timeFormat:{"short":"h:mm tt",medium:"h:mm:ss tt","long":"hh:mm:ss tt"},dateTimeFormat:{"short":"MMM d, yyyy, hh:mm:ss tt",medium:"MMM d, yyyy, hh:mm:ss tt","long":"dddd, MMMM d, yyyy 'at' h:mm tt",full:"dddd, MMMM d, yyyy 'at' h:mm tt"},numberFormat:{thousandSeparator:",",decimalSeparator:"."},currency:{code:"USD",name:"United States Dollar",symbol:"$"}}},keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,ALT:18},initDeferredComponents:function(componentsMap,timeout,callback){var base=this;setTimeout(function(){$.each(componentsMap,function(ctype,componentGroup){$(componentGroup).each(function(i,component){base._initComponent($(component),ctype)})}),callback&&callback(componentsMap)},timeout?timeout:1e4)},init:function(container,callback,attr,options){needToInit&&this._init(),options=options||{},container=$(container?container:"body");var attr1=attr?attr:this.selector,attrSelector="["+attr1+"]",uiComponents=options.nodeArray||(document.querySelectorAll?container[0].querySelectorAll(attrSelector):$(attrSelector,container));if((container[0].attributes[attr1]||container[0].dataset&&container[0].dataset[attr1])&&(uiComponents=$(container).add(uiComponents)),uiComponents.length){var base=this;this.eachAsync(uiComponents,{delay:options.delay||20,chunkSize:options.chunkSize||500,loop:function(i,ele){base._initComponent(ele,void 0,attr)},end:function(){base._end(container,uiComponents,callback)}})}else this._end(container,uiComponents,callback)},destroy:function(container,callback,attr){container=$(container?container:"body"),attr=attr?attr:this.selector;var attrSelector="["+attr+"]",uiComponents=$(attrSelector,container);if(container.is(attrSelector)&&(uiComponents=$(container).add(uiComponents)),uiComponents.length){var base=this;this.eachAsync(uiComponents,{delay:20,loop:function(i,ele){$(ele)[ele.getAttribute(attr)]("destroy")},end:function(){base._end(container,uiComponents,callback,!0)}})}else this._end(container,uiComponents,callback,!0)},eachAsync:function(array,_opts){var i=0,l=array.length,loop=_opts.loop||function(){};_opts=_opts||{},_opts.test=function(){return l>i},_opts.loop=function(){var val=array[i];return loop.call(val,i++,val)},this.whileAsync(_opts)},whileAsync:function(opts){var delay=Math.abs(opts.delay)||10,bulk=opts.chunkSize?opts.chunkSize:isNaN(opts.bulk)?500:Math.abs(opts.bulk),test=opts.test||function(){return!0},loop=opts.loop||function(){},end=opts.end||function(){};!function executeLoop(){for(var t=!1,begin=new Date;(t=test())&&(loop(),!(0===bulk||new Date-begin>bulk)););t?setTimeout(executeLoop,delay):end()}()},_initComponent:function(element,ctype,attr){attr=attr?attr:this.selector,element=$(element),element[ctype?ctype:element.attr(attr)]()},_end:function(mainDiv,uiComponents,callback,isdestroy){this.$document.trigger(isdestroy?"zcomponentdestroyed":"zcomponentinitialized",mainDiv),callback&&callback(uiComponents)},clearMetadata:function(elements){elements&&$(elements).removeData("metadata")},_getDataAttributes:function(element,object){for(var data=element.attributes,len=data.length,i=0;len>i;i++){var name=data[i].nodeName,value=""===data[i].nodeValue?"true":data[i].nodeValue;"data"!==name&&name.match(/^data-/)&&(name=name.replace(/^data-/,""),name=name.replace(/-([a-zA-Z])/g,this._stringReplace.bind(this)),name=name.replace(/(Html|Svg|Hsv|Hsl|Rgb)/gi,this._toUpperCase),object[name]="true"===value||"false"===value?"true"===value:-1!==value.indexOf("{")?ZComponents._getObject(value):value)}return object},_stringReplace:function(g){return g[1].toUpperCase()},_toUpperCase:function(s){return s.toUpperCase()},_getDataSet:function(element,object){var value,data=element.dataset;for(var i in data)data.hasOwnProperty(i)&&(value=data[i],i=i.replace(/(Html|Svg|Hsv|Hsl|Rgb)/gi,this._toUpperCase),object[i]="true"===value||"false"===value?"true"===value:-1!==value.indexOf("{")?ZComponents._getObject(value):value);return object},_getOptions:void 0,getMetadata:function(element){return this.getOptions(element)},getOptions:function(element){element=element instanceof $?element[0]:element;var object=$.data(element,"metadata");if(!object&&element.attributes){var dataAttr=element.getAttribute("data");dataAttr&&(object=ZComponents._getObject(void 0,element)),object=this._getOptions(element,object?object:{}),$.data(element,"metadata",object)}return object?object:{}},getTemplate:function(handleBarsFileName){var template;return this.hasHandlebars&&Handlebars.templates&&(template=Handlebars.templates[handleBarsFileName]),template},_getObject:function(data,element){if("object"==typeof data)return data;data=data||element.getAttribute("data"),data=data.indexOf("{")<0?"{"+data+"}":data;try{data=JSON.parse(data.replace(/'/g,'"'))}catch(error){return $.metadata?$(element).metadata():{}}return data},_extend:function(target,base){target.prototype=$.extend({},base.prototype,target.prototype),$.each(target.prototype,function(prop,value){"function"===$.type(value)&&(target.prototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)};return function(){return this._super=_super,value.apply(this,arguments)}}())})},OS:{isLinux:function(){return-1!=navigator.appVersion.indexOf("Linux")}},Browser:{isMobile:function(){return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())},isIE:function(){return-1!==userAgent.indexOf("msie")||-1!==userAgent.indexOf(".net")},isSafari:function(){return-1!==userAgent.indexOf("safari")&&-1===userAgent.indexOf("chrome")},isChrome:function(){return window.chrome},isFirefox:function(){return userAgent.indexOf("firefox")>-1?!0:!1},isMac:function(){return navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)?!0:!1},isWindows:function(){return-1!==navigator.platform.indexOf("Win")},getIEVersion:function(){var rv=-1;if("Microsoft Internet Explorer"==navigator.appName){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=re.exec(ua)&&(rv=parseFloat(RegExp.$1))}return rv}},AJAX:{transport:function(params,successCallback,failureCallback){var request=$.ajax({url:params.sourceURL,data:params.data,type:params.type,dataType:params.dataType,success:function(data){successCallback(data)},fail:function(error,exception){failureCallback(error,exception)},error:function(error,exception){failureCallback(error,exception)}});return request}},setI18NKeys:function(moduleName,values,replace){if("object"==typeof moduleName)for(var i in moduleName)this.keys[i]=$.extend({},this.keys[i],moduleName[i]);else this.keys[moduleName]=replace?values:$.extend({},this.keys[moduleName],values)},getI18NText:function(moduleName,key,stringArray){var defaultKeys=void 0;4===arguments.length&&(defaultKeys=stringArray,stringArray=arguments[3]);var keyObject=ZComponents.keys[moduleName]||{},ii8nText=keyObject[key]||"";if(""===ii8nText&&defaultKeys&&(ii8nText=defaultKeys[key]),stringArray)for(var i=0;i<stringArray.length;i++)ii8nText=ii8nText.replace("{"+i+"}",stringArray[i]);return ii8nText},create:function(initObject){var componentName=initObject.ctype.replace(initObject.ctype.charAt(0),""),methodName="create"+componentName.charAt(0).toUpperCase()+componentName.substring(1);return this[methodName](initObject)},setProperties:function(){var doc=document.documentElement||{},body=document.body||{};ZComponents.documentObject={height:Math.max(doc.clientHeight,doc.scrollHeight,doc.offsetHeight,body.offsetHeight,body.scrollHeight),width:Math.max(doc.clientWidth,doc.scrollHeight,doc.offsetHeight,body.offsetWidth,body.scrollWidth)},ZComponents.windowObject={height:window.innerHeight,width:window.innerWidth}},createSVGElement:function(tagName,attributes,childElements){var element=document.createElementNS("http://www.w3.org/2000/svg",tagName);for(var i in attributes)element.setAttribute(i,attributes[i]);if(childElements)for(var a=0;a<childElements.length;a++)for(var b in childElements[a]){var childEle=document.createElementNS("http://www.w3.org/2000/svg",b),childData=childElements[a][b];if(childData.nodes)childEle=this.createSVGElement(b,childData.props,childData.nodes);else for(var k in childData)childEle.setAttribute(k,childData[k]);element.appendChild(childEle)}return element},createIcon:function(element,icon,svgId,iconClass,cname){if(icon=svgId?-1===svgId.indexOf("#")?"#"+svgId:svgId:iconClass?iconClass:icon)if(-1===icon.indexOf("#"))element.addClass(" "+icon);else{var svgId=icon.split(" ")[0],customClass=icon.slice(svgId.length).trim()+" "+(cname?cname+"__svg":"");element.empty().append($("<svg class='"+customClass+"'><use xlink:href='"+svgId+"'></use></svg>"))}return element},_handleIcon:function(iTag,svgData,defaultSVGId,iconClass,svgIconId,v1IconClass,isUpdate,prevIconClass){isUpdate&&iTag.removeClass(prevIconClass);var iconIsSVG=!1;if(void 0!==v1IconClass||void 0!==iconClass||void 0!==svgIconId)if(v1IconClass&&0===v1IconClass.indexOf("#")||void 0!==svgIconId){var svgIcon=svgIconId||v1IconClass;if(svgIcon){var iconInfo=svgIcon.split(" ");svgIconId=iconInfo[0],iconClass=iconInfo[1]||"",iconIsSVG=!0}}else iconClass=iconClass||v1IconClass;else if(void 0!==defaultSVGId&&void 0!==svgData){var svgIcon=this._svgSprite.querySelector("#"+defaultSVGId);if(!svgIcon){var props=svgData.props||{};props.id=defaultSVGId;var element=this.createSVGElement("symbol",props,svgData.nodes);element.removeAttribute("class"),this._svgSprite.appendChild(element)}svgIconId="#"+defaultSVGId,iconClass=svgData.props&&svgData.props["class"]?svgData.props["class"]:defaultSVGId,iconIsSVG=!0}return iconIsSVG?(svgIconId=-1!==svgIconId.indexOf("#")?svgIconId:"#"+svgIconId,iTag.empty().append($("<svg class='"+iconClass+"'><use xlink:href='"+svgIconId+"'></use></svg>"))):iTag.addClass(iconClass),iTag},_handleFocus:function(element,cname){element=$(element),element.off("keyup.fs."+cname).on("keyup.fs."+cname,function(event){event.keyCode===ZComponents.keyCode.TAB&&element.addClass("has-focus")}).off("keydown.fs."+cname).on("keydown.fs."+cname,function(event){(event.keyCode===ZComponents.keyCode.ENTER||event.keyCode===ZComponents.keyCode.SPACE)&&element.addClass("has-focus")}).off("blur.fs."+cname).on("blur.fs."+cname,function(){element.removeClass("has-focus")}).off("focus.fs."+cname).on("focus.fs."+cname,function(event){event.originalEvent||element.addClass("has-focus")})},encodeHTML:function(str){return sourceText.nodeValue=str,sourceDiv.innerHTML},_init:function(){ZDOMUtil.init();var base=ZComponents;return needToInit?(needToInit=!1,base._getOptions=ZDOMUtil.clone("div").dataset?base._getDataSet:base._getDataAttributes,base.isDOMAttrModifiedSupported=getAttrSupport(),sourceDiv.appendChild(sourceText),base.Browser.isIE()&&base.isDOMAttrModifiedSupported&&(base.core._attachObserver=function(element){var base=this;this.observer=function(e){-1!==base.attributeList.indexOf(e.attrName)&&base._handleObserver(e.attrName,e.newValue)},element.addEventListener("DOMAttrModified",this.observer,!1)},base.core.destroy=function(){this.element[0].removeEventListener("DOMAttrModified",this.observer)}),base.setProperties(),base._svgSprite=base.createSVGElement("svg",{id:"zcomponents__svg"}),void $(base._svgSprite).appendTo("body").hide()):!1},registerComponent:function(componentName,parentComponent,prototype){prototype||(prototype=parentComponent,parentComponent=this.core),prototype.componentName=componentName,$[componentName]=function(options,element,userOptions){arguments.length&&this._init(options,element,userOptions)};var baseClass=new parentComponent;baseClass.options=$.extend(!0,{},baseClass.options),$[componentName].prototype=$.extend(!0,{},baseClass,prototype),this[componentName]||(this[componentName]={DEFAULTS:{}}),this[componentName]._DEFAULTS=$[componentName].prototype.options,$.fn[componentName]=function(options){needToInit&&ZComponents._init();var returnValue=this,length=this.length;if(options&&"object"!=typeof options){if("string"!=typeof options||-1!==options.indexOf("_"))return!1;for(var params=Array.prototype.slice.call(arguments,1),i=0;length>i;i++){var componentInstance=$(this[i]).data(componentName);componentInstance&&("option"===options?options=params&&2===params.length?"setAttribute":"getAttribute":"options"===options&&(options=params&&0===params.length?"getAttributes":"setAttributes"),returnValue=componentInstance[options].apply(componentInstance,params))}}else{options=options?options:{};for(var i=0;length>i;i++){var componentInstance=$(this[i]).data(componentName);if(componentInstance){if(length>1)continue;return returnValue}var metadata=ZComponents.getOptions(this[i],{});if(metadata.override){var newArray={};for(var obj in metadata)if(0===obj.indexOf(componentName)){var result=obj.replace(componentName,""),keyName=result[0].toLowerCase()+result.substring(1);newArray[keyName]=metadata[obj]}metadata=newArray}var data=$.extend(!0,{},ZComponents[componentName]._DEFAULTS,ZComponents[componentName].DEFAULTS,metadata,options);$(this[i]).data(componentName,new $[componentName](data,this[i],options)),$(this[i]).data("componentName",componentName)}}return returnValue},this._extend($[componentName],parentComponent)}}}(jQuery);!function(ZC){"object"==typeof module&&"object"==typeof module.exports&&(module.exports=function(){return ZC}())}(ZComponents),function(ZC){var $=ZC.DOMUtil;ZC.core=function(options,element){arguments.length&&this._init(options,element)},ZC.core.prototype={_init:function(options,element,userOptions){this.element=$(element),this.options=options,this._create($(element),options,userOptions)},_create:function(){},_trigger:function(eventName,event,data,element,isFromUI){return this._dispatchEvent(eventName,event,data,element,isFromUI)},_dispatchEvent:function(eventName,event,data,element,isFromUI){var type=this._EVENTS[eventName]||eventName;element=element?element:this.element;var prop,orig,value,callback=this.options[type];data=data||{},data.fromUI=isFromUI,data.fromui=isFromUI,data.element=element,data.options=data.options||this.options;var event=$.Event(event);if(event.type=(this.componentName?this.componentName+type:""+type).toLowerCase(),event.originalTarget=event.target||event.originalEvent&&event.originalEvent.target,event.target=element,orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return element.trigger(event,data),data=[event].concat(data),value=callback&&"string"==typeof callback?this._triggerFunction(callback,element[0],data):$.isFunction(callback)?callback.apply(element,data):void 0,void 0!==value?value:!event.isDefaultPrevented()},_handleIcon:function(iTag,svgData,defaultSVGId,iconClass,svgIconId,v1IconClass,isUpdate,prevIconClass,prevSVGIconId,svgIconName){return svgIconName=svgIconName||this.componentName+"__"+defaultSVGId,ZC._handleIcon(iTag,svgData,svgIconName,iconClass,svgIconId,v1IconClass,isUpdate,prevIconClass,prevSVGIconId)},_triggerFunction:function(functionName,context,params){for(var namespaces=functionName.split("."),executionContext=window,i=0;i<namespaces.length&&executionContext;i++)executionContext=executionContext[namespaces[i]];return executionContext&&executionContext.apply(context,params)},_handleObserver:function(attrName,attrValue){var formattedAttribute=attrName.replace(/^data-/,"");formattedAttribute=formattedAttribute.replace(/-([a-zA-Z])/g,function(g){return g[1].toUpperCase()}),this.setAttribute(formattedAttribute,attrValue)},_attachObserver:function(element){var base=this;this.observer=new MutationObserver(function(props){var attrName=props[0].attributeName,attrValue=props[0].target.getAttribute(attrName);base._handleObserver(attrName,attrValue)}),this.observer.observe(element,{attributes:!0,attributeFilter:this.attributeList})},_handleFocus:function(element){ZC._handleFocus(element||this.container,this.componentName)},getData:function(element){return ZC.getOptions(element?element:this.element[0])},_setAttribute:function(){return!0},_checkIsObject:function(value){return!(value instanceof Array||value instanceof Date||value instanceof RegExp||value instanceof $||value instanceof Element||$.isWindow(value)||value.nodeName)},setAttribute:function(optionName,value){var oldValue=this.options[optionName];if("string"!=typeof oldValue||oldValue!==value){value=value&&"object"==typeof value&&"object"==typeof oldValue&&this._checkIsObject(value)?$.extend(!0,{},oldValue,value):value;var valueChanged=this._setAttribute(optionName,value);"disable"===optionName&&(this._handleDisable(value),valueChanged=!0),valueChanged&&(this.options[optionName]=value)}},setAttributes:function(options){for(var i in options)this.setAttribute(i,options[i])},getAttribute:function(optionName){return this.options[optionName]},getAttributes:function(){return $.extend(!0,{},this.options)},_localize:function(key,stringArray,optionKey){var defaultsKeys=this.options.labels||this.options.messages,i18nText=optionKey?this.options[optionKey][key]:void 0;return i18nText||this._getI18N(this.componentName,key,defaultsKeys,stringArray)},_getI18N:function(moduleName,key,defaultKeys,stringArray){var keyObject=ZC.keys[moduleName]||{},ii8nText=keyObject[key]||"";if(""===ii8nText&&defaultKeys&&(ii8nText=defaultKeys[key]),stringArray)for(var i=0;i<stringArray.length;i++)ii8nText=ii8nText.replace("{"+i+"}",stringArray[i]);return ii8nText},enable:function(){this._handleDisable(!0)},disable:function(){this._handleDisable(!1)},_handleDisable:function(enable){var ele=$(this.container||this.element);enable?ele.removeClass("is-disabled").removeAttr("aria-disabled disabled"):ele.addClass("is-disabled").attr({"aria-disabled":!0,disabled:!0}),this.setAttribute("disabled",!enable)},getElement:function(){return this.container||this.element},_destroy:function(){},destroy:function(){this.element.off("."+this.eventPrefix),this.element.removeData(this.componentName).removeData("metadata"),this._destroy();var ele=this.container;ele&&ele[0]!==this.element[0]&&ele.remove()}};var bindedElements=[],closeHandlerDatas=[],getHandlerData=function(element){return closeHandlerDatas[bindedElements.indexOf(element)]};ZC.bindDocumentEvents=function(options){var uniqueNamespace=".zclosehandler-"+Math.floor(1e6*Math.random()),ctype=options.ctype,element=$(options.element),container=$(options.container||options.element),forElement=$(options.forElement),closeFn=options.closeMethodName,closeEvent=ctype+(options.closeEvent||closeFn),metadata={},data=getHandlerData(element[0]);data&&forElement.is(data.forElement)||(ZC.unBindDocumentEvents(element),bindedElements.forEach(function(bindedEle){var data=getHandlerData(bindedEle);data.contextElements=forElement.closest(data.container).length?data.contextElements.add(forElement).add(container):data.contextElements.not(element)}),bindedElements.push(element[0]),metadata.contextElements=container.add(forElement),metadata.uniqueNamespace=uniqueNamespace,metadata.forElement=forElement,metadata.container=container,metadata.ctype=ctype,metadata.closeFn=closeFn,closeHandlerDatas.push(metadata),element.on(closeEvent+".zclosehandler",function(){ZC.unBindDocumentEvents(element)}),metadata.timer=setTimeout(function(){ZC.$document.on("mousedown"+uniqueNamespace+" contextmenu"+uniqueNamespace,function(origEvent){var metadata1=getHandlerData(element[0]);if(!metadata1||!$.contains(document.documentElement,element[0]))return void ZC.unBindDocumentEvents(element);if(metadata1.uniqueNamespace===metadata.uniqueNamespace){var target=$(origEvent.target);if(!target.closest(metadata.contextElements).length){var customEvent=$.Event("zclosehandlerbeforehide",{originalEvent:origEvent});element.trigger(customEvent),customEvent.isDefaultPrevented()||element[ctype](closeFn)}}})},10))},ZC.unBindDocumentEvents=function(element,close){var index=bindedElements.indexOf(element[0]);if(-1!==index){var data=closeHandlerDatas[index];clearTimeout(data.timer);var relatedElements=data.contextElements.not(element);relatedElements.each(function(i,rel_ele){ZC.unBindDocumentEvents($(rel_ele),!0)}),element.off(".zclosehandler"),ZC.$document.off(data.uniqueNamespace),index=bindedElements.indexOf(element[0]),bindedElements.splice(index,1),closeHandlerDatas.splice(index,1),close&&element[data.ctype](data.closeFn)}}}(ZComponents),document.addEventListener("DOMContentLoaded",ZComponents._init),window.addEventListener("resize",ZComponents.setProperties);var ZPosition=function($,$window){function getCorrectionOffset(){var $body=$("body");if(correctionOffset)return correctionOffset;if(correctionOffset={left:0,top:0},/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var temp=$("<span>").css({position:"absolute",height:"20px",width:"20px",top:"0px",left:"0px"}).appendTo($body);correctionOffset=temp.offset(),correctionOffset.left=correctionOffset.left-parseFloat($body.css("margin-left"))-parseFloat($body.css("border-left-width")),correctionOffset.top=correctionOffset.top-parseFloat($body.css("margin-top"))-parseFloat($body.css("border-top-width")),temp.remove()}return correctionOffset}function getDimensions(element){if(element.preventDefault)return{width:0,height:0,offset:{left:element.pageX,top:element.pageY}};var element=$(element);if(9===element.nodeType)return{width:element.width(),height:element.height(),offset:{left:0,top:0}};if($.isWindow(element))return{width:element.width(),height:element.height(),offset:{left:element.scrollLeft(),top:element.scrollTop()}};var dimension={width:getDimension(element[0],"outerWidth"),height:getDimension(element[0],"outerHeight"),offset:getOffset(element)};return dimension}function getOffset(element){var offset=element.offset(),excessoffset=getCorrectionOffset();return offset.left-=excessoffset.left,offset.top-=excessoffset.top,offset}function fixDirection(direction){var dir=direction.split("-");if(/^(top|bottom)$/.test(dir[0])||/^corner$/.test(dir[2])){callout&&callout.callback.call(this,callout.element,calloutPositions[dir[0]]);var collisionWidth=elemDim.width+(callout?callout.width?callout.width:callout.element.outerWidth():0),collisionHeight=elemDim.height+(callout?callout.height?callout.height:callout.element.outerHeight():0),dirInfo=flip.top(direction,collisionHeight);if(direction=dirInfo.direction,dirInfo.overTop>0&&regex.flipall.test(options.positionAlterable)){var newDirInfo=flip.left("right",collisionWidth);newDirInfo.overLeft<=0&&(direction=newDirInfo.direction)}}if(dir=direction.split("-"),/^(left|right)$/.test(dir[0])||/^corner$/.test(dir[2])){callout&&callout.callback.call(this,callout.element,calloutPositions[dir[0]]);var collisionWidth=elemDim.width+(callout?callout.width?callout.width:callout.element.outerWidth():0),collisionHeight=elemDim.height+(callout?callout.height?callout.height:callout.element.outerHeight():0),dirInfo=flip.left(direction,collisionWidth);if(direction=dirInfo.direction,dirInfo.overLeft>0&&regex.flipall.test(options.positionAlterable)){var newDirInfo=flip.top("bottom",collisionHeight);direction=newDirInfo.direction}}return direction}function fixAlternateDirection(direction){var dir=direction.split("-"),calloutWidthLeft=0,calloutHeightLeft=0;if(target.preventDefault&&callout&&(calloutWidthLeft=2*callout.width+callout.width/2,calloutHeightLeft=2*callout.height+callout.height/2),/^(left|right)$/.test(dir[1])){var dirInfo=flip.left(dir[1],elemDim.width-("corner"===dir[0]?0:targetDim.width)-calloutHeightLeft);direction=direction.replace(dir[1],dirInfo.direction)}else if(/^(top|bottom)$/.test(dir[1])){var dirInfo=flip.top(dir[1],elemDim.height-targetDim.height-calloutWidthLeft);direction=direction.replace(dir[1],dirInfo.direction)}return direction}function initCallout(elementDir){if(options.arrow&&options.arrow.element){var callout={},element=options.arrow.element;if(("string"==typeof element||element.jquery||element.nodeType)&&(element=$(element),element.length&&(callout.element=element)),callout.element&&"static"!==callout.element.css("position"))return callout.centeredToTarget=/^(center|undefined)$/.test(options.arrow.direction)&&!target.preventDefault?!0:!1,callout.callback=$.isFunction(options.arrow.callback)?options.arrow.callback:$.isFunction(options.arrowCallback)?options.arrowCallback:$.noop,callout.direction=calloutPositions[elementDir],callout.callback.call(this,callout.element,callout.direction.split("-")[0]),callout.height="number"==typeof options.arrow.height?options.arrow.height:0,callout.width="number"==typeof options.arrow.height?options.arrow.width:0,callout.minSpace=options.arrow.minSpace,callout.margin=options.arrow.margin||{left:0,top:0},callout;options.arrow=void 0}}function getElementHeight(){return elemDim.height>getAvailableHeight(options.direction)?getAvailableHeight(options.direction):elemDim.height}function getElementWidth(){return elemDim.width>getAvailableWidth(options.direction)?getAvailableWidth(options.direction):elemDim.width}function fitCalloutPosition(callout,calloutP){var maxValue,dir=callout.direction.split("-"),tempDir=dir[1],minValue=0,elemWidth1=getElementWidth(),elemHeight1=getElementHeight();/^(left|right)$/.test(dir[1])?maxValue=elemWidth1-callout.width:/^(top|bottom)$/.test(dir[1])?maxValue=elemHeight1-callout.height:/^(top|bottom)$/.test(dir[0])?(maxValue=elemWidth1-callout.width,tempDir="left"):/^(left|right)$/.test(dir[0])&&(maxValue=elemHeight1-callout.height,tempDir="top"),calloutP[tempDir]>maxValue&&(calloutP[tempDir]=maxValue),calloutP[tempDir]<minValue&&(calloutP[tempDir]=minValue)}function getCalloutPosition(callout,correctionPixel){callout.element.css({left:"auto",top:"auto",right:"auto",bottom:"auto"});var pos={},dir=callout.direction.split("-");if(/^(top|bottom)$/.test(dir[0])?(pos[dir[0]]=-callout.height,dir[1]||(pos.left=elemDim.width/2-callout.width/2-correctionPixel.left)):/^(left|right)$/.test(dir[0])&&(pos[dir[0]]=-callout.width,dir[1]||(pos.top=elemDim.height/2-callout.height/2-correctionPixel.top)),/^(left|right)$/.test(dir[1])){var cPix=correctionPixel.left;"left"===dir[1]&&(cPix=-cPix),targetDim.width&&elemDim.width>targetDim.width?pos[dir[1]]=targetDim.width/2-callout.width/2+cPix:pos.left=elemDim.width/2-callout.width/2}else if(/^(top|bottom)$/.test(dir[1])){var cPix=correctionPixel.top;"top"===dir[1]&&(cPix=-cPix),targetDim.height&&elemDim.height>targetDim.height?pos[dir[1]]=targetDim.height/2-callout.height/2+cPix:pos.top=elemDim.height/2-callout.height/2}var doesHaveBoxShadow="none"!==element.css("box-shadow");return"top"===callout.direction.split("-")[0]?pos.top=pos.top+(parseFloat(element.css("border-top-width"))||doesHaveBoxShadow?1:0):"bottom"===callout.direction.split("-")[0]?pos.bottom=pos.bottom+(parseFloat(element.css("border-bottom-width"))||doesHaveBoxShadow?1:0):"right"===callout.direction.split("-")[0]?pos.right=pos.right+(parseFloat(element.css("border-right-width"))||doesHaveBoxShadow?1:0):"left"===callout.direction.split("-")[0]&&(pos.left=pos.left+(parseFloat(element.css("border-left-width"))||doesHaveBoxShadow?1:0)),pos}function fitPosition(position){var newPosition=$.extend({},position),direction=options.direction,dir=(elemDim.width+callout?callout.width:0,elemDim.height+callout?callout.height:0,direction.split("-"));dir[1]=void 0===dir[1]?/^(top|bottom)$/.test(dir[0])?"left":"top":dir[1];within.isWindow?{left:win.scrollLeft,top:win.scrollTop}:within.offset;if(/^(top|bottom)$/.test(dir[1])||target.preventDefault){var overTop=within.scrollTop-newPosition.top;overTop>0&&(newPosition.top+=overTop);var overBottom=newPosition.top+elemDim.height-(within.scrollTop+getAvailableHeight().complete);overBottom>0&&(newPosition.top-=overBottom)}if(/^(left|right)$/.test(dir[1])||target.preventDefault){var overLeft=within.scrollLeft-newPosition.left;overLeft>0&&(newPosition.left+=overLeft);var overRight=newPosition.left+elemDim.width-(within.scrollLeft+getAvailableWidth().complete)+1;overRight>0&&(newPosition.left-=overRight)}return newPosition}function calculatePosition(direction){var newPosition,position;options.direction=direction,/corner/.test(options.direction)||(callout=initCallout(options.direction)),options.callbacks.beforeComputingDir.dimensionModifier(targetDim,elemDim,within),regex.flip.test(options.positionAlterable)&&!recalculated&&(options.direction=fixDirection(options.direction)),callout&&(callout.direction=calloutPositions[options.direction],callout.callback.call(this,callout.element,callout.direction.split("-")[0]),callout.height||(callout.height=callout.element.outerHeight()),callout.width||(callout.width=callout.element.outerWidth())),regex.flipside.test(options.positionAlterable)&&(options.direction=fixAlternateDirection(options.direction)),options.callbacks.beforeComputingPos.dimensionModifier(targetDim,elemDim,within),position=fixPosition(options.direction),newPosition=$.extend({},position),regex.fit.test(options.positionAlterable)&&(newPosition=fitPosition(position)),newPosition.top<within.scrollTop&&(newPosition.top=within.scrollTop),newPosition.left<within.scrollLeft&&(newPosition.left=within.scrollLeft);var newdir;if(callout&&regex.flipall.test(options.positionAlterable)&&!recalculated&&!target.preventDefault){var CALLOUTMINSPACE=callout.minSpace;if(void 0!==CALLOUTMINSPACE){var minElemLeft,minElemTop,maxEleLeft,maxEleTop,dir=options.direction.split("-"),elemWidth1=getElementWidth(),elemHeight1=getElementHeight();minElemLeft=targetDim.offset.left-elemWidth1+callout.width,minElemTop=targetDim.offset.top-elemHeight1+callout.height,maxEleLeft=targetDim.offset.left+targetDim.width-callout.width,maxEleTop=targetDim.offset.top+targetDim.height-callout.height,/^(top|bottom)$/.test(dir[0])?(newPosition.left<minElemLeft&&(newdir="left"),newPosition.left>maxEleLeft&&(newdir="right")):/^(left|right)$/.test(dir[0])&&(newPosition.top<minElemTop&&(newdir="top"),newPosition.top>maxEleTop&&(newdir="bottom"))}}if(!newdir||recalculated){var correctedPosition=getCorrectedPosition(newPosition,element);if(callout){callout.direction=calloutPositions[options.direction];var correctionPixel={left:newPosition.left-position.left,top:newPosition.top-position.top};callout.position=getCalloutPosition(callout,correctionPixel),fitCalloutPosition(callout,callout.position)}}else recalculated=!0,correctedPosition=calculatePosition(newdir);return correctedPosition}function getAvailableHeight(direction){if(!availableHeight)if(within.isWindow||within.isDocument)availableHeight={top:targetDim.offset.top-within.scrollTop,bottom:within.height-(targetDim.offset.top+targetDim.height-within.scrollTop),complete:within.height};else{availableHeight={},availableHeight.top=within.offset.top<win.scrollTop?targetDim.offset.top-win.scrollTop:targetDim.offset.top-within.scrollTop,availableHeight.bottom=within.offset.top+within.height-(targetDim.offset.top+targetDim.height);var diffHeight=win.height+win.scrollTop-(within.offset.top+within.height);0>diffHeight&&(availableHeight.bottom+=diffHeight),availableHeight.complete=availableHeight.top+availableHeight.bottom+targetDim.height}return direction?(direction=direction.split("-")[0],"top"===direction?availableHeight.top:"bottom"===direction?availableHeight.bottom:availableHeight.complete):availableHeight}function getAvailableWidth(direction){if(!availableWidth)if(within.isWindow||within.isDocument)availableWidth={left:targetDim.offset.left-within.scrollLeft,right:within.width-(targetDim.offset.left+targetDim.width-within.scrollLeft),complete:within.width};else{availableWidth={},availableWidth.left=within.offset.left<win.scrollLeft?targetDim.offset.left-win.scrollLeft:targetDim.offset.left-within.scrollLeft,availableWidth.right=within.offset.left+within.width-(targetDim.offset.left+targetDim.width);var diffWidth=win.width+win.scrollLeft-(within.offset.left+within.width);0>diffWidth&&(availableWidth.right+=diffWidth),availableWidth.complete=availableWidth.left+availableWidth.right+targetDim.width}if(!direction)return availableWidth;var dir=direction.split("-"),finaldir="corner"===dir[2]?dir[1]:dir[0];return"left"===finaldir?availableWidth.left:"right"===finaldir?availableWidth.right:availableWidth.complete}function fixPosition(direction){direction=direction||options.direction,regex.relDirections.test(direction)||(options.direction=direction="top-left");var dir=direction.split("-"),basePosition=$.extend({},targetDim.offset);return"top"===dir[0]?basePosition.top-=elemDim.height+(callout?callout.height:0):"bottom"===dir[0]?basePosition.top+=targetDim.height+(callout?callout.height:0):"left"===dir[0]?basePosition.left-=elemDim.width+(callout?callout.width:0):"right"===dir[0]&&(basePosition.left+=targetDim.width+(callout?callout.width:0)),void 0===dir[1]?dir[0].match(/^left|right$/)?basePosition.top=basePosition.top-elemDim.height/2+targetDim.height/2:basePosition.left=basePosition.left-elemDim.width/2+targetDim.width/2:"top"===dir[1]?basePosition.top=basePosition.top+targetDim.height-elemDim.height:"left"===dir[1]?basePosition.left=basePosition.left-elemDim.width+("corner"===dir[2]?0:targetDim.width):"right"===dir[1]&&"corner"===dir[2]&&(basePosition.left=basePosition.left+targetDim.width),basePosition}function showHiddenParent(element){if(element=$(element),element.is(":hidden"))for(var i=1,parent=element;i&&parent&&!parent.is("body");)"none"===parent.css("display")&&(hiddenParents.push(parent),prevStyles.push(parent.attr("style")||""),parent.css({display:"block",position:"absolute",opacity:1,visibility:"hidden"}),i=parent.is(":hidden")),parent=parent.parent()}function resetParent(){hiddenParents&&hiddenParents.length&&(hiddenParents.forEach(function(parent,i){parent.attr("style",prevStyles[i])}),hiddenParents=[],prevStyles=[])}function getCorrectedPosition(calculatedOffset,element){var offsetNew=$.extend({},calculatedOffset),position=element.css("position"),parent=element.parent()[0],temp=$("<span>").css({position:position,height:"20px",width:"20px",top:"0px",left:"0px",transform:"none",margin:"0px",display:"",visibility:"hidden"});parent.appendChild(temp[0]);var curOffset=temp.offset();return parent.removeChild(temp[0]),offsetNew.top=offsetNew.top-curOffset.top,offsetNew.left=offsetNew.left-curOffset.left,offsetNew}function getScrollBarWidth(){var scrollEle=document.createElement("div"),styleProps="width:100px;height:100px;overflow:scroll;";document.querySelector("body").appendChild(scrollEle),scrollEle.style.cssText=styleProps;var scrollWidth=$(scrollEle).width()-scrollEle.scrollWidth;return document.querySelector("body").removeChild(scrollEle),scrollWidth||0}function getWithinDimensions(element){element=element.length?element:$window;var width,height,scrollEle,isWindow=$.isWindow(element[0]),isDocument=!!element[0]&&9===element[0].nodeType,offset=isWindow||isDocument?{left:0,top:0}:getOffset(element)||{left:0,top:0},scrollLeft=isWindow||isDocument?win.scrollLeft:offset.left<win.scrollLeft?win.scrollLeft:offset.left,scrollTop=isWindow||isDocument?win.scrollTop:offset.top<win.scrollTop?win.scrollTop:offset.top;if(isWindow?(width=win.width,height=win.height):isDocument?(width=document.documentElement.scrollWidth,height=document.documentElement.scrollHeight):(width=element.outerWidth(),height=element.outerHeight(),scrollEle=element),scrollEle){var scrollWidth,overflowX=scrollEle.css("overflow-x"),overflowY=scrollEle.css("overflow-y"),hasOverflowX="scroll"===overflowX||("auto"===overflowX||scrollEle.is("body")&&"visible"===overflowX)&&width<scrollEle[0].scrollWidth,hasOverflowY="scroll"===overflowY||("auto"===overflowY||scrollEle.is("body")&&"visible"===overflowY)&&height<scrollEle[0].scrollHeight;hasOverflowX&&(height-=void 0===scrollWidth?getScrollBarWidth():scrollWidth),hasOverflowY&&(width-=scrollWidth=getScrollBarWidth())}return{element:element,isWindow:isWindow,isDocument:isDocument,offset:offset,scrollLeft:scrollLeft,scrollTop:scrollTop,width:width,height:height}}function changeDirection(direction){return"top-left"===direction?direction="top-right":"bottom-left"===direction?direction="bottom-right":"top-right"===direction?direction="top-left":"bottom-right"===direction&&(direction="bottom-left"),direction}function getDimension(element,dimension){var value,isSVG,transform=window.getComputedStyle(element).transform;if(element instanceof SVGElement&&(isSVG=!0),isSVG||!transform||"none"===transform){var styles=element.getBoundingClientRect();if(styles)switch(dimension){case"outerWidth":value=styles.width;break;case"outerHeight":value=styles.height}}return(isNaN(value)||!value)&&(value=$(element)[dimension]()),value}function getPosition(targetElement,elementPositioned,opt){if(options=$.extend(!0,{},defaultOptions,opt),target=targetElement,element=elementPositioned,options.showWithinTarget)return getWithinTargetPosition();var oldDirection=options.direction;element.css({top:"0px",left:"0px"}),elemDim=options.computeElementDim?getDimensions(element):{};var elementHidden,actual_display;elemDim.height>document.documentElement.clientHeight&&regex.flip.test(options.positionAlterable)&&(elementHidden=!0,actual_display=element[0].style.display||"",element.css("display","none")),win={scrollLeft:$window.scrollLeft(),scrollTop:$window.scrollTop()+options.withinPadding,height:document.documentElement.clientHeight-2*options.withinPadding,width:document.documentElement.clientWidth},targetDim=options.customDimensions?target:options.computeTargetDim?getDimensions(target):{},within=options.computeWithinDim?getWithinDimensions($(options.within)):{},elementHidden&&element.css("display",actual_display),options.direction=regex.relDirections.test(options.direction)?changeDirection(options.direction):"top-right";var position=calculatePosition(options.direction),response={elementPosition:position||{left:0,top:0},oldDirection:oldDirection,direction:changeDirection(options.direction),arrowPosition:callout?callout.position:{left:0,top:0},arrowDirection:calloutPositions[options.direction]&&calloutPositions[options.direction].split("-")[0]},dir=options.direction.split("-");return/^(top|bottom)$/.test(dir[0])?(response.availableHeight=getAvailableHeight(dir[0])-(callout?callout.height:0),response.availableWidth=getAvailableWidth(dir[0])):/^(left|right)$/.test(dir[0])&&(response.availableHeight=getAvailableHeight(dir[0]),response.availableWidth=getAvailableWidth(dir[0])-(callout?callout.width:0)),response}function getWithinTargetPosition(){target=$(target);var isWindow,position={};target.length&&target[0]!==window&&9!==target[0].nodeType||(target=$(window),isWindow=!0),regex.withinDirections.test(options.direction)||(options.direction="top-left");var containerProps={width:target.outerWidth()-(isWindow?0:parseFloat(target.css("border-right-width"))+parseFloat(target.css("border-left-width"))),height:target.outerHeight()-(isWindow?0:parseFloat(target.css("border-top-width"))-parseFloat(target.css("border-bottom-width")))};containerProps.offset=isWindow?{left:window.scrollX,top:window.scrollY}:getOffset(target)||{left:0,top:0};var elementProps={width:element.outerWidth(),height:element.outerHeight()},centerDirections=["center","left","right","top","bottom"],directionPropertObj={left:"width",top:"height"};for(var dir in directionPropertObj){var oppDir="left"===dir?"right":"bottom",prop=directionPropertObj[dir];-1!==options.direction.indexOf(dir)?position[dir]=containerProps.offset[dir]:-1!==options.direction.indexOf(oppDir)?position[dir]=containerProps.offset[dir]+containerProps[prop]-elementProps[prop]:-1!==centerDirections.indexOf(options.direction)&&(position[dir]=containerProps.offset[dir]+containerProps[prop]/2-elementProps[prop]/2)}return position=getCorrectedPosition(position,element),{elementPosition:position}}var target,element,options,within,targetDim,elemDim,availableHeight,availableWidth,win,element,callout,recalculated,hiddenParents,prevStyles,correctionOffset,defaultOptions={direction:"top-left",showWithinTarget:!1,within:$window,computeElementDim:!0,computeTargetDim:!0,computeWithinDim:!0,arrow:{minSpace:0,margin:{left:0,top:0},callback:void 0},callbacks:{beforeComputingDir:{dimensionModifier:$.noop,directionModifier:$.noop},beforeComputingPos:{dimensionModifier:$.noop,directionModifier:$.noop}},withinPadding:0,customDimensions:!1,positionAlterable:"flipallfit"},calloutPositions={"top-left":"bottom-right","top-right":"bottom-left","bottom-left":"top-right","bottom-right":"top-left",top:"bottom",bottom:"top",left:"right",right:"left","left-top":"right-bottom","left-bottom":"right-top","right-top":"left-bottom","right-bottom":"left-top"},regex={relDirections:/^(top|top-right|top-left|bottom|bottom-right|bottom-left|left|left-top|left-bottom|right|right-top|right-bottom|top-left-corner|top-right-corner|bottom-left-corner|bottom-right-corner)$/,withinDirections:/^(top|bottom|left|right|top-left|top-right|bottom-left|bottom-right|center)$/,fit:/^(fit|flipfit|flipallfit|flipsidefit|flipsideallfit|true)$/,flip:/^(flip|flipfit|flipall|flipallfit|flipside|flipsidefit|flipsideall|flipsideallfit|true)$/,flipside:/^(flipside|flipsidefit|flipsideall|flipsideallfit|true)$/,flipall:/^(flipall|flipallfit|flipsideall|flipsideallfit|true)$/},flip={top:function(direction,collisionHeight){var dir=direction.split("-")[0],response={direction:direction},availHeight=getAvailableHeight(direction);if(response.overTop=collisionHeight-availHeight,response.overTop>0){var newdir="top"===dir?"bottom":"top",newAvailableHeight=getAvailableHeight(direction.replace(dir,newdir));newAvailableHeight>availHeight&&(response.direction=direction.replace(dir,newdir),response.overTop=collisionHeight-newAvailableHeight)}return response},left:function(direction,collisionWidth){var finalDir,newdir,dir=direction.split("-"),response={direction:direction},availWidth=getAvailableWidth(direction);if(response.overLeft=collisionWidth-availWidth,response.overLeft>0){finalDir=dir[0],"corner"===dir[2]&&(finalDir=dir[1]),newdir="left"===finalDir?"right":"left";var newAvailableWidth=getAvailableWidth(direction.replace(finalDir,newdir));newAvailableWidth>availWidth&&(response.direction=direction.replace(finalDir,newdir),response.overLeft=collisionWidth-newAvailableWidth)}return response}};return{get:function(targetElement,elementPositioned,opt){if(targetElement&&$(elementPositioned).length&&(targetElement instanceof $&&(targetElement=targetElement[0]),elementPositioned instanceof $&&(elementPositioned=elementPositioned[0]),1===elementPositioned.nodeType&&(1===targetElement.nodeType||opt.showWithinTarget&&(targetElement===window||targetElement===document)||targetElement.preventDefault||opt.customDimensions))){hiddenParents=[],prevStyles=[],showHiddenParent(targetElement),showHiddenParent(elementPositioned),opt=opt||{};var positionObject=getPosition(targetElement,$(elementPositioned),opt);return resetParent(),target=element=recalculated=callout=options=within=elemDim=availableHeight=availableWidth=win=correctionOffset=hiddenParents=prevStyles=void 0,positionObject}}}}(jQuery,jQuery(window),jQuery(document));!function(ZC){function menuScrollWidth(){var scrollEle=document.createElement("div");return ZM_DOM._iconDiv=scrollEle.cloneNode(),ZM_DOM._iconDiv.className="zmenu__iconcontainer",ZM_DOM._icon=document.createElement("i"),document.querySelector("body").appendChild(scrollEle),scrollEle.style.cssText="width:50px;height:50px;overflow:scroll;",menuPrototype._scrollWidth=$(scrollEle).width()-scrollEle.scrollWidth,$(scrollEle).remove(),ZM_DOM._text=document.createElement("span"),ZM_DOM._hint=ZM_DOM._text.cloneNode(),ZM_DOM._key=ZM_DOM._text.cloneNode(),ZM_DOM._text.className="zmenu__text",ZM_DOM._hint.className="zmenu__hint",ZM_DOM._key.className="zmenu__shortcut",menuPrototype._scrollWidth}var $=ZC.DOMUtil,menuItemTemplate=ZC.getTemplate("zmenu.hbs"),menuItemJsonTemplate=ZC.getTemplate("zmenujson.hbs"),hasHandlebars=!1;!ZC.Browser.isIE()&&menuItemTemplate&&menuItemJsonTemplate&&(Handlebars.partials=Handlebars.templates,hasHandlebars=!0);var menuPrototype={options:{displayType:"box",direction:"auto",type:"list",toggle:!0,contentType:"text",renderInPlace:!1,columnCount:void 0,columns:3,search:!1,forElement:void 0,width:void 0,height:void 0,menuClass:"",className:"",animation:void 0,pointer:!1,checkedRadioItemIconClassName:void 0,checkedRadioItemSVGIconId:void 0,checkedCheckboxItemIconClassName:void 0,checkedCheckboxItemSVGIconId:void 0,isCustomHTMLEncoded:!0,htmlSafe:!0,offset:void 0,scroll:"slider",constructMenu:!0,EFFECTS:{slide:{open:"slideDown",close:"slideUp"},fade:{open:"fadeIn",close:"fadeOut"}},minWidth:200,handleAccessKeyNavigation:!0},ANIMATION_EVENTS:"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend webkitTransitionEnd msTransitionEnd oTransitionEnd transitionEnd transitionend",ARIA_ROLES:{"default":"menuitem",custom:"menuitem",radio:"menuitemradio",checkbox:"menuitemcheckbox",itemgroup:"group",separator:"separator"},EFFECTS:{slide:{open:"slideDown",close:"slideUp"},fade:{open:"fadeIn",close:"fadeOut"}},_MENU_CONTENT_TYPES:{text:"",icon:"zmenu--icononly","icon-text":"zmenu--iconwithtext"},_MENU_ITEM_TYPES:{"default":"zmenu__item",separator:"zmenu__separator",splitmenu:"zmenu__item zmenu--split",itemgroup:"zmenu__title"},_DIRECTIONS:{menu:"bottom-left",submenu:"right-bottom",pointer:"bottom"},_attrNames:["id","name","data-item-type","disabled","checked","hidden","data-fixed","data-is-footer","data-item-value","data-label","data-icon","data-icon-class-name","data-svg-icon-id","data-text-as-icon","data-shortcutkey","data-shortcut-key","data-hint","data-description","data-menu-id"],_EVENTS:{ONBEFORESHOW:"beforeshow",ONBEFOREHIDE:"beforehide",ONSHOW:"show",ONHIDE:"hide",ONSUBMENUMENUITEMCLICKED:"submenuitemclick",ONBEFORESUBMENUSHOW:"beforesubmenushow",ONSUBMENUSHOW:"submenushow",ONBEFORESUBMENUHIDE:"beforesubmenuhide",ONSUBMENUHIDE:"submenuhide",ONMENUITEMHOVERED:"itemhover",ONMENUITEMCLICKED:"itemclick",ONBEFOREFOCUS:"beforefocus",ONKEYDOWN:"keydown"},_lastOverlayedMenuItem:void 0,_lastOverlayedMenu:void 0,_create:function(element,options){this.scrollWidth=void 0===menuPrototype._scrollWidth?menuScrollWidth():menuPrototype._scrollWidth,this.options.appendTo=void 0!==options.appendTo&&options.appendTo.length?$(options.appendTo):void 0,options.usingJSON||this._buildMenu(element),"DIV"===this.element[0].tagName&&element.find("ul:first").addClass("zmenu__list"),element[0].setAttribute("role","menu"),this._initEvents(),this._menuTextArray=[],options.search&&this._createSearchContainer(element),options.renderInPlace?(this._resetMenuTextArray(element),this.show()):element[0].style.display="none",element.data("toggle",options.toggle),element[0].setAttribute("tabindex",0),element[0].style.outline=0,options.height&&element.data("height",options.height),options.width&&element.data("width",options.width),ZC.isRTL&&(this._DIRECTIONS.submenu="left-bottom")},_buildMenu:function(menu){var items=menu[0].querySelectorAll("li");if(this.options.constructMenu){for(var i=0;i<items.length;i++)this._buildMenuItem($(items[i]),menu);menu[0].className+=" zmenu "+("grid"===this.options.type?"zmenu--thumbnail":this._MENU_CONTENT_TYPES[this.options.contentType])+" "+(this.options.menuClass?this.options.menuClass:"")+" "+(this.options.className?this.options.className:"")}else for(var i=0;i<items.length;i++)this._handleCheckedandDisabled($(items[i]),this.getData(items[i])),this._addEventsForMenuItems($(items[i]))},_createSearchContainer:function(menu){var header=$("<div class='zmenu__header'></div>"),textBox=$("<input type='text' class='zmenu__textbox' placeholder='Search' />"),searchIcon=$("<i class='zmenu__icon'></i>"),svgEle=ZC.createSVGElement("svg",{"class":"zmenu__search",viewBox:"0 0 16 16",width:"100%",height:"100%"},[{path:{d:"M15.6,15.6c-0.6,0.6-1.5,0.6-2.1,0l-2.7-2.7C9.7,13.6,8.4,14,7,14c-3.9,0-7-3.1-7-7s3.1-7,7-7c3.9,0,7,3.1,7,7c0,1.4-0.4,2.7-1.1,3.8l2.7,2.7C16.1,14,16.1,15,15.6,15.6z M7,2C4.2,2,2,4.2,2,7s2.2,5,5,5c2.8,0,5-2.2,5-5C12,4.2,9.8,2,7,2z"}}]);searchIcon[0].appendChild(svgEle),header.append(textBox,searchIcon),this.element.prepend(header),menu.data("_styleElement",$("<style id='zmenu-search-filter' type='text/css'>").appendTo("head")),textBox.on("keydown."+this.componentName,function(event){event.keyCode===ZC.keyCode.TAB&&event.preventDefault()})},_buildMenuItem:function(menuItem,menu){var data=this.getData(menuItem),hasSubmenu=data.menuId||(menuItem[0].firstElementChild&&"object"==typeof menuItem[0].firstElementChild&&menuItem[0].firstElementChild.tagName?"UL"===menuItem[0].firstElementChild.tagName:!1),itemClass=data.className?data.className:data.itemCssClass?data.itemCssClass:"";if(data.isGrid="grid"===this.options.type,menuItem[0].className+=" "+(this._MENU_ITEM_TYPES[data.itemType]?this._MENU_ITEM_TYPES[data.itemType]:"zmenu__item")+" "+itemClass,data.parentMenu=menuItem.parent(),data.disabled=void 0!==data.disabled?data.disabled:null!=menuItem[0].getAttribute("disabled"),data.hidden=void 0!==data.hidden?data.hidden:null!=menuItem[0].getAttribute("hidden"),data.checked=void 0!==data.checked?data.checked:null!=menuItem[0].getAttribute("checked"),hasSubmenu&&(data.hasSubmenu=!0,this._buildSubmenu(menuItem,data)),menuItem[0].setAttribute("role",this.ARIA_ROLES[data.itemType?data.itemType:"default"]),"separator"===data.itemType)return void this._handleCheckedandDisabled(menuItem,data);if("custom"===data.itemType||data.custom){if(menuItem[0].className+=" zmenu__custom",data.innerHTML){var content=data.innerHTML.content,replaceArray=data.innerHTML.replaceArray;if(content&&replaceArray){for(var i=0;i<replaceArray.length;i++)content=content.replace("{"+i+"}",ZC.encodeHTML(replaceArray[i]));menuItem.html(content)}else menuItem.html(this.options.isCustomHTMLEncoded||this.options.htmlSafe?data.innerHTML:ZC.encodeHTML(data.innerHTML))}return data.hasSubmenu&&this._createArrowIcon(menuItem),this._handleCheckedandDisabled(menuItem,data),this._addEventsForMenuItems(menuItem)}data.label=data.label?data.label:menuItem.text().trim(),data.label=data.ellipsis?data.label+"...":data.label;var shortcutkey=data.shortcutkey||data.shortcutKey;data.shortcutkey=window.ZShortCut?ZShortCut.getInfo(data.actionName,menuItem,!0):shortcutkey,menuItem[0].innerHTML="";var actualItem=menuItem;if(data.action&&"string"==typeof data.action&&-1!==data.action.indexOf("URL:")&&(data.target=data.target?data.target:"_blank",menuItem.addClass("zmenu--withlink").append("<a class='zmenu__link' href='"+data.action.replace("URL:","")+"' target='"+data.target+"'>"),actualItem=menuItem.find(".zmenu__link")),hasHandlebars)data.icon=data.SVGIconId?"#"+data.SVGIconId:data.iconClassName?data.iconClassName:data.icon,data.icon&&-1!==data.icon.indexOf("#")&&(data.svgId=data.icon.split(" ")[0],data.svgClass=data.icon.slice(data.svgId.length).trim()),"itemgroup"!==data.itemType&&(data["icon"===this.options.contentType?"icon-only":this.options.contentType]=this.options.contentType),actualItem.append(menuItemTemplate(data));else{if("text"!==this.options.contentType)if("itemgroup"!==data.itemType){var isThumbnail=data.isGrid,iconContainer=isThumbnail?void 0:ZM_DOM._iconDiv.cloneNode(),iconEle=ZM_DOM._icon.cloneNode();iconEle.className=isThumbnail?"zmenu__image ":"zmenu__icon ",this._handleIcon($(iconEle),void 0,void 0,data.iconClassName,data.SVGIconId,data.icon),!isThumbnail&&iconContainer.appendChild(iconEle),actualItem[0].appendChild(isThumbnail?iconEle:iconContainer)}else"icon"===this.options.contentType&&this._domUpdate(ZM_DOM._text,data.label,actualItem);"icon"!==this.options.contentType&&(this._domUpdate(ZM_DOM._text,data.label,actualItem),data.hint||data.description?this._domUpdate(ZM_DOM._hint,data.hint?data.hint:data.description,actualItem):data.shortcutkey&&this._domUpdate(ZM_DOM._key,data.shortcutkey,actualItem)),data.hasSubmenu&&this._createArrowIcon(actualItem)}data.icon&&0===data.icon.indexOf("text:")&&"text"!==this.options.contentType&&menuItem.find("i:first").removeClass(data.icon).text(data.icon.replace("text:","")),(data.fixed||data.isFooter)&&this._addFixedItem(menuItem,menu,data),menuItem[0].setAttribute("data-item-type",data.itemType),"icon"!==this.options.contentType&&menuItem[0].setAttribute("data-label",data.label),this._handleCheckedandDisabled(menuItem,data),this._addEventsForMenuItems(menuItem,data)},_domUpdate:function(node,text,item){var itemText=node.cloneNode();item[0].appendChild(itemText),itemText.textContent=text},_createArrowIcon:function(menuItem){var iconEle=$("<i class='zmenu__icon h-alignright'/>"),svgData={props:{"class":"zmenu__arrow",viewBox:"0 0 16 16",width:"100%",height:"100%"},nodes:[{polygon:{points:"6.5,12.5 5.5,11.5 9,8 5.5,4.5 6.5,3.5 11,8"}}]};return this._handleIcon(iconEle,svgData,"arrow",this.options.arrowIconClassName,this.options.arrowSVGIconId),menuItem.append(iconEle),iconEle},_addFixedItem:function(menuItem,menu,data){if(data.label&&"icon"===this.options.contentType&&"grid"===this.options.type&&!menuItem.find(".zmenu__text").length&&menuItem.append($("<span class='zmenu__text'>"+data.label+"</span>")),menu.find(".zmenu__footer").length)menu.find(".zmenu__footer ul").append(menuItem);else{var fixedArea=$("<div class='zmenu__footer'><ul class='zmenu__list'></ul></div>");menu.append(fixedArea),fixedArea.find("ul").append(menuItem.addClass("is-fixed")),menu.data("fixedArea",fixedArea.find("ul"))}},_buildSubmenu:function(menuItem,data){var menu=this.getSubmenu(menuItem);if(menu&&(menuItem.addClass(data.splitmenu||"splitmenu"===data.itemType?"zmenu--split":"zmenu--submenu"),menuItem.data("submenu",menu),!data.menuId)){var menuData=this.getData(menu);$(menuData.appendTo?menuData.appendTo:"body").append(menu),this.getData(menuItem).menuId=menu.attr("id"),menu.zmenu()}},getSubmenu:function(menuItem){if(menuItem.data("submenu"))return menuItem.data("submenu");var submenu=this.getData(menuItem).menuId;return submenu?(submenu=$("#"+submenu),submenu.length?(submenu.data("zmenu")||submenu.zmenu(),submenu.data("isExternalSubmenu",!0),submenu):void 0):menuItem.children("ul:first")},_handleCheckedandDisabled:function(menuItem,data,optionName){var fromSetAttribute=void 0!==optionName;(fromSetAttribute?"hidden"===optionName:void 0!==data.hidden)&&this._hideMenuItem(menuItem,!data.hidden),(fromSetAttribute?"disabled"===optionName:void 0!==data.disabled)&&(menuItem[data.disabled?"addClass":"removeClass"]("is-disabled"),menuItem.attr("aria-disabled",data.disabled),data.disabled?menuItem.attr("disabled",!0):menuItem.removeAttr("disabled"));var condition=fromSetAttribute?"checked"===optionName:!0;!condition||"text"===this.options.contentType||void 0===data.checked||"checkbox"!==data.itemType&&"radio"!==data.itemType||this._checkMenuItem(menuItem,data.checked,data)},_initEvents:function(menu){var base=this,componentName=this.componentName;menu=$(menu?menu:this.element),menu.data("initialized")&&!menu||menu.data("isExternalSubmenu")||(menu.data("initialized",!0),menu.on("mouseup."+componentName,function(event){(3!==event.which||$(event.target).closest(".zmenu--withlink").length)&&base._handleMenuItemClick(event,menu)}).on("contextmenu."+componentName,function(event){var item=$(event.target).closest(".zmenu__item");item.length&&item.hasClass("zmenu--withlink")&&event.stopPropagation()}))},_handleMenuItemClick:function(event,menu){menu=menu||this.element;var menuItem=$(event.target);if(menuItem.is("li")||(menuItem=menuItem.closest("li")),menuItem&&0!==menuItem.length&&!menuItem.hasClass("separator")&&!menuItem.hasClass("zmenu__title")){var data=this.getData(menuItem),hasSubmenu=menuItem.data("submenu")&&menuItem.data("submenu").length&&!menuItem.hasClass("zmenu--split")?!0:!1;if(!data.disabled){if(hasSubmenu&&"click"===data.openOn){var submenu=this.getSubmenu(menuItem),base=this;submenu.is(":visible")?this.hide(submenu,function(){submenu.data("forElement")[0]!==menuItem[0]&&base._showSubmenu(menuItem,{event:event},!1,event)}):(this._checkAndHideAllOpenedSubMenus(menu,!0),this._showSubmenu(menuItem,{event:event},!0,event)),event.preventDefault(),event.stopPropagation()}var click=data.action;void 0!==click&&("function"!=typeof click&&"string"==typeof click&&-1===click.indexOf("URL:")?this._triggerFunction(click,menuItem,[event,{menuitem:menuItem,options:data}]):"function"==typeof click&&click.call(menuItem,event,{menuitem:menuItem,options:data})),this._triggerEvent("beforeitemchecked",event,menu,menuItem,{})&&("checkbox"===data.itemType||"radio"===data.itemType)&&this._checkMenuItem(menuItem,"checkbox"===data.itemType?!menuItem.prop("checked"):!0,data),this._triggerEvent(void 0!==menu.data("parent")?"ONSUBMENUMENUITEMCLICKED":"ONMENUITEMCLICKED",event,menu,menuItem,{})&&(this.options.renderInPlace||(!hasSubmenu&&this.hide(void 0,void 0,event),menuItem&&!menuItem.is(".zmenu--withlink")&&event&&event.preventDefault&&(event.stopImmediatePropagation(),event.preventDefault(),event.stopPropagation())))}}},show:function(options,menu){options=options?options:{};var appendedTo=$(this.options.appendTo),isSubMenu=options.isSubMenu=menu?!0:!1,menu=menu?menu:this.element,forElement=$(options.forElement?options.forElement:this.options.forElement),isFloating=this._isGridMenu(menu),offsetValue=options.offset?options.offset:this.options.offset?this.options.offset:void 0;if(this._uninitSliders(menu),isSubMenu||(this.options.forElement=options.forElement=forElement),menu.is(":visible")&&!options.mustBeShown)return void(this.options.toggle&&!isSubMenu&&this.hide());if(isSubMenu?menu.data({forElement:forElement,parent:forElement}):(this.options.handleAccessKeyNavigation&&this._initRuntimeEvents(),this.element.data("forElement",forElement)),this.options.renderInPlace&&!isSubMenu||options.mustBeShown||(void 0!==appendedTo&&appendedTo.length?appendedTo.append(menu):$("body").append(menu)),options.within=this.options.viewport&&$(this.options.viewport).length?$(this.options.viewport):appendedTo,this.updateLastMenuChain(menu),menu.data("modified")&&(menu.find("#noresultFound").remove(),menu.data("_styleElement").empty()),isFloating||this.options.renderInPlace||menu.addClass("zmenu__width"),this.options.renderInPlace)menu.css({width:"inherit",height:"inherit",position:"relative"}),this._openWithAnimation(menu,options,originalEvent);else{ZC.bindDocumentEvents&&ZC.bindDocumentEvents({element:menu,forElement:options.isRightClick?void 0:forElement,ctype:this.componentName,closeMethodName:"hide",closeEvent:"hide"});var originalEvent=options.event?options.event:{};if(options.isRightClick=options.isRightClick?options.isRightClick:options.direction?"after-pointer"===options.direction||"at-cursor"===options.direction:"after-pointer"===this.options.direction||"at-cursor"===this.options.direction,!this._triggerEvent(isSubMenu?"ONBEFORESUBMENUSHOW":"ONBEFORESHOW",originalEvent,menu,void 0,{currentTarget:options.isRightClick?originalEvent.target:forElement}))return;var base=this;if(menu.css({display:"block",opacity:"0"}),this._setFocus(),menu.data("width")){var menuWidth=parseInt(menu.outerWidth(!0)),optionWidth=parseInt(menu.data("width"));if(menuWidth>optionWidth){var maxWidth=menu.find("li").map(function(index,item){return $(item).find(".zmenu__shortcut").length?parseInt($(item).find(".zmenu__shortcut").outerWidth(!0)):0});maxWidth=Math.max.apply(null,maxWidth),maxWidth&&menu.find("li:not(li.zmenu__title) .zmenu__text").css("width","calc(100% - "+maxWidth+"px)")}menu.removeClass("zmenu__width"),menu.width(optionWidth)}else menu.outerWidth()<parseInt(this.options.minWidth)&&"icon"!==menu.data("zmenu").options.contentType&&(menu.removeClass("zmenu__width"),menu.width("border-box"===menu.css("box-sizing")?parseInt(this.options.minWidth)-parseInt(menu.css("border-left-width"))-parseInt(menu.css("border-right-width"))-1:parseInt(this.options.minWidth)-1));var hasScroll=!1;if(isFloating&&this._fixFloatingMenuWidth(menu),menu.css("height","auto"),menu.find("ul").length&&menu.find("ul").css("height","auto"),menu.data("height")<=menu.outerHeight()&&(menu.outerHeight(parseInt(menu.data("height"))),hasScroll=!0),menu.removeClass("zmenu__width"),!isFloating){var mwidth=menu.innerWidth()+1+(hasScroll?this.scrollWidth:0);menu.width(mwidth)}if(this.refresh(menu),options&&!options.position){if(options.direction=options.direction?"auto"===options.direction||options.isRightClick?this.options.pointer||"callout"===this.options.displayType?this._DIRECTIONS.pointer:this._DIRECTIONS.menu:options.direction:isSubMenu?this._DIRECTIONS.submenu:"auto"===this.options.direction||options.isRightClick?this.options.pointer||"callout"===this.options.displayType?this._DIRECTIONS.pointer:this._DIRECTIONS.menu:this.options.direction,options.eventObj=options.event,options.positionAlterable=options.positionAlterable||this.options.positionAlterable,options.positionAlterable=void 0!==options.positionAlterable?options.positionAlterable:isSubMenu?"flipfit":"auto"===this.options.direction||"after-pointer"===this.options.direction||"at-cursor"===this.options.direction,options.positionAlterable="after-pointer"!==this.options.direction&&"at-cursor"!==this.options.direction&&!options.isRightClick||isSubMenu?options.positionAlterable:"fit","object"!=typeof options.position){if((this.options.pointer||"callout"===this.options.displayType)&&!isSubMenu){this._createPointerElement();var base=this;options.arrowCallback=function(element,direction){base._arrowDirection=direction,element.removeClass("h-top h-bottom h-right h-left").addClass("h-"+direction)}}menu.data("isRightClick",options.isRightClick),options.withinPadding=8;var pos=ZPosition.get(options.isRightClick&&!isSubMenu?options.event:forElement,menu,$.extend({},{arrow:{element:isSubMenu?null:this._pointerElement,callback:options.arrowCallback}},options),this._pointerElement?this._pointerElement:void 0);if(options.availableHeight=pos.availableHeight,options.position=pos.elementPosition,options.position.direction=pos.direction,menu.data("direction",pos.direction),this._pointerElement&&!isSubMenu)offsetValue&&(pos.arrowDirection.match(/^top|bottom$/)?pos.arrowPosition.left=pos.arrowPosition.left-offsetValue.left:pos.arrowPosition.top=pos.arrowPosition.top-offsetValue.top),this._pointerElement.css(pos.arrowPosition);else if(!this._pointerElement&&!offsetValue)if(menu.removeClass("zmenu--bottomleft zmenu--bottomright zmenu--topleft zmenu--topright zmenu--top zmenu--bottom zmenu--left zmenu--right"),isSubMenu)"right-top"===pos.direction?(menu.addClass("zmenu--bottomleft"),options.position.left=options.position.left-1):"right-bottom"===pos.direction?(menu.addClass("zmenu--topleft"),options.position.left=options.position.left-1):"left-top"===pos.direction?(menu.addClass("zmenu--bottomright"),options.position.left=options.position.left+1):"left-bottom"===pos.direction&&(menu.addClass("zmenu--topright"),options.position.left=options.position.left+1);else{var topLeft=forElement.length?parseInt(forElement.css("border-top-left-radius")):0,topRight=forElement.length?parseInt(forElement.css("border-top-right-radius")):0,bottomLeft=forElement.length?parseInt(forElement.css("border-bottom-left-radius")):0,bottomRight=forElement.length?parseInt(forElement.css("border-bottom-right-radius")):0;5>=topLeft&&5>=topRight&&5>=bottomLeft&&5>=bottomRight?options.isRightClick?menu.removeClass("zmenu--bottomleft zmenu--bottomright zmenu--topleft zmenu--topright zmenu--top zmenu--bottom zmenu--left zmenu--right"):0===pos.direction.indexOf("bottom")?("bottom-right"===pos.direction?forElement.outerWidth(!0)<menu.width()?(menu.addClass("zmenu--topright"),forElement.css({"border-bottom-left-radius":"0px","border-bottom-right-radius":"0px"})):(menu.addClass("zmenu--top"),forElement.css({"border-bottom-right-radius":"0px"})):"bottom-left"===pos.direction&&(forElement.outerWidth(!0)<menu.width()?(menu.addClass("zmenu--topleft"),forElement.css({"border-bottom-left-radius":"0px","border-bottom-right-radius":"0px"})):(menu.addClass("zmenu--top"),forElement.css({"border-bottom-left-radius":"0px"}))),options.position.top=options.position.top-1):0===pos.direction.indexOf("top")?("top-right"===pos.direction?forElement.outerWidth(!0)<menu.width()?(menu.addClass("zmenu--bottomright"),forElement.css({"border-top-left-radius":"0px","border-top-right-radius":"0px"})):(menu.addClass("zmenu--bottom"),forElement.css({"border-top-right-radius":"0px"})):"top-left"===pos.direction&&(forElement.outerWidth(!0)<menu.width()?(menu.addClass("zmenu--bottomleft"),forElement.css({"border-top-left-radius":"0px","border-top-right-radius":"0px"})):(menu.addClass("zmenu--bottom"),forElement.css({"border-top-left-radius":"0px"}))),options.position.top=options.position.top+1):0===pos.direction.indexOf("left")?(menu.addClass("zmenu--right"),forElement.css({"border-top-left-radius":"0px","border-bottom-left-radius":"0px"})):0===pos.direction.indexOf("right")&&(menu.addClass("zmenu--left"),forElement.css({"border-top-right-radius":"0px","border-bottom-right-radius":"0px"})):options.position.top=options.position.top+2}}if(menu.find(".zmenu__textbox").length){menu.data("initialDirection",options.position.direction);var searchDiv=menu.find(".zmenu__search").parent();if(options.position.top<$(forElement).position().top){menu.append(searchDiv.addClass("zmenu__footer").removeClass("zmenu__header"));var pos=ZPosition.get(options.isRightClick&&!isSubMenu?options.event:forElement,menu,options,this._pointerElement?this._pointerElement:void 0);options.position=pos.elementPosition,options.position.top=options.position.top+1}else menu.prepend(searchDiv.addClass("zmenu__header").removeClass("zmenu__footer"))}offsetValue&&(options.position.top=options.position.top+(parseInt(offsetValue.top)||0),options.position.left=options.position.left+(parseInt(offsetValue.left)||0))}options.position&&(options.isRightClick&&(options.position.top=options.position.top+2,options.position.left=options.position.left+2),menu.css(options.position)),this._fixMenuUI(menu,options,isSubMenu),0===menu.find("ul:first .zmenu__item").length&&menu.find(".zmenu__footer").length&&menu.find(".zmenu__footer").css("border-top","0px"),menu.css({display:"block",opacity:""}),this._pointerElement&&this._pointerElement.hide(),this._openWithAnimation(menu,options,originalEvent)}isSubMenu||(ZC.currentMenu&&ZC.currentMenu.get(0)!=menu.get(0)&&(ZC.prevMenu=ZC.currentMenu),ZC.currentMenu=menu)},_openWithAnimation:function(menu,options,originalEvent){var animationObject=this.options.animation;if(options.isSubMenu&&(animationObject=menu.data("zmenu").options.animation),animationObject||options&&options.animation){var base=this,animation=animationObject?animationObject.open:options.animation.open,animationClass=animation.className,effect=animation.name,duration=animation.duration?animation.duration:0,completeFunction=function(){base._handleMenuOpen(menu,options,originalEvent)};animationClass?(this._pointerElement&&this._pointerElement.show().addClass(animationClass),menu.show().addClass(animationClass).on(this.ANIMATION_EVENTS,function(){menu.removeClass(animationClass),completeFunction&&completeFunction(),completeFunction=void 0,menu.off(base.ANIMATION_EVENTS)})):"object"==typeof effect?(this._pointerElement&&this._pointerElement.show().animate(effect,duration,completeFunction),menu.show().animate(effect,duration,completeFunction)):this.options.EFFECTS[effect]&&(this._pointerElement&&this._pointerElement[this.options.EFFECTS[effect].open](duration,completeFunction),menu[this.options.EFFECTS[effect].open](duration,completeFunction))}else menu.show(),this._pointerElement&&this._pointerElement.show(),this._handleMenuOpen(menu,options,originalEvent)},_handleMenuOpen:function(menu,options,originalEvent){this._resetMenuTextArray(menu),!this.options.renderInPlace&&this._triggerEvent(options.isSubMenu?"ONSUBMENUSHOW":"ONSHOW",originalEvent,menu,void 0,{forElement:options.forElement})},_createPointerElement:function(){return this._pointerElement?this._pointerElement.removeAttr("class").addClass("zmenu__pointer"):(this._pointerElement=$("<div class='zmenu__pointer' />"),void this.element.prepend(this._pointerElement))},_isGridMenu:function(menuOrMenuItem,isMenuItem){var menu=isMenuItem?menuOrMenuItem.closest(".zmenu"):menuOrMenuItem?menuOrMenuItem:this.element;if(menu.length){var type=this.getMenuType(menu);return this._isTypeFloating(type,menu)}},_addEventsForMenuItems:function(menuItem){var base=this,metaData=this.getData(base.element);menuItem.hover(function(event,data){event.data=data;var isdirect=base._isDirectEvent(event),mouseOverFunc=function(){base._handleMouseOverOnMenuItems(menuItem,event,void 0,!0)};base._clearMouseHoverTimeout(),isdirect&&base._isToBeDelayed(event)?metaData.mouseOverTimeout=setTimeout(mouseOverFunc,300):mouseOverFunc()},function(event,data){event.data=data;var isdirect=base._isDirectEvent(event),mouseOutFunc=function(){base._handleMouseOutOnMenuItems(menuItem,event)};isdirect&&(menuItem.data("submenu")||metaData.mouseOverTimeout)?metaData.mouseOutTimeout=setTimeout(mouseOutFunc,300):mouseOutFunc()})},hide:function(menu,callback,event){if(!this.options.renderInPlace){var isSubMenu=menu&&menu.length||this.element.data("parent")&&$(this.element.data("parent")).is(".zmenu__item")&&!event?!0:!1;if(menu=menu?$(menu):this.element,!menu.is(":hidden")){var result=this._triggerEvent(isSubMenu?"ONBEFORESUBMENUHIDE":"ONBEFOREHIDE",event,menu);result&&(isSubMenu||(this._hideAllSubMenus(menu),this._destroyRuntimeEvents()),$("li.on-hover",menu).each(function(i,menuItem){$(menuItem).is(".zmenu--split")&&$(menuItem).find(".zmenu__icon.h-alignright").removeClass("on-hover"),$(menuItem).removeClass("on-hover")}),menu.get(0)!==this.element.get(0)?this.updateLastMenuChain(menu.data("parent").parent()):this._lastOverlayedMenuItem=void 0,this._uninitSliders(menu),this._closeWithAnimation(menu,isSubMenu,callback,event))}}},_closeWithAnimation:function(menu,isSubMenu,callback,event){var animation=this.options.animation;if(isSubMenu&&(animation=menu.data("zmenu").options.animation),animation&&animation.close){animation=animation.close;var base=this,animationClass=animation.className,effect=animation.name,duration=animation.duration?animation.duration:0,completeFunction=function(){base._handleMenuClose(menu,isSubMenu,callback,event)};if(animationClass)menu.addClass(animationClass).on(this.ANIMATION_EVENTS,function(){menu.removeClass(animationClass),menu.hide(),completeFunction&&completeFunction(),completeFunction=void 0,menu.off(base.ANIMATION_EVENTS)});else if("object"==typeof effect){var base=this;menu.animate(effect,duration,completeFunction)}else this.options.EFFECTS[effect]&&menu[this.options.EFFECTS[effect].close](duration,completeFunction);isSubMenu&&menu.data("parent").closest(".zmenu").data("waitingTime",duration)}else{var base=this;menu.data("waitingTime")>0?window.setTimeout(function(){menu.hide(),base._handleMenuClose(menu,isSubMenu,callback,event),menu.data("waitingTime",0)},menu.data("waitingTime")):(menu.hide(),base._handleMenuClose(menu,isSubMenu,callback,event))}},_handleMenuClose:function(menu,isSubMenu,callback,event){if(isSubMenu){var __menu=$(menu.data("parent")).closest(".zmenu");this._resetMenuTextArray(__menu)}else this._resetMenuTextArray(menu);menu.css({top:"",left:"",height:"",width:""}),menu.removeClass("zmenu--bottomleft zmenu--bottomright zmenu--topright zmenu--topleft zmenu--bottom zmenu--top zmenu--left zmenu--right"),$(menu.data("forElement")).css({"border-radius":""}),void 0!==menu.data("_styleElement")&&menu.data("_styleElement").empty(),this._triggerEvent(isSubMenu?"ONSUBMENUHIDE":"ONHIDE",event,menu),callback&&callback()},_clearMouseHoverTimeout:function(){var metaData=this.getData(this.element);if(clearTimeout(metaData.mouseOverTimeout),clearTimeout(metaData.mouseOutTimeout),void 0!==this.element.data("parent")){var parData=this.getData(this.element.data("parent").closest(".zmenu"));clearTimeout(parData.mouseOverTimeout),clearTimeout(parData.mouseOutTimeout),parData.constantLoc=void 0}},_isElementInMenu:function(element,menu){return menu||(menu=this.element),element=$(element)[0],1===menu.has(element).length},_isToBeDelayed:function(e){var metaData=this.getData(this.element);if(void 0!==metaData.constantLoc){var cursorPosition={x:e.pageX,y:e.pageY},decreasingSlope=this._slope(cursorPosition,this.decreasingCorner),increasingSlope=this._slope(cursorPosition,this.increasingCorner);if(decreasingSlope<this.prevDecreasingSlope&&increasingSlope>this.prevIncreasingSlope)return!0}return!1},_scrollToView:function(menuitem){var ul=menuitem.closest("ul"),itemTop=menuitem.offset().top-ul.offset().top,scrollTop=ul[0].scrollTop;0>itemTop?scrollTop+=itemTop:scrollTop<itemTop+scrollTop+menuitem.outerHeight(!0)-ul.outerHeight()&&(scrollTop+=itemTop),ul.scrollTop(scrollTop)},_handleMouseOverOnMenuItems:function(menuItem,event,scrollToView,triggerEvent,fromLoad){if(menuItem.is(".is-disabled")||menuItem.is(".zmenu__title"))return void(this._lastOverlayedMenuItem&&this._lastOverlayedMenuItem.removeClass("on-hover"));if(scrollToView&&this._scrollToView(menuItem,menuItem.closest(".zmenu").is("ul")?menuItem.closest(".zmenu"):menuItem.closest(".zmenu").find("ul:first")),menuItem.is(".on-hover")&&this._isMenuOfMenuItemShown(menuItem))return void this._setLastOverlayedMenuItem(menuItem);if(fromLoad||triggerEvent&&this._triggerEvent("ONMENUITEMHOVERED",event,menuItem.closest(".zmenu"),menuItem)){this._checkAndHideAllOpenedSubMenus(menuItem.closest(".zmenu")),this._setLastOverlayedMenuItem(menuItem),this._clearMenuTimeout(),menuItem.addClass("on-hover");var isDirectlyFromMouseEvent=event?this._isDirectEvent(event):!1,base=this,showSubMenuAndTriggerEvent=function(){"click"!==this.getData(menuItem).openOn&&menuItem.data("submenu")&&isDirectlyFromMouseEvent?(this._checkAndHideAllOpenedSubMenus(menuItem.closest(".zmenu"),!0),this._showSubmenu(menuItem,{event:event},!1,event)):this.getData(this.element).constantLoc=void 0};menuItem.is(".zmenu--split")?window.setTimeout(function(){menuItem.hasClass("on-hover")&&(menuItem.find(".zmenu__icon.h-alignright").addClass("on-hover"),showSubMenuAndTriggerEvent.bind(base)())},150):showSubMenuAndTriggerEvent.bind(this)()}},_showSubmenu:function(menuItem,options,showImmediately,eventObj){var base=this;options.forElement||(options.forElement=menuItem);var f=function(){if(menuItem.is(":visible")){var submenu=base.getSubmenu(menuItem);options.direction=submenu.data("zmenu").options.submenuDirection?submenu.data("zmenu").options.submenuDirection:base._DIRECTIONS.submenu,base.show(options,submenu,!1),base._saveMenuPoints(eventObj,menuItem)}};showImmediately?f():base._menuTimeout=setTimeout(f,100)},_clearMenuTimeout:function(){this._menuTimeout&&(clearTimeout(this._menuTimeout),this._menuTimeout=void 0)},_handleMouseOutOnMenuItems:function(menuItem,e){var isDirectlyFromMouseEvent=this._isDirectEvent(e);if(isDirectlyFromMouseEvent){if(!menuItem.parent().has(e.relatedTarget).length){if(menuItem.data("submenu")&&this._isMenuOfMenuItemShown(menuItem))return;this._setLastOverlayedMenuItem(void 0)}}else{var relatedEle=e.data;if((!this._isMenuOfMenuItemShown(menuItem)||!this._isElementInMenu(relatedEle,$(this.getSubmenu(menuItem))))&&(this._clearMenuTimeout(),menuItem.removeClass("on-hover"),menuItem.is(".zmenu--split")&&menuItem.find(".zmenu__icon.h-alignright").removeClass("on-hover"),menuItem.data("submenu"))){var smenu=this.getSubmenu(menuItem);if(!smenu||"click"===this.getData(menuItem).openOn)return;!this._isElementInMenu(relatedEle,$(smenu))&&$(smenu).data("parent")&&$(smenu).data("parent")[0]===menuItem[0]&&this.hide(smenu)}}},_isMenuOfMenuItemShown:function(menuItem){return menuItem.data("submenu")&&$(this.getSubmenu(menuItem)).is(":visible")},_isDirectEvent:function(e){return!!e.originalEvent},_hideMenuItem:function(menuItem,show){var menuItem="string"==typeof menuItem?$("#"+menuItem,this.element):$(menuItem);menuItem.length&&(menuItem[show?"show":"hide"](),menuItem.attr({hidden:show?!1:!0,"aria-hidden":show?!1:!0}))},_checkMenuItem:function(menuItem,checked,data){"radio"===data.itemType?this._handleRadioChecked(menuItem,checked,data):"checkbox"===data.itemType&&this._handleCheckboxChecked(menuItem,checked,data)},_checkAndHideAllOpenedSubMenus:function(menu,hideAll,callback){for(var items=menu.find("li"),i=0;i<items.length;i++){var item=$(items[i]),subMenu=this.getSubmenu(item),openOnClick=subMenu&&"click"==this.getData(item).openOn;subMenu&&subMenu.is(":visible")&&(!openOnClick||hideAll)&&(this._checkAndHideAllOpenedSubMenus(subMenu,hideAll,callback),subMenu.data("parent")&&"click"===this.getData(subMenu.data("parent")).openOn?menu.zmenu("hide",subMenu,callback):item.trigger("mouseleave"))}},_setLastOverlayedMenuItem:function(menuItem,noTrigger){if(!this._lastOverlayedMenuItem||!menuItem||this._lastOverlayedMenuItem.get(0)!==menuItem.get(0)){if(this._lastOverlayedMenuItem&&menuItem&&menuItem.length&&!this._lastOverlayedMenu.has(menuItem.get(0)).length){var submenu=menuItem.data("submenu");if(!submenu||submenu[0]!==this._lastOverlayedMenu[0]){var par=this._lastOverlayedMenu.data("parent");par&&par.parent().has(menuItem[0]).length&&par.trigger("mouseleave",menuItem)}}if(this._lastOverlayedMenuItem&&!noTrigger&&this._lastOverlayedMenuItem.trigger("mouseleave",menuItem),this._lastOverlayedMenuItem=menuItem,menuItem&&menuItem.length){var __menu=menuItem.closest(".zmenu"),currentMenu=this.element;for(this.updateLastMenuChain(__menu),this.getData(currentMenu)._lastOverlayedMenuItem=menuItem;currentMenu.data("isSubMenu");){var par=this.getData(currentMenu).parent;currentMenu=par.closest(".zmenu")}this.getData(currentMenu)._lastOverlayedMenuItem=menuItem}}},_fixFloatingMenuWidth:function(menu){var options=menu.data("zmenu").options,columns=(options.type,options.columnCount||options.columns);if(!columns||-1===columns){var _menu=menu.closest(".zmenu");if(columns=_menu.data("isExternalSubmenu")?this.getData(_menu).columns?this.getData(_menu).columns:this.getData(_menu).columnCount:this.options.columns,!columns||-1===columns)return}for(var itemStyle,items=this._getAllMenuItems(menu,!1,!1,!0),floatingMenuWidth=($(items[0]).outerWidth(!0),0),i=0;columns>i;i++)itemStyle=window.getComputedStyle(items[i]),floatingMenuWidth+=Math.round(parseFloat(itemStyle.width))+Math.round(parseFloat(itemStyle.marginLeft))+Math.round(parseFloat(itemStyle.marginRight));menu.width(floatingMenuWidth),(menu.data("height")<=menu.outerHeight()||menu.hasClass("h-scroll_y")||menu.find(".h-scroll_y").length)&&(floatingMenuWidth+=this.scrollWidth,menu.width(floatingMenuWidth)),menu.data("width",floatingMenuWidth),this.getData(menu).search&&menu.data("container").width(floatingMenuWidth).find("input").width(floatingMenuWidth)},getItemCount:function(){return $(this.element).children(".zmenu__item").length},removeMenuItems:function(menuItems){var item,base=this;if(menuItems)for(var i=0;i<menuItems.length;i++)item=$(menuItems[i],this.element),item.length&&base.removeMenuItem(item);else this.element.empty(),this.element.is("div")&&(this._pointerElement&&this.element.append(this._pointerElement),this.element.append($("<ul class='zmenu__list'>")))},removeMenuItem:function(menuItem){if(menuItem=$(menuItem,this.element),menuItem.length){var name=menuItem.attr("name");menuItem.remove();var groupTitle=name?this.element.find("#"+name+".zmenu__title"):void 0;if(groupTitle&&groupTitle.length){var items=this.element.find("li[name="+name+"]:not(.zmenu__title)");items.length||groupTitle.remove()}this.element.find(".zmenu__footer")&&!this.element.find(".zmenu__footer li").length&&this.element.find(".zmenu__footer").remove(),this._fixMenuUI(this.element),this._resetMenuTextArray(this.element)}},getMenuItemAt:function(index,menu,returnAsObj){return menu=menu?menu:this.element,returnAsObj?this._getMenuItemAsObject(menu.find(".zmenu__item:eq("+index+")")):menu.find(".zmenu__item:eq("+index+")")},_getMenuItemAsObject:function(menuItem){var mdata={},data=this.getData(menuItem),base=this;$(this._attrNames).each(function(i,name){var attrVal=menuItem.attr(name)||data[name];void 0!==attrVal&&(mdata[name]=attrVal)});for(var i in data)-1===$.inArray(i,base._attrNames)&&"menuItems"!==i&&void 0!==data[i]&&(mdata[i]=data[i]);if("custom"==mdata.itemType||mdata.custom?mdata.innerHTML=menuItem[0].innerHTML:void 0===mdata.label&&(mdata.label=menuItem.find(".zmenu__text").length&&menuItem.find(".zmenu__text").text()),mdata.text=void 0,menuItem.data("submenu")){var subMenu=this.getSubmenu(menuItem);subMenu&&(mdata.menuItems=this._getMenuAsObject(subMenu))}return mdata},_getMenuAsObject:function(menu){menu=menu?menu:this.element;var base=this,menuArr=[],menuItems=menu.find("li");return menuItems.each(function(index,menuItem){menuArr.push(base._getMenuItemAsObject($(menuItem)))}),menuArr},addMenuItems:function(menuItemArray,itemCallback,appendOnce){for(var items=[],base=this,menuItemArr=Object.create(menuItemArray),menuItem=void 0,len=menuItemArr.length,i=0;len>i;i++)menuItem=base.addMenuItem(menuItemArr[i],itemCallback,!0,appendOnce),items.push(menuItem);return appendOnce&&this.element.find("ul.zmenu__list:first").append(items),(this.element.is(":visible")||this.options.renderInPlace)&&(this._fixMenuUI(this.element),this._resetMenuTextArray(this.element)),items},addMenuItem:function(menuItemObj,itemCallback,isInternal,appendOnce){var menuItem=void 0,menu=$(this.element);"object"==typeof menuItemObj&&(menuItemObj=Object.create(menuItemObj)),menuItemObj.menu&&menuItemObj.menu.length&&"object"==typeof menuItemObj.menu&&(menu="UL"===!$(menuItemObj.menu)[0].tagName?$(menuItemObj.menu).children("ul"):menuItemObj.menu);var container="UL"===menu[0].tagName?!1:!0;if(menuItem=hasHandlebars?this._menuItemUsingTemplate(menu,menuItemObj,itemCallback):$(this._menuItemUsingElementCreation(menu,menuItemObj,itemCallback)),!appendOnce){var allItems=menu[0].querySelectorAll("li");if("undefined"!=typeof menuItemObj.index&&allItems.length){var insertAfter=!1;menuItemObj.index>=allItems.length&&(menuItemObj.index=allItems.length-1,insertAfter=!0),menuItemObj.index<0&&(menuItemObj.index=0),menuItem[insertAfter?"insertAfter":"insertBefore"]($(allItems[menuItemObj.index]))}else container?menu[0].querySelector("ul").appendChild(menuItem[0]):menu[0].appendChild(menuItem[0])}"object"!=typeof menuItemObj.menuItems&&itemCallback&&"separator"!==menuItemObj.mtype&&itemCallback(menuItem,menuItemObj);var attrName=void 0;for(var i in this._attrNames)attrName=this._attrNames[i],menuItemObj[attrName]&&menuItem[0].setAttribute(attrName,menuItemObj[attrName]+"");var data=this.getData(menuItem);for(var i in menuItemObj)-1===$.inArray(i,this._attrNames)&&"menuItems"!==i&&"action"!==i&&menuItemObj[i]&&(data[i]=menuItemObj[i]);if(menuItemObj.action&&"string"==typeof menuItemObj.action&&-1!==menuItemObj.action.indexOf("URL:")&&(data.action=menuItemObj.action),menuItemObj.checked&&(menuItem.data("checked",menuItemObj.checked),menuItem.attr({"data-checked":menuItemObj.checked,"aria-checked":menuItemObj.checked})),menuItemObj.hidden&&menuItem.attr({"data-hidden":menuItemObj.hidden,"aria-hidden":menuItemObj.hidden}),menuItemObj.disabled&&menuItem.attr({"data-disabled":menuItemObj.disabled,"aria-disabled":menuItemObj.disabled}),menuItemObj.customAttributes){if(menuItemObj.customAttributes.data){var attrVal=menuItemObj.customAttributes.data;"string"==typeof attrVal&&(attrVal=JSON.parse(attrVal)),attrVal.appData&&(this.getData(menuItem).appData=attrVal.appData)}menuItem.attr(menuItemObj.customAttributes)}if(menuItemObj.internal||hasHandlebars){if(menuItem.attr("role",this.ARIA_ROLES[menuItemObj.itemType?menuItemObj.itemType:"default"]),menuItemObj.innerHTML){var content=menuItemObj.innerHTML.content,replaceArray=menuItemObj.innerHTML.replaceArray;if(content&&replaceArray){for(var i=0;i<replaceArray.length;i++)content=content.replace("{"+i+"}",ZC.encodeHTML(replaceArray[i]));menuItem.html(content)}else this.options.isCustomHTMLEncoded||this.options.htmlSafe?menuItem.append(data.innerHTML):menuItem.html(ZC.encodeHTML(data.innerHTML));menuItemObj.hasSubmenu&&this._createArrowIcon(menuItem)}this._handleCheckedandDisabled(menuItem,menuItemObj)}else this._buildMenuItem(menuItem,menu);var extAsso=menuItemObj.itemValue;extAsso&&menuItem.data("itemValue",extAsso);var splitButtonData=menuItemObj.splitButtonData;splitButtonData&&menuItem.data("relatedButton",splitButtonData),this.getData(menuItem).action=menuItemObj.action,(menuItemObj.fixed||menuItemObj.isFooter)&&this._addFixedItem(menuItem,menu,data),isInternal||this._fixMenuUI(menu);var className=menuItemObj.className?menuItemObj.className:menuItemObj.itemCssClass?menuItemObj.itemCssClass:"";return menuItemObj.isFooter?null:menuItem.addClass(className)},_menuItemUsingTemplate:function(menu,menuItemObj,itemCallback){if(menuItemObj.listClass="itemgroup"===menuItemObj.itemType?"zmenu__title":"zmenu__item",menuItemObj.icon=menuItemObj.SVGIconId?menuItemObj.SVGIconId:menuItemObj.iconClassName?menuItemObj.iconClassName:menuItemObj.icon,menuItemObj.icon&&-1!==menuItemObj.icon.indexOf("#")&&(menuItemObj.svgId=menuItemObj.icon.split(" ")[0],menuItemObj.svgClass=menuItemObj.icon.slice(menuItemObj.svgId.length).trim()),menuItemObj.isGrid=this._isGridMenu(menu),menuItemObj.isSeparator="separator"===menuItemObj.itemType?!0:!1,menuItemObj.isCustom="custom"===menuItemObj.itemType||menuItemObj.custom?!0:!1,"splitmenu"===menuItemObj.itemType&&(menuItemObj.listClass+=" zmenu--split"),"string"==typeof menuItemObj.menuId)menuItemObj.hasSubmenu=!0,menuItemObj.submenuId=menuItemObj.menuId.substr(1);else if(menuItemObj.menuItems&&menuItemObj.menuItems.length){menuItemObj.submenuId=menuItemObj.id+"submenu",menuItemObj.submenu=$("<ul>").attr("id",menuItemObj.submenuId),menuItemObj.hasSubmenu=!0,menuItemObj.contentType=menuItemObj.contentType?menuItemObj.contentType:"text",this.getData(menuItemObj.submenu).contentType=menuItemObj.contentType;var base=this;$(menuItemObj.menuItems).each(function(i,_menuItemObj){_menuItemObj.menu=menuItemObj.submenu,_menuItemObj.internal=!0,base.addMenuItem(_menuItemObj,itemCallback,void 0)}),menuItemObj.submenu.addClass("zmenu "+this._MENU_CONTENT_TYPES[menuItemObj.contentType?menuItemObj.contentType:"text"]).zmenu({usingJSON:!0}),$("body").append(menuItemObj.submenu)}var menuType=menu.data("zmenu")?menu.data("zmenu").options.contentType:this.getData(menu).contentType;menuItemObj["icon"===menuType?"icon-only":menuType]=menuType;var menuItem=$(menuItemJsonTemplate(menuItemObj));if(menuItemObj.isGroup?menuItem.append(menuItemObj.submenu):menuItemObj.menuItems&&menuItemObj.menuItems.length&&(menuItem.attr("data-menu-id",menuItemObj.submenuId),menuItemObj.submenu.data("parent",menuItem)),menuItemObj.label&&menuItem.attr("data-label",menuItemObj.label),menuItemObj.disabled&&menuItem.attr("data-disabled",menuItemObj.disabled),menuItemObj.hidden&&menuItem.attr("data-hidden",menuItemObj.hidden),this.getData(menuItem).parentMenu=menu,menuItemObj.icon&&0===menuItemObj.icon.indexOf("text:")&&"text"!==this.options.contentType&&menuItem.find("i:first").removeClass(menuItemObj.icon).text(menuItemObj.icon.replace("text:","")),menuItem.is(".zmenu__separator")||menuItem.is(".zmenu__title")||this._addEventsForMenuItems(menuItem),menuItemObj.action&&"string"==typeof menuItemObj.action&&-1!==menuItemObj.action.indexOf("URL:")){var menuItemContents=menuItem.html();menuItemObj.target=menuItemObj.target?menuItemObj.target:"_blank",menuItem.empty().addClass("zmenu--withlink").append($("<a class='zmenu__link' href='"+menuItemObj.action.replace("URL:","")+"' target='"+menuItemObj.target+"'></a>")),menuItem.find(".zmenu__link").append(menuItemContents)}return menuItemObj.hasSubmenu&&menuItem.data("submenu",menuItemObj.submenu?menuItemObj.submenu:$(menuItemObj.submenuId)),menuItem},_menuItemUsingElementCreation:function(menu,menuItemObj,itemCallback){var menuItem=document.createElement("li");if(menuItemObj.itemType&&menuItem.setAttribute("data-item-type",menuItemObj.itemType),menuItemObj.name&&menuItem.setAttribute("name",menuItemObj.name),"object"==typeof menuItemObj.menuItems){var className=menuItemObj.className?menuItemObj.className:menuItemObj.menuClass?menuItemObj.menuClass:"",subMenu=$("<ul>").attr({id:menuItemObj.id+"submenu","class":className}),base=this;menuItem.appendChild(subMenu[0]),subMenu.data("usingJSON",!0),this.getData(subMenu).appendTo=menuItemObj.appendTo?menuItemObj.appendTo:this.options.appendTo,this.getData(subMenu).contentType=menuItemObj.contentType?menuItemObj.contentType:this.getData(menu).contentType,$(menuItemObj.menuItems).each(function(i,_menuItemObj){_menuItemObj.menu=subMenu,base.addMenuItem(_menuItemObj,itemCallback,void 0)})}return menuItem},destroy:function(menu){var menu=menu?menu:this.element;if(this._clearMenuTimeout(),this._uninitSliders(menu),this.hide(),menu.data("usingJSON")||this.options.usingJSON){for(var submenuItems=menu.find(".zmenu--submenu"),i=0;i<submenuItems.length;i++)$(submenuItems[i]).data("submenu").zmenu("destroy"),$(submenuItems[i]).data("submenu").remove();menu.empty()}var componentName=this.componentName;menu.off("mouseup."+componentName+" keydown.run."+componentName).removeClass("zmenu zmenu--thumbnail "+this._MENU_CONTENT_TYPES[this.options.contentType]+" "+this.options.menuClass+" "+this.options.className).removeData("zmenu").data("initialized",!1),menu.find(".h-scroll_y").removeClass("h-scroll_y"),menu.find(".zmenu__pointer").length&&(menu.find(".zmenu__pointer").remove(),this._pointerElement=void 0);for(var listEle=menu.find("li"),i=0;i<listEle.length;i++){var item=listEle[i],itemData=this.getData(listEle[i]),text=$(item).find(".zmenu__text").text()||itemData.label,isFixed=$(item).is(".is-fixed");$(item).removeData("metadata").empty().removeClass("zmenu__item zmenu__title zmenu__custom zmenu__separator is-disabled is-fixed is-selected").empty().removeAttr("data-label").off("mouseenter mouseleave"),$(item).text(text),isFixed&&$(item).appendTo(menu.find("ul:first"))}menu.find(".zmenu__header,.zmenu__footer").remove(),menu.removeData("fixedArea width height"),this._menuTextArray=[]},updateLastMenuChain:function(menu,isExternal){if(this._lastOverlayedMenu=menu,!isExternal&&menu[0]!==this.element[0]){var bmenu=this._traverseAndFindBaseMenu();bmenu.zmenu("updateLastMenuChain",menu,!0)}},_traverseAndFindBaseMenu:function(menu){var _menu=menu;if(menu=menu?menu:this.element,menu.data("parent"))for(var par=menu.data("parent");par;){var _menu=par.closest(".zmenu");_menu.is(":visible")?(menu=_menu,par=menu.data("parent")):par=!1}return menu.closest(".zmenu")},selectHoveredMenuItem:function(){var item=this._lastOverlayedMenuItem;return item&&$(item).trigger("mouseup"),item?item:!1},hoverMenuItem:function(item){return item=$(item),item.length?void this._handleMouseOverOnMenuItems($(item),{},!0,!1,!0):(this._lastOverlayedMenuItem&&this._lastOverlayedMenuItem.removeClass("on-hover"),void(this._lastOverlayedMenuItem=void 0))},_getAllMenuItems:function(menu,excludeFloatingItems,excludeSubMenuItems,isOnlyVisible,excludeseparator){return menu&&menu.length||(menu=this.element),menu.find(".zmenu__item:not([itemType=group], .zc-splitmenu-list-rht"+(excludeseparator?", .zmenu__separator":"")+(excludeFloatingItems?", .zmenu--thumbnail":"")+(excludeSubMenuItems?", li ul[mtype=submenu] li":"")+")"+(isOnlyVisible?":visible":""))},_handleCheckboxChecked:function(menuItem,checked,data){if(this._isGridMenu(menuItem,!0))menuItem[checked?"addClass":"removeClass"]("is-selected");else if((data.icon||data.iconClassName||data.SVGIconId)&&"text"!==this.options.contentType)menuItem[checked?"addClass":"removeClass"]("is-selected");else{var iconEle=menuItem.find("i:first");if(iconEle.length)if(this.options.checkedCheckboxItemIconClassName&&iconEle.removeClass(this.options.checkedCheckboxItemIconClassName),checked){var svgData={props:{"class":"zmenu__tick",viewBox:"-2 -2 20 20",width:"100%",height:"100%"},nodes:[{polygon:{points:"14.6,2.4 4.9,12.1 1.2,8.5 0.4,9.3 4.9,13.8 15.4,3.2"}}]};this._handleIcon(iconEle,svgData,"checkedcheckbox",this.options.checkedCheckboxItemIconClassName,this.options.checkedCheckboxItemSVGIconId)}else iconEle.find("svg").remove()}menuItem.prop("checked",checked).attr({checked:checked,"aria-checked":checked})},_handleRadioChecked:function(menuItem,checked,data){var name=$(menuItem).attr("name"),menu=menuItem.closest("ul"),base=this,metaInfo=void 0,radios=menu.find("li[role=menuitemradio][name="+name+"]");checked&&(radios=radios.filter(function(){return $(this).prop("checked")}),radios.each(function(i,radio){radio=$(radio),metaInfo=base.getData(radio),base._fixRadioIcon(radio,!1,metaInfo)})),base._fixRadioIcon(menuItem,checked,data)},_fixRadioIcon:function(menuItem,checked,data){var isGrid=this._isGridMenu(menuItem,!0);if(isGrid)menuItem[checked?"addClass":"removeClass"]("is-selected");else if(data.icon||data.iconClassName||data.SVGIconId)menuItem[checked?"addClass":"removeClass"]("is-selected");else{var iconEle=menuItem.find("i:first");if(iconEle.length)if(this.options.checkedRadioItemIconClassName&&iconEle.removeClass(this.options.checkedRadioItemIconClassName),checked){var svgData={props:{"class":"zmenu__radio",viewBox:"-7 -7 64 64",width:"100%",height:"100%"},nodes:[{circle:{cx:"24.5",cy:"24.5",r:"15.5"}}]};this._handleIcon(iconEle,svgData,"checkedradio",this.options.checkedRadioItemIconClassName,this.options.checkedRadioItemSVGIconId)}else iconEle.find("svg").remove()}menuItem.prop("checked",checked).attr({checked:checked,"aria-checked":checked})},_initRuntimeEvents:function(){var base=this,componentName=this.componentName;this.element.off("keydown.run."+componentName).on("keydown.run."+componentName,function(event){base.handleKeyCode(event.keyCode,event,void 0),($(event.target).closest(".zmenu__header").length||event.ctrlKey||event.metaKey||event.shiftKey||event.altKey)&&event.keyCode!==ZC.keyCode.UP&&event.keyCode!==ZC.keyCode.DOWN&&event.keyCode!==ZC.keyCode.LEFT&&event.keyCode!==ZC.keyCode.RIGHT||(event.preventDefault(),event.stopPropagation())})},handleKeyCode:function(code,event,showSubMenu){var _isFloatingMenu=this._isGridMenu();switch(event=event?event:{},code){case ZC.keyCode.UP:if(event.altKey||event.ctrlKey||event.metaKey){var item=this._lastOverlayedMenu.find("li:visible:not('.zmenu__title,.is-disabled'):first");this.hoverMenuItem(item,!0)}else{var nextItem=this._getNextMenuItem(!0);nextItem.length&&(this._scrollToView(nextItem,nextItem.closest(".zmenu").is("ul")?nextItem.closest(".zmenu"):nextItem.closest(".zmenu").find("ul:first")),nextItem.trigger("mouseover"))}break;case ZC.keyCode.DOWN:if(event.altKey||event.ctrlKey||event.metaKey){var item=this._lastOverlayedMenu.find("li:visible:not('.zmenu__title,.is-disabled'):last");this.hoverMenuItem(item,!0)}else{var nextItem=this._getNextMenuItem();nextItem.length&&(this._scrollToView(nextItem,nextItem.closest(".zmenu").is("ul")?nextItem.closest(".zmenu"):nextItem.closest(".zmenu").find("ul:first")),nextItem.trigger("mouseover"))}break;case ZC.keyCode.RIGHT:if(void 0!==this._lastOverlayedMenuItem){var subMenu=this.getSubmenu(this._lastOverlayedMenuItem),menu=this._lastOverlayedMenuItem.closest(".zmenu");if((_isFloatingMenu||!subMenu.length&&menu.hasClass("zmenu--thumbnail"))&&!showSubMenu){var f=void 0,item=this._getNextMenuItem(f,f,f,code);this._scrollToView(item,item.closest(".zmenu").is("ul")?item.closest(".zmenu"):item.closest(".zmenu").find("ul:first")),item.trigger("mouseover");break}if(this._lastOverlayedMenuItem.is(".is-disabled"))return;if(subMenu&&subMenu.length){var menu=this.getSubmenu(this._lastOverlayedMenuItem);if(!menu)return;this.show({forElement:this._lastOverlayedMenuItem,event:event},menu),this._lastOverlayedMenuItem=void 0,this._getNextMenuItem(!1,!0).trigger("mouseover")}}else _isFloatingMenu&&this._lastOverlayedMenu.find("li:not('.zmenu__title,.is-disabled'):not(':hidden'):first").trigger("mouseover");break;case ZC.keyCode.LEFT:if(void 0!==this._lastOverlayedMenuItem){menu=this._lastOverlayedMenuItem.closest(".zmenu");var parentItem=this._lastOverlayedMenu.data("parent"),subMenuShown=parentItem&&this._isMenuOfMenuItemShown(parentItem),firstMenuItem=menu.find(":visible.zmenu__item").not(".zmenu__separator,.is-disabled,.zmenu__title").filter(":first"),_isFirstItem=firstMenuItem[0]==this._lastOverlayedMenuItem[0],currentMenuFloating=this._isGridMenu(menu);if(!(!currentMenuFloating||_isFirstItem||subMenuShown&&_isFirstItem)){var item=this._getNextMenuItem(!0,void 0,void 0,code);this._scrollToView(item,item.closest(".zmenu").is("ul")?item.closest(".zmenu"):item.closest(".zmenu").find("ul:first")),item.trigger("mouseover");break}this._isMenuMainMenu(this._lastOverlayedMenu)||this._hideLastShownMenu()}else _isFloatingMenu&&this._lastOverlayedMenu.find("li:not('.zmenu__title,.is-disabled'):not(':hidden'):last").trigger("mouseover");break;case ZC.keyCode.ESCAPE:this.options.renderInPlace||(this._isMenuMainMenu(this._lastOverlayedMenu)?this.hide():this._hideLastShownMenu());break;case ZC.keyCode.ENTER:case ZC.keyCode.SPACE:this._lastOverlayedMenuItem&&this._lastOverlayedMenuItem.data("submenu")&&!this._lastOverlayedMenuItem.hasClass("zmenu--split")?this.handleKeyCode(ZC.keyCode.RIGHT,event,!0):this._lastOverlayedMenuItem?this._lastOverlayedMenuItem.is(".zmenu--withlink")?$(this._lastOverlayedMenuItem).find(".zmenu__link")[0].click():(event.target=$(this._lastOverlayedMenuItem),this._handleMenuItemClick(event,this._lastOverlayedMenuItem.closest(".zmenu"))):this.hide();break;case ZC.keyCode.PAGE_UP:var item=this._lastOverlayedMenu.find("li:not('.zmenu__title,.is-disabled'):first");this.hoverMenuItem(item,!0);break;case ZC.keyCode.PAGE_DOWN:var item=this._lastOverlayedMenu.find("li:not('.zmenu__title,.is-disabled'):last");this.hoverMenuItem(item,!0);break;default:var alphaNumericKey=String.fromCharCode(code);this._menuTextArray.length&&this.options.handleAccessKeyNavigation&&this._callMenuitemSearch(alphaNumericKey,(new Date).getTime())}var hoveredItem=this.element.find(".on-hover"),containsSubmenu=hoveredItem.length?hoveredItem.data("submenu")&&hoveredItem.data("submenu").length:!1;event&&"keydown"===event.type&&!containsSubmenu&&this._triggerEvent("KEYDOWN",event,this.element)},_isDisabled:function(menuItem){var disabled=menuItem.attr("disabled")?menuItem.attr("disabled"):!1;return disabled},_isMenuMainMenu:function(menu){return $(menu).get(0)===this.element.get(0)},_getNextFloatingMenuItem:function(currentItemPos,items,isPrev,compareTop,isReverse){var next=void 0,key=compareTop?"top":"left",total=items.length;return $.each(items,function(i,item){item=items[isReverse?total-i-1:i];var ipos=$(item).position();return ipos[key]===currentItemPos[key]?(next=$(item),!1):"top"===key?(next=$(item),!1):void 0}),next},_hideLastShownMenu:function(){var nextItem=this._lastOverlayedMenu.data("parent");this._lastOverlayedMenuItem=nextItem,this.hide(this._lastOverlayedMenu);var __menu=nextItem.closest(".zmenu");this.updateLastMenuChain(__menu),this.getData(this.element)._lastOverlayedMenuItem=nextItem},_resetMenuTextArray:function(menu){this._menuTextArray=[],this._prevSearchKey="",this._prevKeydownTime="",this._prevSearchIndex="",this._prevSearchTimer=void 0;var menuItemSelector=".zmenu__item:visible:not(.zmenu__title,.is-disabled,.zmenu__separator)";this.options.renderInPlace&&(menuItemSelector=".zmenu__item:not(.zmenu__title,.is-disabled,.zmenu__separator)");for(var menuItems=menu.find(menuItemSelector),i=0;i<menuItems.length;i++)this._menuTextArray[this._menuTextArray.length]={text:$(menuItems[i]).find(".zmenu__text").text()||"",menuitem:$(menuItems[i])}},_callMenuitemSearch:function(alphaNumericKey,currentTime){var sameKeySearch=!1;""!==this._prevKeydownTime&&currentTime-this._prevKeydownTime>700?(sameKeySearch=this._prevSearchKey==alphaNumericKey?!0:!1,this._prevSearchKey=alphaNumericKey):this._prevSearchKey=this._prevSearchKey+alphaNumericKey,this._prevKeydownTime=currentTime,this._menuitemSearch(sameKeySearch)},_menuitemSearch:function(sameKeySearch){var regExp=new RegExp("^"+this._prevSearchKey.replace(/[|()\[{.+*?$\\]/g,"\\$0"),"i"),searchFromIndex=sameKeySearch&&this._prevSearchIndex<this._menuTextArray.length?this._prevSearchIndex+1:0;searchFromIndex=searchFromIndex>0&&searchFromIndex<this._menuTextArray.length?searchFromIndex:0;for(var x=searchFromIndex;x<this._menuTextArray.length;x++)if(this._menuTextArray[x].text.match(regExp)){this._prevSearchIndex=x;for(var checkNextMatch=!1,y=x+1;y<this._menuTextArray.length;y++)this._menuTextArray[y].text.match(regExp)&&(checkNextMatch=!0);return checkNextMatch||(this._prevSearchIndex=-1),void this._handleMouseOverOnMenuItems($(this._menuTextArray[x].menuitem),{},!0,!0)}},_getNextMenuItem:function(isPrev,noTrigger,prevItem,keyCode){var menu=this._lastOverlayedMenu&&0!==this._lastOverlayedMenu.length?this._lastOverlayedMenu:this.element,_isFloatingMenu=this._isGridMenu(menu),item=void 0,actualMenu=menu.is("ul")?menu:menu.find("ul:first");if(prevItem=void 0!==prevItem?prevItem:this._lastOverlayedMenuItem,prevItem&&prevItem.length){if(item=prevItem[isPrev?"prevAll":"nextAll"](".zmenu__item:visible").not(".zmenu__separator,.is-disabled,.zmenu__title"),_isFloatingMenu){var prevPos=prevItem.position(),compareTop=keyCode===ZC.keyCode.LEFT||keyCode===ZC.keyCode.RIGHT;item=this._getNextFloatingMenuItem(prevPos,item,isPrev,compareTop),item||menu.find(".zmenu__footer").length&&compareTop||(item=prevItem[isPrev?"nextAll":"prevAll"](".zmenu__item:not(.zmenu__separator,.is-disabled,.zmenu__title):visible"),prevPos[compareTop?"left":"top"]=0,item=this._getNextFloatingMenuItem(prevPos,item,isPrev,compareTop,!0))}else item=$(item[0]);item&&item.length||(menu.find(".zmenu__footer").length?prevItem.closest(".zmenu__footer").length?prevItem[0]===menu.find(".zmenu__footer").find(".zmenu__item:visible").first()[0]?(prevItem.removeClass("on-hover"),item=this._getNextMenuItem(isPrev,noTrigger,!1)):item=this._getNextMenuItem(isPrev,noTrigger,!1):item=menu.find(".zmenu__footer").find(".zmenu__item:visible")[isPrev?"last":"first"]():item=this._getNextMenuItem(isPrev,noTrigger,!1))}else item=menu.find(".zmenu__footer").length&&!this._lastOverlayedMenuItem?menu.find(".zmenu__item:visible:not(.zmenu__title,.is-disabled,.zmenu__separator):"+(isPrev?"last":"first")):actualMenu.find(".zmenu__item:visible:not(.zmenu__title,.is-disabled,.zmenu__separator):"+(isPrev?"last":"first"));return this._setLastOverlayedMenuItem(item,noTrigger),this._lastOverlayedMenuItem},_setFocus:function(){var base=this,f=function(){base.element.focus(),base.element.find(".zmenu__textbox").length&&base.element.find(".zmenu__textbox").focus()};this._triggerEvent("ONBEFOREFOCUS",{},this.element)&&setTimeout(f,100)},refresh:function(menu){menu=menu?menu:this.element,this._fixMenuItemsWidth(menu)},_fixMenuItemsWidth:function(menu,type){return menu?(type=type?type:this.getMenuType(menu),this._isTypeFloating(type)?this._fixFloatingMenuWidth(menu):void 0):void 0},getMenuType:function(menu){if(menu&&menu.data("isExternalSubmenu"))return menu.zmenu("getMenuType");menu=menu?menu:this.element;var type=this._getMenuTypeFromData(menu);return type||(type=this.options.type),type},_getMenuTypeFromData:function(menu){var mdata=this.getData(menu);return mdata.componentOptions?mdata.componentOptions.type:mdata.type},_isTypeFloating:function(type,menu){return type&&"grid"===type||menu&&menu.hasClass("zmenu--thumbnail")?!0:!1},_fixMenuUI:function(menu,options){menu.is(":visible")&&this._fixMenuHeight(menu,options)},_fixMenuHeight:function(menu,options){var menuHeight="auto",actualMenu=menu.is("ul")?void 0:menu.find("ul:first");menu.height(menuHeight),actualMenu&&actualMenu.height(menuHeight),menu.removeClass("h-scroll_y");var positionAlterable="auto"===this.options.direction||"after-pointer"===this.options.direction||"at-cursor"===this.options.direction,height=menu.outerHeight(),top=1*menu.css("top").split("px")[0]-$(window).scrollTop(),windowHeight=ZC.windowObject?ZC.windowObject.height:$(window).height(),openingDirection=menu.data("direction"),limit=(openingDirection&&0===openingDirection.indexOf("bottom")||openingDirection&&0===openingDirection.indexOf("top"))&&options&&!options.isRightClick?options.availableHeight:windowHeight,space=limit-height,top=top?top:0;options&&options.isRightClick&&(top=parseInt(top)+2),(top+height>=limit&&0>space||!positionAlterable)&&(menuHeight=options&&options.availableHeight&&!options.isRightClick?options.availableHeight:windowHeight-top),menu.data("height")?menuHeight=options&&options.availableHeight&&parseInt(menu.data("height"))>=options.availableHeight?options.availableHeight:parseInt(menu.data("height")):space>0&&positionAlterable&&(menuHeight=height);this.scrollWidth,this.getData(menu);if(height>menuHeight)if(menu.outerHeight(menuHeight),actualMenu){var headerHeight=menu.find(".zmenu__header").length?parseInt(menu.find(".zmenu__header").outerHeight(!0))+parseInt(menu.find(".zmenu__header").css("margin-top"))+parseInt(menu.find(".zmenu__header").css("margin-bottom"))+parseInt(menu.css("padding-top")):parseInt(menu.css("padding-top")),footerHeight=menu.find(".zmenu__footer").length?parseInt(menu.find(".zmenu__footer").outerHeight(!0))+parseInt(menu.find(".zmenu__footer").css("margin-top"))+parseInt(menu.find(".zmenu__footer").css("margin-bottom")):parseInt(menu.css("padding-bottom")),pointerHeight=menu.find(".zmenu__pointer").length?parseInt(menu.find(".zmenu__pointer").outerHeight(!0)):0,remaining=headerHeight+(menu.find(".zmenu__footer").length>1?menu.find(".zmenu__footer").length*footerHeight:footerHeight)+pointerHeight;actualMenu.innerHeight(menuHeight-remaining),"slider"===this.options.scroll?(this._initSliders(menu),actualMenu.addClass("h-overflowhidden")):actualMenu.addClass("h-scroll_y"),"slider"===this.options.scroll&&this._initSliders(menu),0!==remaining&&menu.outerHeight(menuHeight)}else"slider"===this.options.scroll?(this._uninitSliders(menu),this._initSliders(menu),menu.addClass("h-overflowhidden")):(this._uninitSliders(menu),menu.addClass("h-scroll_y"));else menu.removeClass("h-scroll_y")},_findScrollWidth:function(){var scrollEle=document.createElement("div"),styleProps="width:100px;height:100px;overflow:scroll;";document.querySelector("body").appendChild(scrollEle),scrollEle.style.cssText=styleProps;var scrollWidth=$(scrollEle).width()-scrollEle.scrollWidth;return document.querySelector("body").removeChild(scrollEle),scrollWidth},_initSliders:function(menu){this._createSlider(menu),this._createSlider(menu,!0)},_uninitSliders:function(menu){menu=menu.is("div")?menu.find("ul:first"):menu;var data=this.getData(menu);data&&data.sliders&&(data.sliders.top&&data.sliders.top.remove(),data.sliders.down&&data.sliders.down.remove(),data.sliders=null),menu.off("mousewheel")},_createSlider:function(menu,isTop){menu=menu.is("div")?menu.find("ul:first"):menu;var direction=isTop?"top":"down",data=this.getData(menu),base=this;data.sliders||(data.sliders={});var slider=data.sliders[direction];slider&&slider.remove(),slider=$("<div>").addClass("zmenu--scroller zmenu--scroller"+direction),data.sliders[direction]=slider;var base=this;slider.hover(function(){base._startScrolling(menu,isTop)},function(){base._stopScrolling(menu)}).hide(),slider.click(function(){var top=menu.scrollTop();return base._stopScrolling(menu),menu.scrollTop(top+(isTop?-1:1)),base._startScrolling(menu,isTop),!1});var componentName=this.componentName;menu.off("mousewheel."+componentName).on("mousewheel."+componentName,function(event){var top=menu.scrollTop();menu.scrollTop(event.originalEvent.wheelDelta>0?top-6:top+6),base._displayScrollElements(menu),event.stopPropagation(),event.preventDefault()});var width=menu.width();slider.css({width:width}),isTop||slider.show();var iconSpan=$('<i class="zmenu__icon"></i>'),svgData=void 0;if(svgData="top"===direction?{props:{viewBox:"-3 -3 22 22",width:"100%",height:"100%"},nodes:[{path:{d:"M0,12l8-8l8,8H0z"}}]}:{props:{viewBox:"-3 -3 22 22",width:"100%",height:"100%"},nodes:[{path:{d:"M16,4l-8,8L0,4H16z"}}]},this._handleIcon(iconSpan,svgData,isTop?"topscroller":"bottomscroller",isTop?this.options.scrollUpArrowIconClassName:this.options.scrollDownArrowIconClassName,isTop?this.options.scrollUpArrowSVGIconId:this.options.scrollDownArrowSVGIconId),$(iconSpan).appendTo(slider),menu.hasClass("zmenu__list")){slider.appendTo(menu.parent());var topValue=menu.height()-slider.outerHeight(!0)+parseInt(menu.parent().css("padding-top"));menu.parent().find(".zmenu__footer").length?topValue+=parseInt(menu.parent().find(".zmenu__footer").css("margin-top")):topValue=this._pointerElement?topValue+Math.ceil(this._pointerElement.outerHeight(!0)/2)+parseInt(menu.parent().css("border-bottom-width")):topValue-parseInt(menu.parent().css("border-bottom-width"))-parseInt(menu.parent().css("border-top-width")),slider.css({left:"0px",top:isTop?"0px":topValue})}else{slider.insertAfter(menu);var offset=menu.position(),buffer=isTop?1:menu.outerHeight()-slider.outerHeight(!0)-1;slider.css({top:offset.top+buffer,left:offset.left+1})}return slider},_displayScrollElements:function(menu){var scrollElement=(menu.hasClass("zmenu")?!1:!0,this.getData(menu).sliders),scrollTop=menu.scrollTop();scrollElement.top[0===scrollTop?"hide":"show"](),scrollElement.down[menu[0].scrollHeight-scrollTop<=menu.outerHeight()?"hide":"show"]()},_startScrolling:function(menu,isTop){var stop=isTop?0:menu[0].scrollHeight-menu.innerHeight(),base=this,distance=menu.scrollTop()-stop,duration=Math.abs(1e3*distance/50);menu.animate({scrollTop:stop},{duration:duration,easing:"linear",complete:function(){base._displayScrollElements(menu)}})},_stopScrolling:function(menu){menu.stop(),this._displayScrollElements(menu)},_hideAllSubMenus:function(menu,callback){var menu=this._traverseAndFindBaseMenu(menu);menu[0]!=this.element[0]?menu.zmenu("hide",void 0,callback):this._checkAndHideAllOpenedSubMenus(menu,!0,callback)},_destroyRuntimeEvents:function(){$(this.element).off(".run."+this.componentName)},_triggerEvent:function(type,orgEvent,menu,menuItem,dataObj){orgEvent=orgEvent?orgEvent:{},menuItem=menuItem?menuItem:$(orgEvent.target).closest(".zmenu__item");var isBase=!menu||menu.get(0)==this.element.get(0),data={originalEvent:orgEvent,target:menu.data("forElement"),forElement:menu.data("forElement"),offset:menu.offset(),menu:menu,isBaseMenu:isBase,menuitem:menuItem,data:menuItem.length?this._getMenuItemAsObject(menuItem):void 0,itemValue:menuItem.length&&menuItem.data("itemValue")};if(dataObj&&(data=$.extend({},data,dataObj)),menu.data("parent")&&-1!==type.indexOf("SUBMENU")){menu.zmenu("triggerEvent",type.replace("SUBMENU",""),orgEvent,data);var parentMenu=menu.data("parent").closest(".zmenu");return parentMenu.zmenu("triggerEvent",type,orgEvent,data)}return this._dispatchEvent(type,orgEvent,data,menu)},triggerEvent:function(type,orgEvent,data){return this._dispatchEvent(type,orgEvent,data)},_slope:function(a,b){return(b.y-a.y)/(b.x-a.x)},_saveMenuPoints:function(e,menuItem){var metaData=this.getData(this.element),subMenu=this._lastOverlayedMenu,baseMenuOffset=this.element.offset(),subMenuOffset=subMenu.offset();if(metaData.constantLoc={x:baseMenuOffset.left,y:baseMenuOffset.top+menuItem.position().top},baseMenuOffset.left>=subMenuOffset.left){var upperRight={x:subMenuOffset.left+subMenu.outerWidth(),y:subMenuOffset.top},lowerRight={x:subMenuOffset.left+subMenu.outerWidth(),y:subMenuOffset.top+subMenu.outerHeight()};this.increasingCorner=upperRight,this.decreasingCorner=lowerRight}else{var upperLeft={x:subMenuOffset.left,y:subMenuOffset.top},lowerLeft={x:subMenuOffset.left,y:subMenuOffset.top+subMenu.outerHeight()};this.decreasingCorner=upperLeft,this.increasingCorner=lowerLeft}this.prevDecreasingSlope=this._slope(metaData.constantLoc,this.decreasingCorner),this.prevIncreasingSlope=this._slope(metaData.constantLoc,this.increasingCorner)},setAttribute:function(optionName,value){if("height"===optionName&&this.options.height!==value)this.options.height=parseInt(value),this.element.data("height",parseInt(value)),this._fixMenuHeight(this.element,{});else if("width"===optionName&&this.options.width!==value)this.options.width=parseInt(value),this.element.data("width",parseInt(value)).width(this.options.width);else if("contentType"===optionName&&this.options.contentType!==value){"grid"!==this.options.type&&this.element.removeClass(this._MENU_CONTENT_TYPES[this.options.contentType]).addClass(this._MENU_CONTENT_TYPES[value]),this.options.contentType=value;var items=this._getMenuAsObject(this.element);this.element.is("ul")?this.element.empty():this.element.find("ul").empty(),this.addMenuItems(items)}else if("type"===optionName&&this.options.type!==value)this.element.zmenu("destroy"),this.options.type=value,this.element.zmenu(this.options);else if("search"===optionName&&this.options.search!==value){if(value)this._createSearchContainer(this.element);else{var searchBoxPosition=this.element.find(".zmenu__textbox").parent().attr("class");this.element.find("."+searchBoxPosition).remove()}this._fixMenuHeight(this.element,{})}else if("pointer"!==optionName&&"displayType"!==optionName||this.options.pointer===value)if("renderInPlace"===optionName&&this.options.renderInPlace!==value)value||this.element.css({position:"absolute",width:"auto",height:"auto"});else if("menuClass"!==optionName&&"className"!==optionName||this.options.menuClass===value&&this.options.className===value){if("handleAccessKeyNavigation"===optionName&&this.options.handleAccessKeyNavigation!==value)value?this._initRuntimeEvents():this._destroyRuntimeEvents();else if("appendTo"===optionName)void 0!==value&&$(value).length?this.element.appendTo($(value)):$("body").append(this.element);else if("checkedCheckboxItemSVGIconId"===optionName||"checkedCheckboxItemIconClassName"===optionName||"checkedRadioItemSVGIconId"===optionName||"checkedRadioItemIconClassName"===optionName){this.options[optionName]=value;for(var menuItem,childElements=this.element.find("li"),length=childElements.length,i=0;length>i;i++)menuItem=$(childElements[i]),this._checkMenuItem(menuItem,menuItem.prop("checked"),this.getData(menuItem))}}else this.element.removeClass(this.options.menuClass).addClass(value),this.element.removeClass(this.options.className).addClass(value);else value&&"box"!==value?this._createPointerElement():(this._pointerElement.remove(),this._pointerElement=void 0);this.options[optionName]=value},checkMenuItems:function(items){items=items?items:this.element.find("[role=menuitemcheckbox],[role=menuitemradio]"),this.setMenuItemsAttribute(items,"checked",!0)},uncheckMenuItems:function(items){items=items?items:this.element.find("[role=menuitemcheckbox],[role=menuitemradio]"),this.setMenuItemsAttribute(items,"checked",!1)},hideMenuItems:function(items){items=items?items:this.element.find("li").filter(function(){return"none"!==$(this).css("display")}),this.setMenuItemsAttribute(items,"hidden",!0)},showMenuItems:function(items){items=items?items:this.element.find("li:not(li[data-hidden=true])"),this.setMenuItemsAttribute(items,"hidden",!1)},setMenuItemsAttribute:function(menuItems,optionName,value){var base=this;$.each(menuItems,function(i,menuItem){if(menuItem=$(menuItem,base.element),menuItem.length){var data=base.getData(menuItem);if("itemgroup"===data.itemType){var groupItems=$("[name="+menuItem.attr("name")+"]:not(.zmenu__title)",base.element);groupItems.length&&base.setMenuItemsAttribute(groupItems,optionName,value)}if("icon"!==optionName&&"iconClassName"!==optionName&&"SVGIconId"!==optionName||data[optionName]===value)"label"===optionName&&data.label!==value?(data.ellipsis&&(value+="..."),menuItem.find(".zmenu__text").text(value)):"shortcutkey"!==optionName&&"shortcutKey"!==optionName||data.shortcutkey===value&&data.shortcutKey===value?"hint"===optionName||"description"===optionName&&(data.hint!==value||data.description!==value)?data.hint||data.description?menuItem.find(".zmenu__hint").text(value):menuItem.append($("<span class='zmenu__hint'/>").text(value)):"disabled"===optionName||"checked"===optionName||"hidden"===optionName?(data[optionName]=value,base._handleCheckedandDisabled(menuItem,data,optionName)):"menuId"===optionName&&data.menuId!==value?(data[optionName]=value,value?(menuItem.removeData("submenu"),base._buildSubmenu(menuItem,data),base._createArrowIcon(menuItem)):(menuItem.find(".zmenu__icon.h-alignright").remove(),menuItem.removeData("submenu"),menuItem.off("mouseup.submenuitem.zmenu"))):"innerHTML"===optionName&&"custom"===data.itemType?menuItem.empty().html(value):"itemType"===optionName&&data.itemType!==value&&("separator"===value?menuItem.removeClass("zmenu__item").addClass("zmenu__separator").empty():"default"===value?menuItem.removeClass("zmenu__title zmenu__custom zmenu__separator").addClass("zmenu__item"):"custom"===value?menuItem.addClass("zmenu__item zmenu__custom"):"itemgroup"===value?menuItem.removeClass("zmenu__item zmenu__custom zmenu__separator").addClass("zmenu__title"):"splitmenu"===value&&(menuItem.removeClass("zmenu__title zmenu__custom zmenu__separator").addClass("zmenu--split"),base._createArrowIcon(menuItem),menuItem.find(".zmenu__shortcut").remove()),menuItem.attr("role",base.ARIA_ROLES[value?value:"default"]),menuItem.attr("data-item-type",value),menuItem[0].setAttribute("role",this.ARIA_ROLES[value?value:"default"])):data.shortcutKey||data.shortcutkey?menuItem.find(".zmenu__shortcut").text(value):(value=window.ZShortCut?ZShortCut.getInfo(void 0,value):value,base.getData(menuItem).shortcutkey=base.getData(menuItem).shortcutKey=value,menuItem.append($("<span class='zmenu__shortcut'/>").text(value)));else{(data.icon||data.iconClass||data.SVGIconId||menuItem.find(".zmenu__iconcontainer:first").length)&&menuItem.find(".zmenu__iconcontainer:first").remove();var iconEle=$("<i class='zmenu__icon'/>");0===value.indexOf("text:")?(menuItem.prepend($("<div class='zmenu__iconcontainer'>").append(iconEle)),menuItem.find(".zmenu__icon:first").text(value.replace("text:",""))):(data[optionName]=value,menuItem.prepend($("<div class='zmenu__iconcontainer'>").append(base._handleIcon(iconEle,void 0,void 0,data.iconClassName,data.SVGIconId,data.icon))))}data[optionName]=value}})}};menuPrototype.updateMenuItems=menuPrototype.setMenuItemsAttribute,ZC.registerComponent("zmenu",menuPrototype),ZC.createMenu=function(menuId,menuDetails,options){if("object"==typeof menuId&&(menuDetails=menuId.items,options=menuId,menuId=menuId.id),$("#"+menuId).data("zmenu"))return $("#"+menuId);var menu=void 0;document.getElementById(menuId)?(menu=$(document.getElementById(menuId)),"DIV"===menu[0].tagName&&menu[0].appendChild(document.createElement("ul"))):menu=$("<div><ul></ul></div>").attr("id",menuId);var appendTo=options?options.appendTo:void 0;menu[0].className+=" zmenu "+menuPrototype._MENU_CONTENT_TYPES[options.contentType?options.contentType:"text"]+" "+(options.menuClass?options.menuClass:"")+" "+(options.className?options.className:""),options.type&&-1!==options.type.indexOf("grid")&&(menu[0].className+=" zmenu--thumbnail"),options.usingJSON=!0;var appendedTo=document.querySelector("body");return void 0!==appendTo&&appendTo.length&&(appendedTo=$(appendTo)[0]),appendedTo.appendChild(menu[0]),ZC.getOptions(menu).type=options.type,menu.zmenu(options),menuDetails.length?menu.zmenu("addMenuItems",menuDetails,options?options.addItemCallback:void 0):"",menu};var ZM_DOM={}}(ZComponents);var ZAlertBanner={};!function(ZC){var $=ZC.DOMUtil;ZC.notifierCount=0;var alertbannerPrototype={options:{type:"info",icon:void 0,message:"Default alert banner",isMessageHTMLEncoded:!1,position:"top",align:"center",positionAlterable:!0,hideDelay:void 0,closeButton:!1,display:"fixed",target:"body",displayAfter:void 0,displayBefore:void 0,displayInside:void 0,hideOnClick:!1,left:void 0,right:void 0,bottom:void 0,top:void 0,margin:void 0,pauseOnMouseOver:!1,height:"auto",width:"auto",className:void 0,animation:!1,closePreviousBanner:!0,icons:{close:void 0,error:void 0,info:void 0,warning:void 0,success:void 0},labels:{close:"Close"},widgetEventPrefix:"zalertbanner"},_TEMPLATE:{close:"<svg class='zalertbanner__svg' viewBox='0 0 16 16'><g><rect x='1.5' y='7.4' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -3.3137 8)' class='st0' width='13' height='1.1'></rect><rect x='1.5' y='7.4' transform='matrix(0.7071 0.7071 -0.7071 0.7071 8 -3.3137)' class='st0' width='13' height='1.1'></rect></g></svg>",info:"<svg class='zalertbanner__svg' viewBox='0 0 48 48'><g><g><path d='M23.9,17.4c1.5,0,2.5-1.1,2.4-2.3c0-1.3-0.9-2.4-2.3-2.4s-2.4,1.1-2.4,2.4C21.6,16.3,22.6,17.4,23.9,17.4z'></path><path d='M26.2,35.5V21.8c0-1.2-1.4-1.3-1.8-1.3h-0.7c0,0-1.7,0-1.7,1.1v14.3c0,0.3,0.2,0.9,1.3,0.9h1.6C25.3,36.7,26.2,36.5,26.2,35.5z'></path></g><path d='M24,0C10.7,0,0,10.7,0,24s10.7,24,24,24s24-10.7,24-24S37.3,0,24,0z M24,44C13,44,4,35,4,24S13,4,24,4s20,9,20,20S35,44,24,44z'></path></g></svg>",error:"<svg class='zalertbanner__svg' viewBox='0 0 48 48'><path d='M41.2,7.2C31.9-2.2,16.7-2.5,7.3,6.9c-9.5,9.3-9.7,24.5-0.4,33.9c9.3,9.5,24.5,9.7,33.9,0.4C50.3,31.9,50.4,16.8,41.2,7.2z M37.9,38.2C30,46,17.4,45.9,9.7,38S2.1,17.5,10,9.8S30.5,2.1,38.2,10C45.9,17.9,45.8,30.5,37.9,38.2z'></path><path d='M31.7,17.5l-1.1-1.1c-0.8-0.8-1.7-0.1-2,0.1L24,21l-4.6-4.7c-0.3-0.3-1.1-0.8-1.9,0l-1.1,1.1c-0.8,0.8-0.1,1.7,0.1,2L21,24l-4.7,4.6c-0.9,0.9-0.3,1.6-0.1,1.8l1.3,1.3c0.2,0.2,0.9,0.8,1.8-0.1L24,27l4.6,4.7c0.9,0.9,1.6,0.3,1.8,0.1l1.3-1.3c0.2-0.2,0.8-0.9-0.1-1.8L27,24l4.7-4.6C32,19.1,32.5,18.4,31.7,17.5z'></path></svg>",warning:"<svg class='zalertbanner__svg' viewBox='0 0 48 48'><g><path d='M47.3,36.6L27.7,2.5c-0.9-1.4-2.4-2.2-3.9-2.1c-1.6,0-2.9,0.9-3.7,2.2L0.7,36.5c-0.9,1.3-1,3-0.2,4.4c0.8,1.5,2.3,2.4,4,2.4h39c1.6,0,3.1-0.8,3.9-2.2C48.2,39.7,48.2,38,47.3,36.6z M43.9,39.2c-0.1,0.1-0.2,0.2-0.4,0.2h-39c-0.3,0-0.4-0.2-0.5-0.3c-0.1-0.2,0-0.3,0-0.4L23.5,4.6c0,0,0.1-0.2,0.3-0.2c0,0,0,0,0,0c0.1,0,0.3,0,0.4,0.2l19.6,34C44,38.8,44,39,43.9,39.2z'></path></g><circle cx='24' cy='33.4' r='2'></circle><path d='M24.1,28.4L24.1,28.4c-0.8,0-1.3-0.4-1.4-1l-1-10c-0.1-1.1,1-2,2.4-2l0,0c1.4,0,2.5,0.9,2.4,2l-1,10C25.4,27.9,24.9,28.4,24.1,28.4z'></path></svg>",success:'<svg class="zalertbanner__svg" viewBox="0 0 48 48"><path d="M41.2 7.2C31.9-2.3 16.7-2.5 7.3 6.8c-9.5 9.3-9.7 24.5-0.4 33.9 9.3 9.5 24.5 9.7 33.9 0.4C50.3 31.9 50.4 16.7 41.2 7.2zM37.9 38.2c-7.9 7.7-20.5 7.6-28.2-0.3S2.1 17.4 10 9.7 30.5 2.1 38.2 10C45.9 17.8 45.8 30.5 37.9 38.2z"></path><path d="M35 20.3L23.1 32.2c-1.1 1.1-2.9 1.1-4 0l-1-1 -4.5-4.6c-0.2-0.2-1-1.1-0.1-2l1.1-1.1c0.8-0.8 1.6-0.3 1.9 0l4.6 4.7 11-10.8c0.2-0.2 1.1-1 2-0.1l1.1 1.1C35.8 19.2 35.3 19.9 35 20.3z"></path></svg>'},_EVENTS:{ONSHOW:"show",ONHIDE:"hide",ONBEFORESHOW:"beforeshow",ONBEFOREHIDE:"beforehide"},_ANIMATION:{slide:{show:"slideDown",hide:"slideUp"},fade:{show:"fadeIn",hide:"fadeOut"},end:"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"},_CLASS:{SUCCESS:"zalertbanner--success",INFO:"zalertbanner--info",WARNING:"zalertbanner--warning",ERROR:"zalertbanner--error"},_create:function(element,options){this._initialize(element,options),this._createNotifier(),this._positionNotifier(),this.notifier.hide()&&this._open(),this._bindEvents()},_initialize:function(element,options){if(this.notifier=element,options.hideOnClick=options.closeButton?!1:options.hideOnClick,options.hideDelay=this._hideDelay=parseInt(void 0!==options.hideDelay?options.hideDelay:options.closeButton?0:5e3),this.eventNameSpace="."+options.widgetEventPrefix,"number"==typeof options.margin||"string"==typeof options.margin){var number=isNaN(parseInt(options.margin))?0:parseInt(options.margin);options.margin={left:number,top:number,right:number,bottom:number}}else"object"==typeof options.margin?(void 0===options.margin.left&&(options.margin.left="inline"===options.display?0:10),void 0===options.margin.right&&(options.margin.right="inline"===options.display?0:10),void 0===options.margin.top&&(options.margin.top="inline"===options.display?0:10),void 0===options.margin.bottom&&(options.margin.bottom="inline"===options.display?0:10)):(options.margin={},options.margin.left=options.margin.right=options.margin.bottom=options.margin.top="inline"===options.display?0:10)},_createNotifier:function(){var o=this.options,holder=this.notifier;clearTimeout(this.autoHideTimer),/^(success|info|warning|error|custom)$/.test(o.type)||(o.type="success");var baseClass="zalertbanner "+("custom"===o.type?"":this._CLASS[o.type.toUpperCase()])+" "+("string"==typeof o.className?o.className:"");if(this.notifier.addClass(baseClass),o.icon){holder=$('<div class="zalertbanner__table">').appendTo(this.notifier);var notifierIcon=$('<i class="zalertbanner__icon"></i>').prependTo(holder);o[o.type+"SVGIconId"]||o[o.type+"IconClassName"]?ZC.createIcon(notifierIcon,void 0,o[o.type+"SVGIconId"],o[o.type+"IconClassName"]):"string"==typeof o.icon?ZC.createIcon(notifierIcon,o.icon):notifierIcon.html(this._TEMPLATE[o.type])}if(o.closeButton){var base=this,notifierClose=$('<i class="zalertbanner__icon"></i>');o.closeSVGIconId||o.closeIconClassName?ZC.createIcon(notifierClose,void 0,o.closeSVGIconId,o.closeIconClassName):notifierClose[0].innerHTML=this._TEMPLATE.close;var closeButton=$('<button type=button class="zalertbanner__close"></button').append(notifierClose).on("click"+this.eventNameSpace,function(){base._close()});$('<div class="zalertbanner__action"></div>').append(closeButton).appendTo(holder).attr("title",this._localize("close"))}if(holder.append('<span class="zalertbanner__text">'+(o.isMessageHTMLEncoded?String(o.message):ZC.encodeHTML(String(o.message)))+"</span>"),"inline"===o.display?this.options.displayInside?(this.target=$(this.options.displayInside),this.notifier.appendTo(this.target)):this.options.displayAfter?(this.target=$(this.options.displayAfter),this.notifier.insertAfter(this.target)):this.options.displayBefore&&(this.target=$(this.options.displayBefore),this.notifier.insertBefore(this.target)):(this.target=$(o.target),this.notifier.appendTo(this.target).css({position:this.target.is("body")?"fixed":"absolute"})),this.notifier.css("text-align",o.textAlign),"inline"===o.display){var actualWidth=this.notifier.outerWidth()+1;this.notifier.css("display","block");var maxWidth=this.notifier.outerWidth();actualWidth>maxWidth&&(actualWidth=maxWidth,o.align="center"),this.notifier[0].style.width=actualWidth+"px"}},_bindEvents:function(){this.options.hideOnClick&&this.notifier.on("click"+this.eventNameSpace,this._close.bind(this)),(this.options.pauseOnMouseOver||this.options.pauseOnHover)&&this._hideDelay&&this.notifier.on("mouseenter"+this.eventNameSpace,this._pauseTimer.bind(this)).on("mouseleave"+this.eventNameSpace,this._setHideTimer.bind(this))},_setHideTimer:function(){this._hideDelay&&(clearTimeout(this.autoHideTimer),this._startTimer=(new Date).getTime(),this.autoHideTimer=setTimeout(this._close.bind(this),this._hideDelay))},_pauseTimer:function(){this._startTimer&&(clearTimeout(this.autoHideTimer),this._hideDelay-=(new Date).getTime()-this._startTimer,this._startTimer=void 0)},_showComplete:function(){this._trigger("ONSHOW"),this._setHideTimer()},_open:function(){this._trigger("ONBEFORESHOW")&&this._animate(this.notifier,this.options.animation,"show","show",this._showComplete.bind(this))},_closeComplete:function(){var base=this;this._trigger("ONHIDE");var id=this.target.data("previous-bannerId");id===this.notifier.attr("id")&&this.target.removeData("previous-bannerId"),setTimeout(function(){base.notifier&&base.notifier.remove()},100)},_close:function(immediate){this._trigger("ONBEFOREHIDE")&&(clearTimeout(this.autoHideTimer),this._animate(this.notifier,immediate?void 0:this.options.animation,"hide","hide",this._closeComplete.bind(this)))},_animate:function(element,animation,action,alterFn,callback){if(animation&&"object"==typeof animation){var effect,className;"string"==typeof animation?effect=this._ANIMATION[animation][action]:animation.name?this._ANIMATION[animation.name]&&(effect=this._ANIMATION[animation.name][action]):animation[action]&&("string"==typeof animation[action]?effect=animation[action]:animation[action].name?effect=animation[action].name:animation[action].className&&(className=animation[action].className));var duration=animation.duration?animation.duration:animation[action]&&animation[action].duration?animation[action].duration:void 0;"object"==typeof effect?element.animate(effect,duration,callback):/^(fadeIn|fadeOut|slideDown|slideUp)$/.test(effect)?element[effect](duration,callback):"string"==typeof className?("show"===alterFn&&element.css("display",""),element.removeClass(element.data("css-effect")).addClass(className).data("css-effect",className).off(this._ANIMATION.end).on(this._ANIMATION.end,function(){"hide"===alterFn&&element.hide(),element.removeClass(className).removeData("css-effect"),callback()})):(element.css("display","hide"===alterFn?"none":"block"),callback())}else element.css("display","hide"===alterFn?"none":"block"),callback()},_trigger:function(customEvent,origEvent){return this._dispatchEvent(customEvent,origEvent)},_positionNotifier:function(){var o=this.options,position=this._getPosition();["left","right","top","bottom"].forEach(function(prop){o[prop]&&(position[prop]=o[prop])}),this.notifier.css(position)},_getPosition:function(){var position,align,cssPos={},margin={top:this.options.margin.top,bottom:this.options.margin.bottom,left:this.options.margin.left,right:this.options.margin.right};return/^(left|right|center)$/.test(this.options.align)||(this.options.align=$.zalertbanner.prototype.options.align),align=this.options.align,"fixed"===this.options.display?(/^(top|bottom|middle)$/.test(this.options.position)||(this.options.position=$.zalertbanner.prototype.options.position),position=this.options.position,/^(top|bottom)$/.test(position)?cssPos[position]=parseInt(margin[position]):cssPos.top="calc(50% - "+this.notifier.outerHeight()/2+"px)",this.notifier.attr("data-position",position+"-"+align)):(margin.top&&(cssPos["margin-top"]=margin.top),margin.bottom&&(cssPos["margin-bottom"]=margin.bottom)),"left"===align?margin.left&&(cssPos.left=parseInt(margin.left)):"right"===align?"fixed"!==this.options.display?cssPos.left="calc(100% - "+(this.notifier.outerWidth()+parseInt(margin.right))+"px)":cssPos.right=parseInt(margin.right):"fixed"===this.options.display?cssPos.left="calc(50% - "+this.notifier.outerWidth()/2+"px)":(cssPos["margin-left"]="auto",cssPos["margin-right"]="auto"),cssPos}};ZC.registerComponent("zalertbanner",alertbannerPrototype),ZAlertBanner.show=function(options){var target;"fixed"===options.display?(target=$(options.target),target.length||(options.target=target=$("body"))):(options.displayInside?target=$(options.displayInside):options.displayAfter?target=$(options.displayAfter):options.displayBefore&&(target=$(options.displayBefore)),target&&target.length||(target=$("body"),options.display="fixed"));var previousID=target.data("previous-bannerId");if(previousID){var element=$("#"+previousID);element.finish?element.finish():element.stop(!0,!0),element.is(":visible")&&element.length&&(ZAlertBanner.hide(element,!0),"inline"===options.display&&options.animation&&options.animation.show&&(options.animation.show=!1))}var id="zalertbanner_"+ZC.notifierCount++;return target.data("previous-bannerId",id),$('<div id="'+id+'" role="status" ></div>').zalertbanner("string"===options?{message:options}:options),id},ZAlertBanner.hide=function(notifierId,imm){if(notifierId){var notifiers=$(notifierId);notifiers.length&&notifiers.each(function(i,notifier){var data=$(notifier).data("zalertbanner");data&&data._close.call(data,imm)})}},ZC.AlertBanner=ZAlertBanner}(ZComponents),function(ZC){var $=ZC.DOMUtil;ZAlertDialog={position:"golden-mean",ANIMATION_EVENTS:"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend transitionend",overlayClassName:"",EFFECTS:{slide:{open:"slideDown",close:"slideUp"},fade:{open:"fadeIn",close:"fadeOut"}},_ALIGNMENTS:{left:"zdialogfooter--invert",right:"",center:"h-center"},DEFAULTS:{type:"custom",buttonsAlignment:"right",isHTMLEncoded:!1,isTitleHTMLEncoded:!1,isMessageHTMLEncoded:!1,className:"",icon:void 0,draggable:!0,labels:{cancel:"Cancel",no:"No",ok:"OK",yes:"Yes",close:"Close",help:"Help",suppressionMessage:"Do not show this message again."},closeIcon:void 0,helpIcon:void 0,OKButtonLabel:void 0,cancelButtonLabel:void 0,yesButtonLabel:void 0,noButtonLabel:void 0,closeButtonLabel:void 0,helpButtonLabel:void 0,suppressionDecisionBoxLabel:void 0},widgetName:"zalertdialog",open:function(options){var baseObj=this;this.close({},{},function(){baseObj._openDialog(options)})},_openDialog:function(options){if(this.options=$.extend(!0,{},this.DEFAULTS,options),this.options.customAttributes&&window.sessionStorage.suppressAlertId&&-1!==window.sessionStorage.suppressAlertId.indexOf(this.options.customAttributes.id)||window.sessionStorage.suppressAlert&&"null"!==window.sessionStorage.suppressAlert)return void(options.suppressed&&options.suppressed());this._constructDialog(),this._bindEvents(),$("body").append(this.wrapper),this._positionDialog(),this._createOverlay(),this._openWithAnimation();var base=this;ZC.$window.off("resize.zalertdialog").on("resize.zalertdialog",function(event){base.wrapper&&base.wrapper.is(":visible")&&(base.options.position&&!base.options.position.length||"center"===base.options.position)&&"resize"===event.originalEvent.type&&base._positionDialog()})},_constructDialog:function(){this.wrapper=$("<div/>").attr({"class":"zdialog zdialog--alert "+this.options.className,tabIndex:-1,role:"alertdialog","aria-modal":!0}),this.options.customAttributes&&this.wrapper.attr(this.options.customAttributes),(this.options.title||this.options.closeButton)&&(this._createTitleBar(),$.fn.zdraggable&&this.options.draggable&&this._makeDraggable()),(this.options.primaryMessage&&""!==this.options.primaryMessage.trim()||this.options.secondaryMessage&&""!==this.options.secondaryMessage.trim())&&this._createContent(),this._createFooter()},_makeDraggable:function(){this.wrapper.zdraggable({ignore:".zdialog__actiongroup",handle:".zdialog__header",container:"window"})},_createTitleBar:function(){var titleBar=$("<div/>").attr("class","zdialog__header");if(this.options.title&&titleBar.append($("<span/>").attr("class","zdialog__title").html(this.options.isHTMLEncoded||this.options.isTitleHTMLEncoded?this.options.title:ZC.encodeHTML(this.options.title))),this.options.closeButton){var closeContainer=$("<div class='zdialog__actiongroup'></div>"),closeButton=$("<button type='button'></button>").attr({"class":"zbutton zbutton--action",title:this.options.closeButtonLabel||this._getString("close")}),base=this;closeButton.on("click."+this.widgetName,function(event){base.close(event,{button:closeButton,buttonType:"CLOSE",closeButton:!0})});var iconEle=$("<i class='zbutton__icon'></i"),svgData={props:{"class":"zbutton__svg",viewBox:"0 0 16 16",width:"100%",height:"100%"},nodes:[{rect:{x:"1.5",y:"7.4",transform:"matrix(0.7071 -0.7071 0.7071 0.7071 -3.3137 8)","class":"st0",width:"13",height:"1.1"}},{rect:{x:"1.5",y:"7.4",transform:"matrix(0.7071 0.7071 -0.7071 0.7071 8 -3.3137)","class":"st0",width:"13",height:"1.1"}}]};ZC._handleIcon(iconEle,svgData,"close",this.options.closeIconClassName,this.options.closeSVGIconId),closeButton.append(iconEle),titleBar.append(closeContainer.append(closeButton))}this.wrapper.append(titleBar)},_createContent:function(){var contentPortion=$("<div class='zdialog__content'/>"),descriptionDiv=$("<div class='zdialog__description'></div>"),iconEle=$("<i class='zdialog__icon'></i>"),actualIcon=this._getIcon(iconEle);if(actualIcon&&void 0!==actualIcon&&""!==actualIcon){var iconDiv=$("<div class='zdialog__alerticon'></div>");contentPortion.append(iconDiv.append(iconEle))}if(this.options.primaryMessage&&descriptionDiv.append($("<div class='zdialog__primarytext'>").html(this.options.isHTMLEncoded||this.options.isMessageHTMLEncoded?this.options.primaryMessage:ZC.encodeHTML(this.options.primaryMessage))),this.options.secondaryMessage&&descriptionDiv.append($("<div class='zdialog__secondarytext'>").html(this.options.isHTMLEncoded||this.options.isMessageHTMLEncoded?this.options.secondaryMessage:ZC.encodeHTML(this.options.secondaryMessage))),contentPortion.append(descriptionDiv),this.options.suppressionDecisionBox){var suppressionDiv=$("<div class='zdialog__suppression'></div>"),base=this,suppressionDecisionBox=$("<div class='zcheckbox'><input id='zalert__suppression--box' type='checkbox' class='zcheckbox__helper'/><label for='zalert__suppression--box' class='zcheckbox__label'>"+(this.options.suppressionDecisionBoxLabel||this._getString("suppressionMessage"))+"</label></div>");contentPortion.append(suppressionDiv.append(suppressionDecisionBox)),suppressionDecisionBox.find("#zalert__suppression--box").on("change",function(){var checkedState=$("#zalert__suppression--box").prop("checked"),getItem=window.sessionStorage.getItem("suppressAlertId"),wrapperId=base.wrapper.attr("id");checkedState?(checkedState="true",wrapperId&&(checkedState=null!=getItem?getItem+","+wrapperId:","+wrapperId)):(checkedState=null,wrapperId&&(checkedState=null!==getItem?getItem.replace(","+wrapperId,""):void 0)),window.sessionStorage.setItem("suppressAlertId",checkedState)})}this.wrapper.append(contentPortion)},_clickHandler:function(event){var base=this,targetBtn=$(event.target).closest(".zbutton"),targetBtnData=targetBtn.data("metadata"),args={button:targetBtn,properties:targetBtnData,buttonOptions:targetBtnData};targetBtnData.action&&"string"!=typeof targetBtnData.action?targetBtnData.action(event,args):base.close(event,args),event.stopPropagation(),event.preventDefault()},_createFooter:function(){for(var buttonPanel=$("<div/>").attr({"class":"zdialog__footer "+this._ALIGNMENTS[this.options.buttonsAlignment],tabIndex:-1}),buttons=this._getButtonPanelElements(),base=this,i=0;i<buttons.length;i++){var buttonElement=$("<button>");buttons[i].customAttributes&&buttonElement.attr(buttons[i].customAttributes),buttons[i].id&&buttonElement.attr("id",buttons[i].id),buttons[i].name&&buttonElement.attr("name",buttons[i].name),buttons[i].type&&(buttonElement[0].type=buttons[i].type),buttonElement.data("metadata",buttons[i]).addClass("primary"===buttons[i].appearance?"zbutton zbutton--primary":"zbutton").append($("<span/>").attr("class","zbutton__text").text(buttons[i].text)).attr("data-text",buttons[i].text.toLowerCase()),"CANCEL"===buttons[i].action&&buttonElement.addClass("h--clickonescape"),buttonElement.on("click."+this.widgetName,base._clickHandler.bind(this)),buttonPanel.append(buttonElement),ZC._handleFocus(buttonElement)}if(this.options.helpButton){var helpButton=$("<button class='zbutton zbutton--help' type='button' title='"+(this.options.helpButtonLabel||this._getString("help"))+"'></button>"),base=this,iconEle=$("<i class='zdialog__icon'></i>"),svgData={props:{"class":"zdialog__svg grayscale",viewBox:"0 0 48 48",width:"100%",height:"100%"},nodes:[{g:{nodes:[{path:{d:"M24,0C10.7,0,0,10.7,0,24s10.7,24,24,24s24-10.7,24-24C48,10.8,37.3,0,24,0z M24,44.1c-11,0-20-9-20-20s9-20,20-20s20,9,20,20C44,35.2,35,44.1,24,44.1z"}},{g:{nodes:[{path:{d:"M22.8,31.9c-1.7,0-2.6,0.9-2.6,2.7c0,0.9,0.2,1.5,0.7,2c0.4,0.5,1.1,0.7,1.9,0.7c0.8,0,1.5-0.2,1.9-0.7c0.5-0.5,0.7-1.1,0.7-2c0-0.8-0.2-1.5-0.7-2C24.3,32.2,23.6,31.9,22.8,31.9z"}},{path:{d:"M29.3,12.4c-1.3-1.1-3.2-1.7-5.5-1.7s-4.4,0.5-6.5,1.4c-1.1,0.5-0.6,1.7-0.6,1.7l0.5,1c0,0,0.5,0.9,1.7,0.5l0,0c0.5-0.2,1-0.4,1.5-0.6c0.9-0.3,2-0.5,3.1-0.5c1.2,0,2.2,0.3,2.8,0.8c0.7,0.5,1,1.3,1,2.3c0,0.8-0.2,1.6-0.6,2.2c-0.4,0.6-1.3,1.5-2.7,2.6c-1.2,0.9-2,1.8-2.5,2.7c-0.5,0.9-0.7,1.9-0.7,3.2c0,0.9,1.1,1.1,1.1,1.1h0.7c0,0,1.4,0,1.6-1.2l0,0c0-0.8,0.2-1.4,0.5-1.8c0.4-0.6,1.1-1.3,2.2-2.1c1.3-1,2.2-1.8,2.7-2.4s0.9-1.3,1.2-2s0.4-1.5,0.4-2.3C31.4,15.1,30.7,13.5,29.3,12.4z"}}]}}]}}]};ZC._handleIcon(iconEle,svgData,"help",this.options.helpIconClassName,this.options.helpSVGIconId),helpButton.append(iconEle),this.options.helpButton.customAttributes&&helpButton.attr(this.options.helpButton.customAttributes),helpButton.on("click",function(){base.options.helpButton.action&&base.options.helpButton.action()}),buttonPanel.prepend(helpButton)}this.wrapper.append(buttonPanel)},_createCommandBar:function(buttonPane){var layout=this.options.commandBar,commandBar=$("<div class='zalertdialog__commandbar zalertdialog__footer' ></div>");if(layout.leftColumn){var leftColumn=$("<div class='zalertdialog__commandbaractionsleft'></div>"),leftButtonNames=layout.leftColumn.commands;layout.leftColumn.className&&leftColumn.addClass(layout.leftColumn.className);for(var i=0;i<leftButtonNames.length;i++)leftColumn.append(buttonPane.find(".zbutton[name="+leftButtonNames[i]+"]"));commandBar.append(leftColumn)}if(layout.centerColumn){var centerColumn=$("<div class='zalertdialog__commandbaractionscenter'></div>"),middleButtonNames=layout.centerColumn.commands;layout.centerColumn.className&&centerColumn.addClass(layout.centerColumn.className);for(var i=0;i<middleButtonNames.length;i++)centerColumn.append(buttonPane.find(".zbutton[name="+middleButtonNames[i]+"]"));commandBar.append(centerColumn)}if(layout.rightColumn){var rightColumn=$("<div class='zalertdialog__commandbaractionsright'></div>"),rightButtonNames=layout.rightColumn.commands;layout.rightColumn.className&&rightColumn.addClass(layout.rightColumn.className);for(var i=0;i<rightButtonNames.length;i++)rightColumn.append(buttonPane.find(".zbutton[name="+rightButtonNames[i]+"]"));commandBar.append(rightColumn)}return this.wrapper.find(".zdialog__footer").remove(),this.wrapper.append(commandBar),commandBar},_getString:function(label){return ZC.getI18NText("zalertdialog",label,this.options.labels,[])},_getButtonPanelElements:function(){var buttons={CANCEL:{actionType:"CANCEL",id:"zc-zdialog-cancel",text:this.options.cancelButtonLabel||this._getString("cancel"),action:"CANCEL",name:"cancel",isCancel:!0},OK:{actionType:"OK",id:"zc-zdialog-ok",text:this.options.OKButtonLabel||this._getString("ok"),appearance:"primary",name:"ok"},NO:{actionType:"NO",id:"zc-zdialog-no",text:this.options.noButtonLabel||this._getString("no"),action:"CANCEL",isCancel:!0,name:"no"},YES:{actionType:"YES",id:"zc-zdialog-yes",text:this.options.yesButtonLabel||this._getString("yes"),appearance:"primary",name:"yes"}},buttonFormats={mac:{CANCEL:buttons.CANCEL,OK:buttons.OK,NO:buttons.NO,YES:buttons.YES},windows:{OK:buttons.OK,CANCEL:buttons.CANCEL,YES:buttons.YES,NO:buttons.NO}},options=this.options,buttonsOrder=this.options.buttonsOrder;switch(buttonsOrder||(buttonsOrder=ZC.Browser.isWindows()?"windows":"mac"),buttons=buttonFormats[buttonsOrder],options.type){case"custom":case"confirm":if(!this.options.buttons)return[buttons.CANCEL,buttons.OK];default:if("string"==typeof options.buttons){var newArray=[],i=0,splitArr=options.buttons.split("-");return $.each(buttons,function(key){-1!==splitArr.indexOf(key.toLowerCase())&&(newArray[i]=buttons[key],i++)}),newArray}return"object"==typeof options.buttons?options.buttons:[buttons.OK]}},_getIcon:function(iconEle){if(this.options.icon||this.options.iconClassName||this.options.SVGIconId)return ZC._handleIcon(iconEle,void 0,void 0,this.options.iconClassName,this.options.SVGIconId,this.options.icon);var svgData={props:{viewBox:"0 0 48 48",width:"100%",height:"100%"}},type=this.options.type;if("success"===type)svgData.props["class"]="zdialog__svg successcolor",svgData.nodes=[{g:{nodes:[{path:{d:"M41.2,7.2C31.9-2.3,16.7-2.5,7.3,6.8c-9.5,9.3-9.7,24.5-0.4,33.9c9.3,9.5,24.5,9.7,33.9,0.4C50.3,31.9,50.4,16.7,41.2,7.2z M37.9,38.2c-7.9,7.7-20.5,7.6-28.2-0.3S2.1,17.4,10,9.7S30.5,2.1,38.2,10C45.9,17.8,45.8,30.5,37.9,38.2z"}},{path:{d:"M36,19.3L23.1,32.2c-1.1,1.1-2.9,1.1-4,0l-1-1l-4.5-4.6c-0.2-0.2-1-1.1-0.1-2l1.1-1.1c0.8-0.8,1.6-0.3,1.9,0l4.6,4.7l12-11.8c0.2-0.2,1.1-1,2-0.1l1.1,1.1C36.8,18.2,36.3,18.9,36,19.3z"}}]}}];else if("info"===type)svgData.props["class"]="zdialog__svg infocolor",svgData.nodes=[{g:{nodes:[{g:{nodes:[{path:{d:"M23.9,17.4c1.5,0,2.5-1.1,2.4-2.3c0-1.3-0.9-2.4-2.3-2.4s-2.4,1.1-2.4,2.4C21.6,16.3,22.6,17.4,23.9,17.4z"}},{path:{d:"M26.2,35.5V21.8c0-1.2-1.4-1.3-1.8-1.3h-0.7c0,0-1.7,0-1.7,1.1v14.3c0,0.3,0.2,0.9,1.3,0.9h1.6C25.3,36.7,26.2,36.5,26.2,35.5z"}}]}},{path:{d:"M24,0C10.7,0,0,10.7,0,24s10.7,24,24,24s24-10.7,24-24S37.3,0,24,0z M24,44C13,44,4,35,4,24S13,4,24,4s20,9,20,20S35,44,24,44z"}}]}}];else if("error"===type)svgData.props["class"]="zdialog__svg errorcolor",svgData.nodes=[{path:{d:"M41.2,7.2C31.9-2.2,16.7-2.5,7.3,6.9c-9.5,9.3-9.7,24.5-0.4,33.9c9.3,9.5,24.5,9.7,33.9,0.4C50.3,31.9,50.4,16.8,41.2,7.2z M37.9,38.2C30,46,17.4,45.9,9.7,38S2.1,17.5,10,9.8S30.5,2.1,38.2,10C45.9,17.9,45.8,30.5,37.9,38.2z"}},{path:{d:"M31.7,17.5l-1.1-1.1c-0.8-0.8-1.7-0.1-2,0.1L24,21l-4.6-4.7c-0.3-0.3-1.1-0.8-1.9,0l-1.1,1.1c-0.8,0.8-0.1,1.7,0.1,2L21,24l-4.7,4.6c-0.9,0.9-0.3,1.6-0.1,1.8l1.3,1.3c0.2,0.2,0.9,0.8,1.8-0.1L24,27l4.6,4.7c0.9,0.9,1.6,0.3,1.8,0.1l1.3-1.3c0.2-0.2,0.8-0.9-0.1-1.8L27,24l4.7-4.6C32,19.1,32.5,18.4,31.7,17.5z"}}];else if("warning"===type)svgData.props["class"]="zdialog__svg warningcolor",svgData.nodes=[{g:{nodes:[{path:{d:"M47.3,36.6L27.7,2.5c-0.9-1.4-2.4-2.2-3.9-2.1c-1.6,0-2.9,0.9-3.7,2.2L0.7,36.5c-0.9,1.3-1,3-0.2,4.4c0.8,1.5,2.3,2.4,4,2.4h39c1.6,0,3.1-0.8,3.9-2.2C48.2,39.7,48.2,38,47.3,36.6z M43.9,39.2c-0.1,0.1-0.2,0.2-0.4,0.2h-39c-0.3,0-0.4-0.2-0.5-0.3c-0.1-0.2,0-0.3,0-0.4L23.5,4.6c0,0,0.1-0.2,0.3-0.2c0,0,0,0,0,0c0.1,0,0.3,0,0.4,0.2l19.6,34C44,38.8,44,39,43.9,39.2z"}}]}},{path:{d:"M24.1,28.4L24.1,28.4c-0.8,0-1.3-0.4-1.4-1l-1-10c-0.1-1.1,1-2,2.4-2l0,0c1.4,0,2.5,0.9,2.4,2l-1,10C25.4,27.9,24.9,28.4,24.1,28.4z"}},{circle:{cx:"24",cy:"33.4",r:"2"}}];else{if("confirm"!==type)return!1;svgData.props["class"]="zdialog__svg helpcolor",svgData.nodes=[{g:{nodes:[{path:{d:"M24,0C10.7,0,0,10.7,0,24s10.7,24,24,24s24-10.7,24-24C48,10.8,37.3,0,24,0z M24,44.1c-11,0-20-9-20-20s9-20,20-20s20,9,20,20C44,35.2,35,44.1,24,44.1z"}},{g:{nodes:[{path:{d:"M22.8,31.9c-1.7,0-2.6,0.9-2.6,2.7c0,0.9,0.2,1.5,0.7,2c0.4,0.5,1.1,0.7,1.9,0.7c0.8,0,1.5-0.2,1.9-0.7c0.5-0.5,0.7-1.1,0.7-2c0-0.8-0.2-1.5-0.7-2C24.3,32.2,23.6,31.9,22.8,31.9z"}},{path:{d:"M29.3,12.4c-1.3-1.1-3.2-1.7-5.5-1.7s-4.4,0.5-6.5,1.4c-1.1,0.5-0.6,1.7-0.6,1.7l0.5,1c0,0,0.5,0.9,1.7,0.5l0,0c0.5-0.2,1-0.4,1.5-0.6c0.9-0.3,2-0.5,3.1-0.5c1.2,0,2.2,0.3,2.8,0.8c0.7,0.5,1,1.3,1,2.3c0,0.8-0.2,1.6-0.6,2.2c-0.4,0.6-1.3,1.5-2.7,2.6c-1.2,0.9-2,1.8-2.5,2.7c-0.5,0.9-0.7,1.9-0.7,3.2c0,0.9,1.1,1.1,1.1,1.1h0.7c0,0,1.4,0,1.6-1.2l0,0c0-0.8,0.2-1.4,0.5-1.8c0.4-0.6,1.1-1.3,2.2-2.1c1.3-1,2.2-1.8,2.7-2.4s0.9-1.3,1.2-2s0.4-1.5,0.4-2.3C31.4,15.1,30.7,13.5,29.3,12.4z"}}]}}]}}]}return ZC._handleIcon(iconEle,svgData,type,this.options[type+"IconClassName"],this.options[type+"SVGIconId"]),!0},_openWithAnimation:function(){if(this.options.animation&&this.options.animation.open){var base=this,animation=this.options.animation.open,animationClass=animation.className,effect=animation.name,duration=animation.duration?animation.duration:0;animationClass?this.wrapper.show().addClass(animationClass).on(this.ANIMATION_EVENTS,function(){base.wrapper.removeClass(animationClass),base._handleDialogOpen()}):"object"==typeof effect?this.wrapper.show().animate(effect,duration,base._handleDialogOpen):this.wrapper[effect](duration,base._handleDialogOpen.bind(base))}else this.wrapper.show(),this._handleDialogOpen()},_handleDialogOpen:function(){if(this.options.open&&this.options.open({dialog:this.wrapper,options:this.options}),void 0!==this.options.closeTimeout&&""!==this.options.closeTimeout){var base=this;window.setTimeout(function(){base.close({},{})},parseInt(this.options.closeTimeout))}this.wrapper.attr("aria-expanded",!0),window.ZFocusHandler&&ZFocusHandler.init(this.wrapper,this.options.excludeFocus),this._focusActionButton()},_positionDialog:function(){var dialog=this.wrapper;this.options.width&&dialog.outerWidth(this.options.width),this.options.height&&dialog.outerHeight(this.options.height);var elemWidth=dialog.outerWidth(!0)+parseInt(dialog.css("border-left-width"))+parseInt(dialog.css("border-right-width")),elemHeight=dialog.outerHeight(!0)+parseInt(dialog.css("border-bottom-width"))+parseInt(dialog.css("border-top-width")),positionObject=this._calculateGoldenMeanPosition(dialog);"object"==typeof this.options.position&&(this.options.position.left||this.options.position.top)?(positionObject=$.extend({},positionObject,this.options.position),positionObject.left=parseInt(positionObject.left)+window.pageXOffset,positionObject.top=parseInt(positionObject.top)+window.pageYOffset):"string"==typeof this.options.position&&"center"===this.options.position&&(positionObject.top=ZC.windowObject.height/2-elemHeight/2+window.pageYOffset,positionObject.left=ZC.windowObject.width/2-elemWidth/2+window.pageXOffset),dialog.css(positionObject)},_focusActionButton:function(){var buttonSelector=this.options.defaultActionButton;buttonSelector=buttonSelector&&0!==buttonSelector.indexOf("#")?"button[data-text='"+buttonSelector.toLowerCase()+"']":".zbutton--primary";var buttonTobeFocused=this.wrapper.find(buttonSelector);buttonTobeFocused.length||(buttonTobeFocused=this.wrapper.find("button:last")),buttonTobeFocused.focus()},_calculateGoldenMeanPosition:function(dialog){var phi=1.618,windowHeight=document.documentElement.clientHeight,windowWidth=document.documentElement.clientWidth,halfWindow=windowHeight/2,smallerPortion=halfWindow-halfWindow/phi,topPosition=smallerPortion-parseFloat(dialog.height()/2),leftPosition=windowWidth/2-parseFloat(dialog.width()/2);return 0>topPosition&&(topPosition=0),0>leftPosition&&(leftPosition=0),topPosition+=window.pageYOffset,leftPosition+=window.pageXOffset,{top:topPosition,left:leftPosition}},_createOverlay:function(){this._overlay=$("<div class='zdialog--overlay "+this.options.overlayClassName+"' ></div>").attr("tabindex",1),document.body.insertBefore(this._overlay[0],this.wrapper[0]),this._hideBodyScroll(!0),ZC.zIndex+=2,this._overlay.css("z-index",ZC.zIndex-1),this.wrapper.css("z-index",ZC.zIndex),this._overlay.on("keydown."+this.widgetName,function(event){event.stopPropagation(),event.preventDefault()}).on("click."+this.widgetName,function(event){event.stopPropagation()})},_hideBodyScroll:function(hide){$("body")[hide?"addClass":"removeClass"]("h-overflowhidden")},close:function(event,data,callback){data=data||{actionType:"CLOSE",isCancel:!0},this.wrapper?this.options.beforeclose?this.options.beforeclose(data)!==!1&&this._handleClose(event,data,callback):this._handleClose(event,data,callback):callback&&callback.apply(this)},_handleClose:function(event,data,callback){if(this.options.animation){var base=this,animation=this.options.animation.close,animationClass=animation.className,effect=animation.name,duration=animation.duration?animation.duration:0;animationClass?this.wrapper.addClass(animationClass).on(this.ANIMATION_EVENTS,function(){base.wrapper.removeClass(animationClass),base.wrapper.hide(),base._close(event,data,callback)}):"object"==typeof effect?this.wrapper.animate(effect,duration,function(){base._close(event,data,callback)}):this.wrapper[effect](duration,function(){base._close(event,data,callback)})}else this.wrapper.hide(),this._close(event,data,callback)},_close:function(event,data,callback){this.wrapper.remove(),this._overlay&&this._overlay.remove(),$("body").find(".zdialog--overlay").length||this._hideBodyScroll(!1),ZC.zIndex=ZC.zIndex-2,event=event?event:{},data.options=this.options,data.button=$(event.target),data.event=event,this.options.close&&this.options.close(event,data),this._overlay=this.wrapper=void 0,callback&&callback.apply(this)},_bindEvents:function(){var base=this;this.wrapper.on("keydown."+this.widgetName,function(event){if(event.keyCode===ZC.keyCode.ESCAPE){var cancelBtn=base.wrapper.find(".h--clickonescape:first");cancelBtn.length?window.setTimeout(function(){cancelBtn.trigger("click")},150):base.options.closeButton?base.wrapper.find(".zdialog__actiongroup .zbutton").trigger("click"):base.close(event,{ESCAPE_PRESSED:!0})}else if(event.keyCode===ZC.keyCode.ENTER){var buttonElement=base.wrapper.find(base.options.defaultActionButton||".zbutton--primary"),includedList=".zbutton:not(.zbutton--menu), input:not(.ztokenfield):not(.zsuggestfield-element), div.zdialog__header";$(event.target).closest(includedList).length&&buttonElement.length&&!$(event.target).closest(".zdialog__footer").length&&buttonElement.trigger("click")}event.keyCode===ZC.keyCode.TAB&&event.preventDefault()}).on("click."+this.widgetName,function(event){event.stopPropagation()}),this.wrapper.find(".zdialog__header").length&&this.wrapper.find(".zdialog__header").on("mouseup."+this.widgetName,function(){base._focusActionButton()})}},ZC.AlertDialog=ZAlertDialog}(ZComponents),function(ZC){var $=ZC.DOMUtil,sliderPrototype={options:{orientation:"horizontal",locale:void 0,thumbIconStyle:"circle",thumbIconClassName:void 0,thumbSVGIconId:void 0,min:0,max:100,step:1,valuesType:"range",value:0,minValueAllowed:void 0,maxValueAllowed:void 0,values:[],showTooltip:"never",tooltip:{position:"top",displayType:"callout",text:"#value#",isHTMLEncoded:!1},showTicks:!1,ticks:{splitBy:"count",count:4,step:void 0,randomValues:void 0,position:"bottom",showLabels:!0,showLabelsFor:void 0,labelPattern:"#value#",customLabels:void 0,isLabelHTMLEncoded:!1},valueDisplayFormat:{type:"number",currencyCode:void 0,prefix:void 0,suffix:void 0,decimalPlaces:void 0,thousandSeparator:!1},snapToTicks:!0,rangeGroups:{groups:[],isLabelHTMLEncoded:!1,labelPosition:"top"},animation:{slide:{className:void 0,duration:200}},stepBehavior:"w3",selectionStartValue:void 0,blurOnRelease:!1,className:void 0,disabled:!1,tabIndex:0,widgetEventPrefix:"zslider"},_MEASUREMENTS:["minValueAllowed","maxValueAllowed"],_CLASS:{SLIDER:"zslider",VERTICAL:"zslider--vertical",HANDLE:"zslider__thumb",TRACK:"zslider__track",FILL:"zslider__selection",PIPES:"zslider__scale",PIPE:"zslider__tick",LABELS:"zslider__labels",LABEL:"zslider__label",DISABLED:"is-disabled"},_EVENTS:{ONINIT:"init",ONFOCUS:"focus",ONBLUR:"blur",ONCHANGE:"change",ONSLIDESTART:"slidestart",ONSLIDE:"slide",ONSLIDEEND:"slideend"},_TEMPLATE:{bottom:'<svg class="zslider__pointerthumbsvg" viewBox="0 0 21 32" width="22" height="32"> <path class="pointerthumb__border" d="M16.5,15.2l-6.5,7l-6.5-7V5c0-0.9,0.7-1.6,1.6-1.6H15c0.8,0,1.5,0.7,1.5,1.6V15.2z"></path> <path class="pointerthumb__innerborder" d="M15.5,14.4l-5.5,6l-5.5-6V5.7c0-0.7,0.6-1.3,1.3-1.3h8.3c0.8,0,1.4,0.6,1.4,1.3V14.4z"></path> <path class="pointerthumb" d="M14.5,13.9L10,18.8l-4.5-4.9V6.5c0-0.6,0.5-1.1,1.1-1.1h6.8c0.6,0,1.1,0.5,1.1,1.1V13.9z"></path> </svg>',top:'<svg class="zslider__pointerthumbsvg" viewBox="0 0 21 32" width="22" height="32"><path class="pointerthumb__border" d="M3.5,12.8l6.5-7l6.5,7V23c0,0.9-0.7,1.6-1.6,1.6H5c-0.8,0-1.5-0.7-1.5-1.6V12.8z"></path> <path class="pointerthumb__innerborder" d="M4.5,13.6l5.5-6l5.5,6v8.7c0,0.7-0.6,1.3-1.3,1.3H5.9c-0.8,0-1.4-0.6-1.4-1.3V13.6z"></path> <path class="pointerthumb" d="M5.5,14.1L10,9.2l4.5,4.9v7.4c0,0.6-0.5,1.1-1.1,1.1H6.6c-0.6,0-1.1-0.5-1.1-1.1V14.1z"></path> </svg>',left:'<svg class="zslider__pointerthumbsvg" viewBox="0 0 32 21"  width="32" height="22"><path class="pointerthumb__border" d="M12.8,16.5l-7-6.5l7-6.5l10.2,0c0.9,0,1.6,0.7,1.6,1.6l0,9.9c0,0.8-0.7,1.5-1.6,1.5L12.8,16.5z"></path> <path class="pointerthumb__innerborder" d="M13.6,15.5l-6-5.5l6-5.5l8.7,0c0.7,0,1.3,0.6,1.3,1.3l0,8.3c0,0.8-0.6,1.4-1.3,1.4L13.6,15.5z"></path> <path class="pointerthumb" d="M14.1,14.5L9.2,10l4.9-4.5l7.4,0c0.6,0,1.1,0.5,1.1,1.1l0,6.8c0,0.6-0.5,1.1-1.1,1.1L14.1,14.5z"></path> </svg>',right:'<svg class="zslider__pointerthumbsvg" viewBox="0 0 32 21" width="32" height="22"><path class="pointerthumb__border" d="M15.2,3.5l7,6.5l-7,6.5L5,16.5c-0.9,0-1.6-0.7-1.6-1.6V5c0-0.8,0.7-1.5,1.6-1.5L15.2,3.5z"></path> <path class="pointerthumb__innerborder" d="M14.4,4.5l6,5.5l-6,5.5H5.7c-0.7,0-1.3-0.6-1.3-1.3l0-8.3c0-0.8,0.6-1.4,1.3-1.4H14.4z"></path> <path class="pointerthumb" d="M13.9,5.5l4.9,4.5l-4.9,4.5H6.5c-0.6,0-1.1-0.5-1.1-1.1l0-6.8c0-0.6,0.5-1.1,1.1-1.1H13.9z"></path> </svg>'},_create:function(element,options){this._frominit=!0,this.element.hide(),this._eventNamespace="."+options.widgetEventPrefix;var base=this;["min","max","step","value","title","tabIndex"].forEach(function(attr){null!==base.element[0].getAttribute(attr)&&(options[attr]=base.element[0][attr])}),this.element[0].disabled&&(options.disabled=!0),/^(range|fixed)$/.test(options.valuesType)||(options.valuesType="range"),/^(never|always|onslide)$/.test(options.showTooltip)||(options.showTooltip="never"),"vertical"===options.orientation&&(this.vertical=!0),options.locale=options.locale||ZC.locale,this._cacheMeasurements(),this._setFixedValues(),this._validateProperty(),this._constructLayout(),this._showHiddenParent(),this._constructThumb(),this._constructScale(),this._constructRangeLabels(),this._constructLimitLayout(),this._positionHandle(),this._resetParent(),this._bindEvents(),this._setInitial(),options.disabled&&this._setAttribute("disabled",!0),this._trigger("ONINIT"),this._frominit=!1},_getFromLocale:function(prop,currency){var value=this["_"+prop];if(void 0===value)if(currency)"currency_code"===prop?value=this.options.valueDisplayFormat.currencyCode?this.options.valueDisplayFormat.currencyCode:ZC.localeInfo?ZC.localeInfo[this.options.locale].currency.code:void 0:(!this._currencyData&&ZC.currencyInformation&&(this._currencyData=ZC.currencyInformation[this._getFromLocale("currency_code",!0)]),this._currencyData&&(value=this._currencyData[prop.replace("currency_","")]));else if(ZC.localeInformation){var base=this;Object.keys(ZC.localeInformation[prop]).some(function(separator){var locales=ZC.localeInformation[prop][separator];return-1!==locales.indexOf(base.options.locale)?value=separator:!1})}return this["_"+prop]=value?value:!1},_cacheMeasurements:function(){this.actualProps={};var base=this;this._MEASUREMENTS.forEach(function(opt){base.actualProps[opt]=base.options[opt]})},_constructLayout:function(){var options=this.options,baseClass=this.element[0].className+" "+this._CLASS.SLIDER+(this.vertical?" zslider--vertical":" ")+("string"==typeof options.className?" "+options.className:" ");this.container=$(document.createElement("div")).attr({"class":baseClass,style:this.element[0].getAttribute("style"),title:options.title}).insertAfter(this.element),this.container[0].style.display="",this.container[0].innerHTML='<div class="zslider__shadowtrack"></div><div class="'+this._CLASS.TRACK+'"> <div class="'+this._CLASS.FILL+'"></div></div>',this._innerSlider=$(this.container[0].querySelector("."+this._CLASS.TRACK)),this._range=$(this.container[0].querySelector("."+this._CLASS.FILL)),this._shadowTrack=$(this.container[0].querySelector(".zslider__shadowtrack"))},_constructThumb:function(){this.container.append(this._createThumb()),this._handles=Array.prototype.slice.call(this.container[0].querySelectorAll("."+this._CLASS.HANDLE),0),this._updateDimensions()},_createThumb:function(){var o=this.options,thumb=$('<div role="slider" class="'+this._CLASS.HANDLE+'" aria-orientation="'+o.orientation+'" aria-valuemin="'+o.min+'" aria-valuemax="'+o.max+'"></div>');if(o.disabled?thumb.addClass(this._CLASS.DISABLED).attr("aria-disabled",!0):thumb[0].tabIndex=o.tabIndex,o.thumbIconClassName||o.thumbSVGIconId)return ZC.createIcon(thumb,void 0,o.thumbSVGIconId,o.thumbIconClassName);if("pointer"===o.thumbIconStyle){thumb.addClass("zslider__pointerthumb");var scalePosition=o.showTicks?o.ticks.position:"",dir="";/^(left|top)$/.test(scalePosition)?(dir=this.vertical?"left":"top",thumb.addClass("h-inverted")):dir=this.vertical?"right":"bottom",thumb.html(this._TEMPLATE[dir])}else thumb.addClass("zslider__circlethumb");return thumb},_updateDimensions:function(){this.vertical?(this.innerDim="height",this.outerDim="outerHeight",this.marginDir="bottom",this.oppOuterDim="outerWidth",this.oppMargin="left"):(this.innerDim="width",this.outerDim="outerWidth",this.marginDir="left",this.oppOuterDim="outerHeight",this.oppMargin="top");var handle=$(this._handles[0]);this.sliderDim={height:this._innerSlider.height(),width:this._innerSlider.width(),outerHeight:this._innerSlider.outerHeight(),outerWidth:this._innerSlider.outerWidth()},this.handleDim={outerHeight:handle.outerHeight(),outerWidth:handle.outerWidth()}},_showHiddenParent:function(){if(document.body.contains(this.container[0])&&this.container.is(":hidden")){var i=1;this.hiddenParents=[],this.prevStyles=[];for(var parent=this.container;i&&parent&&!parent.is("body");)"none"===parent.css("display")&&(this.hiddenParents.push(parent),this.prevStyles.push(parent.attr("style")||""),parent.css({display:"block",position:"absolute",visibility:"hidden"}),i=parent.is(":hidden")),parent=parent.parent()}},_resetParent:function(){if(this.hiddenParents){var base=this;this.hiddenParents.forEach(function(parent,i){parent.attr("style",base.prevStyles[i])}),this.hiddenParents=this.prevStyles=void 0}},_positionHandle:function(){var innersliderOffset=this._innerSlider.position(),trackTop=parseInt(innersliderOffset[this.oppMargin]),trackHalfHt=this.sliderDim[this.oppOuterDim]/2,handleHalfHt=this.handleDim[this.oppOuterDim]/2,shadowTrackHalfHt=this._shadowTrack[this.oppOuterDim]()/2;$(this._handles).css(this.oppMargin,trackTop-(handleHalfHt-trackHalfHt)+"px").css("margin-"+this.marginDir,-this.handleDim[this.outerDim]/2+"px"),this._shadowTrack.css(this.oppMargin,trackTop-(shadowTrackHalfHt-trackHalfHt)+"px"),!this._frominit&&this._updateTip()},_setInitial:function(){this._setInitialValue(),this._updateLayout()},_setInitialValue:function(){this.setValue(this.options.value)},_constructLimitLayout:function(){var o=this.options;"fixed"!==o.valuesType&&(o.minValueAllowed!==o.min&&this._createLimitBox(o.min,o.minValueAllowed,"zslider__selected"),o.maxValueAllowed!==o.max&&this._createLimitBox(o.maxValueAllowed,o.max,"zslider__notallowedrange"))},_constructRangeLabels:function(){var groups,o=this.options;if("fixed"!==o.valuesType&&Array.isArray(groups=this._parseArray(o.rangeGroups.groups))&&groups.length){var base=this;this._range.hide(),this.container.addClass("zslider--range"),this._rangeLayout=$('<div class="zslider__rangelabels"></div>'),this._rangeBgs=[],this._rangeTicks=[];var lastPer=0,labelHtmls=[],rangeHtmls=[],getPercent=function(value){if(void 0!==value){if(/%$/.test(value)&&(value=o.min+(o.max-o.min)*parseFloat(value)/100),isNaN(value)||value<o.min||value>o.max)return;if(+value!==o.max)return base._getPercent(+value)}};o.rangeGroups.groups.forEach(function(rangeLabel){var fromPer=0;rangeLabel.from!==o.min&&(fromPer=getPercent(rangeLabel.from)),isNaN(fromPer)||(lastPer=fromPer);var curPer=100;if(rangeLabel.to!==o.max&&(curPer=getPercent(rangeLabel.to)),!isNaN(curPer)){var style=base.marginDir+":"+lastPer+"%;"+base.innerDim+":"+(curPer-lastPer)+"%;";if(rangeHtmls.push('<div class="zslider__rangegroup '+(rangeLabel.className?rangeLabel.className:"")+'" style="'+style+(rangeLabel.background?"background:"+rangeLabel.background:"")+';" ></div>'),base.vertical){var innerStyle="max-"+base.innerDim+":"+base.sliderDim[base.outerDim]*(curPer-lastPer)/100+"px";labelHtmls.push('<div class="zslider__rangelabel" style="'+style+'"><span class="zslider__textcontainer" > <span class="zslider__text" style="'+innerStyle+'">'+rangeLabel.label+"</span></span></div>")}else labelHtmls.push('<div class="zslider__rangelabel" style="'+style+'">'+rangeLabel.label+"</div>");lastPer=curPer}});var childselector=".zslider__rangelabel";this.vertical&&(rangeHtmls=rangeHtmls.reverse().join(""),labelHtmls=labelHtmls.reverse().join(""),childselector=".zslider__text"),this._innerSlider.prepend(rangeHtmls),this._rangeLayout.append(labelHtmls),this._positionRangeLabels(),Array.prototype.slice.call(this._rangeLayout[0].querySelectorAll(childselector),0).forEach(function(label){(label.offsetWidth<label.scrollWidth-2||label.offsetHeight<label.scrollHeight-2)&&label.setAttribute("title",label.textContent)})}},_positionRangeLabels:function(){var rangeGpSettings=this.options.rangeGroups;if(this._rangeLayout){var position=rangeGpSettings.labelPosition;/^(bottom|right)$/.test(position)?(this.container.append(this._rangeLayout),this._rangeLayout.addClass("h-inverted")):(this.container.prepend(this._shadowTrack,this._rangeLayout),this._rangeLayout.removeClass("h-inverted"))}},_createLimitBox:function(min,max,className){var props={},range=$('<div class="'+(className||"")+'"></div>');this._innerSlider.append(range);var minPercent=parseFloat(min)===this.options.min?0:this._getPercent(min),maxPercent=parseFloat(max)===this.options.max?100:this._getPercent(max);props[this.marginDir]=minPercent+"%",props[this.innerDim]=maxPercent-minPercent+"%",range.css(props);var o=this.options;Array.prototype.slice.call(this.container[0].querySelectorAll(".zslider__tick,.zslider__label"),0).forEach(function(node){var val=+node.getAttribute("data-val");min>val||val>max||val===min&&min!==o.min||val===max&&max!==o.max||$(node).addClass("is-disabled")})},_bindEvents:function(){this.container.on("mousedown"+this._eventNamespace,".zslider__shadowtrack,.zslider__track,.zslider__thumb,.zslider__tick,.zslider__label",this._onMouseDown.bind(this)).on("keydown"+this._eventNamespace,"."+this._CLASS.HANDLE,this._onSlide.bind(this)).on("keyup"+this._eventNamespace,"."+this._CLASS.HANDLE,this._onSlideEnd.bind(this)).on("mouseup"+this._eventNamespace,this._onSlideEnd.bind(this)).on("mouseenter"+this._eventNamespace,"."+this._CLASS.HANDLE,this._onThumbEnter.bind(this)).on("mouseleave"+this._eventNamespace,"."+this._CLASS.HANDLE,this._onThumbLeave.bind(this)).on("focusin"+this._eventNamespace,this._onFocus.bind(this)).on("focusout"+this._eventNamespace,this._onFocusout.bind(this))},_onFocus:function(){this.container.addClass("has-focus"+(this._mouseActive?"":" on-tabfocus")),this._trigger("ONFOCUS")},_onFocusout:function(){var base=this;clearTimeout(this.blurtimer),this.blurtimer=setTimeout(function(){$(base._handles).is(":focus")||$(document.activeElement).closest(".zslider").length||(base.container.removeClass("is-active on-tabfocus has-focus"),$(base._activeHandle).removeClass("is-active"),base._mouseActive=base._animate=!1,base._trigger("ONBLUR"))},1)},_onThumbEnter:function(origEvent){if(!this.container.hasClass(this._CLASS.DISABLED)){var target=$(origEvent.target).closest("."+this._CLASS.HANDLE);target.addClass("on-mouseover"),this._showTip(origEvent)}},_onThumbLeave:function(origEvent){if(!this.container.hasClass(this._CLASS.DISABLED)){var target=$(origEvent.target).closest("."+this._CLASS.HANDLE);target.removeClass("on-mouseover"),!this._dragStarted&&!this._dragSelectionStarted&&this._hideTip()}},_showTip:function(origEvent){var o=this.options;"fixed"!==o.valuesType&&"never"!==o.showTooltip&&this._tooltip&&(this._tooltip[0].style.display="","at-cursor"===o.tooltip.position&&origEvent&&("vertical"===o.orientation?this._tooltip[0].style.top=Math.max(Math.min(origEvent.pageY-this.container.offset().top,this.sliderDim.outerHeight),0)+"px":this._tooltip[0].style.left=Math.max(Math.min(origEvent.pageX-this.container.offset().left,this.sliderDim.outerWidth),0)+"px"))},_hideTip:function(){"always"!==this.options.showTooltip&&this._tooltip&&(this._tooltip[0].style.display="none")},_keyPress:function(origEvent){var value,keyCode=origEvent.keyCode;if(keyCode===ZC.keyCode.HOME)value=this.options.minValueAllowed;else if(keyCode===ZC.keyCode.END)value=this.options.maxValueAllowed;else if(keyCode===ZC.keyCode.RIGHT||keyCode===ZC.keyCode.UP||keyCode===ZC.keyCode.PAGE_UP)value=this._increase(this.options.value);else{if(keyCode!==ZC.keyCode.LEFT&&keyCode!==ZC.keyCode.DOWN&&keyCode!==ZC.keyCode.PAGE_DOWN)return;value=this._decrease(this.options.value)}return origEvent.preventDefault(),value},_getActiveHandle:function(){return this._handles[0]},_onMouseDown:function(origEvent){this.container.hasClass(this._CLASS.DISABLED)||(this._mouseActive=!0,this.container.removeClass("on-tabfocus").addClass("is-active"),$(this._activeHandle).removeClass("is-active"),this._activeHandle=this._getActiveHandle(origEvent),$(this._activeHandle).addClass("is-active"),!this.options.blurOnRelease&&this._activeHandle.focus(),$(origEvent.target).closest(".zslider__thumb").length||this._onSlide(origEvent),this._bindDocumentEvent(origEvent))},_bindDocumentEvent:function(origEvent){ZC.$document.off(this._eventNamespace).on("mousemove"+this._eventNamespace,this._onSlide.bind(this)).on("mouseup"+this._eventNamespace,this._onSlideEnd.bind(this)),origEvent.preventDefault()},_onSlide:function(origEvent){if(!this.container.hasClass(this._CLASS.DISABLED)){var value=this._getValueFromEvent(origEvent);this._showTip(origEvent),void 0!==value&&(this._animate="mousemove"!==origEvent.type,this._dragStarted||(this._storeInitialValue(),this._dragStarted=!0,this._trigger("ONSLIDESTART",origEvent)),this._setValue(value,origEvent),this._trigger("ONSLIDE",origEvent),origEvent.preventDefault())}},_onSlideEnd:function(origEvent){this.container.hasClass(this._CLASS.DISABLED)||(ZC.$document.off(this._eventNamespace),this._dragStarted&&(this._trigger("ONSLIDEEND",origEvent),this._isChangeInValue()&&this._updateLayout(origEvent)),!$(this._activeHandle).hasClass("on-mouseover")&&this._hideTip(),this.container.removeClass("is-active"),this._animate=this._mouseActive=this._dragStarted=!1)},_storeInitialValue:function(){this._startValue=this.getValue()},_isChangeInValue:function(){return this._startValue!==this.getValue()},_getValueFromEvent:function(origEvent){var target=$(origEvent.target);if("mousedown"===origEvent.type&&target.hasClass("zslider__label")){if(target.hasClass("is-disabled"))return;return this._getInnerVal(target[0].getAttribute("data-val"))}if("keydown"===origEvent.type)return this._keyPress(origEvent);var offset,cursorPercent,getCustomVal,sliderLength=this.sliderDim[this.innerDim],handleLength=this.handleDim[this.outerDim],totalpixel=sliderLength-handleLength,operator=1,slideroffset=this._innerSlider.offset();if("function"==typeof this.options.getCustomValue&&(getCustomVal=this.options.getCustomValue,handleLength=0),this.vertical?(offset=origEvent.pageY-(slideroffset.top+handleLength/2),operator=-1,cursorPercent=1-offset/totalpixel):(offset=origEvent.pageX-(slideroffset.left+handleLength/2),cursorPercent=offset/totalpixel),0>cursorPercent?cursorPercent=0:cursorPercent>1&&(cursorPercent=1),getCustomVal)return getCustomVal(100*cursorPercent,this.options.min,this.options.max,this._handles.indexOf(this._activeHandle));var value=this.options.min+cursorPercent*(this.options.max-this.options.min);return value=this._trimDecimal(this.options.min,this.options.step,value),this.options.snapToTicks&&this._dragStarted&&(value=this._trimForSnap(value,offset+handleLength/2)),value},_trimValue:function(value){var o=this.options,mod=(parseFloat(value)-o.min)%o.step;if(0!==mod){var adjustedVal=parseFloat(value)-mod;2*Math.abs(mod)>o.step&&(adjustedVal+=mod>0?o.step:-o.step),value=adjustedVal}return this._trimDecimal(o.min,o.step,value)},_trimForSnap:function(value,left){if(this._ticksLayout&&this._gridValues&&this._gridValues.length){value=parseFloat(value);for(var nearestPt=this._gridValues[0],min_dis=Math.abs(this._gridValues[0]-value),i=1;i<this._gridValues.length;i++){var dis=Math.abs(this._gridValues[i]-value);min_dis>dis&&(nearestPt=this._gridValues[i],min_dis=dis)}if(nearestPt%this.options.step===0&&nearestPt!==value){var gridLeft,nearestGrid=this._ticksLayout.find('[data-val="'+nearestPt+'"]');gridLeft=this.vertical?nearestGrid.position().top:nearestGrid.position().left,Math.abs(gridLeft-left)<7&&(value=this._getActualVal(nearestPt))}}return value},_trimDecimal:function(min,step,value){var minDecimal=String(min).split(".")[1],stepDecimal=String(step).split(".")[1],decimalplace=Math.max(minDecimal&&minDecimal.length||0,stepDecimal&&stepDecimal.length||0);return+(+value).toFixed(decimalplace)},_validateProperty:function(){var o=this.options;if("fixed"!==o.valuesType)o.step=parseFloat(o.step),o.min=parseFloat(o.min),o.max=parseFloat(o.max),o.value=parseFloat(o.value),o.minValueAllowed=parseFloat(o.minValueAllowed),o.maxValueAllowed=parseFloat(o.maxValueAllowed),(isNaN(o.step)||o.step<=0)&&(o.step=1),isNaN(o.min)&&(o.min=0),isNaN(o.max)&&(o.max=100),o.max<=o.min&&(o.max=o.min+o.step),o.max-o.min<o.step&&(o.step=o.max-o.min),(isNaN(o.minValueAllowed)||o.minValueAllowed<o.min||o.max-o.minValueAllowed<o.step)&&(o.minValueAllowed=o.min),(isNaN(o.maxValueAllowed)||o.maxValueAllowed>o.max||o.maxValueAllowed<o.minValueAllowed||o.maxValueAllowed-o.minValueAllowed<o.step)&&(o.maxValueAllowed=o.max),isNaN(o.value)||o.value<o.minValueAllowed?o.value=o.minValueAllowed:o.value>o.maxValueAllowed&&(o.value=o.maxValueAllowed);else{o.step=1,o.min=o.minValueAllowed=0,o.max=o.maxValueAllowed=o.values.length-1;var index=this._getInnerVal(o.value);0>index&&(o.value=this._getInnerVal(0))}},_setValue:function(value,origEvent){var prevVal=this.options.value;this.options.value=this._getActualVal(this._getCorrectedValue(value,this.options.minValueAllowed,this.options.maxValueAllowed)),prevVal!==this.options.value&&this._updateLayout(origEvent)},_getCorrectedValue:function(value,min,max){value=+value;var o=this.options;if("fixed"===o.valuesType?(min=o.min,max=o.max):(min<o.min&&(min=o.min),max>o.max&&(max=o.max)),"default"===o.stepBehavior&&(min>=value||value>=max||isNaN(value)))min>value||isNaN(value)?value=min:value>max&&(value=max);else{if(value=this._trimValue(value),min>value||isNaN(value)){var mod=(min-o.min)%o.step||o.step;value=min+o.step-mod}else value>max&&(value=max-(max-o.min)%o.step);value=this._trimDecimal(o.min,o.step,value)}return value},_setFixedValues:function(){if("fixed"===this.options.valuesType){this._values=[],this._labels=[];var base=this;this.options.values.forEach(function(obj){"string"==typeof obj||"number"==typeof obj?(base._values.push(String(obj)),base._labels.push(obj)):void 0!==obj.value&&(base._values.push(String(obj.value)),base._labels.push(obj.label||obj.value))})}},_getInnerVal:function(actualVal){return"fixed"===this.options.valuesType?this._values.indexOf(String(actualVal)):actualVal},_getActualVal:function(value){return"fixed"===this.options.valuesType?this._values[value]:value},_updateLayout:function(origEvent){var handleObj={},o=this.options,oncomplete=function(){this._animate=!1,this._frominit||origEvent&&/(keydown|mousedown|mousemove)/.test(origEvent.type)||this._trigger("ONCHANGE",origEvent)},valPer=this._getPercent(o.value);handleObj[this.marginDir]=valPer+"%";var rangeObj={},left=0,width=valPer,progressFrom=parseFloat(o.selectionStartValue);!isNaN(progressFrom)&&progressFrom>o.min&&progressFrom<=o.max&&(left=progressFrom===o.max?100:this._getPercent(o.selectionStartValue),o.selectionStartValue>=o.value&&(width=[left,left=width][0])),rangeObj[this.marginDir]=left+"%",rangeObj[this.innerDim]=width-left+"%";var attr={"data-val":this._getInnerVal(o.value),"aria-valuenow":this._getInnerVal(o.value),"aria-valuetext":o.value};this._handleAnimation($(this._handles[0]).attr(attr),handleObj),this._handleAnimation(this._range,rangeObj,oncomplete.bind(this)),this._updateTip(handleObj)},_handleAnimation:function(element,object,callback){var duration=this.options.animation.slide.duration,className=this.options.animation.slide.className;element.stop();var animationEndEvent="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";this._animate&&(duration||className)?className?element.addClass(className).off(animationEndEvent).on(animationEndEvent,function(){element.removeClass(className),callback&&callback()}):element.animate(object,duration,callback):(element.css(object),callback&&callback())},_updateTip:function(handleObj){if(this._tooltip||this._createTooltip(),this._tooltip&&"fixed"!==this.options.valuesType){this._tooltip.find(".ztooltip__content").text(this._getTipText());var pos=this._getTipPosition(handleObj);this._handleAnimation(this._tooltip,pos)}},_getLabel:function(template,label,encode){return label=this._getFormattedLabel(label),"string"==typeof template&&""!==template.trim()&&(label=template.replace(new RegExp("#value#","gi"),label)),encode?ZC.encodeHTML(label):label},_getFormattedLabel:function(label){if("fixed"!==this.options.valuesType&&void 0!==label){var base=this,formatter=this.options.valueDisplayFormat,precision=parseInt(formatter.decimalPlaces),thousandSep=this._getFromLocale("thousandSeparator"),decimalSep=this._getFromLocale("decimalSeparator");label=label.toString(),precision>=0&&20>=precision&&!isNaN(precision)&&(label=(+label).toFixed(precision));var splits=label.split(".");formatter.thousandSeparator&&(splits[0]=splits[0].replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g,"$1"+(thousandSep||","))),label=splits.join(decimalSep||".");var pattern=label;"string"==typeof formatter.prefix?pattern=formatter.prefix+pattern:"currency"===formatter.type&&(pattern="#symbol#"+pattern),"string"==typeof formatter.suffix&&(pattern+=formatter.suffix),pattern!==label&&(label=pattern.replace(/#value#/gi,label),"currency"===formatter.type&&["code","symbol","name"].forEach(function(prop){var regex=new RegExp("#"+prop+"#","gi");if(regex.test(pattern)){var value=base._getFromLocale("currency_"+prop,!0);value&&(label=label.replace(regex,value))}}))}return label},_resetLocaleData:function(){this._thousandSeparator=this._decimalSeparator=this._currencyData=this._currency_code=this._currency_name=this._currency_symbol=void 0},_getTipText:function(){var o=this.options;return this._getLabel(o.tooltip.text,o.value,!o.tooltip.isHTMLEncoded)},_getTipPosition:function(handleObj){var pos={},position=this.options.tooltip.position,operator=/^(top|left)$/.test(position)?-1:1,length="outerHeight",adjLength="outerWidth",mainDir="top";/^(left|right)$/.test(position)&&(length="outerWidth",adjLength="outerHeight",mainDir="left");var sliderLn=this.sliderDim[length],tooltipLn=this._tooltip[length](),pointerLn=this.pointer?this.pointer[length]():0,handleLn=this.handleDim[length],totalLn=(sliderLn>handleLn?0:(handleLn-sliderLn)/2)+pointerLn+0;return totalLn+=position===mainDir?tooltipLn:sliderLn,pos[mainDir]=this._innerSlider.position()[mainDir]+totalLn*operator+"px","at-cursor"!==position&&(pos["margin-"+this.marginDir]=-(this._tooltip[adjLength]()/2)+"px",pos[this.marginDir]=handleObj?handleObj[this.marginDir]:this._handles[0].style[this.marginDir]),pos},_createTooltip:function(){var o=this.options;if("fixed"!==o.valuesType&&"never"!==o.showTooltip){var position=o.tooltip.position;this.pointer=!1;var pointerClass={left:"h-right",right:"h-left",top:"h-bottom",bottom:"h-top","at-cursor":"h-top"};"at-cursor"===position&&"onslide"===o.showTooltip?o.tooltip.displayType="box":this.vertical?/^(left|right)$/.test(position)||(position="bottom"===position?"right":"left"):/^(top|bottom)$/.test(position)||(position="right"===position?"bottom":"top"),o.tooltip.position=position,this._tooltip=$("<div class='ztooltip ztooltip--"+("at-cursor"===position?"bottom":position)+"'><div class='ztooltip__content'></div>"+("callout"===o.tooltip.displayType?'<div class="ztooltip__pointer '+pointerClass[position]+'"></div>':"")+"</div>").appendTo(this.container),"callout"===o.tooltip.displayType&&(this.pointer=$(this._tooltip[0].querySelector(".ztooltip__pointer")),this.vertical&&this.pointer.css({top:"auto"}),this.pointer[0].style[this.marginDir]="calc(50% - "+this.pointer[this.outerDim]()/2+"px)"),"always"!==o.showTooltip&&this._hideTip()}},_getPercent:function(value){if(value=this._getInnerVal(value),this.options.getCustomPosition)return this.options.getCustomPosition(value,this.options.min,this.options.max);var percent=(parseFloat(value)-this.options.min)/(this.options.max-this.options.min),sliderLength=this.sliderDim[this.innerDim],handleLength=this.handleDim[this.outerDim];return percent=100*(percent*(1-handleLength/sliderLength)+.5*handleLength/sliderLength)},_constructScale:function(){(this.options.showTicks||"fixed"===this.options.valuesType)&&(this._ticksLayout=$("<div>",{"class":this._CLASS.PIPES}).appendTo(this.container),this._constructGrids(),this._constructLabel(),this._positionScale())},_positionScale:function(){if(this.options.showTicks){var scalePosition=this.options.ticks.position,elements=$(this._handles).add(this._ticksLayout).add(this._labelsLayout);/^(left|top)$/.test(scalePosition)?(elements.addClass("h-inverted"),this._innerSlider.before(this._labelsLayout,this._ticksLayout)):(elements.removeClass("h-inverted"),this._innerSlider.after(this._ticksLayout,this._labelsLayout))}},_constructGrids:function(){var random,base=this,o=this.options,values=this._gridValues=[],splitBy=o.ticks.splitBy;if("fixed"===o.valuesType&&(o.ticks.step=1,splitBy="step"),"step"===splitBy&&o.ticks.step>0){o.ticks.step=parseFloat(o.ticks.step);for(var val=o.min;val<=o.max;val+=o.ticks.step)values.push(base._getActualVal(base._trimDecimal(o.min,o.ticks.step,val)))}else if("random"===splitBy&&Array.isArray(random=this._parseArray(o.ticks.randomValues)))random.forEach(function(val){val=parseFloat(val),!isNaN(val)&&val>=o.min&&val<=o.max&&-1===values.indexOf(val)&&values.push(val)}),this._gridValues=values=values.sort(function(a,b){return+a-+b});else{o.ticks.count=parseInt(o.ticks.count);for(var count=o.ticks.count>1?o.ticks.count:4,step=(o.max-o.min)/(count-1),i=0;count>i;i++){var value;value=0===i?o.min:i===count-1?o.max:this._trimDecimal(o.min,step,i*step+o.min),values.push(value)}}var html="";values.forEach(function(val){var percent=base._getPercent(val)+"%";html=html+"<div class='"+base._CLASS.PIPE+"' data-val='"+val+"' style='"+base.marginDir+":"+percent+"'></div>"}),this._ticksLayout[0].innerHTML=html,this._ticks=Array.prototype.slice.call(this._ticksLayout[0].children,0);var gridlength=$(this._ticks[0])[this.outerDim]();$(this._ticks).css("margin-"+this.marginDir,-gridlength/2+"px")},_constructLabel:function(){var o=this.options;if(o.showTicks&&o.ticks.showLabels||"fixed"===o.valuesType){this._labelsLayout=$("<div>",{"class":this._CLASS.LABELS}).appendTo(this.container);var grids=this._ticks;if(grids&&grids.length){var base=this,sliderLength=this.sliderDim[this.innerDim],labels="fixed"===o.valuesType?this._labels:this._parseArray(o.ticks.customLabels),finalLabels=[],_labelledGrids=[],labelDimensions=[],showFor=this._parseArray(o.ticks.showLabelsFor),tempspan=$("<div>",{"class":this._CLASS.LABEL}).appendTo(this._labelsLayout),pushToArray=function(label){tempspan.text(label),labelDimensions.push(tempspan[base.outerDim]()+1),finalLabels.push(label)};if(Array.isArray(labels)&&labels.length)for(var labelCount=0,i=0;i<grids.length&&labelCount!==labels.length;i++){var value=grids[i].getAttribute("data-val");if(!Array.isArray(showFor)||!showFor.length||showFor.indexOf(value)>-1){var label=labels[labelCount++];pushToArray(o.ticks.isLabelHTMLEncoded?label:ZC.encodeHTML(label)),_labelledGrids.push(grids[i])}}else _labelledGrids=grids,grids.forEach(function(grid){var value=grid.getAttribute("data-val");(!Array.isArray(showFor)||!showFor.length||showFor.indexOf(value)>-1)&&pushToArray(base._getLabel(o.ticks.labelPattern,value,!o.ticks.isLabelHTMLEncoded))});if(tempspan.remove(),_labelledGrids.length){if(this.vertical)_labelledGrids.forEach(function(grid,i){var label=$('<div class="'+base._CLASS.LABEL+'" data-val="'+grid.getAttribute("data-val")+'" style="bottom:"'+grid.style.bottom+'";">'+finalLabels[i]+"</div>").appendTo(base._labelsLayout);label[0].style.bottom="calc("+grid.style.bottom+" - "+label[0].offsetHeight/2+"px)"});else{for(var EXTRADIM=60,labelHtml="",length=_labelledGrids.length,prevDim=parseInt($(_labelledGrids[0]).css(this.marginDir))+EXTRADIM,i=0;length>i;i++){var curGrid=$(_labelledGrids[i]),nextGrid=$(_labelledGrids[i+1]),nextDim=Math.abs((nextGrid.length?parseInt(nextGrid.css(this.marginDir)):sliderLength+EXTRADIM)-parseInt(curGrid.css(this.marginDir)));nextGrid.length&&labelDimensions[i+1]<nextDim&&(nextDim=Math.abs(nextDim+(nextDim-labelDimensions[i+1])));var labelDim=Math.min(prevDim,nextDim,labelDimensions[i]);if(labelDim){prevDim=nextDim+(nextDim-labelDim);var percent=base._getPercent(curGrid.attr("data-val"))+"%";percent="calc("+percent+" - "+labelDim/2+"px)",labelHtml=labelHtml+"<div  class='"+this._CLASS.LABEL+"' data-val='"+curGrid[0].getAttribute("data-val")+"' style = '"+this.innerDim+":"+labelDim+"px; "+this.marginDir+":"+percent+"'>"+finalLabels[i]+"</div>"}}this._labelsLayout.append(labelHtml)}Array.prototype.slice.call(this._labelsLayout[0].children,0).forEach(function(label){label.offsetWidth<label.scrollWidth&&label.setAttribute("title",label.textContent)})}}}},_increase:function(value,step){return step=step||this.options.step,value=this._getInnerVal(value),value+=step-(value-this.options.min)%step},_decrease:function(value,step){return step=step||this.options.step,value=this._getInnerVal(value),value-=step-(value-this.options.min)%step},_trigger:function(customEvent,origEvent,data){return data=data||{},data.slider=this.getElement(),data.options=this.options,data.value=this.getValue(),this._dispatchEvent(customEvent,origEvent,data,void 0,!!origEvent)},_restoreMeasurements:function(){var base=this;this._MEASUREMENTS.forEach(function(opt){base.options[opt]=base.actualProps[opt]})},_resetValues:function(){this._values=this._labels=void 0,this._setFixedValues(),this._validateProperty(),$(this._handles).attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max}),this._setInitial(),this._resetScale(),this._resetRangeLabels(),this._resetLimitLayout(),this._resetTooltip(),this._positionHandle()},_resetLimitLayout:function(){$(this.container[0].querySelectorAll(".zslider__notallowedrange,.zslider__selected")).remove(),$(this.container[0].querySelectorAll(".zslider__label, .zslider__tick")).removeClass("is-disabled"),this._constructLimitLayout()},_resetScale:function(){this._ticksLayout&&this._ticksLayout.remove(),this._labelsLayout&&this._labelsLayout.remove(),this._ticks=this._ticksLayout=this._labelsLayout=this._gridValues=void 0,this._constructScale(),this._resetLimitLayout(),this._positionHandle()},_resetThumb:function(){$(this._handles).remove(),this._constructThumb()},_resetRangeLabels:function(){this._rangeLayout&&($(this._innerSlider[0].querySelectorAll(".zslider__rangegroup")).remove(),this.container.removeClass("zslider--range"),this._rangeLayout.remove(),this._rangeLayout=this._rangeBgs=this._rangeTicks=void 0),this._range.show(),this._constructRangeLabels()},_resetTooltip:function(){this._tooltip&&this._tooltip.remove(),this._tooltip=void 0,this._updateTip()},_parseArray:function(value){if("string"==typeof value)try{value=JSON.parse(value)}catch(e){}return value},_setAttribute:function(optionName,value){this._showHiddenParent();var o=this.options;switch(optionName){case"disabled":o[optionName]=!!value;{this.container.add(this._handles)}value?(this.element[0].setAttribute("disabled","disabled"),this.container.add($(this._handles).removeAttr("tabIndex").attr("aria-disabled",!0)).addClass(this._CLASS.DISABLED),this._tooltip&&this._tooltip.remove()):(this.element[0].removeAttribute("disabled"),this.container.add($(this._handles).attr("tabIndex",o.tabIndex).removeAttr("aria-disabled")).removeClass(this._CLASS.DISABLED),"always"===o.showTooltip&&this._resetTooltip());break;case"orientation":/^(horizontal|vertical)$/.test(value)&&(o[optionName]=value,this.vertical="vertical"===value,this.container[this.vertical?"addClass":"removeClass"](this._CLASS.VERTICAL),this._range.removeAttr("style"),this._shadowTrack.css({left:"auto",top:"auto"}),this._resetThumb(),this._resetValues());break;case"className":"string"==typeof value&&(this.container.removeClass(o[optionName]).addClass(value),o[optionName]=value);break;case"min":case"max":case"minValueAllowed":case"maxValueAllowed":case"step":this._restoreMeasurements(),o[optionName]=value,this._cacheMeasurements(),this._resetValues();break;case"locale":o.locale=value||ZC.locale,this._resetLocaleData(),this._setAttribute("showTicks",o.showTicks);break;case"selectionStartValue":o[optionName]=value,this._updateLayout();break;case"value":this.setValue(value);break;case"valuesType":/^(range|fixed)$/.test(value)&&(o[optionName]=value,"range"===value?o.ticksStep=this.actualProps.ticksStep:this.actualProps.ticksStep=o.ticksStep,this._resetValues());break;case"values":Array.isArray(value)&&(o[optionName]=value,this._resetValues());break;case"showTooltip":o[optionName]=value,this._resetTooltip();break;case"tooltip":var update;Object.keys(value).forEach(function(key){/^(position|displayType|text|isHTMLEncoded)$/.test(key)&&(o.tooltip[key]=value[key],update=!0)}),update&&this._setAttribute("showTooltip",o.showTooltip);break;case"ticks":var update;Object.keys(value).forEach(function(key){/^(splitBy|step|count|randomValues|position|showLabels|showLabelsFor|customLabels|labelPattern|isLabelHTMLEncoded)$/.test(key)&&(o.ticks[key]=value[key],update=!0)}),update&&this._setAttribute("showTicks",o.showTicks);break;case"valueDisplayFormat":var update;Object.keys(value).forEach(function(key){/^(type|decimalPlaces|thousandSeparator|pattern)$/.test(key)&&(o.valueDisplayFormat[key]=value[key],update=!0)}),update&&(this._resetLocaleData(),this._setAttribute("showTicks",o.showTicks));break;case"rangeGroups":var update;Object.keys(value).forEach(function(key){/^(groups|isLabelHTMLEncoded|labelPosition)$/.test(key)&&(o.rangeGroups[key]=value[key],update=!0)}),update&&(this._resetRangeLabels(),this._positionHandle());break;case"showTicks":case"thumbIconStyle":case"thumbSVGIconId":case"thumbIconClassName":o[optionName]=value,this._resetThumb(),this._resetValues();break;default:o[optionName]=value}this._resetParent()},increase:function(origEvent){this._setValue(this._increase(this.options.value),origEvent)},decrease:function(origEvent){this._setValue(this._decrease(this.options.value),origEvent)},setValue:function(value,origEvent){void 0!==value&&(value=this._getInnerVal(value),this._setValue(value,origEvent))},getValue:function(){return this.options.value},destroy:function(){this.container.remove(),this.element.show().removeData(this.options.widgetEventPrefix)},setAttribute:function(optionName,value){value="string"==typeof value?value.trim():value,value!==this.options[optionName]&&this._setAttribute(optionName,value)}};ZC.registerComponent("zslider",sliderPrototype),ZC.createSlider=function(options){if("object"==typeof options){var element=$("#"+options.id);if(element.length){if(element.data("zslider"))return element}else element=$("<input>").appendTo($(options.appendTo).length?options.appendTo:"body").attr({id:options.id,style:options.style,title:options.title,tabIndex:options.tabIndex});return element.zslider(options),element}}}(ZComponents),function(ZC){function buttonElement(){ZB_DOM._text=document.createElement("span"),ZB_DOM._label=document.createElement("label"),ZB_DOM._arrow=document.createElement("i"),ZB_DOM._text.className="zbutton__text",ZB_DOM._arrow.className="zbutton__icon h-floatright"}function createElement(initObject){var tagName=initObject.tagName?initObject.tagName:"button",element=document.createElement(tagName);return element.setAttribute("id",initObject.id),initObject.customAttributes&&$(element).attr(initObject.customAttributes),initObject.appendTo&&$(initObject.appendTo)[0].appendChild(element),$(element)[initObject.componentName](initObject)}var $=ZC.DOMUtil,buttonPrototype={options:{appearance:"normal",text:void 0,icon:void 0,iconClassName:void 0,SVGIconId:void 0,size:"medium",disabled:!1,checked:!1,actionInProgress:!1,progressIndicator:{type:"circular",position:"left",direction:"left-to-right",loadingText:"",value:5,iconClassName:void 0,SVGIconId:void 0},constructButton:!0,className:""},attributeList:["data-appearance","data-icon","data-text","data-size","data-disabled","disabled","data-action-in-progress","data-progress-indicator"],_EVENTS:{CLICK:"click",CHANGE:"change",STATECHANGE:"statechange"},_CIRCLEX:{medium:"8px",large:"10.5px",small:"7.5px",mini:"7px"},_CIRCLEY:{medium:"8px",large:"10.5px",small:"7.5px",mini:"7px"},_CIRCLER:{medium:"7",large:"9.5px",small:"6.5px",mini:"6px"},_create:function(){void 0===ZB_DOM._text&&buttonElement(),this.options.icon=this.options.icons&&this.options.icons.primary||this.options.icon,this.options.disabled=this.options.disabled||this.element[0].disabled,this.options.checked=this.options.checked||this.element[0].checked,this.element[0].setAttribute("role","button"),this.container="INPUT"===this.element[0].tagName?this._getLabelElement(this.element):this.element,this.options.constructButton&&this._construct(),this.element[0].type||(this.element[0].type="button"),this._checkAndDisable(),this._bindEvents(),this._handleFocus()},_construct:function(){if(this.options.text=this.options.text?this.options.text:this.options.label?this.options.label:this.element.text().trim(),this.options.text&&""!==this.options.text){var textSpan=ZB_DOM._text.cloneNode();textSpan.textContent=this.options.text,this.container[0].innerHTML="",this.container[0].appendChild(textSpan)}(this.options.icon||this.options.iconClassName||this.options.SVGIconId)&&this._setIcons(),this.container[0].className+=" zbutton "+("normal"!==this.options.appearance?"zbutton--"+this.options.appearance:"")+" zbutton--"+this.options.size+" "+this.options.className,this.container[0].setAttribute("aria-label",this.options.text?this.options.text:this.element.attr("title"))},_setIcons:function(){if(!this.options.actionInProgress||!this.container.find(".zeffects--rotate").length){this.container.find(".zbutton__mainicon").remove();var iconEle=$("<i class='zbutton__icon zbutton__mainicon '></i>"),iconSpan=this._handleIcon(iconEle,void 0,void 0,this.options.iconClassName,this.options.SVGIconId,this.options.icon);this.container.prepend(iconSpan),(this.options.icon||this.options.iconClassName||this.options.SVGIconId)&&""===this.options.text&&(this.container[0].className+=" zbutton--icononly")}},_bindEvents:function(){var base=this,componentName=this.componentName;if(this.container.on("click."+componentName,function(event){base._handleButtonClick(event),base._mouseup=!0}),this._input){var base=this;this.container.off("keydown."+componentName).on("keydown."+componentName,function(event){if(event.keyCode===ZC.keyCode.ENTER||event.keyCode===ZC.keyCode.SPACE)base.container.trigger("click"),event.preventDefault();else if(event.keyCode===ZC.keyCode.LEFT||event.keyCode===ZC.keyCode.DOWN){var groupName=base._input.attr("name"),navigateTo=base._input.prevAll("input[type=radio][name="+groupName+"]")[0];navigateTo||(navigateTo=base._input.nextAll("input[type=radio][name="+groupName+"]:last")),$("label[for='"+$(navigateTo).attr("id")+"']").trigger("click").trigger("focus")}else if(event.keyCode===ZC.keyCode.RIGHT||event.keyCode===ZC.keyCode.UP){var groupName=base._input.attr("name");navigateTo=base._input.nextAll("input[type=radio][name="+groupName+"]")[0],navigateTo||(navigateTo=base._input.prevAll("input[type=radio][name="+groupName+"]:last")),$("label[for='"+$(navigateTo).attr("id")+"']").trigger("click").trigger("focus")}})}window.ZShortCut&&ZShortCut.register(this.element)},_handleButtonClick:function(event){this.container.hasClass("is-disabled")||(this.options.actionInProgress&&this.showProgressIndicator(),this.container.is("label")&&this._check(!0,event),this._dispatchEvent("CLICK",event,{button:this.element}))},_checkAndDisable:function(){this.options.disabled?(this.container.addClass("is-disabled").attr({"aria-disabled":!0}),this.container.attr("disabled")||this.container[0].setAttribute("disabled",!0)):(this.container.removeClass("is-disabled").removeAttr("aria-disabled"),this.container.attr("disabled")&&this.container.removeAttr("disabled")),this._dispatchEvent("STATECHANGE",{},{button:this.element,disabled:this.options.disabled}),this.options.checked?(this.container.addClass("is-selected").prop("checked",!0).attr("aria-checked",!0),this._input.prop("checked",!0)):(this.container.removeClass("is-selected").removeAttr("checked aria-checked").prop("checked",!1),this._input&&this._input.prop("checked",!1))},_check:function(isChecked,event){if(!this.container.hasClass("is-disabled")){var groupName=this._input.attr("name"),buttonGroup=$("input[type=radio][name="+groupName+"]");isChecked&&"radio"==this._input[0].type&&buttonGroup.each(function(i,button){$(button).prop("checked",!1).next("label").prop("checked",!1),$(button).next(".zbutton").removeClass("is-selected"),$(button).data("zbutton").options.checked=!1}),"radio"===this._input[0].type?this.options.checked=isChecked:this.container.prop("checked")||!isChecked?this.options.checked=!1:isChecked&&(this.options.checked=isChecked),this._checkAndDisable(),event&&this._dispatchEvent("CHANGE",event,{button:this.element})}},_getLabelElement:function(element){var _label=element.next("label");return _label.length||(_label=$("<label>").text(this.options.text).insertAfter(element),this._labelCreated=!0),_label.attr({"for":element.attr("id"),tabindex:void 0!==this.element.attr("tabindex")?this.element.attr("tabindex"):0,"class":element.attr("class"),title:element.attr(element.attr("title")?"title":"data-title"),role:element[0].type}),this._input=element.addClass("h-dnone"),_label},_createLoaderElement:function(position){var iconEle=$("<i class='zbutton__icon "+("right"!==position||this.container.is(".zbutton--icononly")?"":"h-floatright")+"'></i>"),loaderInfo=this.options.progressIndicator,SVGIconId=loaderInfo.SVGIconId,iconClassName=loaderInfo.iconClassName;if(SVGIconId||iconClassName)this._handleIcon(iconEle,void 0,void 0,iconClassName,SVGIconId);else{var loaderEle=ZC.createSVGElement("svg",{"class":"zbutton__svg zbutton__loader zeffects--rotate"},[{circle:{"class":"circle__track",cx:this._CIRCLEX[this.options.size],cy:this._CIRCLEY[this.options.size],r:this._CIRCLER[this.options.size]}},{circle:{"class":"circle__load",cx:this._CIRCLEX[this.options.size],cy:this._CIRCLEY[this.options.size],r:this._CIRCLER[this.options.size]}}]);iconEle[0].appendChild(loaderEle)}return iconEle},setProgressValue:function(value){this._progressElement&&(value>100&&(value=100),this._progressElement.css("width",parseInt(value)+"%"),this.options.progressIndicator.value=value)},getProgressValue:function(){return this._progressElement?100*parseFloat(this._progressElement.outerWidth(!0)/(this.element.outerWidth(!0)-2*parseInt(this.element.css("border")))):0},showProgressIndicator:function(options){var options=options||{},loaderInfo=this.options.progressIndicator,type=options.type||loaderInfo.type,position=options.position||loaderInfo.position,direction=options.direction||loaderInfo.direction,btnText=options.loadingText||loaderInfo.loadingText,percentage=options.value||loaderInfo.value;this.container.find(".zbutton__loader").length||("circular"===type?((this.options.icon||this.options.iconClassName||this.options.SVGIconId)&&("left"===position||this.container.is(".zbutton--icononly"))&&this.container.find("i:first").remove(),this.container.prepend(this._createLoaderElement(position))):"linear-bar"===type?(this._progressElement=$("<span class='"+("top"===position?"zbutton__topline":"zbutton__bottomline")+"'/>"),this.setProgressValue(percentage)):"linear-fill"===type&&(this._progressElement=$("<span class='"+("right-to-left"===direction?"zbutton__bgprogress--fromright":"zbutton__bgprogress")+"'/>"),this.setProgressValue(percentage)),""!==btnText&&this.container.find(".zbutton__text").text(btnText),this.container.append(this._progressElement).addClass("is-disabled zbutton--loading h-transition"),this.options.actionInProgress=!0)},hideProgressIndicator:function(){this._progressElement&&(this._progressElement.remove(),this._progressElement=void 0),this.options.icon||this.options.iconClassName||this.options.SVGIconId?(this.container.find(".zbutton__icon").remove(),this.container.find(".zbutton__icon").length||this._setIcons()):this.container.find(".zbutton__icon").remove(),this.container.removeClass("zbutton--loading h-transition"),this.options.disabled||this.container.removeAttr("disabled").removeClass("is-disabled"),this.options.text?this.container.find(".zbutton__text").text(this.options.text):(this.container.find(".zbutton__text").remove(),(this.options.icon||this.options.iconClassName||this.options.SVGIconId)&&this.container.addClass("zbutton--icononly"))},destroy:function(){return this._super(),this.container.off("."+this.componentName).empty().removeClass("zbutton zbutton--icononly is-disabled is-selected"),this.container.off("."+this.componentName),this._input&&(this._input.removeClass("h-dnone").removeData("zbutton"),this._input=void 0,this._labelCreated&&this.container.remove()),this.element.text(this.options.text).removeData("zbutton")},setAttribute:function(optionName,value){if("appearance"===optionName&&value!==this.options.appearance)this.container.removeClass("zbutton--"+this.options.appearance).addClass("zbutton--"+value);else if("text"!==optionName&&"label"!==optionName&&"data-text"!==optionName||value===this.options.text)if("size"!==optionName&&"data-size"!==optionName||value===this.options.size)if("disabled"===optionName&&this.options.disabled!==value)"string"==typeof value&&(value="true"===value||"disabled"===value),this.options.disabled=value,this._checkAndDisable();else if("icon"!==optionName&&"data-icon"!==optionName&&"iconClassName"!==optionName&&"SVGIconId"!==optionName||value===this.options[optionName]){if("checked"===optionName&&value!==this.options.checked)this._input&&this._check(value,void 0);else if("actionInProgress"===optionName&&value!==this.options.actionInProgress)this.options[optionName]=value,value?this.showProgressIndicator():this.hideProgressIndicator();else if("progressIndicator"===optionName&&this.options.actionInProgress){var options=this.options;options.progressIndicator=$.extend({},options.progressIndicator,value),this.destroy(),this.element.zbutton(options),this.showProgressIndicator()}}else(this.options.icon||this.options.iconClassName||this.options.SVGIconId)&&this.container.find("i:first").remove(),this.options[optionName]=value,value&&this._setIcons();else this.options.size&&this.container.removeClass("zbutton--"+this.options.size),this.container.addClass("zbutton--"+value),this.options.actionInProgress&&(value=""===value.trim()||"default"===value?"medium":value,this.container.find(".zbutton__loader circle").attr({cx:this._CIRCLEX[value],cy:this._CIRCLEY[value],r:this._CIRCLER[value]}));else if(this.options.text&&""!==this.options.text)this.options.actionInProgress||(value&&""!==value?this.container.find(".zbutton__text").text(value):(this.container.find(".zbutton__text").remove(),this.container.find("i").length&&(this.options.icon||this.options.iconClassName||this.options.SVGIconId)&&this.container.addClass("zbutton--icononly")));else{var textSpan=$("<span class='zbutton__text'>"+value+"</span>");this.options.actionInProgress||(this.container.find("i").length&&(this.options.icon||this.options.iconClassName||this.options.SVGIconId)?textSpan.insertAfter(this.container.find(".zbutton__icon:first")):textSpan[this.container.find("i").length?"prependTo":"appendTo"](this.container),this.container.removeClass("zbutton--icononly"))}this.options[optionName]=value}},menubuttonPrototype={options:{menuId:void 0,delay:0,showArrowIcon:!0,arrowIconClassName:void 0,arrowSVGIconId:void 0,activeClass:"is-selected"},_construct:function(){this._super(),this.element[0].className+=" zbutton--menu",this.element[0].setAttribute("aria-haspopup",!0);var iconEle=ZB_DOM._arrow.cloneNode();if(this.options.showArrowIcon){var className=this.options.splitbutton?"zbutton__svg zbutton__splitarrow":"zbutton__svg zbutton__menuarrow",svgData={props:{"class":className,viewBox:"0 0 16 16",width:"100%",height:"100%"},nodes:[{polygon:{points:"3.5,6.5 4.5,5.5 8,9 11.5,5.5 12.5,6.5 8,11"}}]};this._handleIcon($(iconEle),svgData,"arrow",this.options.arrowIconClassName,this.options.arrowSVGIconId),this.element[0].appendChild(iconEle)}},destroy:function(){this._super(),this.element.off("."+this.componentName).removeClass("zbutton--menu").removeData("zmenubutton").removeAttr("aria-haspopup")},_bindEvents:function(){var base=this,componentName=this.componentName,key=ZC.keyCode;this.element.on("mousedown."+componentName,function(){base.element.hasClass("is-disabled")||base.options.menuId&&$.fn.zmenu&&(base.options.delay?window.setTimeout(function(){base._showHideMenu()},base.options.delay):base._showHideMenu()),base._mouseup=!1}).on("click."+componentName,function(event){base._dispatchEvent("CLICK",event,{button:base.element}),base._mouseup=!0}).on("keydown."+componentName,function(event){var prevent=!1,menu=$("#"+base.options.menuId);event.keyCode===key.DOWN||event.keyCode===key.UP||event.keyCode===key.LEFT||event.keyCode===key.RIGHT?(prevent=!0,menu.is(":visible")?menu.zmenu("handleKeyCode",event.keyCode,event):(event.keyCode===key.UP||event.keyCode===key.DOWN)&&base._showHideMenu()):(event.keyCode===key.ENTER||event.keyCode===key.SPACE)&&base.options.menuId&&$.fn.zmenu?document.activeElement===base.element[0]&&(prevent=!0,menu.find(".on-hover").length?menu.zmenu("handleKeyCode",event.keyCode,event):base._showHideMenu()):(event.keyCode===key.ESCAPE||event.keyCode===key.TAB)&&menu.is(":visible")&&(menu.find(".on-hover").hasClass("zmenu--submenu")?menu.zmenu("handleKeyCode",event.keyCode,event):(menu.zmenu("hide"),event.keyCode===key.ESCAPE&&event.stopPropagation())),prevent&&(event.preventDefault(),event.stopPropagation())}),window.ZShortCut&&ZShortCut.register(this.element)},_showHideMenu:function(){var base=this,menu=$("#"+this.options.menuId);!menu.is(":visible")||base.options.splitbutton&&menu.data("forElement")&&menu.data("forElement")[0]!==base.element.closest(".zbutton--split").get(0)||!base.options.splitbutton&&menu.data("forElement")&&menu.data("forElement")[0]!==base.element.get(0)?(menu.zmenu("hide"),menu.on("zmenuhide",function(event,ui){!base.options.splitbutton&&event.originalEvent&&("mouseup"===event.originalEvent.type?(ui&&ui.menuitem&&ui.menuitem.is(".is-fixed")||base.element.focus(),base.element.removeClass("has-focus")):ui&&ui.menuitem&&ui.menuitem.is(".is-fixed")&&base.element.removeClass("has-focus")),base.element.removeClass(base.options.activeClass)}).on("zmenubeforefocus",function(){return!1}),menu.zmenu(),menu.zmenu("show",{forElement:base.options.splitbutton?base.element.closest(".zbutton--split"):base.element}),base.element.addClass(base.options.activeClass),ZC.$window.on("resize."+this.componentName,function(){menu.zmenu("hide")})):(base.element.removeClass(base.options.activeClass),menu.zmenu("hide"))}},splitbuttonPrototype={_initialShow:!0,attributeList:["data-appearance","data-icon","data-text","data-size","data-disabled","disabled","data-menu-id"],options:{size:"medium",disabled:!1,updateButtonOnMenuItemClick:!0},_create:function(button,options){var buttonId=button.attr("id"),menuButtonId=void 0,menuButton=button.next(),splitPair=document.createElement("div");this.splitPair=splitPair,splitPair.setAttribute("class","zbutton--split "+options.className),splitPair.setAttribute("role","splitbutton"),"primary"!==options.appearance&&(splitPair.className+=" zbutton--splitnormal"),buttonId&&(splitPair.setAttribute("id",buttonId+"Container"),menuButtonId=buttonId+"DropDown"),button[0].parentNode.insertBefore(splitPair,button[0]),!options.menuId&&menuButton.length&&"BUTTON"===menuButton[0].tagName?menuButton=menuButton[0]:(menuButton=document.createElement("button"),menuButton.setAttribute("id",menuButtonId)),this.menuButton=$(menuButton),menuButton.setAttribute("class","zbutton--icononly");var _data={appearance:options.appearance,size:options.size,disabled:void 0!==options.disabled?options.disabled:!1,delay:options.delay,splitbutton:!0,showArrowIcon:options.showArrowIcon,arrowIconClassName:options.arrowIconClassName,arrowSVGIconId:options.arrowSVGIconId};splitPair.appendChild(button[0]),splitPair.appendChild(menuButton),options.menuId&&menuButton.setAttribute("data-menu-id",options.menuId),button.disabled&&menuButton.setAttribute("disabled",!0),options.splitbuttonAttributes&&$(menuButton).attr(options.splitbuttonAttributes),options.appData&&(_data.appData=options.appData),button.removeAttr("data-menu-id"),options.className="",button.attr("title")&&splitPair.setAttribute("title",button.attr("title")),button.removeAttr("title"),button.zbutton(options),this.element=button,$(menuButton).zmenubutton(_data),this.options=options,this._bindEvents(),this.container=$(this.splitPair)},_bindEvents:function(){var base=this,menu=$("#"+this.options.menuId);this.element.off("click.zbutton"),$(this.splitPair).off("click.zbutton").on("click."+this.componentName,function(event){var element=$(event.target).closest(".zbutton"),ui={dropdownButton:base.menuButton};element.hasClass("zbutton--menu")?ui.isMenuButton=!0:$.fn.zmenu&&menu.zmenu("hide"),base._dispatchEvent("CLICK",event,ui)}),window.ZShortCut&&(ZShortCut.register(this.element),ZShortCut.register(this.menuButton)),menu.on("zmenubeforeshow",function(){base.options.updateButtonOnMenuItemClick&&base._initialShow?base._hideMenuItem(base.options.menuId,!0):$.noop}).on("zmenushow",function(event,ui){if(menu.data("forElement")[0]==base.splitPair){var className=ui.menu.attr("class");className.match("top")?(base.element.css("border-bottom-left-radius",window.getComputedStyle(base.splitPair,null).borderBottomLeftRadius),base.menuButton.css("border-bottom-right-radius",window.getComputedStyle(base.splitPair,null).borderBottomRightRadius)):className.match("bottom")&&(base.element.css("border-top-left-radius",window.getComputedStyle(base.splitPair,null).borderTopLeftRadius),base.menuButton.css("border-top-right-radius",window.getComputedStyle(base.splitPair,null).borderTopRightRadius)),base._initialShow=!1}}).on("zmenuhide",function(){base.element.css({"border-bottom-left-radius":"","border-top-left-radius":"","border-bottom-right-radius":"","border-top-right-radius":""}),base.menuButton.css({"border-bottom-right-radius":"","border-top-right-radius":"","border-top-left-radius":"","border-bottom-left-radius":""})}),this.options.updateButtonOnMenuItemClick&&menu.on("zmenuitemclick",function(event,ui){var menuData=ui.menu.data("zmenu").options,menuType=menuData.contentType,buttonType=(base.options.icon||base.options.iconClassName||base.options.SVGIconId)&&base.element.data("zbutton").options.text?"icon-text":base.options.icon||base.options.iconClassName||base.options.SVGIconId?"icon":"text";menuType===buttonType&&(base._hideMenuItem(base.options.menuId,!1),menu.zmenu("hideMenuItems",[ui.menuitem]),(base.options.icon||base.options.iconClassName||base.options.SVGIconId)&&base.setAttribute("icon",ui.data.icon),base.element.data("zbutton").options.text&&base.setAttribute("text",ui.data.label),base._dispatchEvent("CHANGE",event,ui))})},_hideMenuItem:function(menuId,hide){for(var menu=$("#"+menuId),currentText=this.element.data("zbutton").options.text,currentIcon=this.options.icon||this.options.iconClassName||this.options.SVGIconId,menuItems=menu.find("li"),i=0;i<menuItems.length;i++){var metadata=this.getData(menuItems[i]),iconMatch=metadata.icon&&currentIcon?0===metadata.icon.indexOf(currentIcon):!0,textMatch=metadata.label&&currentText?metadata.label===currentText:!0;iconMatch&&textMatch&&menu.zmenu(hide?"hideMenuItems":"showMenuItems",[menuItems[i]])}},getElement:function(){return $(this.splitPair)},setAttribute:function(optionName,value){return("disabled"===optionName||"menuId"===optionName||"data-menu-id"===optionName||"size"===optionName||"data-size"===optionName||"appearance"===optionName||"data-appearance"===optionName&&this.options[optionName]!==value)&&($(this.menuButton).zmenubutton("setAttribute",optionName,value),"appearance"===optionName&&$(this.splitPair)["primary"===value?"removeClass":"addClass"]("zbutton--splitnormal")),this.options[optionName]=value,this.element.zbutton("object"==typeof optionName?"setAttributes":"setAttribute",optionName,value)},destroy:function(){this._super(),$(this.menuButton).remove(),this.element.unwrap().zbutton("destroy").removeData("zsplitbutton")}},ZB_DOM={};ZC.createButton=function(initObject){return initObject.componentName="zbutton",createElement(initObject)},ZC.createSplitbutton=ZC.createSplitButton=function(initObject){return initObject.componentName="zsplitbutton",createElement(initObject)},ZC.createMenubutton=ZC.createMenuButton=function(initObject){return initObject.componentName="zmenubutton",createElement(initObject)},ZC.createUploadbutton=ZC.createUploadButton=function(initObject){return initObject.componentName="zuploadbutton",initObject.tagName="input",initObject.customAttributes=initObject.customAttributes?initObject.customAttributes:{},initObject.customAttributes.type="file",createElement(initObject)},ZC.registerComponent("zbutton",buttonPrototype),ZC.registerComponent("zmenubutton",$.zbutton,menubuttonPrototype),ZC.registerComponent("zsplitbutton",$.zbutton,splitbuttonPrototype)}(ZComponents);var ZAnnotator=function($){var defaultKeys={"select.label":"Select","done.label":"Done","cancel.label":"Cancel","ellipse.label":"Ellipse","rectangle.label":"Rectangle","pencil.label":"Marker","marker.label":"Highlighter Pen","highlightingTools.label":"Highlighting Tools","taggingTools.label":"Tagging Tools","concealInfo.label":"Concealing Tools","arrow.label":"Arrow","line.label":"Line","doubleArrow.label":"Double Arrow","markerArrow.label":"Marker Arrow","arrowline.label":"Arrow & Line","text.label":"Text","warning.label":"Warning","numbering.label":"Numbering","correct.label":"Correct","wrong.label":"Wrong","unclear.label":"Unclear","hideInfo.label":"Hide Info","blur.label":"Blur","smudge.label":"Smudge","crop.label":"Crop","zoomOut.label":"Zoom Out","zoomIn.label":"Zoom In","actualSize.label":"Actual Size","fitToScreen.label":"Fit to Screen","fitToWidth.label":"Fit To Width","yellow.label":"Yellow","red.label":"Red","green.label":"Green","orange.label":"Orange","fontSize.label":"Font Size","fontColor.label":"Text Color","textOutline.label":"Text Outline","fillColor.label":"Fill Color","borderColor.label":"Border Color","borderWidth.label":"Border Style & Thickness","lineColor.label":"Line Color","lineWidth.label":"Line Style & Thickness","solid.label":"Solid","dashed.label":"Dashed","paste.label":"Paste","copy.label":"Copy","delete.label":"Delete","selectall.label":"Select All","deselectall.label":"Deselect All","ok.label":"OK","yes.label":"Yes","no.label":"No","bringToFront.label":"Bring To Front","sendToBack.label":"Send To Back","bringForward.label":"Bring Forward","moveBackward.label":"Move Backward","undo.label":"Undo","redo.label":"Redo","imageSaveAlert.label":"An unexpected error has occurred. Please retry.","unexpectedError.label":"Unexpected Error","closeWarningMessgae.label":"Are you sure you want to discard the changes?","closeWarningMessgae2.label":"You will lose the changes you've made.","noFill.label":"No Fill","noColor.label":"No Color","opacity.label":"Opacity","10Percent.label":"10%","25Percent.label":"25%","50Percent.label":"50%","75Percent.label":"75%","100Percent.label":"100%","125Percent.label":"125%","150Percent.label":"150%","200Percent.label":"200%","pink.label":"Reddish Pink","blue.label":"Blue","violet.label":"Violet","white.label":"White","brown.label":"Brown","black.label":"Black","discardChanges.label":"Discard Changes","initalisingBlur.label":"Initialising Blur..."},zimagedit={widgetEventPrefix:"zimagedit",_EVENTS:{},options:{showImageName:!0},_create:function(options){options.imageID=options.target,options.keys=$.extend({},defaultKeys,options.keys),this.options=options,zimagedit.options.isContinuousDraw=!0,this._toolSelected=!1,this._drag=!1,zimagedit.textareaCreatedElements=[],this.previousFillColor="none",this.previousBorderColor="#ff004e",this.previousNumberingColor="#226cfb",this.previousOpacity=100,this.previousBorderThickness=3,this.currentValueForNumbering=1,this.isDraw=!1,this.ctrlKeyPressed=!1,this.multiSelectFlag=!1,this.shiftKeyPressed=!1,this.smudgeStack=[],this.smudgeStackFlag=!1,this.smudgeStackPosition=0,this.undoStack=[],this.tempStack=[],this.redoStack=[],this.selectOnDrag=[],this.lastHover=void 0,this.numberingColor={tick:"#01be13"},this.imageType="image/png",void 0!==options.imageType&&""!==options.imageType&&(this.imageType=options.imageType),this.cropAreaCanvasPosition=[],this.isImageCropped=!1,this.textareaSelected=!1,zimagedit.textareaBorderWidth=1.5,this.fitToWidthZoomValue=100,this.previousZoomValue=100,this.numberingTagSelected="numbering",this.boundaryClicked=[],this._checkFlagMouseAction=!1,this.targetAction="",this.resize_flag=!0,zimagedit._noOfIdSelected=[],this.borderWidth=3,this.stackPushFlag=!1,this._crop_arr=[],this.textareaList=[],this.cropCreated=!1,this.drawnElements=[],this.cropSelected=!1,this.lastAction="",this._bodyObj=$("body"),this._triggerEvent(this._EVENTS.ONOPEN),this._overalObj={action:"create/move/resize/delete/change/addtext",object:"Circle/Blackout/Rectangle/Text",id:"<object-id>",property:{color:"000"}},this._imageOrginalHeight=this._imageHeight,void 0===this.options.showLoader&&this._bodyObj.append('<div class="zimageeditor__loadercont" id="zimageeditor__loadercont" style="visibility="visible""><svg class="zimageeditor__loader zimageeditorloader__rotate"><circle class="zimageeditor__circle--track" cx="24" cy="24" r="20" stroke-dasharray="0" stroke-dashoffset="0" stroke-width="4"></circle><circle class="zimageeditor__circle--load" cx="24" cy="24" r="20" stroke-dasharray="94.29" stroke-dashoffset="55" stroke-width="4"></circle></svg></div>'),this._constructLayout();var img=new Image,imgURL=options.imageURL;void 0===imgURL&&(imgURL=$("#"+options.imageElementId).attr("src")),img.src=imgURL,img.onload=function(){zimagedit.inputImageId=options.imageElementId,zimagedit._imageWidth=parseFloat($(this).prop("naturalWidth")),zimagedit._imageHeight=parseFloat($(this).prop("naturalHeight")),$("#zimageeditor__sourceImage").remove(),$(".zimageeditor__actions").show(),$("body").append(img),$(img).attr("id","zimageeditor__sourceImage").css("display","none"),zimagedit.inputImageId="zimageeditor__sourceImage",zimagedit._currImg=$("#zimageeditor__sourceImage")[0],zimagedit._constructLayout(),zimagedit._createCanvas(),$("#zimageeditor__btns--select").addClass("zimageeditor__btns--active"),zimagedit.handleOpenAnimation(),zimagedit.createToolsAndProperties(),zimagedit._editActions(),zimagedit.initMouseFunction(),zimagedit.initFunction(options.imageID),zimagedit._touchInit(),$(".zimageeditor__footer").css("background","#222327"),zimagedit._selectedTool="none","function"==typeof zimagedit.options.onLoad&&zimagedit.options.onLoad(),$(".zimageeditor__overlay").css("background","#3d3f44"),"extension"===zimagedit.options.annotatorType&&($("#zimageeditor .zimageeditor__cancel").text(zimagedit._getString("discardChanges.label")),$("#zimageeditor .zimageeditor__cancel").attr("disabled",!0)),$("#zimageeditor .zimageeditor__cancel").on("click",function(){-1===$(this).attr("class").indexOf("zimageeditor__crop--cancel")&&zimagedit.close()})},this.finalCropPosition=[0,0,0,0,0],this.propertiesOfObjects=[[]],this.propertiesOfObjects[0]=["ellipse",!0,!0,!0,!1,!1,!1,!1],this.propertiesOfObjects[1]=["rectangle",!0,!0,!0,!1,!1,!1,!1],this.propertiesOfObjects[2]=["pencil",!1,!0,!0,!1,!1,!1,!1],this.propertiesOfObjects[3]=["marker",!1,!1,!1,!1,!1,!1,!1],this.propertiesOfObjects[4]=["numbering",!1,!1,!1,!1,!1,!1,!0],this.propertiesOfObjects[5]=["arrow",!1,!0,!0,!1,!1,!1,!1],this.propertiesOfObjects[6]=["text",!1,!1,!1,!0,!0,!0,!1],this.PropertiesAvailableForMultiSelect=[!0,!0,!0,!0,!0,!0,!0],this.zoomScaleValue=1,this.dragOnly=!1,this.isNumberingBeackSelected=!1,this.toolBarMoved=this.toolBarMoved?!0:!1,this.propertiesBarMoved=!1,this.row_val=0,this.col_val=0,this.temp_id=0,this.polyline_points="",this.clickPosition=[],zimagedit.textFontSize=20,zimagedit.defaultMarkerOpacity=.4,zimagedit.textFontColor="#8b23d5",zimagedit.textFontShadow=!0,zimagedit.cropCaptureCount=0,zimagedit.isFitToScreen=!0,zimagedit.numberingQuestionColor="#fe9300",zimagedit.arrowStrokeColor="#ff004e",zimagedit.blurPosition=[],zimagedit.blurPositionLength=0,zimagedit.cropPosition=[],zimagedit.propertiesLeft="47%",zimagedit.propertiesTop="10px",zimagedit.cropPosition[0]="none",zimagedit.smudgeBrushSize=20,zimagedit.numberingTagElements=[],zimagedit.svgPath="http://www.w3.org/2000/svg"},_constructLayout:function(){$("#zimageeditor").length||(this.shapesMenu=void 0,this.createMainDiv(),this.checkForIE(),this.createFooter(),this.createToolSection(),this.createHeader(),this._imageContainer=$("#zimageeditor")),zimagedit.editorSVG=document.getElementById("zimageeditor__svgeditor")},handleOpenAnimation:function(){$(".zimageeditor__done, .zimageeditor__cancel").addClass("zimageeditor__transistionHeaderShow").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("zimageeditor__transistionHeaderShow")}).css("visibility","visible"),$(".zimageeditor__footer").addClass("zimageeditor__transistionZoomShow").css("display","inherit"),$(".zimageeditor__tools").addClass("zimageeditor__transistionToolShow").css("display","inherit"),$("#zimageeditor .zimageeditor__transistionToolShow").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("zimageeditor__transistionToolShow"),$("#zimageeditor .zimageeditor__tools").css("display","block")}),$("#zimageedit-ele-canvas").css("visibility","visible")},_createCanvas:function(){$("#zimageeditor__loadercont").remove(),$("#zimageeditor__container").remove();var editorWrapper=$("<div/>",{id:"zimageeditor__wrapper","class":"zimageeditor__wrapper"});$(this._imageContainer).append(editorWrapper);var editorMain=$("<div/>",{id:"zimageeditor__container","class":"zimageeditor__container"});editorWrapper.append(editorMain),zimagedit.editContainer=editorMain;var paddingLeft,paddingTop,paddingRight,paddingBottom,maximumWidth,maximumHeight,windowWidth=$(window).width(),windowHeight=$(window).height(),_canvas=$("<div/>",{id:"zimageeditor__image","class":"zimageeditor__image",width:this._imageWidth,height:this._imageHeight});paddingLeft=paddingRight=110,paddingTop=85,"fullpage"===this.options.captureType?(maximumWidth=windowWidth-220,maximumHeight=this._imageHeight,$("#zimageeditor__container").css("overflow","auto"),$("#zimageeditor__container").css("overflow-x","hidden")):(maximumWidth=windowWidth-220,maximumHeight=windowHeight-150,maximumHeight>this._imageHeight&&(maximumHeight=this._imageHeight),maximumWidth>this._imageWidth&&(maximumWidth=this._imageWidth));var contentWidth,contentHeight,ratio=Math.min(maximumWidth/this._imageWidth,maximumHeight/this._imageHeight);contentWidth=this._imageWidth*ratio,contentHeight=this._imageHeight*ratio,paddingRight=paddingLeft=(windowWidth-contentWidth)/2,paddingBottom=paddingTop=(windowHeight-contentHeight)/2,editorMain.append(_canvas),$(_canvas).css({width:contentWidth,height:contentHeight,left:paddingLeft-110,top:0}),this._canvasContainer=_canvas,zimagedit.actualHeight=contentHeight,zimagedit.actualWidth=contentWidth,this._aspectRatio=this._imageHeight/zimagedit.actualHeight;var svgMain=$("<div/>",{id:"zimageeditor__svgcontainer","class":"zimageeditor__svgcontainer"});editorMain.append(svgMain);$("#zimageeditor__image, #zimageeditor__svgcontainer").css({width:contentWidth,height:contentHeight,left:paddingLeft-110>0?paddingLeft-110:0,top:paddingTop-85>0?paddingTop-85:0});zimagedit.svgContainer=svgMain,this._svgRendering("zimageeditor__svgeditor","zimageeditor__svgeditor",svgMain[0]),zimagedit.editorSVG=document.getElementById("zimageeditor__svgeditor"),zimagedit.SVGElement=$("#zimageeditor__svgeditor"),zimagedit.SVGElement.attr({width:contentWidth,height:contentHeight}),this.borders(),this.borderElement=$("#zimageeditor  .zimageedit__active--shape"),this.createPlusMenu(zimagedit.SVGElement),zimagedit.createBorderForNumbering(),zimagedit.removeBorderForNumbering(),zimagedit.removePlusAttributes(),zimagedit.removeBorderFocus(),this._imageLeft=paddingLeft,this._imageTop=paddingTop,this._imageCanvas=$("<canvas>").attr({id:"zimageedit-ele-canvas","class":"zimageedit-ele-canvas",width:zimagedit._imageWidth,height:zimagedit._imageHeight}).css({width:this._imageWidth,height:this._imageHeight,visibility:"hidden"}).appendTo(_canvas),$("<canvas>").attr({id:"zimageedit__canvas--blur",width:zimagedit._imageWidth,height:zimagedit._imageHeight}).css({width:zimagedit._imageWidth,height:zimagedit._imageHeight}).appendTo(_canvas),zimagedit._imageCanvas=$("#zimageedit-ele-canvas"),zimagedit.mainCanvas=document.getElementById("zimageedit-ele-canvas"),zimagedit.actualWidth=contentWidth,zimagedit.actualHeight=contentHeight,zimagedit.draw_image_on_Canvas(),zimagedit._imageCropCanvas=$("<canvas>").attr({id:"zimageditCropCanvas","class":"zimageditCropCanvas",width:zimagedit._imageWidth,height:zimagedit._imageHeight}).css({display:"none",width:zimagedit._imageWidth,height:zimagedit._imageHeight}).appendTo(_canvas),zimagedit.orginalCanvasFitToWidth=parseFloat(zimagedit._imageCanvas.css("width")),zimagedit.orginalCanvasFitToHeight=parseFloat(zimagedit._imageCanvas.css("height")),zimagedit.currentZoomValue=100/(zimagedit._imageWidth/zimagedit.orginalCanvasFitToWidth),zimagedit.changeZoomTextValue(zimagedit.currentZoomValue),"fullpage"===this.options.captureType&&(zimagedit.handleZoomCases(zimagedit.currentZoomValue),$("#zimageeditor__container").scrollTop(0),$("#zimageeditor__container").css("overflow-x","hidden"))},draw_image_on_Canvas:function(){zimagedit._imageCanvas.attr({width:zimagedit._imageWidth,height:zimagedit._imageHeight});var c=zimagedit.mainCanvas;zimagedit._ctx=c.getContext("2d"),zimagedit._ctx.drawImage(this._currImg,0,0,zimagedit._imageWidth,zimagedit._imageHeight),c=document.getElementById("zimageedit__canvas--blur"),zimagedit._ctx2=c.getContext("2d"),zimagedit.orgin_ctx2=c.getContext("2d"),zimagedit._ctx2.drawImage(this._currImg,0,0,this.actualWidth,this.actualHeight),zimagedit._imageCanvas.css({width:zimagedit.actualWidth,height:zimagedit.actualHeight}),zimagedit.orginalRatio=zimagedit._imageWidth/zimagedit.actualWidth},_svgRendering:function(cls,id,append_to){this._svgns=zimagedit.svgPath,this._svg=document.createElementNS(this._svgns,"svg"),this._svg.setAttribute("class",cls),this._svg.setAttribute("id",id);var viewbox="0 0 "+zimagedit.actualWidth+" "+zimagedit.actualHeight;this._svg.setAttribute("viewBox",viewbox),append_to.appendChild(this._svg),zimagedit.line_marker("zimageedit__triangle"),$("#zimageedit__triangle").css("visibility","hidden"),zimagedit.line_marker("zimageedit__triangle1"),$("#zimageedit__triangle1").css("visibility","hidden")},_svgElements:function(ele,obj,toUpdateEle){var svgEle;svgEle=toUpdateEle?toUpdateEle:document.createElementNS(zimagedit.svgPath,ele);for(var prop in obj)svgEle.setAttribute(prop,obj[prop]);return svgEle},createMainDiv:function(){var mainDiv=$("<div>",{"class":"zimageeditor",id:"zimageeditor"});$("body").append(mainDiv);var overlay_div=$("<div/>",{"class":"zimageeditor__overlay"});$(overlay_div).appendTo(mainDiv),zimagedit.main_div=mainDiv,zimagedit._mainContainer=mainDiv},checkForIE:function(){var usrAgnt=window.navigator.userAgent,checkIE=usrAgnt.indexOf("MSIE"),checkEdge=usrAgnt.indexOf("Edge"),checkIE11=usrAgnt.indexOf("Trident");zimagedit.isIEBrowser=checkIE>0||checkEdge>0||checkIE11>0?!0:!1,zimagedit.isSafari=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"),zimagedit.isWindowsOS=!1,-1!==window.navigator.platform.toUpperCase().indexOf("WIN")&&(zimagedit.isWindowsOS=!0),(-1!==window.navigator.userAgent.indexOf("Linux")||-1!=navigator.appVersion.indexOf("Linux"))&&(zimagedit.isWindowsOS=!0),zimagedit.isMacOS=-1!==navigator.platform.toUpperCase().indexOf("MAC")},createHeader:function(){var div,header_div=$("<div/>",{"class":"zimageeditor__header zimageeditor__header--bg"});$(zimagedit.main_div).append(header_div),zimagedit.options.showImageName&&(div=$("<div/>",{"class":"zimageeditor__imgname"}),$(header_div).append(div),$(div).text(zimagedit.options.imageName)),div=$("<div/>",{"class":"zimageeditor__actions"}).css("visibility","hidden"),$(header_div).append(div);var doneBtn={className:"zimageeditor__done",id:"zimageeditor__done",text:zimagedit._getString("done.label"),appendTo:".zimageeditor__actions",updateButtonOnMenuItemClick:!1};if(doneBtn=$.extend({},doneBtn,zimagedit.options.finishButton),doneBtn.ctype=doneBtn.type?doneBtn.type:"zbutton",doneBtn.menu&&doneBtn.menu.menuItems){{ZComponents.createMenu("zimageedit__done--splitMenu",doneBtn.menu.menuItems,{appendTo:"#zimageeditor"})}doneBtn.menuId="zimageedit__done--splitMenu",$("#zimageedit__done--splitMenu").on("zmenuitemclick",function(e,uiObj){"function"==typeof zimagedit.options.onFinish&&zimagedit.options.onFinish(uiObj),zimagedit.saveFunction()})}var ele=ZComponents.create(doneBtn),inner_div=$("<button/>",{"class":"zimageeditor__cancel",text:zimagedit._getString("cancel.label")});$(div).append(inner_div),ele.click(function(){zimagedit.cropSelected||("function"==typeof zimagedit.options.onFinish&&zimagedit.options.onFinish(zimagedit.options.finishButton),zimagedit.saveFunction())})},createFooter:function(){if(zimagedit.isIEBrowser)return!0;var footer_div=$("<div/>",{"class":"zimageeditor__footer zimageeditor__header--bg"}).css("display","none");$(zimagedit.main_div).append(footer_div);var button=$("<button/>",{"class":"zimageeditor__btns","data-objectaction":"zoomout",id:"zimageeditor__btns--zoomOut",title:zimagedit._getString("zoomOut.label"),"data-title-position":"top"});$(footer_div).append(button);var i=$("<i/>",{"class":"zimageedit__icon--minus"});$(button).append(i);var div=$("<div/>",{"class":"zbutton--split"});button=$("<button/>",{"class":"zimageeditor__btns zimageeditor__zoom","data-objectmenu":"zoom",id:"zimageeditor__zoom"}),$(div).append(button),$(footer_div).append(div),i=$("<span>",{text:"100%","class":"zimageeditor__zoom--text"});var splitButton=$("<span>",{"class":"zimageeditor__btns zimageeditor__btns_spilit","data-objectmenu":"zoom"});$(button).append(i),$(div).append(splitButton),button=$("<button/>",{"class":"zimageeditor__btns","data-objectaction":"zoomin",id:"zimageeditor__btns--zoomIn",title:zimagedit._getString("zoomIn.label"),"data-title-position":"top"}),$(footer_div).append(button),i=$("<i/>",{"class":"zimageedit__icon--plus"}),$(button).append(i)},createToolSection:function(){var tool_div=$("<div/>",{"class":"zimageeditor__tools"}).css("display","none");$(zimagedit.main_div).append(tool_div);var div_function=function(tool_div,cls){var div=$("<div/>",{"class":cls});return $(tool_div).append(div),div},ele=div_function(tool_div,"zimageeditor__tools--header");ele.attr("id","zimageeditor__tools--header");var span=$("<span/>",{});$(ele).append(span),span=$("<span/>",{}),$(ele).append(span),span=$("<span/>",{}),$(ele).append(span);var createButton=function(tool_div,cls,data_object,data_object_action,title,position){var splitHTML=$('<div class="zbutton--split"></div>'),button=$("<button>",{"class":"zimageeditor__btns ",title:title,"data-title-position":position}),splitButton=$("<span>",{"class":"zimageeditor__btns zimageeditor__btns_spilit",title:title,"data-title-position":position});"shapes"===data_object||"numbering"===data_object||"blur"===data_object||"marker"===data_object||"linearrow"===data_object?($(splitHTML).append(button),$(button).attr("id","zimageeditor__btns--"+data_object),$(splitHTML).append(splitButton),$(tool_div).append(splitHTML)):($(tool_div).append(button),$(button).attr("id","zimageeditor__btns--"+data_object_action)),void 0!==data_object?($(button).attr({"data-objectmenu":data_object,"data-objectaction":data_object}),$(splitButton).attr("data-objectmenu",data_object)):$(button).attr("data-objectaction",data_object_action);var i;void 0!==data_object?("blur"===data_object&&(data_object="hideInfo"),i=$("<i/>",{"class":"zimageedit__icon zimageedit__icon--"+data_object})):i=$("<i/>",{"class":"zimageedit__icon "+cls}),$(button).append(i)};createButton(tool_div,"zimageedit__icon--arrow","select","select",zimagedit._getString("select.label"),"right"),$("#zimageeditor__btns--select").addClass("zimageeditor__btns--active"),createButton(tool_div,"zimageedit__icon--square","shapes",void 0,zimagedit._getString("highlightingTools.label"),"right"),createButton(tool_div,"zimageedit__icon--marker","marker","marker",zimagedit._getString("marker.label"),"right"),createButton(tool_div,"zimageedit__icon--arrow","linearrow",void 0,zimagedit._getString("arrowline.label"),"right"),createButton(tool_div,"zimageedit__icon--text",void 0,"textarea",zimagedit._getString("text.label"),"right"),createButton(tool_div,"zimageedit__icon--numbering","numbering",void 0,zimagedit._getString("taggingTools.label"),"right"),createButton(tool_div,"zimageedit__icon--blur","blur",void 0,zimagedit._getString("concealInfo.label"),"right"),createButton(tool_div,"zimageedit__icon--crop",void 0,"crop",zimagedit._getString("crop.label"),"right"),ele=div_function(tool_div,"zimageeditor__arrow"),$(ele).attr({id:"zimageeditor__arrow"}).css({top:"362px",display:"none"});var i=$("<i/>",{"class":"zimageedit__icon zimageedit__icon--arrow"});$(ele).append(i),zimagedit.createDashedIconSVG()},createToolsAndProperties:function(){function createMenu(menuID,itemObj,menuOptions){menuOptions=$.extend({},{columnCount:4,type:"grid",contentType:"icon",menuClass:"zimageeditor__menu",addItemCallback:function(menuItem){menuItem.attr({name:"zimageeditor__shapes"})}},menuOptions),ZComponents.createMenu(menuID,itemObj,menuOptions)}function handelOpacitySliderMove(){if(zimagedit.opacitySliderMoved=!0,0===flag){var len=zimagedit._noOfIdSelected.length;for(len--;len>=0;len--)zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len);flag=1}var value=$("#zimageeditor__slider").zslider("getAttribute","value");zimagedit.previousOpacity=value,zimagedit.changeOpacity(zimagedit.tagSelected,value/100),zimagedit.opacitySliderMoved=!1}if(!zimagedit.shapesMenu){var menuShortCut={undo:"Ctrl+Z",redo:"Ctrl+Y",copy:"Ctrl+C",paste:"Ctrl+V",selectall:"Ctrl+A",deselectall:"Shift+Ctrl+A"};zimagedit.isMacOS&&(menuShortCut={undo:"⌘Z",redo:"⇧⌘Z",copy:"⌘C",paste:"⌘V",selectall:"⌘A",deselectall:"⇧⌘A"});var shapesMenu=[{icon:"zimageedit__icon zimageedit__icon--square",itemType:"radio","data-action":"rectangle",customAttributes:{title:zimagedit._getString("rectangle.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--circle",itemType:"radio","data-action":"ellipse",customAttributes:{title:zimagedit._getString("ellipse.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--pencil",itemType:"radio","data-action":"polyline",customAttributes:{title:zimagedit._getString("pencil.label"),"data-title-position":"bottom"}}];createMenu("zimageeditor__shapes--menu",shapesMenu,{columnCount:shapesMenu.length,appendTo:"#zimageeditor"}),zimagedit.shapesMenu=$("#zimageeditor__shapes--menu");var lineMenu=[{icon:"zimageedit__icon zimageedit__icon--arrow",itemType:"radio","data-action":"line",customAttributes:{title:zimagedit._getString("arrow.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--doublearrow",itemType:"radio","data-action":"doubleArrow",customAttributes:{title:zimagedit._getString("doubleArrow.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--line",itemType:"radio","data-action":"stline",customAttributes:{title:zimagedit._getString("line.label"),"data-title-position":"bottom"}}];createMenu("zimageeditor__linearrow--menu",lineMenu,{columnCount:lineMenu.length,appendTo:"#zimageeditor",addItemCallback:function(menuItem){menuItem.attr({name:"zimageeditor__line"})}}),zimagedit.lineMenu=$("#zimageeditor__linearrow--menu");var zoomMenu=[{label:zimagedit._getString("10Percent.label"),id:"zimageditor__zoom--10","data-zoomAction":"10"},{label:zimagedit._getString("25Percent.label"),id:"zimageditor__zoom--25","data-zoomAction":"25"},{label:zimagedit._getString("50Percent.label"),id:"zimageditor__zoom--50","data-zoomAction":"50"},{label:zimagedit._getString("75Percent.label"),id:"zimageditor__zoom--75","data-zoomAction":"75"},{label:zimagedit._getString("100Percent.label"),id:"zimageditor__zoom--100","data-zoomAction":"100"},{label:zimagedit._getString("125Percent.label"),id:"zimageditor__zoom--125","data-zoomAction":"125"},{label:zimagedit._getString("150Percent.label"),id:"zimageditor__zoom--150","data-zoomAction":"150"},{label:zimagedit._getString("200Percent.label"),id:"zimageditor__zoom--200","data-zoomAction":"200"},{itemType:"separator",id:"zimageditor__zoom--seperator"},{label:zimagedit._getString("actualSize.label"),id:"zimageditor__zoom--ActualSize","data-zoomAction":"actualSize"},{label:zimagedit._getString("fitToScreen.label"),id:"zimageditor__zoom--fitToScreen","data-zoomAction":"fitToScreen"},{label:zimagedit._getString("fitToWidth.label"),id:"zimageditor__zoom--fitToWidth","data-zoomAction":"fitToWidth"}];createMenu("zimageeditor__zoom--menu",zoomMenu,{contentType:"text",type:"list",width:82,appendTo:"#zimageeditor",menuClass:"zimageeditor__zoom--menu",addItemCallback:function(menuItem){menuItem.addClass("zimageeditor__zoom--actions")}}),"screenshot"===this.options.captureType?$("#zimageditor__zoom--fitToWidth").css("display","none"):$("#zimageditor__zoom--fitToWidth").css("display","block");var contextMenu=[{c_action:"bringToFront",label:zimagedit._getString("bringToFront.label"),id:"zimageeditor__cmenu--bringToFront"},{c_action:"sendToBack",label:zimagedit._getString("sendToBack.label"),id:"zimageeditor__cmenu--sendToBack"},{c_action:"bringForward",label:zimagedit._getString("bringForward.label"),id:"zimageeditor__cmenu--bringForward"},{c_action:"moveBackward",label:zimagedit._getString("moveBackward.label"),id:"zimageeditor__cmenu--moveBackward"},{itemType:"separator"},{c_action:"zoomIn",label:zimagedit._getString("zoomIn.label"),id:"zimageeditor__cmenu--zoomIn"},{c_action:"zoomOut",label:zimagedit._getString("zoomOut.label"),id:"zimageeditor__cmenu--zoomOut"},{itemType:"separator",id:"zimageeditor__cmenu--separator"},{c_action:"undo",label:zimagedit._getString("undo.label"),shortcutkey:menuShortCut.undo,id:"zimageeditor__cmenu--undo"},{c_action:"redo",label:zimagedit._getString("redo.label"),shortcutkey:menuShortCut.redo,id:"zimageeditor__cmenu--redo"},{itemType:"separator",id:"zimageeditor__cmenu--separator1"},{c_action:"copy",label:zimagedit._getString("copy.label"),shortcutkey:menuShortCut.copy,id:"zimageeditor__cmenu--copy"},{c_action:"paste",label:zimagedit._getString("paste.label"),shortcutkey:menuShortCut.paste,id:"zimageeditor__cmenu--paste"},{c_action:"delete",label:zimagedit._getString("delete.label"),id:"zimageeditor__cmenu--delete"},{c_action:"selectall",label:zimagedit._getString("selectall.label"),shortcutkey:menuShortCut.selectall,id:"zimageeditor__cmenu--selectall"},{c_action:"deselectall",label:zimagedit._getString("deselectall.label"),shortcutkey:menuShortCut.deselectall,id:"zimageeditor__cmenu--deselectall"},{c_action:"crop",label:zimagedit._getString("crop.label"),id:"zimageeditor__cmenu--crop"},{c_action:"cancel",label:zimagedit._getString("cancel.label"),id:"zimageeditor__cmenu--cancel"}];createMenu("zimageeditor__context--menu",contextMenu,{contentType:"text",type:"list",menuClass:"zimageeditor__context--menu",addItemCallback:function(menuItem){menuItem.addClass("zimageeditor__objects--actions")},appendTo:"#zimageeditor"}),zimagedit.rightClickMenu=$("#zimageeditor__context--menu");var blurMenu=[{icon:"zimageedit__icon zimageedit__icon--blur",itemType:"radio","data-action":"blur",customAttributes:{title:zimagedit._getString("blur.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--smudge",itemType:"radio","data-action":"smudge",customAttributes:{title:zimagedit._getString("smudge.label"),"data-title-position":"bottom"}}];createMenu("zimageeditor__blur--menu",blurMenu,{columnCount:2,addItemCallback:function(menuItem){menuItem.attr({name:"zimageeditor__blur"})},appendTo:"#zimageeditor"}),zimagedit.blurMenu=$("#zimageeditor__blur--menu");var markerMenu=[{icon:"zimageedit__icon zimageedit__icon--markerYellow","data-action":"marker",itemType:"radio",actionColor:"ffff00",actionOpacity:.35,customAttributes:{title:zimagedit._getString("yellow.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--markerRed","data-action":"marker",itemType:"radio",actionColor:"ff0000",actionOpacity:.25,customAttributes:{title:zimagedit._getString("red.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--markerGreen","data-action":"marker",itemType:"radio",actionColor:"05d823",actionOpacity:.3,customAttributes:{title:zimagedit._getString("green.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--markerOrange","data-action":"marker",itemType:"radio",actionColor:"ff8a00",actionOpacity:.3,customAttributes:{title:zimagedit._getString("orange.label"),"data-title-position":"bottom"}}];createMenu("zimageeditor__marker--menu",markerMenu,{columnCount:4,addItemCallback:function(menuItem){menuItem.attr({name:"zimageeditor__marker"})},appendTo:"#zimageeditor"}),zimagedit.markerMenu=$("#zimageeditor__marker--menu");var numberingMenu=[{icon:"zimageedit__icon zimageedit__icon--numbering","data-action":"numbering",itemType:"radio",actionType:"numbering",customAttributes:{title:zimagedit._getString("numbering.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--tick","data-action":"numbering",itemType:"radio",actionType:"tick",customAttributes:{title:zimagedit._getString("correct.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--delete","data-action":"numbering",itemType:"radio",actionType:"wrong",customAttributes:{title:zimagedit._getString("wrong.label"),"data-title-position":"bottom"}},{icon:"zimageedit__icon zimageedit__icon--question","data-action":"numbering",itemType:"radio",actionType:"question",customAttributes:{title:zimagedit._getString("unclear.label"),"data-title-position":"bottom"}}];createMenu("zimageeditor__numbering--menu",numberingMenu,{columnCount:4,addItemCallback:function(menuItem){menuItem.attr({name:"zimageeditor__numbering"})},appendTo:"#zimageeditor"}),zimagedit.numberingMenu=$("#zimageeditor__numbering--menu");var colorVariations=[{"inner-color":"ff004e",itemType:"radio",customAttributes:{title:zimagedit._getString("pink.label")}},{"inner-color":"ff3131",itemType:"radio",customAttributes:{title:zimagedit._getString("red.label")}},{"inner-color":"fe9300",itemType:"radio",customAttributes:{title:zimagedit._getString("orange.label")}},{"inner-color":"ffc300",itemType:"radio",customAttributes:{title:zimagedit._getString("yellow.label")}},{"inner-color":"19de5e",itemType:"radio",customAttributes:{title:zimagedit._getString("green.label")}},{"inner-color":"226cfb",itemType:"radio",customAttributes:{title:zimagedit._getString("blue.label")}},{"inner-color":"8b23d5",itemType:"radio",customAttributes:{title:zimagedit._getString("violet.label")}},{"inner-color":"8b4513",itemType:"radio",customAttributes:{title:zimagedit._getString("brown.label")}},{"inner-color":"ffffff",itemType:"radio",customAttributes:{title:zimagedit._getString("white.label")}},{"inner-color":"000000",itemType:"radio",customAttributes:{title:zimagedit._getString("black.label")}},{"inner-color":"none",icon:"zimageedit__icon zimageedit__icon--nofill",itemType:"radio",customAttributes:{title:zimagedit._getString("noFill.label")}},{itemType:"separator","inner-color":"separator"},{itemType:"custom","inner-color":"opacity",innerHTML:'<div class="zimageeditor__slider--label">'+zimagedit._getString("opacity.label")+'</div><div class="zimageeditor__opacity"><span></span></div><input id="zimageeditor__slider" data-class-name="zimageeditor__slider" min="0" max="100" style="width:70px" />'}];createMenu("zimageeditor__colorpalatte--menu",colorVariations,{submenuDirection:"bottom-left",columnCount:5,addItemCallback:function(menuItem,menuItemObj){menuItem.attr({id:"zimageeditor__colors--"+menuItemObj["inner-color"],name:"zimageeditor__colors"})},appendTo:"#zimageeditor",animation:{open:{className:"zimageeditColorPallate--slideInDown",duration:"200"},close:{className:"zimageeditor__transistionPropertiesHide",duration:"200"}}});for(var _colorpalatteMenu=zimagedit.colorPalatteMenu=$("#zimageeditor__colorpalatte--menu"),colorIndex=0;colorIndex<colorVariations.length;colorIndex++){var innnerColor=colorVariations[colorIndex]["inner-color"];_colorpalatteMenu.find("#zimageeditor__colors--"+innnerColor+" .zmenu__image").css("background","#"+innnerColor)}var plusMenu=[{icon:"zimageedit__icon zimageedit__icon--text",itemType:"default","plus-action":"text"},{icon:"zimageedit__icon zimageedit__icon--numbering",itemType:"default","plus-action":"numbering"}];createMenu("zimageeditor__plus--menu",plusMenu,{columnCount:2,appendTo:"#zimageeditor",menuClass:"zimageeditor__menu zimageeditor__plus--menu"});var strokeWidth=[{itemType:"custom",innerHTML:'<div id="zimageeditor__strokewidth" class="zimageeditor__strokewidth"><div class="zimageeditor__line" title='+zimagedit._getString("solid.label")+'><span></span></div><div class="zimageeditor__dashed zimageeditor--unchecked" title='+zimagedit._getString("dashed.label")+"><span></span></div></div>"},{borderWidth:"2",itemType:"radio"},{borderWidth:"4",itemType:"radio"},{borderWidth:"7",itemType:"radio"},{borderWidth:"10",itemType:"radio"},{borderWidth:"4",borderType:"dash",itemType:"radio",icon:"#zimageedit__icon--dashedsmall"},{borderWidth:"8",borderType:"dash",itemType:"radio",icon:"#zimageedit__icon--dashedbig"}],borderType="line";createMenu("zimageeditor__strokewidth--menu",strokeWidth,{submenuDirection:"bottom-left",columnCount:4,appendTo:"#zimageeditor",addItemCallback:function(menuItem,menuItemObj){"custom"!==menuItemObj.itemType&&(borderType=menuItemObj.borderType||borderType,menuItem.data({borderWidth:menuItemObj.borderWidth}).attr({name:"zimageeditor__strokewidth--menu",id:"zimageeditor__"+borderType+"--"+menuItemObj.borderWidth}),menuItem.addClass("zimageedit--stroke--"+borderType))},animation:{open:{className:"zimageeditColorPallate--slideInDown",duration:"200"},close:{className:"zimageeditor__transistionPropertiesHide",duration:"200"}}}),$("#zimageeditor__strokewidth--menu .zimageedit--stroke--line").css("display",""),$("#zimageeditor__strokewidth--menu .zimageedit--stroke--dash").css("display","none"),$("#zimageeditor__strokewidth--menu .zimageeditor__line").on("click",function(){$("#zimageeditor__strokewidth--menu .zimageedit--stroke--line").show(),$("#zimageeditor__strokewidth--menu .zimageedit--stroke--dash").hide()}),$("#zimageeditor__strokewidth--menu .zimageeditor__dashed").on("click",function(){$("#zimageeditor__strokewidth--menu .zimageedit--stroke--line").hide(),$("#zimageeditor__strokewidth--menu .zimageedit--stroke--dash").show()});var textareaMenu=[{itemType:"custom",id:"zimageeditor--propertiesTool--header",innerHTML:'<div class="zimageeditor__propertiesTools--header"><span></span><span></span><span></span></div>'},{itemType:"custom",id:"zimageeditor--fontsize--slider",innerHTML:'<div class="zimageeditor__fontsize" ><span class="zimageedit__icon zimageedit__icon--fontsize"></span><input id="zimageeditor__fontsize--slider" data-class-name="zimageeditor__slider" min="12" max="40"/></div>',customAttributes:{title:zimagedit._getString("fontSize.label"),"data-title-position":"bottom",tabindex:"-1"}},{itemCssClass:"zimageeditor__textarea--item",itemType:"custom",id:"zimageeditor__text--fontcolor",innerHTML:'<span class="zimageedit__icon zimageedit__icon--shadow"></span><span class="zimageedit__fontcolor"></span><span class="zimaggeditor__submenuArrow"></span>',"textclick-action":"color",menuId:"zimageeditor__colorpalatte--menu",openOn:"click",customAttributes:{"data-objectaction":"text",title:zimagedit._getString("fontColor.label"),"data-title-position":"bottom",tabindex:"-1"}},{itemCssClass:"zimageeditor__textarea--item",icon:"zimageedit__icon zimageedit__icon--glow","textclick-action":"glow",id:"zimageedit__icon--textglow",itemType:"checkbox",customAttributes:{name:"zimageedit__icon--textglow",title:zimagedit._getString("textOutline.label"),"data-title-position":"bottom",tabindex:"-1"}},{itemCssClass:"zimageeditor__textarea--item",itemType:"custom",innerHTML:'<span class="zimageedit__fill--border"></span><span class="zimageedit__fill--transparent"></span><span class="zimageedit__fill--bg"></span><span class="zimaggeditor__submenuArrow"></span>',id:"zimageedit__icon--cfill","textclick-action":"fill",menuId:"zimageeditor__colorpalatte--menu",openOn:"click",customAttributes:{title:zimagedit._getString("fillColor.label"),"data-title-position":"bottom","data-objectaction":"fill",tabindex:"-1"}},{itemType:"custom",itemCssClass:"zimageeditor__textarea--item",innerHTML:'<span class="zimageedit__stroke--border zimageedit__prop--nofill" style="border: 2px solid white;"></span><span class="zimageedit__stroke--bg" style="background: gray;"></span><span class="zimaggeditor__submenuArrow"></span>',"textclick-action":"stroke",id:"zimageedit__icon--cstroke",menuId:"zimageeditor__colorpalatte--menu",openOn:"click",customAttributes:{"data-objectaction":"stroke","data-title-position":"bottom",title:zimagedit._getString("borderColor.label"),tabindex:"-1"}},{itemType:"custom",innerHTML:'<span class="zmenu__image zimageedit__icon zimageedit__icon--strokeWidth"></span><span class="zimaggeditor__submenuArrow"></span>',"textclick-action":"strokeWidth",id:"zimageedit__icon--cstrokWidth",menuId:"zimageeditor__strokewidth--menu",openOn:"click",customAttributes:{"data-objectaction":"strokewidth",title:zimagedit._getString("borderWidth.label"),"data-title-position":"bottom",tabindex:"-1"}}];createMenu("zimageeditor__textarea--menu",textareaMenu,{columnCount:3,direction:"after-pointer",toggle:!1,appendTo:"#zimageeditor",menuClass:"zimageeditor__menu zimageeditor__textarea--menu",addItemCallback:function(menuItem,menuItemObj){"checkbox"===menuItemObj.itemType&&menuItem.attr({name:"zimageeditor__textarea"})}});var flag=0;zimagedit.propertiesMenu=$("#zimageeditor__textarea--menu"),zimagedit.propertiesMenu.on("zmenubeforehide",function(){return zimagedit.opacitySliderMoved===!0?!1:void 0}).on("zmenubeforesubmenushow",function(){flag=0;var sliderValue,dataObjectAction=$(zimagedit.lastHover).data("objectaction");if("text"===dataObjectAction||zimagedit.numberingStrokeSelected===!0?(zimagedit.colorPalatteMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__colors--opacity","#zimageeditor__colors--separator"],"hidden",!0),zimagedit.colorPalatteMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__colors--none"],"disabled",!0),zimagedit.colorPalatteMenu.zmenu("hideMenuItems",["#zimageeditor__colors--none"]),zimagedit.colorPalatteMenu.zmenu("showMenuItems",["#zimageeditor__colors--8b4513"])):(zimagedit.colorPalatteMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__colors--opacity","#zimageeditor__colors--separator"],"hidden",!1),zimagedit.colorPalatteMenu.zmenu("hideMenuItems",["#zimageeditor__colors--8b4513"]),zimagedit.colorPalatteMenu.zmenu("showMenuItems",["#zimageeditor__colors--none"])),("fill"===dataObjectAction||"stroke"===dataObjectAction||"text"===dataObjectAction)&&(zimagedit.tagSelected=dataObjectAction,sliderValue=zimagedit.init_properties(dataObjectAction)),void 0!==zimagedit.lastHover&&void 0!==menuToBeOpen&&($("#zimageeditor__arrow").fadeOut(),menuToBeOpen.data("zmenu")&&menuToBeOpen.zmenu()),("fill"===dataObjectAction||"stroke"===dataObjectAction||"text"===dataObjectAction)&&void 0!==sliderValue&&($("#zimageeditor__slider").zslider("setValue",sliderValue[0]),zimagedit.changeOpacitySliderProperties(sliderValue[1])),"strokewidth"===dataObjectAction){for(var strokeWidth,strokeDashArray,loop=0;loop<zimagedit._noOfIdSelected.length;loop++){var currentStrokeWidth,currentStrokeDashArray,id=zimagedit._noOfIdSelected[loop];if(currentStrokeWidth=parseFloat($(id).attr("stroke-width")),currentStrokeDashArray=$(id).attr("stroke-dasharray"),0===loop)strokeWidth=currentStrokeWidth,strokeDashArray=currentStrokeDashArray;else if(strokeWidth!==currentStrokeWidth||strokeDashArray!==currentStrokeDashArray)return $("#zimageedit__svg--Icon .zimageedit__icon--dashedbig").attr("class","zimageedit__icon--dashedbig"),$("#zimageedit__svg--Icon .zimageedit__icon--dashedsmall").attr("class","zimageedit__icon--dashedsmall"),$("#zimageeditor__strokewidth--menu").zmenu("uncheckMenuItems"),$("#zimageeditor__strokewidth--menu .zimageeditor__line").trigger("click"),!0}if(void 0!==zimagedit._idSelected||1===zimagedit._noOfIdSelected.length)if((void 0===strokeDashArray||"undefined"===strokeDashArray)&&(strokeDashArray="none"),"none"===strokeDashArray)$("#zimageedit__svg--Icon .zimageedit__icon--dashedbig").attr("class","zimageedit__icon--dashedbig"),$("#zimageedit__svg--Icon .zimageedit__icon--dashedsmall").attr("class","zimageedit__icon--dashedsmall"),$("#zimageeditor__strokewidth--menu").zmenu("setMenuItemsAttribute",["#zimageeditor__line--"+strokeWidth],"checked",!0),$("#zimageeditor__strokewidth--menu .zimageeditor__line").trigger("click");else{var stroke=parseFloat($(zimagedit._noOfIdSelected[0]).attr("stroke-width"));10==stroke?$("#zimageedit__svg--Icon .zimageedit__icon--dashedbig").attr("class","zimageedit__icon--dashedbig is-selected"):$("#zimageedit__svg--Icon .zimageedit__icon--dashedbig").attr("class","zimageedit__icon--dashedbig"),6==stroke?$("#zimageedit__svg--Icon .zimageedit__icon--dashedsmall").attr("class","zimageedit__icon--dashedsmall is-selected"):$("#zimageedit__svg--Icon .zimageedit__icon--dashedsmall").attr("class","zimageedit__icon--dashedsmall"),$("#zimageeditor__strokewidth--menu").zmenu("setMenuItemsAttribute",["#zimageeditor__dash--"+stroke],"checked",!0),$("#zimageeditor__strokewidth--menu .zimageeditor__dashed").trigger("click")}}}),$("#zimageeditor__slider").zslider({change:function(){zimagedit.opacitySliderMoved===!1&&handelOpacitySliderMove(),zimagedit.isDraw=!0;var len=zimagedit._noOfIdSelected.length;for(flag=0,len--;len>=0;len--)zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len+1);zimagedit.copyFromTempToUndoStack(),zimagedit.opacitySliderMoved=!1},slide:function(){handelOpacitySliderMove()}}),$("#zimageeditor__slider").next().attr("id","zimageeditor__zslider"),$("#zimageeditor__fontsize--slider").zslider({change:function(){if(!zimagedit._toolSelected){zimagedit.isDraw=!0,"undefined"!==zimagedit.focussedTextareaID&&1===zimagedit._noOfIdSelected.length&&$("#"+zimagedit.focussedTextareaID).focus();for(var loop=0;loop<zimagedit._noOfIdSelected.length;loop++)zimagedit._idSelected=zimagedit._noOfIdSelected[loop],zimagedit._idSelected=zimagedit._idSelected.substr(1,zimagedit._idSelected.length),zimagedit.pushIntoTempStack(zimagedit._idSelected,2*loop+1),zimagedit.textFontSize=parseFloat($("#zimageeditor__fontsize--slider").zslider("getAttribute","value")),$("#"+zimagedit._idSelected).css({"font-size":Math.round(zimagedit.textFontSize)}),zimagedit.textareaAlignment(zimagedit._idSelected),zimagedit.textFontShadow="none"===$("#"+zimagedit._idSelected).css("text-shadow")?!1:!0,zimagedit.applyTextShadow(zimagedit._idSelected,zimagedit.textFontShadow);zimagedit.copyFromTempToUndoStack()}},slide:function(){var loop;if(zimagedit._checkFlagMouseAction===!1){for(loop=0;loop<zimagedit._noOfIdSelected.length;loop++)zimagedit._idSelected=zimagedit._noOfIdSelected[loop].substr(1,zimagedit._noOfIdSelected[loop].length),zimagedit.pushIntoTempStack(zimagedit._idSelected,2*loop);zimagedit._checkFlagMouseAction=!0}var value=$("#zimageeditor__fontsize--slider").zslider("getAttribute","value");for(loop=0;loop<zimagedit._noOfIdSelected.length;loop++)zimagedit._idSelected=zimagedit._noOfIdSelected[loop].substr(1,zimagedit._noOfIdSelected[loop].length),$("#"+zimagedit._idSelected).css({"font-size":Math.round(value)}),zimagedit.textareaAlignment(zimagedit._idSelected)},min:12,max:40}),$("#zimageeditor__fontsize--slider").next().attr("id","zimageeditor__fontsize--zslider"),$("#zimageeditor__strokewidth--menu").on("zmenubeforeshow",function(){$("#zimageeditor__context--menu").zmenu("hide");var menuItems=$("#zimageeditor__strokewidth--menu").find(".zmenu__item:not(.zmenu__custom)"),itemHeight=$(menuItems[0]).height()/2;menuItems.each(function(i,menuItem){menuItem=$(menuItem);var borderWidth=menuItem.data("borderWidth"),cssProps={"margin-top":itemHeight-borderWidth/2};"dash"!==menuItem.data("borderType")&&(cssProps["border-top-width"]=borderWidth+"px"),menuItem.find("i").css(cssProps)})});var menuToBeOpen;$("#zimageeditor__strokewidth").children().on("click",function(orgEvent){return $(orgEvent.target).hasClass("zimageeditor__line")?($("#zimageeditor__strokewidth .zimageeditor__dashed").addClass("zimageeditor--unchecked"),$(this).removeClass("zimageeditor--unchecked"),$("#zimageeditor__strokewidth--menu").removeClass("zimageeditor__dashed").addClass("zimageeditor__line")):($("#zimageeditor__strokewidth .zimageeditor__line").addClass("zimageeditor--unchecked"),$(this).removeClass("zimageeditor--unchecked"),$("#zimageeditor__strokewidth--menu").removeClass("zimageeditor__line").addClass("zimageeditor__dashed")),orgEvent.preventDefault(),orgEvent.stopPropagation(),!1}),$("#zimageeditor .zimageeditor__btns:not(#zimageeditor__plus), .zimageeditor__textarea--item, #zimageedit__icon--cstrokWidth, #zimageeditor--fontsize--slider").on("mouseenter",function(orgEvent){zimagedit.toolMove===!0?zimagedit.moveToolbar(orgEvent,zimagedit.toolbarMove,zimagedit.propertiesMove):(orgEvent.stopPropagation(),zimagedit.lastHover=$(this))}).on("click",function(orgEvent){zimagedit.lastHover=$(this);var dataobject=zimagedit.lastHover.data("objectmenu");"colorpalatte"===dataobject||"strokewidth"===dataobject?(menuToBeOpen=$("#zimageeditor__"+zimagedit.lastHover.data("objectmenu")+"--menu"),zimagedit.handleMenuOpen(orgEvent,menuToBeOpen,dir)):void 0!==zimagedit.lastHover.data("colorpalatte")&&(menuToBeOpen=zimagedit.colorPalatteMenu)}),$("#zimageeditor__arrow").on("click",function(orgEvent){setTimeout(function(){zimagedit.handleMenuOpen(orgEvent,menuToBeOpen)},100)}).on("mouseenter",function(orgEvent){setTimeout(function(){zimagedit.handleMenuOpen(orgEvent,menuToBeOpen)},100)})}},handleMenuOpen:function(orgEvent,menuToBeOpen,direction){var lastHoverClass=$(zimagedit.lastHover).attr("class"),orginalLastHover=zimagedit.lastHover;-1!==lastHoverClass.indexOf("zimageeditor__btns_spilit")&&(zimagedit.lastHover=zimagedit.lastHover.parent(),direction="right","zoom"===zimagedit.lastHover.children().eq(0).data("objectmenu")&&(direction="top"));var menuName=zimagedit.lastHover.data("objectmenu");if("zoom"===menuName&&(direction="top"),"zoom"===zimagedit.lastHover.data("objectmenu")&&$("#zimageeditor__zoom--menu").is(":visible")===!0)return $("#zimageeditor__zoom--menu").zmenu("hide"),!0;if($("#zimageeditor__zoom--menu").is(":visible")&&$("#zimageeditor__zoom--menu").zmenu("hide"),zimagedit.handleToolsMenuAnimation(menuName,menuToBeOpen),void 0!==zimagedit.lastHover&&void 0!==menuToBeOpen){$("#zimageeditor__arrow").fadeOut(),menuToBeOpen.data("zmenu")&&menuToBeOpen.zmenu();var position={top:0,left:0};"zimageedit__plus"===zimagedit.lastHover.attr("id")&&(position.top=-4,position.left=-18),menuToBeOpen.zmenu("show",{forElement:zimagedit.lastHover,direction:direction?direction:"right-bottom",event:orgEvent,offset:{top:position.top,left:position.left},preventHover:!0}),zimagedit.lastHover=orginalLastHover}},textareaAlignment:function(textareaID){var textarea,svgHeight,top,left,width,height,element;textarea=document.getElementById(textareaID),$(textarea).css("overflow","hidden"),svgHeight=parseFloat(zimagedit.SVGElement.attr("height")),element=$(textarea).parent(),top=parseFloat(element.attr("y")),left=parseFloat(element.attr("x")),width=parseFloat(element.attr("width")),height=parseFloat(element.attr("height"));var resizeFlag=$(textarea).data("resized");textarea.style.height="0px";var fontSize=parseFloat(textarea.style.fontSize),scrollHeight=textarea.scrollHeight+8;$(textarea).attr("wrap","off"),textarea.style.width="0px";var scrollWidth=textarea.scrollWidth;textarea.style.height="100%",textarea.style.width="100%",resizeFlag===!1?(element.attr({width:"0px",height:"0px"}),zimagedit.isIEBrowser&&element.css({width:"0px",height:"0px"}),scrollWidth=textarea.scrollWidth+(fontSize+2),element.attr({width:scrollWidth>40?scrollWidth:40,height:scrollHeight>31?scrollHeight:31}),zimagedit.isIEBrowser&&element.css({width:scrollWidth>40?scrollWidth:40,height:scrollHeight>31?scrollHeight:31}),textarea.scrollWidth+left>zimagedit.actualWidth&&(scrollWidth=Math.abs(zimagedit.actualWidth-left-5),textarea.scrollWidth=width,element.attr("width",scrollWidth),zimagedit.isIEBrowser&&element.css("width",scrollWidth)),element.attr({width:scrollWidth>40?scrollWidth:40,height:scrollHeight>31?scrollHeight:31}),zimagedit.isIEBrowser&&(element.css({width:scrollWidth>40?scrollWidth:40,height:scrollHeight>31?scrollHeight:31}),top+scrollHeight>svgHeight&&(scrollHeight=svgHeight-top,element.css({height:scrollHeight}))),width=scrollWidth,height=scrollHeight):(element.attr({width:width>40?width:40,height:scrollHeight>31?scrollHeight:31}),zimagedit.isIEBrowser===!0&&element.css({width:width,height:scrollHeight}),height=scrollHeight),zimagedit.checkTextareaOverflow(textareaID),$(textarea).css("overflow","hidden"),zimagedit.multiSelectFlag===!1?(top-=1,zimagedit.drawBorder("textarea",top,left-4,width>47?width:47,height>33?height:33)):zimagedit.setBoundaryValuesMultiSelect("#"+textareaID,top,left-4,width,height,zimagedit.getValuesOfObject("#"+textareaID)),fontSize=parseFloat(textarea.style.fontSize);var textareaHeightPadding=12;fontSize+textareaHeightPadding>height&&$("#"+textareaID+"--fobject").attr("height",fontSize+textareaHeightPadding),$(textarea).attr("wrap","soft")},handleToolsMenuAnimation:function(menuName,menu){if("shapes"===menuName||"marker"===menuName||"numbering"===menuName||"blur"===menuName||"linearrow"===menuName){var menuWidth,availableWidth,toolBarLeft,windowDimensions,toolBarWidth=60;windowDimensions=zimagedit.getWindowDimensions(),menuWidth="shapes"===menuName?135:"marker"===menuName||"numbering"===menuName?180:"linearrow"===menuName||"blur"===menuName?90:0,"shapes"===menuName?menuWidth=135:"marker"===menuName||"numbering"===menuName?menuWidth=180:"blur"===menuName?menuWidth=90:"linearrow"===menuName&&(menuWidth=90),toolBarLeft=parseFloat($("#zimageeditor .zimageeditor__tools").offset().left),availableWidth=windowDimensions.width-toolBarLeft-toolBarWidth;var position=availableWidth>menuWidth?"Left":"Right";$(menu).zmenu("setAttribute","animation",{open:{className:"zimageditToolsShowFrom"+position,duration:"100"},close:{className:"zimageditToolsHideFrom"+position,duration:"100"}})}},init_properties:function(init_to){var sliderValue,color,length=zimagedit._noOfIdSelected.length,id=zimagedit._noOfIdSelected[length-1],object=zimagedit.getValuesOfObject(id);return"fill"===init_to?(color=object.fill,"transparent"===color&&(color="none"),"textarea"===object.tool&&(color=color.bck_color,"rgba"===color.substr(0,4)&&(color="none")),void 0===color&&(color=zimagedit.previousFillColor),sliderValue="none"===object.fillOpacity||void 0===object.fillOpacity?100:100*object.fillOpacity):"stroke"===init_to?(color=object.borderColor,"transparent"===color&&(color="none"),"textarea"===object.tool?(color=object.fill.border,color="transparent"===color?"none":zimagedit.regtohex_convert(color),"#000000"===color&&(color="none")):"numbering"===object.tool&&(color=object.borderStroke),"textarea"===zimagedit._selectedTool&&void 0===color&&(color="none"),void 0===color&&(color=zimagedit.previousBorderColor),sliderValue="none"===object.strokeOpacity||void 0===object.strokeOpacity?100:100*object.strokeOpacity,void 0===object.strokeOpacity&&"Marker"===zimagedit._selectedTool&&(sliderValue=70)):"text"===init_to&&(color=$(id).css("color"),color=zimagedit.regtohex_convert(color)),"transparent"===color&&(color="none"),void 0!==color&&"none"!==color&&-1!==color.indexOf("#")&&(color=color.substr(1,color.length)),zimagedit.colorPalatteMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__colors--"+color],"checked",!0),"stroke"===init_to&&"#7F7F7F"===zimagedit.borderIconColor&&zimagedit.colorPalatteMenu.zmenu("uncheckMenuItems"),"fill"===init_to&&"#7F7F7F"===zimagedit.fillIconColor&&zimagedit.colorPalatteMenu.zmenu("uncheckMenuItems"),zimagedit.colorPalatteMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__colors--none"],"disabled","text"===init_to||zimagedit.numberingStrokeSelected===!0),[sliderValue,color]},regtohex_convert:function(color){var rgb=color.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return rgb&&4===rgb.length?"#"+("0"+parseInt(rgb[1],10).toString(16)).slice(-2)+("0"+parseInt(rgb[2],10).toString(16)).slice(-2)+("0"+parseInt(rgb[3],10).toString(16)).slice(-2):color},CropDone:function(){zimagedit.cropCancelAnimationHandle(),zimagedit.onCropDone=!0,zimagedit.isImageCropped=!0,zimagedit.catureButtonClickFunction(),zimagedit.cropCaptureCount++,$("#zimageeditor .zimaggeditor__crop--container").children().closest("#zimaggeditor__crop--container").remove(),zimagedit.resetToDefaultAfterCrop()},onCropCancel:function(){zimagedit.onCropDone=!1,zimagedit.cropCancelAnimationHandle(),zimagedit.removeBorderFocus(),void 0===zimagedit._crop_arr[0]?$("#zimageeditor .zimaggeditor__crop--container").remove():(zimagedit.modifyTheCropAreaValues(0,0,zimagedit.actualWidth,zimagedit.actualHeight),zimagedit.drawBorder("crop_element",zimagedit._crop_arr[1]+3,zimagedit._crop_arr[0]+3,zimagedit._crop_arr[2]-3,zimagedit._crop_arr[3]-3),zimagedit.removeBorderFocus()),$("#zimageeditor .zimaggeditor__crop--container").remove(),zimagedit.resetToDefaultAfterCrop(),zimagedit.undoStack.pop()},initMouseFunction:function(){$(document).off("dragstart.zimageeditor").on("dragstart.zimageeditor",function(){return!1}),$(".zimageeditor__btns").off("mousedown click").on("mousedown",function(event){zimagedit.rightClickMenu.is(":visible")===!0&&zimagedit.rightClickMenu.zmenu("hide"),$("#zimageeditor__plus--menu").is(":visible")===!0&&$("#zimageeditor__plus--menu").zmenu("hide");zimagedit.lastHover.data("objectmenu");$(zimagedit.splitMenuOpen).show();var splitData=$(zimagedit.splitMenuOpen).data("objectmenu");void 0!==splitData&&"zoom"!==splitData&&$("#zimageeditor__"+splitData+"--menu").zmenu("hide");var menuToBeOpen,selectedClass=$(this).attr("class");-1!=selectedClass.indexOf("zimageeditor__btns_spilit")?($(".zimageeditor__btns--focus").removeClass("zimageeditor__btns--focus"),zimagedit.lastHover=$(this),menuToBeOpen=$("#zimageeditor__"+zimagedit.lastHover.data("objectmenu")+"--menu"),zimagedit.splitMenuOpen=this,"rectangle"!==zimagedit._selectedTool&&"ellipse"!==zimagedit._selectedTool&&"polyline"!==zimagedit._selectedTool&&$("#zimageeditor__shapes--menu").zmenu("uncheckMenuItems"),"line"!==zimagedit._selectedTool&&$("#zimageeditor__linearrow--menu").zmenu("uncheckMenuItems"),"numbering_"!==zimagedit._selectedTool&&$("#zimageeditor__numbering--menu").zmenu("uncheckMenuItems"),"blur"!==zimagedit._selectedTool&&"smudge"!==zimagedit._selectedTool&&$("#zimageeditor__blur--menu").zmenu("uncheckMenuItems"),zimagedit.handleMenuOpen(event,menuToBeOpen)):zimagedit.splitMenuOpen=void 0;var data_obj=$(this).attr("data-objectaction");return event.stopPropagation(),"crop"===data_obj&&($("#zimaggeditor__crop--container").remove(),zimagedit.textareaSelected=!1,zimagedit.resetMultiSelect(),zimagedit._idSelected="zimageedit__crop",zimagedit.resize_flag=!0,zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected),zimagedit.removeCssFromCrop(),zimagedit.cursorHandling({type:"toolSelect",tool:"crop"}),zimagedit.setPropertiesForSelectedObject("crop"),zimagedit.hidePlusMenu(),zimagedit.multiSelectFlag=!1,$("#zimageedit__focus--crop").css("visibility","visible"),zimagedit.showBorderFocus(),zimagedit.createCropDiv(),zimagedit.previousSelectedTool=zimagedit._selectedTool,zimagedit.showBorderFocus(),zimagedit._selectedTool="crop"),"zoomin"!==data_obj&&"zoomout"!==data_obj&&"fill"!==data_obj&&"stroke"!==data_obj&&"strokewidth"!==data_obj&&"select"!==data_obj?-1==selectedClass.indexOf("zimageeditor__btns_spilit")&&("textarea"!==data_obj&&"crop"!==data_obj&&(zimagedit.lastHover=$(this),menuToBeOpen=$("#zimageeditor__"+zimagedit.lastHover.data("objectmenu")+"--menu"),zimagedit.splitMenuOpen=this,"rectangle"!==zimagedit._selectedTool&&"ellipse"!==zimagedit._selectedTool&&"polyline"!==zimagedit._selectedTool&&$("#zimageeditor__shapes--menu").zmenu("uncheckMenuItems"),"line"===zimagedit._selectedTool||zimagedit._arrowPolyline||$("#zimageeditor__linearrow--menu").zmenu("uncheckMenuItems"),"marker"!==zimagedit._selectedTool&&$("#zimageeditor__marker--menu").zmenu("uncheckMenuItems"),"numbering_"!==zimagedit._selectedTool&&$("#zimageeditor__numbering--menu").zmenu("uncheckMenuItems"),"blur"!==zimagedit._selectedTool&&"smudge"!==zimagedit._selectedTool&&$("#zimageeditor__blur--menu").zmenu("uncheckMenuItems"),"zoom"===zimagedit.lastHover.data("objectmenu")?zimagedit.handleMenuOpen(event,menuToBeOpen,"top"):zimagedit.handleMenuOpen(event,menuToBeOpen)),"crop"!==zimagedit._selectedTool&&(zimagedit.previousSelectedToolObj=this),zimagedit._toolSelected=!0,void 0!==zimagedit._selectedTool&&zimagedit.setPropertiesForSelectedTool(zimagedit._selectedTool,data_obj),"textarea"===zimagedit._selectedTool?zimagedit.cursorHandling({type:"toolSelect",tool:zimagedit._selectedTool}):"crop"===zimagedit._selectedTool&&(zimagedit.cropSelected=!0)):"zoomin"!==data_obj&&"zoomout"!==data_obj||$(this).is(":disabled")!==!1||(zimagedit.handleZoomCases(data_obj),zimagedit.isFitToScreen=!1),"undefined"!=typeof data_obj&&$("#zimageeditor__zoom--menu").is(":visible")&&$("#zimageeditor__zoom--menu").zmenu("hide"),!0}).on("click",function(event){var data_obj=$(this).attr("data-objectaction");event.stopPropagation(),"textarea"===data_obj?(zimagedit._stLine=!1,zimagedit._doubleArrow=!1,zimagedit._arrowPolyline=!1,zimagedit.hideProperties(),$(".zimageeditor__btns--focus").removeClass("zimageeditor__btns--focus"),zimagedit.resetProperties(),zimagedit.textID=void 0,zimagedit.textareaSelected=!1,zimagedit.hidePlusMenu(),zimagedit.removeShadowForMarker(),zimagedit._selectedTool=data_obj,zimagedit.cursorHandling({type:"toolSelect",tool:data_obj}),$(".zimageeditor__btns--active").removeClass("zimageeditor__btns--active"),$("#zimageeditor__btns--"+data_obj).addClass("zimageeditor__btns--active"),zimagedit.setPropertiesForSelectedTool(zimagedit._selectedTool,data_obj)):"select"===data_obj&&(zimagedit._stLine=!1,zimagedit._doubleArrow=!1,zimagedit._arrowPolyline=!1,zimagedit._selectedTool=void 0,$(".zimageeditor__btns--active").removeClass("zimageeditor__btns--active"),zimagedit._toolSelected=!1,$("#zimageeditor__btns--select").addClass("zimageeditor__btns--active"),zimagedit.cursorHandling({type:"toolSelect",tool:void 0}))}),$("#zimageeditor__textarea--menu > ul").on("mouseup",function(){ZComponents.$document.trigger("mouseup")}),$(document).off("zmenuitemclick.ze zmenusubmenuitemclick.zimageeditor").on("zmenuitemclick.ze",function(orgEvent,ui){if(ui.menuitem.is(".zmenu--submenu"))return void("stroke"===ui.data.customAttributes["data-objectaction"]?$("#zimageeditor__colors--none").attr("title",zimagedit._getString("noColor.label")):"fill"===ui.data.customAttributes["data-objectaction"]&&$("#zimageeditor__colors--none").attr("title",zimagedit._getString("noFill.label")));var theColor,itemData=ui.data,action=itemData["data-action"],plus_action=itemData["plus-action"],text_click=itemData["textclick-action"],markerColor=itemData.actionColor,markerColorOpacity=itemData.actionOpacity,zoomValue=itemData["data-zoomAction"],act="c_action",right_click=itemData[act],temp="inner-color",label=itemData[temp];void 0!==label&&(theColor=label);var propertiesHeader=ui.menuitem[0].id;if("zimageeditor--propertiesTool--header"===propertiesHeader||"zimageeditor--fontsize--slider"===propertiesHeader)return"zimageeditor--fontsize--slider"===propertiesHeader&&ZComponents.$document.trigger("mouseup"),!1;var border_width,loop,length,classs;if(temp="borderWidth",border_width=itemData[temp],void 0!==markerColor)zimagedit._stLine=!1,zimagedit._doubleArrow=!1,zimagedit._arrowPolyline=!1,$("#"+zimagedit.textID).blur(),zimagedit.textareaSelected=!1,zimagedit._idSelected=zimagedit.textID=void 0,zimagedit.resetMultiSelect(),zimagedit._noOfIdSelected.length=0,zimagedit.hideProperties(),zimagedit.resetProperties(),zimagedit.markerColor=markerColor,zimagedit.markerColorOpacity=markerColorOpacity,zimagedit._selectedTool="marker",classs=$(zimagedit.lastHover).attr("class"),-1!=classs.indexOf("zimageeditor__btns_spilit")&&(zimagedit.lastHover=$(zimagedit.lastHover).parent().children().eq(0)),$(".zimageeditor__btns--active").removeClass("zimageeditor__btns--active"),$("#zimageeditor__btns--marker").addClass("zimageeditor__btns--active"),zimagedit.hidePlusMenu(),zimagedit.setPropertiesForSelectedTool(zimagedit._selectedTool),zimagedit.cursorHandling({type:"toolSelect",tool:zimagedit._selectedTool});else if(void 0!==action)zimagedit._stLine=!1,zimagedit._doubleArrow=!1,zimagedit._arrowPolyline=!1,zimagedit.textareaSelected=!1,$("#"+zimagedit.textID).blur(),zimagedit.textID=void 0,zimagedit.hideProperties(),$(zimagedit.splitMenuOpen).show(),"numbering"===action?(zimagedit._selectedTool="numbering_",zimagedit.numberingTagSelected=itemData.actionType):("stline"===action&&(action="line",zimagedit._stLine=!0),"doubleArrow"===action&&(action="line",zimagedit._doubleArrow=!0),"arrowPolyline"===action&&(action="polyline",zimagedit._arrowPolyline=!0),zimagedit._selectedTool=action),zimagedit.hidePlusMenu(),zimagedit.resetMultiSelect(),zimagedit.setPropertiesForSelectedTool(zimagedit._selectedTool),zimagedit._noOfIdSelected.length=0,zimagedit.cursorHandling({type:"toolSelect",tool:zimagedit._selectedTool}),zimagedit._toolSelected=!0,classs=$(zimagedit.lastHover).attr("class"),-1!=classs.indexOf("zimageeditor__btns_spilit")&&(zimagedit.lastHover=$(zimagedit.lastHover).parent().children().eq(0)),"numbering_"===zimagedit._selectedTool?zimagedit.lastHover=$("#zimageeditor__btns--numbering"):"ellipse"===zimagedit._selectedTool||"rectangle"===zimagedit._selectedTool||"polyline"===zimagedit._selectedTool&&!zimagedit._arrowPolyline?zimagedit.lastHover=$("#zimageeditor__btns--shapes"):"line"===zimagedit._selectedTool||zimagedit._arrowPolyline?zimagedit.lastHover=$("#zimageeditor__btns--linearrow"):("blur"===zimagedit._selectedTool||"smudge"===zimagedit._selectedTool)&&(zimagedit.lastHover=$("#zimageeditor__btns--blur"),zimagedit.lastDrawnId=void 0),$(".zimageeditor__btns--active").removeClass("zimageeditor__btns--active"),$("#zimageeditor__btns--"+zimagedit.lastHover.attr("data-objectmenu")).addClass("zimageeditor__btns--active"),zimagedit.previousSelectedToolObj=zimagedit.lastHover,"crop"!==zimagedit._selectedTool&&zimagedit.resetProperties();else if(void 0!==label&&"opacity"!==label){if(zimagedit.isDraw=!0,"fill"===zimagedit.tagSelected)zimagedit.changeFillColor(theColor);else if("stroke"===zimagedit.tagSelected)zimagedit.changeBorderColor(theColor);else if("text"===zimagedit.tagSelected){for(zimagedit.pushIntoStack("resize"),length=zimagedit._noOfIdSelected.length,theColor="none"===theColor?"transparent":"#"+theColor,$("#zimageeditor__textarea--menu .zimageedit__fontcolor").css("background-color",theColor),loop=0;length>loop;loop++)zimagedit._idSelected=zimagedit._noOfIdSelected[loop],zimagedit._idSelected=zimagedit._idSelected.substr(1,zimagedit._idSelected.length),zimagedit.pushIntoTempStack(temp,2*loop),$("#"+zimagedit._idSelected).css({color:theColor}),zimagedit.pushIntoTempStack(temp,2*loop+1);1===length&&"undefined"!==zimagedit.focussedTextareaID&&$("#"+zimagedit.focussedTextareaID).focus(),zimagedit.copyFromTempToUndoStack(),zimagedit.textFontColor=theColor}"none"===theColor?(theColor="transparent",$("#zimageeditor__colors--opacity").css("opacity",.5),zimagedit.colorPalatteMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__colors--opacity"],"disabled",!0)):(theColor="#"+theColor,$("#zimageeditor__colors--opacity").css("opacity",1),zimagedit.colorPalatteMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__colors--opacity"],"disabled",!1)),zimagedit.changeOpacitySliderProperties(theColor)}else if(void 0!==border_width){var type=itemData.borderType;10==border_width&&"dash"===type?$("#zimageedit__icon--dashedbig .zimageedit__icon--dashedbig").attr("class","zimageedit__icon--dashedbig is-selected"):$(".zimageedit__icon--dashedbig").attr("class","zimageedit__icon--dashedbig"),6==border_width&&"dash"===type?$("#zimageedit__icon--dashedsmall .zimageedit__icon--dashedsmall").attr("class","zimageedit__icon--dashedsmall is-selected"):$(".zimageedit__icon--dashedsmall").attr("class","zimageedit__icon--dashedsmall"),zimagedit.changeStrokeWidth(parseFloat(border_width),"dash"===type)}else if(void 0!==plus_action){var selectedID=zimagedit._idSelected,values=zimagedit.calculateElementPosition(zimagedit._idSelected),randomNum=Math.round(1e7*Math.random());if(zimagedit.temp_id="zimageedit__shapes--"+randomNum,"numbering"===plus_action){var flag=!1,viewbox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/);values.top-parseFloat(viewbox[1])<40&&(values.top+=values.height+60,flag=!0,values.top+30-parseFloat(viewbox[1])>parseFloat(viewbox[3])&&(values.top-=60,flag=!1));var typeOfObject=zimagedit.typeOfElement(zimagedit._noOfIdSelected[0].substr(1,zimagedit._noOfIdSelected[0].length));zimagedit.cursorHandling({type:"toolSelect",tool:zimagedit._selectedTool}),$(zimagedit._noOfIdSelected[0]).attr("class","zimageedit__"+typeOfObject),zimagedit.numberingTagSelected="numbering",zimagedit.createNumbering(values.left+values.width/2,values.top-30),zimagedit.lastDrawnId=zimagedit._idSelected,zimagedit._idSelected=zimagedit.temp_id,flag===!0&&$("#"+zimagedit.temp_id+"--path").attr("transform","translate("+(values.left+values.width/2)+","+(values.top-65+15)+") rotate(270 0 7.5)"),zimagedit.hideProperties(),zimagedit.pushIntoStack("create"),zimagedit._idSelected=selectedID,zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit.temp_id),zimagedit.checkForPlusDisplay(void 0,orgEvent),zimagedit.removeBorderForNumbering(),zimagedit.removePlusAttributes(),zimagedit.drawnElements.push(zimagedit.temp_id),zimagedit._idSelected=zimagedit.temp_id,zimagedit.showBroderForNumbering(values.left+values.width/2,values.top-30,zimagedit._idSelected),zimagedit.checkForPlusDisplay($("#"+zimagedit._idSelected).attr("class"),orgEvent,zimagedit._idSelected);var addon="";zimagedit.isIEBrowser===!0&&(addon="--IE"),$("#"+zimagedit._idSelected+"--group").attr("class","zimageedit__numbering zimageedit__move--cursor"+addon)}else if("text"===plus_action){zimagedit._stLine=!1,zimagedit._doubleArrow=!1;var temp_id1=zimagedit.temp_id,line=document.createElementNS(zimagedit.svgPath,"path");randomNum=Math.round(1e7*Math.random()),zimagedit.temp_id="zimageedit__shapes--"+randomNum,zimagedit.drawnElements.push(zimagedit.temp_id);var strokeColor=$("#"+zimagedit._idSelected).attr("stroke"),strokeWidth=$("#"+zimagedit._idSelected).attr("stroke-width");zimagedit.setAttributeForObj(line,["class","zimageedit__line","id",zimagedit.temp_id,"stroke-linecap","round","stroke-width",4,"fill","none","stroke",strokeColor,"stroke-width",strokeWidth]);var polygon=document.createElementNS(zimagedit.svgPath,"polygon");zimagedit.setAttributeForObj(polygon,["id",zimagedit.temp_id+"--line","class","zimageedit__line","stroke-width",strokeWidth-5,"fill",strokeColor,"stroke",strokeColor]);var group=document.createElementNS(zimagedit.svgPath,"g");zimagedit.setAttributeForObj(group,["id",zimagedit.temp_id+"--group","class","zimageedit__line"]),$(group).insertBefore("#zimageedit__focus--shape"),$(group).append(line).append(polygon);var point;zimagedit.setPropertiesForSelectedObject("textarea");var textareaHeight=zimagedit.textFontSize+15,viewbox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/);values.left+values.width+150-parseFloat(viewbox[0])<parseFloat(viewbox[2])?(zimagedit.createTextarea(values.top+values.height/2-textareaHeight/2,values.left+values.width+80,textareaHeight+5,textareaHeight,temp_id1),point="M"+(values.left+values.width)+" "+(values.top+values.height/2)+", "+(values.left+values.width+70)+" "+(values.top+values.height/2)):values.left+values.width-parseFloat(viewbox[2])-parseFloat(viewbox[0])<200&&values.top-parseFloat(viewbox[1])+values.height+200<parseFloat(viewbox[3])?(zimagedit.createTextarea(values.top+values.height+100,values.left+values.width/2,textareaHeight+5,textareaHeight,temp_id1),point="M"+(values.left+values.width/2)+" "+(values.top+values.height)+", "+(values.left+values.width/2)+" "+(values.top+values.height+75)):(zimagedit.createTextarea(values.top+values.height/2-textareaHeight/2,values.left-250,170,textareaHeight,temp_id1),point="M"+values.left+" "+(values.top+values.height/2)+", "+(values.left-70)+" "+(values.top+values.height/2),$("#"+temp_id1).data("resized",!0)),line.setAttribute("d",point),zimagedit.changeArrowHeadValues(zimagedit.temp_id+"--line",zimagedit.temp_id),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(zimagedit.temp_id+"--line1",zimagedit.temp_id,!0),zimagedit.textID=temp_id1,$("#"+temp_id1).focus(),zimagedit.textareaSelected=!0,zimagedit._idSelected=zimagedit.temp_id,zimagedit.isDraw=!0,zimagedit.pushIntoStack("create"),zimagedit._idSelected=temp_id1,zimagedit.pushIntoStack("create"),zimagedit.undoStack.push(2),zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected),zimagedit.drawnElements.push(zimagedit._idSelected),zimagedit.lastDrawnId=temp_id1,zimagedit._toolSelected=!0,zimagedit.showProperties(temp_id1,"textarea"),zimagedit.checkForContinuousDrawing(!0),zimagedit.textID=temp_id1,zimagedit.lastAction="draw",zimagedit.actionDone="create",zimagedit.textareaCreated=!0,zimagedit.removePlusAttributes()}}else if(void 0!==text_click){if("glow"===text_click){zimagedit.colorPalatteMenu.zmenu("hide","#zimageeditor__colorpalatte--menu");var id=zimagedit._idSelected;for(zimagedit.pushIntoStack("resize"),zimagedit.isDraw=!0,length=zimagedit._noOfIdSelected.length,loop=0;length>loop;loop++)id=zimagedit._noOfIdSelected[loop],id=id.substr(1,id.length),$("#zimageedit__icon--textglow").prop("checked")===!0?zimagedit.applyTextShadow(id,!0):zimagedit.applyTextShadow(id,!1);return 1===length&&"undefined"!==zimagedit.focussedTextareaID&&$("#"+zimagedit.focussedTextareaID).focus(),zimagedit.pushIntoStack("resize"),!1}"color"===text_click&&(zimagedit.lastHover=$(ui.menuitem),zimagedit.tagSelected="text",zimagedit.init_properties("text"),zimagedit.handleMenuOpen(orgEvent,zimagedit.colorPalatteMenu,"top"))}else if(void 0!==right_click)"undo"===right_click?(zimagedit.undoFunc(),zimagedit._idSelected=void 0,zimagedit.resetMultiSelect()):"redo"===right_click?zimagedit.redoFunc():"paste"===right_click?zimagedit.pasteElements():"copy"===right_click?zimagedit.copyElements():"delete"===right_click?zimagedit.deleteElements():"selectall"===right_click?zimagedit.selectAll():"deselectall"===right_click?(zimagedit.multiSelectFlag===!0?(zimagedit.resetMultiSelect(),zimagedit.multiSelectFlag=!1):(zimagedit.removeBorderFocus(),zimagedit.removePlusAttributes(),zimagedit.removeShadowForMarker(),zimagedit.removeBorderForNumbering()),zimagedit._noOfIdSelected.length=0):"crop"===right_click?zimagedit.CropDone():"cancel"===right_click?zimagedit.onCropCancel():"zoomIn"===right_click?zimagedit.handleZoomCases("zoomin"):"zoomOut"===right_click?zimagedit.handleZoomCases("zoomout"):zimagedit.layeringFunction(right_click,zimagedit._idSelected);else if(void 0!==zoomValue)if("fitToWidth"!==zoomValue&&"fitToScreen"!==zoomValue&&"actualSize"!==zoomValue)zimagedit.isFitToScreen=!1,zimagedit.handleZoomCases(parseFloat(zoomValue));else if("actualSize"===zoomValue)zimagedit.isFitToScreen=!1,zoomValue=100,zimagedit.handleZoomCases(parseFloat(zoomValue));else if("fitToScreen"===zoomValue){var canvasDimensions=zimagedit.getCurrentCanvasDimensions(),windowDimensions=zimagedit.getWindowDimensions();zimagedit.isFitToScreen=!0;var maximumWidth=windowDimensions.width-220,maximumHeight=windowDimensions.height-150;maximumHeight>canvasDimensions[1]&&(maximumHeight=canvasDimensions[1]),maximumWidth>canvasDimensions[0]&&(maximumWidth=canvasDimensions[0]);var ratio=Math.min(maximumWidth/canvasDimensions[0],maximumHeight/canvasDimensions[1]);zoomValue=parseFloat(canvasDimensions[0]*ratio/canvasDimensions[0]*100),zimagedit.handleZoomCases(parseFloat(zoomValue))}else if("fitToWidth"===zoomValue){var canvasDimensions=zimagedit.getCurrentCanvasDimensions(),windowDimensions=zimagedit.getWindowDimensions();maximumWidth=windowDimensions.width-220,maximumHeight=zimagedit._imageHeight;var ratio=Math.min(maximumWidth/zimagedit._imageWidth,maximumHeight/zimagedit._imageHeight);zoomValue=parseFloat(canvasDimensions[0]*ratio/canvasDimensions[0]*100),zimagedit.handleZoomCases(parseFloat(zoomValue)),$("#zimageeditor__container").css("overflow-x","hidden")}}).on("zmenusubmenuitemclick.zimageeditor",function(){return ZComponents.$document.trigger("mouseup"),!1})},initFunction:function(){zimagedit.isIEBrowser||$(window).off("resize.zimageedit").on("resize.zimageedit",function(){if(zimagedit.commandKeyPressed&&(zimagedit.plusKeyPressed||zimagedit.minusKeyPressed))return 0;var imageWidth,imageHeight,paddingLeft,paddingTop,contentWidth,contentHeight,flag=0;"none"!==zimagedit._imageCanvas.css("display")?(flag=1,imageWidth=parseFloat(zimagedit._imageCanvas.attr("width")),imageHeight=parseFloat(zimagedit._imageCanvas.attr("height"))):(imageWidth=parseFloat(zimagedit._imageCropCanvas.attr("width")),imageHeight=parseFloat(zimagedit._imageCropCanvas.attr("height")));var windowWidth=$(window).width(),windowHeight=$(window).height(),maximumWidth=windowWidth-220,maximumHeight=windowHeight-150;if(zimagedit.isFitToScreen===!1&&(imageHeight>maximumHeight||imageWidth>maximumWidth))return!1;maximumHeight>imageHeight&&(maximumHeight=imageHeight),maximumWidth>imageWidth&&(maximumWidth=imageWidth);var ratio=Math.min(maximumWidth/imageWidth,maximumHeight/imageHeight);contentWidth=imageWidth*ratio,contentHeight=imageHeight*ratio,zimagedit.currentZoomValue=100*ratio,zimagedit.changeZoomTextValue(zimagedit.currentZoomValue),paddingLeft=(windowWidth-contentWidth)/2,paddingTop=(windowHeight-contentHeight)/2,1===flag?zimagedit._imageCanvas.css({width:contentWidth,height:contentHeight}):zimagedit._imageCropCanvas.css({width:contentWidth,height:contentHeight}),zimagedit.SVGElement.attr({width:contentWidth>0?contentWidth:0,height:contentHeight>0?contentHeight:0}),$("#zimageeditor__image").css({left:paddingLeft-110>0?paddingLeft-110:0,top:paddingTop-80>0?paddingTop-80:0,width:contentWidth,height:contentHeight}),zimagedit.svgContainer.css({left:paddingLeft-110>0?paddingLeft-110:0,top:paddingTop-80>0?paddingTop-80:0,width:contentWidth,height:contentHeight}),clearTimeout(zimagedit.resizeTimeout),zimagedit.resizeTimeout=setTimeout(function(){zimagedit.zoomFunction()},200)});var c=document.getElementById("zimageedit__canvas--blur");zimagedit._ctx3=c.getContext("2d"),zimagedit.orgin_ctx2=c.getContext("2d");var temp=$("<canvas>").attr({width:zimagedit._imageWidth,height:zimagedit._imageHeight,id:"zeditcanvastempblur"});zimagedit.blurCompleted=!1,$("#zimageeditor__image").append(temp),stackBlurImage(zimagedit.inputImageId,"zeditcanvastempblur",30,!1);var src_canvas=document.getElementById("zeditcanvastempblur");zimagedit._ctx3.drawImage(src_canvas,0,0,zimagedit._imageWidth,zimagedit._imageHeight),$("#zeditcanvastempblur").remove(),zimagedit.blurCompleted=!0,"blur"===zimagedit._selectedTool&&(ZAlertBanner.hide(".zimageedit__blur--initBanner"),zimagedit.cursorHandling({type:"toolSelect",tool:"blur"}))},changeZoomTextValue:function(zoomValue){$("#zimageeditor__zoom").find("span").text(parseInt(zoomValue)+"%"),parseInt(zoomValue)<10&&$("#zimageeditor__btns--zoomOut").attr("disabled","true")},getCurrentCanvasDimensions:function(){var canvasElement=zimagedit._imageCropCanvas;return"none"!==zimagedit._imageCanvas.css("display")&&(canvasElement=zimagedit._imageCanvas),[parseFloat(canvasElement.attr("width")),parseFloat(canvasElement.attr("height")),parseFloat(canvasElement.css("width")),parseFloat(canvasElement.css("height"))]},getWindowDimensions:function(){return{width:$(window).width(),height:$(window).height()}},_editActions:function(){var start,startOffset,mousedown,mouseup,mouse_down_id,targetClass,textmoveFlag,base=this,right_click=!1;$("#zimageeditor--fontsize--slider").off("mousedown").on("mousedown",function(){zimagedit.fontSliderMove=!0}),zimagedit.toolMove=!1,$("#zimageeditor .zimageeditor__tools--header, #zimageeditor--propertiesTool--header").off("mousedown mouseup mousemove").on("mousedown",function(event){"zimageeditor--propertiesTool--header"!==$(this).attr("id")&&($(".zmenu").zmenu("hide"),zimagedit.resetProperties(),zimagedit.removePlusAttributes());var top,left;"zimageeditor__tools--header"===$(this)[0].className?(top=parseFloat($("#zimageeditor .zimageeditor__tools").position().top),left=parseFloat($("#zimageeditor .zimageeditor__tools").position().left),zimagedit.toolbarMove=!0):(top=parseFloat(zimagedit.propertiesMenu.css("top")),left=parseFloat(zimagedit.propertiesMenu.css("left")),zimagedit.colorPalatteMenu.is(":visible")===!0&&zimagedit.colorPalatteMenu.zmenu("hide","#zimageeditor__colorpalatte--menu"),$("#zimageeditor__strokewidth--menu").is(":visible")===!0&&$("#zimageeditor__strokewidth--menu").zmenu("hide","#zimageeditor__strokewidth--menu"),zimagedit.propertiesMove=!0),zimagedit._imageContainer.addClass("zimagedit__noselect"),zimagedit.toolMove=!0,zimagedit.clickPosition[0]=event.clientX-left,zimagedit.clickPosition[1]=event.clientY-top,zimagedit.cursorHandling({event:"headerMouseDown"})}).on("mouseup",function(){zimagedit.toolbarMove=zimagedit.propertiesMove=zimagedit.toolMove=!1,zimagedit._imageContainer.removeClass("zimagedit__noselect"),zimagedit.cursorHandling({event:"headerMouseUp"})}).off("mousemove").on("mousemove",function(event){zimagedit.toolMove===!0&&zimagedit.moveToolbar(event,zimagedit.toolbarMove,zimagedit.propertiesMove)}),$("#zimageeditor").off("mouseup click").on("mouseup",function(){zimagedit.toolMove===!0&&(zimagedit.toolMove=!1),zimagedit.propertiesMove===!0&&(zimagedit.propertiesMove=!1)}).on("click",function(event){event.preventDefault(),event.stopPropagation()}),$("#zimageeditor .zimageeditor__header").off("click").on("click",function(){zimagedit.hideProperties(),zimagedit.resetMultiSelect(),zimagedit.resetProperties()});var checkTextarea;zimagedit.tapped=!1,$("#zimageeditor__container").off("contextmenu mousedown mousemove mouseup click dblclick").on("contextmenu",function(e){if(e.preventDefault(),e.stopPropagation(),"zimageedit__plus--polygon"!==e.target.id&&"zimageedit__plus--cirlce"!==e.target.id){var checkSVG=zimagedit.checkForSelectedElement(["svg"],e.target.id);"foreignObject"===e.target.nodeName&&(checkSVG=!0),"zimageeditor__svgcontainer"!==e.target.id&&(zimagedit.rightClickPreventDefault=!0,right_click=zimagedit.handleRightClick(e,checkSVG,zimagedit._noOfIdSelected.length),zimagedit.isRightClick=!0)}}).on("mousedown",function(e){if(zimagedit.mousedown=!0,zimagedit.dragSelect=!0,startOffset={top:e.clientY,left:e.clientX},$(".zimageeditor__btns--focus").removeClass("zimageeditor__btns--focus"),3===e.which)return e.stopPropagation(),e.preventDefault(),!1;if($("#zimageeditor__zoom--menu").is(":visible")&&$("#zimageeditor__zoom--menu").zmenu("hide"),zimagedit.blurMenu.is(":visible")&&zimagedit.blurMenu.zmenu("hide"),zimagedit.numberingMenu.is(":visible")&&zimagedit.numberingMenu.zmenu("hide"),zimagedit.markerMenu.is(":visible")&&zimagedit.markerMenu.zmenu("hide"),zimagedit.shapesMenu.is(":visible")&&zimagedit.shapesMenu.zmenu("hide"),zimagedit.lineMenu.is(":visible")&&zimagedit.lineMenu.zmenu("hide"),zimagedit.isRightClick=!1,void 0!==zimagedit.lastHover){var menuClose=$("#zimageeditor__"+zimagedit.lastHover.data("objectmenu")+"--menu");$(menuClose).is(":visible")===!0&&$(menuClose).zmenu("hide")}if("ontouchstart"in document.documentElement){var touchduration=500;zimagedit.timer=setTimeout(function(){var checkSVG=zimagedit.checkForSelectedElement(["svg"],e.target.id);"zimageeditor__svgcontainer"!==e.target.id&&(zimagedit.rightClickPreventDefault=!0,right_click=zimagedit.handleRightClick(e,checkSVG,zimagedit._noOfIdSelected.length),zimagedit.isRightClick=!0)},touchduration)}mousedown=e;var pencilFlag,points,markerFlag,elementType,flag,length,checkSVG=zimagedit.checkForSelectedElement(["svg"],e.target.id);elementType=zimagedit.typeOfElement(e.target.id),checkTextarea="textarea"===elementType;var checkPolyline=zimagedit.checkForSelectedElement(["marker","pencil"],e.target.id);if(targetClass=e.target.className,"object"==typeof targetClass&&(targetClass=targetClass.baseVal),checkTextarea===!0||-1!=targetClass.indexOf("zimageedit__active--shape")&&"visible"===$(".zimageedit__active--text--right").css("visibility")&&"none"!==$(".zimageedit__active--text--right").css("display")?zimagedit.textareaSelected=!0:(zimagedit.textareaSelected=zimagedit.textareaCreated=!1,zimagedit.focussedTextareaID="undefined"),zimagedit.shiftKeyPressed===!0&&"zimageeditor__svgeditor"===e.target.id&&void 0===zimagedit._selectedTool)return 0;if(-1===targetClass.indexOf("zimageedit__active--text--")&&(-1!==targetClass.indexOf("zimageedit__active--")&&-1===targetClass.indexOf("zimageedit__active--text--")==!1||1==checkTextarea)&&(zimagedit.focussedTextareaID="undefined"),zimagedit.shiftKeyPressed!==!0||void 0!==zimagedit._selectedTool||void 0===targetClass||"zimageedit__"!==targetClass.toString().substr(0,12)&&-1===targetClass.indexOf("zimageedit__numbering")||"move"===zimagedit.lastAction||"zimageedit__focus--multiselect"===targetClass){if(-1===targetClass.indexOf("zimageedit__active--")&&-1===e.target.id.indexOf("zimageedit__plus--cirlce")){zimagedit.resize_flag=!0,length=zimagedit._noOfIdSelected.length,flag=0,zimagedit.multiSelectFlag===!0&&(flag=1),length=zimagedit._noOfIdSelected.length;var checkForNewElement=!0;for(length--;length>=0;--length)if(zimagedit._noOfIdSelected[length]==="#"+e.target.id){checkForNewElement=!1;break}if(0===flag||checkForNewElement===!0&&zimagedit.cropCreated===!1){if(zimagedit.multiSelectFlag=!1,zimagedit.showBorderFocus(),checkSVG===!1&&void 0!==zimagedit._idSelected){var typeOfElement=zimagedit.typeOfElement(zimagedit._idSelected);zimagedit.setPropertiesForSelectedObject(typeOfElement),zimagedit.elementSelect("#"+zimagedit._idSelected,"return")}zimagedit.resetMultiSelect(),void 0!==zimagedit._idSelected&&zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected)}}}else if(""!==e.target.id)return base._idSelected=e.target.id,zimagedit._idSelected=zimagedit.extractID(e.target.id),zimagedit.multiSelectFlag=!0,zimagedit.removeBorderForNumbering(),checkPolyline&&zimagedit.removeShadowForMarker(),void zimagedit.multiSelect("#"+base._idSelected,e);checkPolyline===!0||checkTextarea||checkSVG===!0&&"textarea"===zimagedit._selectedTool||-1!==targetClass.indexOf("zimageedit__active--text--")?checkPolyline===!0?(zimagedit.removeBorderFocus(),zimagedit.setPropertiesForSelectedObject("polyline")):zimagedit.setPropertiesForSelectedObject("textarea"):3!==e.which&&(zimagedit.cropCreated===!0&&(elementType="crop"),("svg"===elementType&&"line"===zimagedit._selectedTool||-1!=targetClass.indexOf("zimageedit__active--c1c"))&&(elementType="line"),zimagedit.setPropertiesForSelectedObject(elementType));var disable_click=!1;textmoveFlag=!1,3!==e.which?(right_click=!1,zimagedit.rightClickMenu.is(":visible")===!0&&zimagedit.rightClickMenu.zmenu("hide"),zimagedit.rightClickPreventDefault=!1):(e.stopPropagation(),e.preventDefault()),"crop"===zimagedit._selectedTool&&(zimagedit._idSelected="zimageedit__crop",zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#zimageedit__crop")),zimagedit.markerSelected===!0&&zimagedit.removeShadowForMarker(),mouse_down_id=e.target.id,"zimageeditor__svgeditor"!==e.target.id&&"zimageeditor__svgcontainer"!==e.target.id||3===e.which||(zimagedit._noOfIdSelected.length=0),checkTextarea===!0&&$("#"+e.target.id).is(":focus")===!1&&(e.preventDefault(),textmoveFlag=!0);var checkNumbering="numbering"===zimagedit.typeOfElement(e.target.id);checkNumbering&&"numbering"===$("#"+e.target.id).attr("type-contains")&&$("#"+e.target.id).prop("readonly")===!1&&(disable_click=!0),zimagedit.cursorHandling(e);var temp_var=targetClass;if(disable_click===!1&&void 0!==targetClass&&0!==temp_var.length&&"zimageedit__focus--numbering"!==temp_var&&"zimageedit__plus"!==targetClass&&3!==e.which){if(void 0!==targetClass&&"zimageedit__active--"===targetClass.substr(26,20)&&(base.row_val=targetClass.slice(46,48),base.col_val=targetClass.slice(48,50),""!==base.col_val))for(length=zimagedit._noOfIdSelected.length,length--;length>=0;--length)zimagedit.boundaryClicked[length]=zimagedit.row_val+" "+zimagedit.col_val;var checkNumberingSelected=zimagedit.checkForSelectedElement(["numbering"],e.target.id);if((void 0===targetClass||"zimageedit__active--shape"!==targetClass.substr(0,25))&&"zimageedit__"!==targetClass.substr(0,12)&&"zimageedit__crop"!==targetClass&&checkNumberingSelected!==!0&&zimagedit.cropSelected!==!0&&"zimageedit__focus--shape"!==targetClass||zimagedit.lastDrawnId!==zimagedit.extractID(e.target.id)&&zimagedit.cropCreated!==!0&&void 0!==zimagedit._selectedTool&&"zimageedit__focus--shape"!==targetClass&&-1==targetClass.indexOf("zimageedit__active")){if(zimagedit._imageContainer.addClass("zimagedit__noselect"),("numbering_"!==zimagedit.previousSelectedTool&&"numbering_"!==zimagedit._selectedTool||"numbering"!==zimagedit._selectedTool)&&zimagedit.hideProperties(),zimagedit.removePlusAttributes(),zimagedit.multiSelectFlag=!1,zimagedit.resize_flag=!0,base.actionDone="create",base.isDraw=!1,start=base.initDrawElements(e),zimagedit.setPropertiesForSelectedObject(zimagedit._selectedTool),points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),start[0]=points.x,start[1]=points.y,startOffset={top:e.clientY,left:e.clientX},zimagedit.showBorderFocus(),"numbering_"===zimagedit._selectedTool){{zimagedit.orginalCanvasFitToWidth,zimagedit._imageWidth}zimagedit.cursorHandling({type:"beforeDraw",tool:"numbering_"}),base.createNumbering(points.x,points.y-7*zimagedit.fitToWidthZoomValue/100);var addon="";zimagedit.isIEBrowser===!0&&(addon="--IE"),$("#"+zimagedit._idSelected+"--group").attr("class","zimageedit__numbering zimageedit__move--cursor"+addon),zimagedit.lastDrawnId=zimagedit._idSelected,base._drag=!1,zimagedit.numberingCreated=!0,zimagedit.checkForPlusDisplay($("#"+zimagedit._idSelected).attr("class"),e,zimagedit._idSelected)}else if("textarea"===zimagedit._selectedTool){var top,left;top=points.y,left=points.x,zimagedit.createTextarea(top-8,left-5,zimagedit.textFontSize+20,zimagedit.textFontSize+15,zimagedit.temp_id),zimagedit.textID=zimagedit.temp_id,zimagedit.drawnElements.push(zimagedit.temp_id),zimagedit.cursorHandling({type:"select__tool"}),zimagedit.textareaSelected=!0,zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit.textID),zimagedit._idSelected=zimagedit.temp_id,zimagedit.isDraw=!0,zimagedit.lastAction="draw",zimagedit.actionDone="create",zimagedit.textareaCreated=!0}}else{if("foreignObject"===e.target.nodeName)return;if(base.actionDone="resize",start=[e.clientX,e.clientY],startOffset={top:e.clientY,left:e.clientX},points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),start[0]=points.x,start[1]=points.y,base.previousX=points.x,base.previousY=points.y,base.resizeElementSelected=!0,base.getValuesForFunc(base._idSelected),zimagedit.removePlusAttributes(),""!==targetClass&&zimagedit.removePlusAttributes(),zimagedit.multiSelectFlag===!1&&zimagedit.hideProperties(),zimagedit.stackPushFlag=!1,base.isDraw=!0,("zimageedit__"===targetClass.substr(0,12)||"zimageedit__crop"===targetClass||checkNumberingSelected===!0||"zimageedit__focus--shape"===targetClass&&"zimageedit__active--shape"!==targetClass.substr(0,25))&&(-1==targetClass.indexOf("zimageedit__focus--shape")&&-1==targetClass.indexOf("zimageedit__active--shape")&&(zimagedit._idSelected=e.target.id),-1!=targetClass.indexOf("zimageedit__line")&&(zimagedit._idSelected=$("#"+zimagedit._idSelected).parent().attr("id"),zimagedit._idSelected=zimagedit._idSelected.substr(0,zimagedit._idSelected.length-7)),base.lastAction="select",base.getValuesForFunc(base._idSelected),zimagedit.elementMove=!0,-1!==targetClass.indexOf("zimageedit__active--text--")&&(zimagedit.resizeElementSelected=!1),"zimageeditor__svgeditor"!==e.target.id&&-1===targetClass.indexOf("zimageedit__active--text--")&&(""!==e.target.id&&(zimagedit._idSelected=e.target.id),""!==targetClass&&zimagedit.removePlusAttributes(),zimagedit.stackPushFlag=!1,base.isDraw=!0,("zimageedit__"===targetClass.substr(0,12)||"zimageedit__crop"===targetClass||checkNumberingSelected===!0)&&"zimageedit__focus--shape"!==targetClass&&-1==targetClass.indexOf("zimageedit__active--shape")&&(zimagedit._idSelected=e.target.id,-1!=targetClass.indexOf("zimageedit__line")&&(zimagedit._idSelected=$("#"+zimagedit._idSelected).parent().attr("id"),zimagedit._idSelected=zimagedit._idSelected.substr(0,zimagedit._idSelected.length-7),mouse_down_id=zimagedit._idSelected),base.lastAction="select",base.getValuesForFunc(base._idSelected),zimagedit.shiftKeyPressed!==!0)))){for(length=zimagedit._noOfIdSelected.length,flag=0,length--;length>=0;--length)if(zimagedit._noOfIdSelected[length]==="#"+zimagedit._idSelected){flag=1;break}if(0===flag?(zimagedit.multiSelectFlag=!1,checkNumberingSelected!==!0?(zimagedit.showBorderFocus(),zimagedit.markerSelected=!1,markerFlag=zimagedit.checkForSelectedElement(["marker"],zimagedit._idSelected),pencilFlag=zimagedit.checkForSelectedElement(["pencil"],zimagedit._idSelected),(markerFlag===!0||pencilFlag===!0)&&zimagedit.createShadowForMarker(zimagedit._idSelected),zimagedit.elementSelect("#"+zimagedit._idSelected,"return","color_select")):zimagedit._idSelected=zimagedit.extractID(zimagedit._idSelected),zimagedit.resetMultiSelect(),zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected)):(zimagedit.markerSelected=!1,markerFlag=zimagedit.checkForSelectedElement(["marker"],zimagedit._idSelected),pencilFlag=zimagedit.checkForSelectedElement(["pencil"],zimagedit._idSelected),(markerFlag===!0||pencilFlag===!0)&&zimagedit.createShadowForMarker(zimagedit._idSelected)),checkNumberingSelected===!0&&zimagedit.multiSelectFlag===!1){zimagedit._idSelected=zimagedit.extractID(e.target.id),$("#"+zimagedit._idSelected).prop("readonly","readonly");var cx,cy,temp=$("#"+zimagedit._idSelected+"--circle");cx=parseFloat($(temp).attr("cx")),cy=parseFloat($(temp).attr("cy")),zimagedit.showBroderForNumbering(cx,cy,zimagedit._idSelected),zimagedit.changeIconColorProperties(void 0,zimagedit.regtohex_convert($("#"+zimagedit._idSelected+"--path").attr("stroke")))}}"crop"===zimagedit._selectedTool&&("zimageedit__crop"!==e.target.id&&(zimagedit.elementMove=!1),zimagedit._noOfIdSelected.length=0,zimagedit._idSelected="zimageedit__crop",zimagedit._noOfIdSelected.push("#zimageedit__crop"))}}zimagedit.textareaSelected===!0&&-1!==targetClass.indexOf("zimageedit__active--shape")&&zimagedit.cropCreated===!1&&zimagedit.setPropertiesForSelectedObject("textarea"),"zimageedit__focus--numbering"===targetClass&&(zimagedit.isNumberingBeackSelected=!0)}).on("mousemove",function(e){if(zimagedit.toolMove===!0&&zimagedit.moveToolbar(e,zimagedit.toolbarMove,zimagedit.propertiesMove),"foreignObject"===e.target.nodeName?$("#"+e.target.id).removeClass("zimageedit__move--cursor"):"TEXTAREA"!==e.target.nodeName||zimagedit._toolSelected||!$("#"+e.target.id).parent().hasClass("zimageedit__move--cursor")&&e.target.readOnly&&$("#"+e.target.id).parent().addClass("zimageedit__textarea--fobject zimageedit__move--cursor"),zimagedit.mousedown===!0&&right_click===!1){var length,temp,points;if(zimagedit.timer&&clearTimeout(zimagedit.timer),base._drag&&"blur"!==base._selectedTool&&"undefined"!=typeof zimagedit._selectedTool&&"none"!==zimagedit._selectedTool){{e.target.className.baseVal}zimagedit.lastAction="draw",zimagedit.dragOnly=!0,base._drawSvgElements(e,base._selectedTool,start,startOffset),base.isDraw=!0}else if(base._drag&&"blur"===base._selectedTool&&zimagedit.blurCompleted===!0)0===$("#"+base.temp_id).length&&(base.create_canvas(),zimagedit.lastAction="createcanvas"),$("#zimageeditor .zimageedit__focus--shape").css("visibility","visible"),zimagedit.isDraw=!0,zimagedit.functionForBlur(e,base,start);else if(!base.resizeElementSelected||"zimageedit__active--shape"!==targetClass.substr(0,25)||textmoveFlag!==!1||zimagedit.resize_flag!==!0&&zimagedit.multiSelect!==!1){if(zimagedit.isNumberingBeackSelected){if(length=zimagedit._noOfIdSelected.length,zimagedit.stackPushFlag===!1)for(zimagedit.stackPushFlag=!0,length--;length>=0;--length)temp=zimagedit._noOfIdSelected[length],temp=temp.substr(1,temp.length),zimagedit._idSelected=temp,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*length);zimagedit.actionDone="resize",zimagedit.lastAction="move",zimagedit.moveNumberinngBeack(e.target.id,e,!0)}else if(zimagedit.elementMove===!0||textmoveFlag===!0){if(length=zimagedit._noOfIdSelected.length,points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),zimagedit.stackPushFlag===!1){zimagedit.removePlusAttributes(),zimagedit.stackPushFlag=!0;var check_flag=0;for(length--;length>=0;--length)temp=zimagedit._noOfIdSelected[length],temp=temp.substr(1,temp.length),zimagedit._idSelected=temp,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*length),check_flag=1;zimagedit.multiSelectFlag===!1&&zimagedit.hideProperties(),1===check_flag&&(zimagedit._checkFlagMouseAction=!0)}if(length=zimagedit._noOfIdSelected.length,zimagedit._checkFlagMouseAction===!0&&checkTextarea===!1&&mouse_down_id!==zimagedit.textID||length>1||textmoveFlag===!0)for(e.preventDefault(),length--;length>=0;--length)temp=zimagedit._noOfIdSelected[length],temp=temp.substr(1,temp.length),zimagedit._idSelected=temp,base.elementMouseMove(e,start);zimagedit.lastAction="move",zimagedit.previousX=points.x,zimagedit.previousY=points.y,base.targetAction="mousemove"}else if(("none"===zimagedit._selectedTool||void 0===zimagedit._selectedTool)&&!base.resizeElementSelected){var top,left,points=zimagedit.editorSVG.createSVGPoint();points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse());var points1=zimagedit.editorSVG.createSVGPoint();points1.x=startOffset.left,points1.y=startOffset.top,points1=points1.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),$(window).off("mouseup").on("mouseup",function(){document.getElementById("zimageedit__dragselect-MultiSelect")&&$(zimagedit.editorSVG).trigger("mouseup")}),zimagedit.dragSelect?(zimagedit.createBoundary("#zimageedit__dragselect"),left=points.x,top=points.y,$("#zimageedit__dragselect-MultiSelect,#zimageedit__dragselect-MultiSelect2").attr({x:points.x,y:points.y}),zimagedit.dragSelect=!1):(startOffset.left>e.clientX&&(left=points.x),startOffset.top>e.clientY&&(top=points.y),$("#zimageedit__dragselect-MultiSelect,#zimageedit__dragselect-MultiSelect2").attr({x:left,y:top,width:Math.abs(points.x-points1.x),height:Math.abs(points.y-points1.y),fill:"transparent",stroke:"transparent","stroke-width":0})),zimagedit.clickAndDragSelect(e,startOffset)}}else{if(length=zimagedit._noOfIdSelected.length,zimagedit.lastAction="resize",zimagedit.stackPushFlag===!1){for(zimagedit.stackPushFlag=!0,length--;length>=0;--length)temp=zimagedit._noOfIdSelected[length],temp=temp.substr(1,temp.length),zimagedit._idSelected=temp,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*length);-1!=$("#"+zimagedit._idSelected).attr("class").indexOf("zimageedit__textarea")&&zimagedit.setPropertiesForSelectedObject("textarea"),e.onResize=!0,zimagedit.cursorHandling(e)}if(length=zimagedit._noOfIdSelected.length,zimagedit._noOfIdSelected.length<=1)for(e.preventDefault(),length--;length>=0;--length)temp=zimagedit._noOfIdSelected[length],temp=temp.substr(1,temp.length),zimagedit._idSelected=temp,base.getValuesForFunc(zimagedit._idSelected),base.resizeElementsFunc(start,e,length);points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),zimagedit.previousX=points.x,zimagedit.previousY=points.y}}else zimagedit.lastAction="none",base.actionDone="none"}).on("mouseup",function(e){zimagedit._doubleTouchHandler(e);var dragSelectBorder=document.getElementById("zimageedit__dragselect-MultiSelect");if(dragSelectBorder&&($("#zimageedit__dragselect-MultiSelect,#zimageedit__dragselect-MultiSelect2").remove(),zimagedit.selectOnDrag.length&&(zimagedit.multiSelectFlag=!0,zimagedit.selectOnDrag=[])),zimagedit.timer&&clearTimeout(zimagedit.timer),"foreignObject"===e.target.nodeName&&$(".zimageeditor__header").trigger("click"),"none"===zimagedit.lastAction&&"create"===zimagedit.actionDone){var top,left,width,height;if(top=start[1],left=start[0],"rectangle"===zimagedit._selectedTool?(width=132,height=100):"ellipse"===zimagedit._selectedTool&&(top+=50,left+=66,width=66,height=50),"rectangle"===zimagedit._selectedTool||"ellipse"===zimagedit._selectedTool||"line"===zimagedit._selectedTool){if(zimagedit._idSelected=$(zimagedit._elem).attr("id"),$(zimagedit._elem).insertBefore("#zimageedit__focus--shape"),"line"===zimagedit._selectedTool){width=start[0]+132,height=start[1];var group=document.createElementNS(zimagedit.svgPath,"g");group.setAttribute("id",zimagedit._idSelected+"--group"),$(group).attr("class","zimageedit__line"),$(group).insertBefore("#zimageedit__focus--shape"),$("#"+zimagedit._idSelected).appendTo("#"+zimagedit._idSelected+"--group"),$("#zimageedit__triangle").clone().attr({id:zimagedit._idSelected+"--line","class":"zimageedit__line"}).css("visibility","visible").appendTo("#"+zimagedit._idSelected+"--group"),zimagedit._doubleArrow&&$("#zimageedit__triangle").clone().attr({id:zimagedit._idSelected+"--line1","class":"zimageedit__line"}).css("visibility","visible").appendTo("#"+zimagedit._idSelected+"--group"),"true"===$("#"+zimagedit._idSelected+"--line").attr("data-stline")&&$("#"+zimagedit._idSelected+"--line").css("visibility","hidden")}zimagedit.elementValues={tool:zimagedit._selectedTool,top:top,left:left,width:width,height:height},zimagedit.moveElements(zimagedit.elementValues),zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected),zimagedit.checkForPlusDisplay($("#"+zimagedit._idSelected).attr("class"),e,zimagedit._idSelected),base.actionDone="create",zimagedit.drawObject=zimagedit.isDraw=!0,zimagedit.lastDrawnId=zimagedit._idSelected}else"marker"===zimagedit._selectedTool||"polyline"===zimagedit._selectedTool?(zimagedit._idSelected=$(zimagedit._elem).attr("id"),$(zimagedit._elem).insertBefore("#zimageedit__focus--shape"),zimagedit._elem.setAttributeNS(null,"points",""+left+" "+top+" "+left+" "+top+" "),base.actionDone="create",zimagedit.drawObject=zimagedit.isDraw=!0,zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected),zimagedit.checkForPlusDisplay($("#"+zimagedit._idSelected).attr("class"),e,zimagedit._idSelected),zimagedit.lastDrawnId=zimagedit._idSelected):"smudge"===zimagedit._selectedTool?(zimagedit.makeSmudge(e,"smudge",start),zimagedit._noOfIdSelected.length=0):"textarea"===zimagedit._selectedTool&&(randomNum=Math.round(1e7*Math.random()),zimagedit.temp_id="zimageedit__shapes--"+randomNum,zimagedit.createTextarea(start[1],start[0],32,32,zimagedit.temp_id),base.actionDone="create",zimagedit._idSelected=zimagedit.temp_id,zimagedit.drawObject=zimagedit.isDraw=!0,zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected),$("#"+zimagedit._idSelected).focus(),zimagedit.lastDrawnId=zimagedit._idSelected);zimagedit.textareaCreated=!1}var temp,length;if(zimagedit.mousedown=!1,mouseup=e,zimagedit._imageContainer.removeClass("zimagedit__noselect"),zimagedit.smudgeStackFlag===!0&&(zimagedit.smudgeStackFlag=!1,zimagedit.smudgeStackPosition+=1),zimagedit.mouseupFunction(base,e),targetClass=e.target.className,void 0!==targetClass.baseVal&&(targetClass=targetClass.baseVal),zimagedit.multiSelectFlag===!0&&$("#"+zimagedit.textID).blur(),textmoveFlag=!1,"mousemove"===base.targetAction)for(length=zimagedit._noOfIdSelected.length,length--;length>=0;--length){temp=zimagedit._noOfIdSelected[length],temp=temp.substr(1,temp.length),zimagedit._idSelected=temp;var elementType=zimagedit.typeOfElement(zimagedit._idSelected);("pencil"===elementType||"marker"===elementType)&&zimagedit.setValuesFromTranslate(),zimagedit.targetAction=" "}var temp_var=targetClass;if(base._drag=zimagedit.elementMove=!1,zimagedit.cursorHandling(e,{mousedown:mousedown}),void 0!==targetClass&&0!==temp_var.length){var temp_Var=zimagedit._idSelected;if("crop"!==zimagedit._selectedTool){if("move"===zimagedit.lastAction||"resize"===zimagedit.lastAction&&(mousedown.clientX!==mouseup.clientX||mousedown.clientY!==mouseup.clientY)){for(length=zimagedit._noOfIdSelected.length,zimagedit._checkFlagMouseAction=!1,--length;length>=0;--length)temp=zimagedit._noOfIdSelected[length],temp=temp.substr(1,temp.length),zimagedit._idSelected=temp,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*length+1);zimagedit.copyFromTempToUndoStack()}var flag=!1;"create"===base.actionDone&&0!==zimagedit.lastAction.length&&("numbering_"===zimagedit._selectedTool&&"numbering"===zimagedit.numberingTagSelected&&$("#"+zimagedit._idSelected).attr("readOnly",!0),"smudge"===zimagedit._selectedTool?(flag=!0,zimagedit.lastDrawnId=void 0,zimagedit.smudgeStack[zimagedit.smudgeStack.length-1][0]=zimagedit._imageWidth/zimagedit.actualWidth):(zimagedit.pushIntoStack("create"),zimagedit.drawObject=!1,zimagedit.checkForContinuousDrawing()),"marker"===zimagedit._selectedTool&&(zimagedit._noOfIdSelected.length=0),"smudge"!==zimagedit._selectedTool&&"blur"!==zimagedit._selectedTool&&void 0!==zimagedit._selectedTool&&void 0!==zimagedit._idSelected&&zimagedit.drawnElements.push(zimagedit._idSelected))}flag===!1&&"create"!==base.actionDone&&zimagedit.multiSelectFlag===!1&&zimagedit.isRightClick===!1&&void 0!==zimagedit._noOfIdSelected[0]&&zimagedit.checkForPlusDisplay($(zimagedit._noOfIdSelected[0]).attr("class"),e,zimagedit._noOfIdSelected[0].substr(1,zimagedit._noOfIdSelected[0].length)),zimagedit._idSelected=temp_Var}if(zimagedit.isNumberingBeackSelected===!0&&zimagedit.removeTextSelection(),zimagedit.isNumberingBeackSelected=base.resizeElementSelected=zimagedit.stackPushFlag=!1,zimagedit.textareaCreated===!0&&($("#"+zimagedit.textID).focus(),zimagedit.textareaCreated=!1),"draw"===zimagedit.lastAction&&"create"===zimagedit.actionDone&&"blur"!==zimagedit._selectedTool){var selectedClass=$("#"+zimagedit._idSelected).attr("class");void 0!==selectedClass&&(selectedClass=selectedClass.substr(12,selectedClass.length),"ellipse"===zimagedit._selectedTool||"rectangle"===zimagedit._selectedTool&&("ellipse"===selectedClass||"rectangle"===selectedClass)?zimagedit.showPlusMenu(zimagedit._idSelected):"marker"===selectedClass||"marker"===zimagedit._selectedTool?zimagedit.smoothenPolylLine(zimagedit._idSelected):"polyline"===selectedClass&&(zimagedit.smoothenPolylLine(zimagedit._idSelected),zimagedit.createShadowForMarker(zimagedit._idSelected),zimagedit.checkForPlusDisplay($("#"+zimagedit._idSelected).attr("class"),e,zimagedit._idSelected))),zimagedit.multiSelectFlag===!1&&1===zimagedit._noOfIdSelected.length&&zimagedit.checkForPlusDisplay($(zimagedit._noOfIdSelected[0]).attr("class"),e,zimagedit._noOfIdSelected[0].substr(1,zimagedit._noOfIdSelected[0].length))}}).on("click",function(e){zimagedit.mousedown=!1;var targetID=e.target.id;zimagedit._imageContainer.removeClass("zimagedit__noselect");var targetClass=e.target.className;if("object"==typeof targetClass&&(targetClass=targetClass.baseVal),-1!=targetClass.indexOf("zimageedit__line")&&(targetID=$("#"+targetID).parent().attr("id"),targetID=targetID.substr(0,targetID.length-7)),"zimageedit__focus--numbering"===targetClass&&zimagedit.moveNumberinngBeack(targetID,e,!1),"zimageedit__numbering"===targetClass.substr(29,50)&&(e.preventDefault(),0==$("#"+targetID).is(":focus")&&$("#"+targetID).blur()),"select"===zimagedit.lastAction&&"resize"===zimagedit.actionDone){var flag=zimagedit.checkForSelectedElement(["marker"],zimagedit._idSelected);flag&&(zimagedit.markerSelected=!0,zimagedit.markerSelectedId=zimagedit._idSelected+"--shadow",zimagedit.createShadowForMarker(zimagedit._idSelected))}void 0!==targetClass.baseVal&&(targetClass=targetClass.baseVal),"zimageeditor__svgeditor"===targetID&&"resize"!==base.actionDone&&zimagedit.multiSelectFlag===!1&&(zimagedit.resetMultiSelect(),void 0!==zimagedit._idSelected&&zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected),"draw"===zimagedit.lastAction&&"create"===zimagedit.actionDone&&"marker"===zimagedit._selectedTool&&(zimagedit._noOfIdSelected.length=0)),void 0!==targetClass&&"zimageedit__numbering"===targetClass.slice(29,50)&&(base._idSelected=targetID),void 0!==targetClass&&-1!==targetClass.indexOf("zimageeditor__svgeditor")&&(zimagedit.temp_id=void 0),zimagedit.lastAction="none",zimagedit.actionDone="none"}).on("dblclick",function(e){if("blur"!==zimagedit._selectedTool&&"smudge"!==zimagedit._selectedTool&&"zimageedit__active--shape"!==e.target.classList[0]&&"zimageedit__focus--shape"!==e.target.classList[0]){var targetID=e.target.id,targetClass=e.target.className;if("object"==typeof targetClass&&(targetClass=targetClass.baseVal),zimagedit.cursorHandling(e),"crop"===zimagedit._selectedTool&&zimagedit.CropDone(),"zimageedit__numbering"===targetClass.substr(29,50)&&"numbering"===$("#"+e.target.id).attr("type-contains")&&zimagedit.multiSelectFlag===!1){e.preventDefault(),$("#"+targetID).removeAttr("readonly").removeAttr("disabled").focus();var ele=document.getElementById(targetID);ele.setSelectionRange(ele.value.length,ele.value.length),zimagedit.numberingSelected=targetID}}}),$("body").off("keydown.zimageeditor keyup.zimageeditor mouseup.zimageeditor mousemove.zimageeditor").on("keydown.zimageeditor",function(event){$("#preview-container").is(":visible")!==!0&&(17===event.keyCode?zimagedit.ctrlKeyPressed=!0:16===event.keyCode?zimagedit.shiftKeyPressed=!0:91===event.keyCode||93===event.keyCode||224===event.keyCode?zimagedit.commandKeyPressed=!0:187===event.keyCode?zimagedit.plusKeyPressed=!0:189===event.keyCode&&(zimagedit.minusKeyPressed=!0),$(".zdialog--alert").is(":visible")||base.keypressevents(event))}).on("keyup.zimageeditor",function(event){17===event.keyCode?zimagedit.ctrlKeyPressed=!1:16===event.keyCode?zimagedit.shiftKeyPressed=!1:91===event.keyCode||93===event.keyCode||224===event.keyCode?zimagedit.commandKeyPressed=!1:187===event.keyCode?zimagedit.plusKeyPressed=!1:189===event.keyCode&&(zimagedit.minusKeyPressed=!1)}).on("mouseup.zimageeditor",function(){zimagedit.fontSliderMove=zimagedit.toolMove=!1}).on("mousemove.zimageeditor",function(event){zimagedit.toolMove===!0&&zimagedit.moveToolbar(event,zimagedit.toolbarMove,zimagedit.propertiesMove)})},clickAndDragSelect:function(e,startPoint){var elements=zimagedit.drawnElements,startLeft=startPoint.left,startTop=startPoint.top,left=e.clientX,top=e.clientY;if(startLeft>left&&(left=startLeft,startLeft=e.clientX),startTop>top&&(top=startTop,startTop=e.clientY),elements.length)for(var i=0;i<elements.length;i++){var ele=$("#"+elements[i]);ele.hasClass("zimageedit__textarea")&&(ele=ele.parent());var elementType=zimagedit.typeOfElement(elements[i]);if("hidden"!==ele.css("visibility")&&"none"!==ele.css("display")&&void 0!==elements[i]&&(void 0===ele.attr("class")||-1==ele.attr("class").indexOf("zimageedit__numbering")||"none"!==$("#"+elements[i]+"--fobject").css("display")&&"none"!==$("#"+elements[i]+"--group").css("display"))&&("line"!==elementType||"hidden"!==$("#"+elements[i]+"--group").css("visibility")&&"none"!==$("#"+elements[i]+"--group").css("display"))&&void 0!==ele.attr("class")){var offset=ele.offset(),prop=zimagedit.getValuesOfObject("#"+elements[i]),temp=$("#"+elements[i])[0].getBoundingClientRect();if(prop.width=temp.width,prop.height=temp.height,offset.left>startLeft&&offset.left+prop.width<left&&offset.top>startTop&&offset.top+prop.height<top)zimagedit.selectOnDrag.includes("#"+elements[i])||(zimagedit.selectOnDrag.push("#"+elements[i]),zimagedit.multiSelect("#"+elements[i],e));else if(zimagedit.selectOnDrag.includes("#"+elements[i]))for(var j=0;j<zimagedit.selectOnDrag.length;j++)zimagedit.selectOnDrag[j]==="#"+elements[i]&&(zimagedit.selectOnDrag.splice(j,1),zimagedit.multiSelect("#"+elements[i],e))}}},checkForContinuousDrawing:function(flag){("textarea"===zimagedit._selectedTool||flag===!0)&&(zimagedit._selectedTool=void 0,zimagedit._toolSelected=!1,zimagedit.cursorHandling({type:"select__tool"}))},cursorHandling:function(event,args){var currentCursor=void 0,addons="";if("beforeDraw"===event.type){if("marker"===event.tool||"polyline"===event.tool||"numbering_"===event.tool||"smudge"===event.tool){zimagedit.isIEBrowser===!0&&(addons="--IE");var cursorType="brush";"polyline"===event.tool?cursorType=zimagedit._arrowPolyline?"crosshair":"pencil":"numbering_"===event.tool&&(cursorType=zimagedit.numberingTagSelected),currentCursor=cursorType}"rectangle"===event.tool||"line"===event.tool||"ellipse"===event.tool||"blur"===event.tool?currentCursor="crosshair":"textarea"===event.tool&&(currentCursor="text")}else if("mousedown"===event.type)void 0!==zimagedit.numberingSelected&&event.target.id!==zimagedit.numberingSelected&&$("#"+event.target.id).is(":focus")===!1&&$("#"+zimagedit.numberingSelected).attr("readonly","readonly"),event.target.id!==zimagedit.textID&&$("#"+zimagedit.textID).blur();else if("mousemove"===event.type)1==event.onResize&&(zimagedit.cursorType=zimagedit.editContainer.css("cursor"),zimagedit.editContainer.css("cursor",$("#zimageeditor .zimageedit__active--"+zimagedit.row_val+zimagedit.col_val).css("cursor")));else if("mouseup"===event.type){if("create"===zimagedit.actionDone&&0!==zimagedit.lastAction.length||zimagedit.drawObject===!0){if("polyline"===zimagedit._selectedTool||"marker"===zimagedit._selectedTool){if($("#"+zimagedit._idSelected).attr("class","zimageedit__"+zimagedit._selectedTool),"polyline"===zimagedit._selectedTool&&(zimagedit.createShadowForMarker(zimagedit._idSelected),zimagedit._arrowPolyline)){$("#"+zimagedit._idSelected).attr("data-arrowPoly",!0);var group=document.createElementNS(zimagedit.svgPath,"g");group.setAttribute("id",zimagedit._idSelected+"--group"),$(group).attr("class","zimageedit__move--cursor"),$(group).insertBefore("#zimageedit__focus--shape"),$("#"+zimagedit._idSelected).appendTo("#"+zimagedit._idSelected+"--group"),$("#zimageedit__triangle").clone().attr({id:zimagedit._idSelected+"--line","class":"zimageedit__line"}).css("visibility","visible").appendTo("#"+zimagedit._idSelected+"--group"),zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected)}}else("line"===zimagedit._selectedTool||"rectangle"===zimagedit._selectedTool)&&zimagedit.drawObject===!0&&(zimagedit.isDraw=!0,zimagedit.pushIntoStack("create"),zimagedit.isDraw=!1);zimagedit.isSafari===!0&&$("#"+zimagedit._idSelected).css("pointer-events","fill");var currentClass=$("#"+zimagedit._idSelected).attr("class");currentClass+=" zimageedit__move--cursor","line"===zimagedit._selectedTool||"numbering_"===zimagedit._selectedTool?zimagedit.isIEBrowser&&"numbering_"===zimagedit._selectedTool?(currentClass+="--IE",$("#"+zimagedit._idSelected+"--fobject").attr("class","zimagedit__numbering--fobject zimageedit__move--cursor")):$("#"+zimagedit._idSelected+"--group").attr("class",currentClass):"textarea"!==zimagedit._selectedTool&&$("#"+zimagedit._idSelected).attr("class",currentClass),zimagedit.drawObject===!0&&"ellipse"===zimagedit._selectedTool&&(zimagedit.isDraw=!0,zimagedit.pushIntoStack("create"),zimagedit.isDraw=!1),zimagedit.drawObject=!1}zimagedit.toolMove===!0&&(zimagedit.toolbarMove=zimagedit.propertiesMove=zimagedit.toolMove=!1,zimagedit.editContainer.css("cursor",zimagedit.cursorType)),"resize"===zimagedit.lastAction&&zimagedit.editContainer.css("cursor",zimagedit.cursorType),("move"===zimagedit.lastAction||"resize"===zimagedit.lastAction&&(args.mousedown.clientX!==event.clientX||args.mousedown.clientY!==event.clientY))&&1===zimagedit._noOfIdSelected.length&&zimagedit.checkForSelectedElement(["textarea"],zimagedit._noOfIdSelected[0].substr(1,zimagedit._noOfIdSelected[0].length))&&zimagedit._noOfIdSelected[0].substr(1,zimagedit._noOfIdSelected[0].length)==zimagedit.focussedTextareaID&&$("#"+zimagedit._idSelected).focus().addClass("zimageedit__text--cursor")}else if("toolSelect"===event.type){var addon="";if(zimagedit.isIEBrowser===!0&&(addon="--IE"),zimagedit.lastDrawnId=void 0,zimagedit.editContainer.attr("class","zimageeditor__container").css("cursor",""),"textarea"===event.tool?(zimagedit.editContainer.css("cursor","text"),zimagedit.changeIconColorProperties("#fff","none")):"marker"===event.tool||"smudge"===event.tool?zimagedit.editContainer.attr("class","zimageeditor__container zimageedit__brush--cursor"+addon):"polyline"===event.tool?zimagedit._arrowPolyline?zimagedit.editContainer.css("cursor","crosshair"):zimagedit.editContainer.attr("class","zimageeditor__container zimageedit__pencil--cursor"+addon):"numbering_"===event.tool?zimagedit.editContainer.attr("class","zimageeditor__container zimageedit__"+zimagedit.numberingTagSelected+"--cursor"+addon):"crop"===event.tool?zimagedit.editContainer.attr("class","zimageeditor__container").css("cursor","default"):void 0!==event.tool&&"none"!==event.tool&&zimagedit.editContainer.css("cursor","crosshair"),"blur"===event.tool&&zimagedit.blurCompleted===!1&&(zimagedit.editContainer.css("cursor","wait"),ZAlertBanner.show({type:"info",className:"zimageedit__blur--initBanner",message:zimagedit._getString("initalisingBlur.label"),display:"inline"})),void 0!==event.tool&&zimagedit.resetMultiSelect(),"marker"===zimagedit.previousSelectedTool||"polyline"===zimagedit.previousSelectedTool||"smudge"===zimagedit.previousSelectedTool||"numbering_"===zimagedit.previousSelectedTool)for(var loop=0;loop<zimagedit.drawnElements.length;loop++){var typeOfObject=zimagedit.typeOfElement(zimagedit.drawnElements[loop]),element=$("#"+zimagedit.drawnElements[loop]);"pencil"===typeOfObject?typeOfObject="polyline":"line"===typeOfObject||"numbering"===typeOfObject?element=$("#"+zimagedit.drawnElements[loop]+"--group"):"textarea"===typeOfObject&&(element=$("#"+zimagedit.drawnElements[loop]+"--fobject")),element.attr("class","zimageedit__"+typeOfObject)}if(void 0!==event.tool){if("marker"===event.tool||"polyline"===event.tool||"numbering_"===event.tool||"smudge"===event.tool){zimagedit.isIEBrowser===!0&&(addons="--IE");var cursorType="brush";"polyline"===event.tool?cursorType=zimagedit._arrowPolyline?"crosshair":"pencil":"numbering_"===event.tool&&(zimagedit.previousNumberingTagSelected=cursorType=zimagedit.numberingTagSelected),currentCursor=cursorType}"rectangle"===event.tool||"line"===event.tool||"ellipse"===event.tool||"blur"===event.tool?currentCursor="crosshair":"textarea"===event.tool&&(currentCursor="text"),zimagedit.previousSelectedTool=event.tool}else currentCursor="move",zimagedit.showBorderFocus()}else if("headerMouseDown"===event.type)zimagedit.cursorType=zimagedit.editContainer.css("cursor"),zimagedit.editContainer.css("cursor","move");else if("headerMouseUp"===event.type)zimagedit.editContainer.css("cursor",zimagedit.cursorType);else if("dblclick"===event.type){var elementType=($("#"+event.target.id).attr("class"),zimagedit.typeOfElement(event.target.id));"numbering"===elementType&&"numbering"===$("#"+event.target.id).attr("type-contains")?$("#"+event.target.id).focus().addClass("zimageedit__text--cursor"):"textarea"==elementType&&zimagedit.multiSelectFlag===!1&&($("#"+zimagedit.textID).attr("readonly","readonly").removeClass("zimageedit__text--cursor").removeClass("zimageedit__move--cursor"),zimagedit.textID=event.target.id,$("#"+event.target.id).addClass("zimageedit__text--cursor").removeAttr("readonly").focus())}else"select__tool"===event.type&&(zimagedit.options.isContinuousDraw&&($(".zimageeditor__btns--active").removeClass("zimageeditor__btns--active"),$("#zimageeditor__btns--select").addClass("zimageeditor__btns--active")),zimagedit.editContainer.css("cursor","default"),currentCursor="move");if(void 0!==currentCursor)for(var loop=0;loop<zimagedit.drawnElements.length;loop++){var typeOfObject=zimagedit.typeOfElement(zimagedit.drawnElements[loop]),element=$("#"+zimagedit.drawnElements[loop]);"pencil"===typeOfObject?typeOfObject="polyline":"line"===typeOfObject||"numbering"===typeOfObject?("numbering"===typeOfObject&&zimagedit.isIEBrowser&&$("#"+zimagedit.drawnElements[loop]+"--fobject").attr("class","zimagedit__numbering--fobject zimageedit__"+currentCursor+"--cursor"+addons),element=$("#"+zimagedit.drawnElements[loop]+"--group")):"textarea"===typeOfObject&&(element=$("#"+zimagedit.drawnElements[loop]+"--fobject"),typeOfObject+="--fobject"),element.attr("class","zimageedit__"+typeOfObject+" zimageedit__"+currentCursor+"--cursor"+addons)}},moveToolbar:function(event,toolBar,properties){var bodyWidth,bodyHeight;if(toolBar===!0){zimagedit.toolBarMoved=!0;var toolbarWidth=60,toolbarHeight=371;bodyWidth=parseFloat(zimagedit._bodyObj.css("width")),$("#zimageeditor .zimageeditor__tools").css(event.clientX-zimagedit.clickPosition[0]+toolbarWidth>bodyWidth?{left:bodyWidth-toolbarWidth}:{left:event.clientX-zimagedit.clickPosition[0]<0?0:event.clientX-zimagedit.clickPosition[0]}),bodyHeight=parseFloat($(window).height()),event.clientY-zimagedit.clickPosition[1]+toolbarHeight>bodyHeight?$("#zimageeditor .zimageeditor__tools").css({top:bodyHeight-toolbarHeight}):$("#zimageeditor  .zimageeditor__tools").css("top",event.clientY-zimagedit.clickPosition[1]>0?event.clientY-zimagedit.clickPosition[1]:0)}if(properties===!0){zimagedit.propertiesBarMoved=!0;var width,element=zimagedit.propertiesMenu;width=parseFloat(element.css("width")),bodyWidth=parseFloat(zimagedit._bodyObj.css("width")),element.css(event.clientX-zimagedit.clickPosition[0]+width+10>bodyWidth?{left:bodyWidth-width+10}:{left:event.clientX-zimagedit.clickPosition[0]}),bodyHeight=parseFloat($(window).height());var height=parseFloat(element.css("height"));element.css(event.clientY-zimagedit.clickPosition[1]+height+10>bodyHeight?{top:bodyHeight-height-10}:{top:event.clientY-zimagedit.clickPosition[1]>0?event.clientY-zimagedit.clickPosition[1]:0}),zimagedit.propertiesLeft=event.clientX-zimagedit.clickPosition[0],zimagedit.propertiesTop=event.clientY-zimagedit.clickPosition[1]}},numberingDisabled:function(state){for(var length=0;length<zimagedit.numberingTagElements.length;length++)$("#"+zimagedit.numberingTagElements[length]).attr("disabled",state)},handleRightClick:function(e,checkSVG,eleCount){if($(".zmenu").zmenu("hide"),e.preventDefault(),e.stopPropagation(),"zimageeditor__container"===e.target.id)return 0;var obj={target:{id:e.target.id}},isTextarea=zimagedit.checkForSelectedElement(["textarea"],e.target.id),isNumbering=zimagedit.checkForSelectedElement(["numbering"],e.target.id);if(isTextarea!==!0&&isNumbering!==!0||$("#"+e.target.id).is(":focus")!==!0){"zimageeditor__svgeditor"!==e.target.id&&void 0===zimagedit._selectedTool&&(zimagedit.removeBorderFocus(),zimagedit.removeShadowForMarker(),zimagedit.removePlusAttributes());var drawEle=zimagedit.drawnElements,state=!0;if(drawEle.length){var i;for(i=0;i<drawEle.length;i++)if($("#"+drawEle[i]).is(":visible")){state=!1;break}}else state=!0;zimagedit.cMenuSelectallProperty(state),zimagedit.cMenuDeselectallProperty(state),zimagedit.cMenuPasteProperty(!zimagedit.isElementCopied),zimagedit.cMenuUndoProperty(zimagedit.undoStack.length>0==!1),zimagedit.cMenuRedoProperty(zimagedit.redoStack.length>0==!1),zimagedit.cMenuZoomOutProperty(zimagedit.currentZoomValue<=10),zimagedit.cMenuZoomInProperty(zimagedit.currentZoomValue>=200);var right_click,isSVG,isObj,isCrop,isPolylineMarker;right_click=!0,isSVG=checkSVG,isObj=zimagedit.checkForSelectedElement(["ellipse","rectangle","numbering","textarea","pencil","marker","line"],e.target.id),isCrop=zimagedit.checkForSelectedElement(["crop"],e.target.id),isPolylineMarker=zimagedit.checkForSelectedElement(["pencil","marker"],e.target.id),"crop"===zimagedit._selectedTool&&(isCrop=!0),("zimageedit__active--shape"===e.target.classList[0]||"zimageedit__focus--shape"===e.target.classList[0])&&(isSVG=!0);var targetId=e.target.id;if(targetId="zimageeditor__svgcontainer"===targetId,isObj===!0&&"foreignObject"!==e.target.nodeName)if(zimagedit.rightClickMenu.zmenu("showMenuItems"),e.target.id===zimagedit._idSelected||void 0===zimagedit._selectedTool){if(zimagedit._idSelected=e.target.id,-1!=$("#"+zimagedit._idSelected).attr("class").indexOf("zimageedit__rectangle")?zimagedit.setPropertiesForSelectedObject("rectangle"):-1!=$("#"+zimagedit._idSelected).attr("class").indexOf("zimageedit__ellipse")?zimagedit.setPropertiesForSelectedObject("ellipse"):-1!=$("#"+zimagedit._idSelected).attr("class").indexOf("zimageedit__line")&&zimagedit.setPropertiesForSelectedObject("line"),2>eleCount&&(zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected)),isNumbering===!1)zimagedit.elementSelect("#"+e.target.id);else if(!zimagedit.multiSelectFlag){zimagedit._idSelected=zimagedit.extractID(e.target.id);var cx,cy,temp=$("#"+zimagedit._idSelected+"--circle");cx=parseFloat($(temp).attr("cx")),cy=parseFloat($(temp).attr("cy")),zimagedit.showBroderForNumbering(cx,cy,zimagedit._idSelected)}isPolylineMarker===!0&&zimagedit.createShadowForMarker(e.target.id),2>eleCount?(zimagedit.rightClickMenu.zmenu("hideMenuItems"),zimagedit.rightClickMenu.zmenu("showMenuItems",["#zimageeditor__cmenu--bringToFront","#zimageeditor__cmenu--sendToBack","#zimageeditor__cmenu--bringForward","#zimageeditor__cmenu--moveBackward","#zimageeditor__cmenu--separator","#zimageeditor__cmenu--copy","#zimageeditor__cmenu--paste","#zimageeditor__cmenu--delete"])):(zimagedit.rightClickMenu.zmenu("hideMenuItems"),zimagedit.rightClickMenu.zmenu("showMenuItems",["#zimageeditor__cmenu--copy","#zimageeditor__cmenu--paste","#zimageeditor__cmenu--delete"]))}else zimagedit.rightClickMenu.zmenu("hideMenuItems"),zimagedit.rightClickMenu.zmenu("showMenuItems",["#zimageeditor__cmenu--zoomIn","#zimageeditor__cmenu--zoomOut","#zimageeditor__cmenu--separator","#zimageeditor__cmenu--undo","#zimageeditor__cmenu--redo","#zimageeditor__cmenu--separator1","#zimageeditor__cmenu--paste","#zimageeditor__cmenu--selectall"]);else isCrop===!0?(zimagedit.rightClickMenu.zmenu("hideMenuItems"),zimagedit.rightClickMenu.zmenu("showMenuItems",["#zimageeditor__cmenu--crop","#zimageeditor__cmenu--cancel"]),$("#zimageeditor .zimaggeditor__crop--container").contextmenu(function(){})):(isSVG===!0||targetId===!0||"zimageeditor__container"===e.target.id)&&(zimagedit.rightClickMenu.zmenu("hideMenuItems"),zimagedit.rightClickMenu.zmenu("showMenuItems",["#zimageeditor__cmenu--zoomIn","#zimageeditor__cmenu--zoomOut","#zimageeditor__cmenu--separator","#zimageeditor__cmenu--undo","#zimageeditor__cmenu--redo","#zimageeditor__cmenu--separator1","#zimageeditor__cmenu--paste","#zimageeditor__cmenu--selectall","#zimageeditor__cmenu--deselectall"]));return"foreignObject"===e.target.nodeName||isSVG||void 0!==zimagedit._selectedTool||zimagedit.checkForPlusDisplay($("#"+zimagedit._idSelected).attr("class"),obj,zimagedit._idSelected),zimagedit.rightClickMenu.zmenu("show",{event:e,direction:"after-pointer"}),right_click}},resetProperties:function(){$("#zimageeditor__svgeditor .zimageedit__active--shape, #zimageeditor__svgeditor .zimageedit__focus--shape").attr({x:"-2000000px"}),$("#zimageeditor__svgeditor .zimageedit__active--c1c2, #zimageeditor__svgeditor .zimageedit__active--c1c1").attr({cx:"-20000000px"}),zimagedit.removeBorderFocus(),zimagedit.hideProperties(),zimagedit.removePlusAttributes(),void 0!==zimagedit.textID&&$("#"+zimagedit.textID).blur(),zimagedit.textareaSelected=!1,zimagedit.removeBorderForNumbering()},line_marker:function(id){var pathObj={id:id,orient:"auto",stroke:"#ff004e",fill:"#ff004e","stroke-width":0},pathEle=this._svgElements("polygon",pathObj);"zimageedit__triangle"!==id&&"zimageedit__triangle1"!==id?$(pathEle).insertBefore("#zimageedit__focus--shape"):$("#zimageeditor__svgeditor").append(pathEle)},removeBorderFocus:function(){$("#zimageeditor__svgeditor .zimageedit__active--shape, #zimageeditor__svgeditor .zimageedit__focus--shape").attr("x","-20000000px").hide(),$("#zimageeditor__svgeditor .zimageedit__active--text--left, #zimageeditor__svgeditor .zimageedit__active--text--leftWhite, #zimageeditor__svgeditor .zimageedit__active--text--right, #zimageeditor__svgeditor .zimageedit__active--text--rightWhite").attr("points","-2000,-2000").hide(),$("#zimageeditor__svgeditor .zimageedit__active--c1c2, #zimageeditor__svgeditor .zimageedit__active--c1c1").attr("cx","-20000000px").hide()},changeOpacitySliderProperties:function(color){void 0!==color&&(-1!==color.indexOf("#")&&(color=color.slice(1,color.length)),"none"===color||"transparent"===color?(color="transparent",$("#zimageeditor__colors--opacity").css("opacity",.35),$("#zimageeditor__slider").zslider("setAttribute","disabled",!0)):(color="#"+color,$("#zimageeditor__colors--opacity").css("opacity",1),$("#zimageeditor__slider").zslider("setAttribute","disabled",!1)),$("#zimageeditor__colors--opacity .zimageeditor__opacity span").css("background-color",color),$("#zimageeditor__zslider").find(".zslider__track").attr("style","background:rgba(0, 0, 0, 0) linear-gradient(to right, rgba(255, 255, 255, 0), "+color+") repeat scroll 0% 0% !important"))},setPropertiesForSelectedTool:function(tool){var color;if("crop"!==tool&&zimagedit.hideProperties(),void 0!==zimagedit._idSelected){var flag=zimagedit.checkForSelectedElement(["rectangle","ellipse","line","marker","pencil"],zimagedit._idSelected);if(flag===!0){var object=zimagedit.getValuesOfObject("#"+zimagedit._idSelected);zimagedit.lastSelectedStrokeColor=object.borderColor,zimagedit.lastSelectedStrokeWidth=object.borderWidth,zimagedit.lastSelectedFillColor=object.fill,zimagedit.lastSelectedFillOpacity=object.fillOpacity,zimagedit.lastSelectedStrokeOpacity=object.strokeOpacity,zimagedit.lastSelectedStrokeDashArray=object.borderStroke,zimagedit.lastSelectedId=zimagedit._idSelected}}else zimagedit.lastSelectedId=void 0;"rectangle"===tool||"ellipse"===tool?zimagedit.changeIconColorProperties(zimagedit.previousFillColor,void 0):zimagedit.changeIconColorProperties("#fff",void 0),"rectangle"===tool||"ellipse"===tool||"polyline"===tool||"line"===tool?(color=zimagedit.previousBorderColor,zimagedit.changeIconColorProperties(void 0,color)):(color="#ff004e",zimagedit.previousBorderColor="#ff004e",zimagedit.previousFillColor="none",zimagedit.previousOpacity=100,zimagedit.changeIconColorProperties(void 0,color)),"numbering_"===tool&&(color=zimagedit.previousNumberingColor,"question"===zimagedit.numberingTagSelected?color="#226cfb":"wrong"===zimagedit.numberingTagSelected?color="#ff3131":"tick"===zimagedit.numberingTagSelected&&(color="#23d01b"),zimagedit.changeIconColorProperties(void 0,color)),"textarea"!==tool&&(zimagedit.textFontSize=20,zimagedit.textFontColor="#8b23d5",zimagedit.textFontShadow=!0),("numbering_"!==tool||"numbering"!==zimagedit.numberingTagSelected)&&(zimagedit.previousNumberingColor="#226cfb"),("textarea"===tool||"numbering_"===tool||"marker"===tool||"blur"===tool||"crop"===tool)&&(zimagedit._idSelected=void 0,zimagedit.lastSelectedId=void 0)},changeIconColorProperties:function(fillColor,borderColor){var color;"none"===fillColor?$("#zimageeditor__textarea--menu .zimageedit__fill--bg").css({"background-color":"#fff",margin:"3px 3px"}).addClass("zimageedit__icon").addClass("zimageedit__icon--nofill"):void 0!==fillColor&&"none"!==fillColor&&($("#zimageeditor__textarea--menu .zimageedit__fill--bg").css({background:fillColor}).removeClass("zimageedit__icon").removeClass("zimageedit__icon--nofill"),zimagedit.fillIconColor=fillColor,color=fillColor.substr(1,fillColor.length),zimagedit.colorPalatteMenu.zmenu("setAttribute","#zimageeditor__colors--"+color,"checked",!0)),"none"===borderColor||"transparent"==color?($("#zimageeditor__textarea--menu .zimageedit__stroke--border").addClass("zimageedit__prop--nofill").css("border-color","white"),$("#zimageeditor__textarea--menu .zimageedit__stroke--bg").css("background","gray")):void 0!==borderColor&&(color=borderColor,"none"===color||"transparent"==color?($("#zimageeditor__textarea--menu .zimageedit__stroke--bg").css("background","gray"),$("#zimageeditor__textarea--menu .zimageedit__stroke--border").addClass("zimageedit__prop--nofill").css("border-color","white"),color="white"):$("#zimageeditor__textarea--menu .zimageedit__stroke--border").css({border:"2px solid "+color}).removeClass("zimageedit__prop--nofill"),zimagedit.borderIconColor=borderColor,zimagedit.colorPalatteMenu.zmenu("setAttribute","#zimageeditor__colors--"+color,"checked",!0))},hexaToRGB:function(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null},checkForPlusDisplay:function(targetClass,e,id){if(zimagedit._noOfIdSelected.length<2){var target=id||e.target.id,checkTextarea=zimagedit.checkForSelectedElement(["textarea"],target),checkLine=zimagedit.checkForSelectedElement(["line","pencil"],target),checkFlag=zimagedit.checkForSelectedElement(["ellipse","rectangle"],target),numberingFlag=zimagedit.checkForSelectedElement(["numbering"],zimagedit._idSelected)&&"numbering"===$("#"+zimagedit._idSelected).attr("type-contains");numberingFlag===!0&&zimagedit.showProperties(zimagedit._idSelected,"numbering"),zimagedit.showBorderFocus(),void 0!==targetClass&&0===targetClass.indexOf("zimageedit__active--shape")&&(targetClass=$("#"+zimagedit._idSelected).attr("class"),target=zimagedit._idSelected),checkTextarea===!0&&zimagedit.showProperties(target,"textarea"),checkFlag===!0&&zimagedit.multiSelectFlag===!1&&(zimagedit.removePlusAttributes(),checkLine?$("#zimageeditor .zimageedit__active--c1c2, #zimageeditor .zimageedit__active--c1c1").css("visibility","visible"):(zimagedit.showPlusMenu(target,targetClass),$("#zimageeditor .zimageedit__active--c1c2, #zimageeditor .zimageedit__active--c1c1").css("visibility","hidden")),zimagedit.showProperties(target,"ellipse")),checkLine===!0&&zimagedit.showProperties(target,"line")}else zimagedit.hideProperties(),zimagedit.removePlusAttributes()},showBorderFocus:function(){$("#zimageeditor .zimageedit__active--shape, #zimageeditor .zimageedit__focus--shape").show()},createNumbering:function(X,Y){zimagedit.resetMultiSelect();var group=document.createElementNS(zimagedit.svgPath,"g");zimagedit.setAttributeForObj(group,["class","zimageedit__numbering","id",zimagedit.temp_id+"--group"]);var fo;if(zimagedit.isIEBrowser){var viewBox=zimagedit.editorSVG.getAttribute("viewBox").split(" ");fo=$("<div/>",{"class":"zimagedit__numbering--fobject",id:this.temp_id+"--fobject",y:Y-16-parseFloat(viewBox[1]),x:X-16-parseFloat(viewBox[0])}).css({top:Y-16+80-parseFloat(viewBox[1]),left:X-16+110-parseFloat(viewBox[0])})}else fo=document.createElementNS(zimagedit.svgPath,"foreignObject"),zimagedit.setAttributeForObj(fo,["id",this.temp_id+"--fobject","class","zimagedit__numbering--fobject","width",32,"height",32]),fo.setAttribute("y",Y-16),fo.setAttribute("x",X-16);var a=$("<input/>",{id:zimagedit.temp_id,maxlength:2,readonly:!0,"type-contains":zimagedit.numberingTagSelected,"class":"zimageedit__numbering--input zimageedit__numbering"});$(fo).append(a),zimagedit.blurNumberingTool(a,zimagedit.temp_id),zimagedit.isIEBrowser===!0?zimagedit.svgContainer.append(fo):$(group).append(fo),$(group).insertBefore("#zimageedit__focus--shape");var path=document.createElementNS(zimagedit.svgPath,"path");zimagedit.setAttributeForObj(path,["id",this.temp_id+"--path","stroke","#226cfb","fill","#226cfb","class","zimageedit__numbering"]),path.setAttribute("d","M1,15V1l11.4,6.1c0.7,0.4,0.7,1.4,0,1.8L1,15z"),$(group).prepend(path);var circle=document.createElementNS(zimagedit.svgPath,"circle");circle.setAttribute("id",this.temp_id+"--circle");var cy=5>Y?5:Y,cx=X;zimagedit.setAttributeForObj(circle,["cx",cx,"cy",cy,"fill","white","class","zimageedit__numbering","id",this.temp_id+"--circle","stroke-width",4,"r",16]),"numbering"===zimagedit.numberingTagSelected?(circle.setAttribute("stroke",zimagedit.previousNumberingColor),path.setAttribute("fill",zimagedit.previousNumberingColor),path.setAttribute("stroke",zimagedit.previousNumberingColor)):circle.setAttribute("stroke","#226cfb"),$(circle).insertAfter(path),zimagedit.showBroderForNumbering(cx,cy,this.temp_id),zimagedit._idSelected=this.temp_id;var x_pos,y_pos,points;zimagedit.resetMultiSelect(),zimagedit._noOfIdSelected.push("#"+this.temp_id),points=zimagedit.findPointOnACircle(cx,cy,90,7),y_pos=points[1],x_pos=points[0];var trans="translate("+x_pos+","+y_pos+") rotate(90 0 7.5)";$("#"+this.temp_id+"--path").attr({transform:trans}),$("#"+zimagedit.temp_id).append("<textarea class='zimageedit__numbering--input zimageedit__numbering></textarea>");var temp_id=$("#"+zimagedit.temp_id);if(temp_id.css({"z-index":3,background:"transparent","border-radius":"100%"}),"numbering"===zimagedit.numberingTagSelected)$(temp_id).on("keypress",function(event){if(!(event.which<32)){var regex=new RegExp("^[a-zA-Z0-9]+$"),key=String.fromCharCode(event.charCode?event.charCode:event.which);return regex.test(key)||8===event.charCode||46===event.charCode?void 0:(event.preventDefault(),!1)}}),zimagedit.currentValueForNumbering=zimagedit.currentValueForNumbering<=0?1:zimagedit.currentValueForNumbering,$(temp_id).val(zimagedit.currentValueForNumbering),zimagedit.currentValueForNumbering++;else if("tick"===zimagedit.numberingTagSelected){var polyline=document.createElementNS(zimagedit.svgPath,"polyline");zimagedit.setAttributeForObj(polyline,["class","zimageedit__numbering","fill","none","stroke",zimagedit.numberingColor.tick,"stroke-width","2","id",this.temp_id+"--tick"]);var pointx,pointy;pointx=cx-6,pointy=cy+1.5,points=""+pointx+","+pointy+" ",pointx+=3.5,pointy+=3.4,points+=+pointx+","+pointy+" ",pointx+=8.5,pointy-=8.4,points=points+pointx+","+pointy,polyline.setAttribute("points",points),$("#"+this.temp_id+"--circle").attr({stroke:zimagedit.numberingColor.tick}),$("#"+this.temp_id+"--path").attr({stroke:zimagedit.numberingColor.tick,fill:zimagedit.numberingColor.tick}),zimagedit.isIEBrowser?$("#"+this.temp_id+"--group").append(polyline):$(polyline).insertBefore("#"+this.temp_id+"--fobject")}else if("wrong"===zimagedit.numberingTagSelected){var line=document.createElementNS(zimagedit.svgPath,"line");zimagedit.setAttributeForObj(line,["class","zimageedit__numbering","fill","none","stroke","#ff3131","stroke-width","2","points",points]),line.setAttribute("id",this.temp_id+"--wrong1"),zimagedit.isIEBrowser?$("#"+this.temp_id+"--group").append(line):$(line).insertBefore("#"+this.temp_id+"--fobject"),$("#"+this.temp_id+"--wrong1").attr({x1:cx-5,y1:cy-5,x2:cx+5,y2:cy+5}),line=document.createElementNS(zimagedit.svgPath,"line"),line.setAttribute("class","zimageedit__numbering"),zimagedit.setAttributeForObj(line,["class","zimageedit__numbering","fill","none","stroke","#ff3131","stroke-width","2","id",this.temp_id+"--wrong2","points",points]),zimagedit.isIEBrowser?$("#"+this.temp_id+"--group").append(line):$(line).insertBefore("#"+this.temp_id+"--fobject"),$("#"+this.temp_id+"--wrong2").attr({x1:cx+5,y1:cy-5,x2:cx-5,y2:cy+5}),$("#"+this.temp_id+"--circle").attr({stroke:"#ff3131"}),$("#"+this.temp_id+"--path").attr({stroke:"#ff3131",fill:"#ff3131"})}else if("question"===zimagedit.numberingTagSelected){path=document.createElementNS(zimagedit.svgPath,"path");var path1="M 5 0 H 3 C 1.4 0 0 1.4 0 3 v 2 h 2 V 3 c 0 -0.6 0.4 -1 1 -1 h 2 c 0.6 0 1 0.4 1 1 v 3 C 4.3 6 3 7.3 3 9 v 2 h 2 V 8 c 1.7 0 3 -1.3 3 -3 V 3 C 8 1.4 6.7 0 5 0 L 5 0 Z";zimagedit.setAttributeForObj(path,["class","zimageedit__numbering","fill",zimagedit.numberingQuestionColor,"id",this.temp_id+"--question1","d",path1]),cx-=4,cy-=7,trans="translate("+cx+","+cy+") ",zimagedit.isIEBrowser?$(group).append(path):$(path).insertBefore("#"+this.temp_id+"--fobject"),$("#"+zimagedit.temp_id+"--question1").attr({transform:trans}),circle=document.createElementNS(zimagedit.svgPath,"circle"),zimagedit.setAttributeForObj(circle,["class","zimageedit__numbering","fill",zimagedit.numberingQuestionColor,"stroke",zimagedit.numberingQuestionColor,"stroke-width","0","r","1"]),circle.setAttribute("id",this.temp_id+"--question2"),zimagedit.isIEBrowser?$(group).append(circle):$(circle).insertBefore("#"+this.temp_id+"--fobject"),circle=document.createElementNS(zimagedit.svgPath,"circle"),zimagedit.setAttributeForObj(circle,["class","zimageedit__numbering","fill",zimagedit.numberingQuestionColor,"stroke",zimagedit.numberingQuestionColor,"stroke-width","0","r","1"]),circle.setAttribute("id",this.temp_id+"--question3"),zimagedit.isIEBrowser?$(group).append(circle):$(circle).insertBefore("#"+this.temp_id+"--fobject"),$("#"+this.temp_id+"--question2, #"+this.temp_id+"--question3").attr({cx:cx+4,cy:cy+14}),$("#"+this.temp_id+"--circle").attr({stroke:zimagedit.numberingQuestionColor}),$("#"+this.temp_id+"--path").attr({stroke:zimagedit.numberingQuestionColor,fill:zimagedit.numberingQuestionColor})}zimagedit._idSelected=zimagedit.temp_id,zimagedit.isDraw=!0,zimagedit.pushIntoStack("create")},blurNumberingTool:function(a,id){"numbering"!==zimagedit.numberingTagSelected?($(a).attr({maxlength:0,readonly:!0}),$(a).on("focus",function(){$(a).blur()})):($(a).attr("readonly",!0),zimagedit.numberingTagElements.push(id),$(a).on("focus",function(){return zimagedit.multiSelectFlag===!0||"readonly"===$(a).attr("readonly")?void $(a).blur():($(a).removeAttr("readonly"),$(a).attr("class","zimageedit__numbering--input zimageedit__numbering zimageedit__text--cursor"),void(zimagedit.focuessedNumbering=id))}),$(a).on("blur","input",function(){$(a).attr({readonly:"readonly",disabled:!0}),zimagedit.focuessedNumbering=id,$(a).attr("class","zimageedit__numbering--input zimageedit__numbering")}).on("click",function(event){void 0!==$(a).attr("readonly")&&($(a).blur(),event.stopPropagation(),event.preventDefault())}).on("blur",function(){$(a).attr("readonly","readonly"),zimagedit.focuessedNumbering=id,$(a).attr("class","zimageedit__numbering--input zimageedit__numbering")}))},initDrawElements:function(e){if(void 0!==zimagedit._idSelected){var object=zimagedit.getValuesOfObject("#"+zimagedit._idSelected);zimagedit.lastSelectedStrokeColor=object.borderColor,zimagedit.lastSelectedStrokeWidth=object.borderWidth,zimagedit.lastSelectedFillColor=object.fill,zimagedit.lastSelectedFillOpacity=object.fillOpacity,zimagedit.lastSelectedStrokeOpacity=object.strokeOpacity,zimagedit.lastSelectedStrokeDashArray=object.borderStroke,zimagedit.lastSelectedId=zimagedit._idSelected}else zimagedit.lastSelectedId=void 0;zimagedit._idSelected=void 0,this.removeBorderFocus(),zimagedit.removeBorderForNumbering(),this._drag=!0;var start=[e.clientX,e.clientY],randomNum=Math.round(1e7*Math.random());if("rectangle"===this._selectedTool||"ellipse"===this._selectedTool||"line"===this._selectedTool||"polyline"===this._selectedTool||"marker"===this._selectedTool){var color=zimagedit.previousBorderColor,fill=zimagedit.previousFillColor,svgObj={stroke:color,fill:fill,"stroke-width":zimagedit.previousBorderThickness,id:"zimageedit__shapes--"+randomNum,"class":"zimageedit__"+this._selectedTool,"stroke-opacity":1},shape=this._selectedTool;"polyline"===this._selectedTool&&zimagedit.isSafari===!1?(svgObj["stroke-linejoin"]="round",svgObj["stroke-linecap"]="round",$("#zimageedit__triangle").attr("stroke",zimagedit.arrowStrokeColor).attr("fill","#ff004e")):"rectangle"===this._selectedTool?shape="rect":"marker"===this._selectedTool&&(svgObj.stroke="#"+zimagedit.markerColor,svgObj["stroke-opacity"]=zimagedit.defaultMarkerOpacity,shape="polyline",svgObj["stroke-width"]=20,svgObj["stroke-linejoin"]="round",svgObj["stroke-linecap"]="round",svgObj.fill="none"),("rectangle"===this._selectedTool||"ellipse"===this._selectedTool||"line"===this._selectedTool||"polyline"===this._selectedTool)&&(svgObj["stroke-opacity"]=1,svgObj["stroke-width"]=4,svgObj["fill-opacity"]=1,svgObj.fill="none",svgObj.stroke="#ff004e",svgObj["stroke-dasharray"]="none"),"line"===this._selectedTool&&($("#zimageedit__triangle").attr("stroke",zimagedit.arrowStrokeColor).attr("fill","#ff004e"),$("#zimageedit__triangle1").attr("stroke",zimagedit.arrowStrokeColor).attr("fill","#ff004e"),svgObj["stroke-linecap"]="round",svgObj.fill="none",shape="path"),void 0===zimagedit.lastSelectedId||!zimagedit.checkForSelectedElement(["ellipse","rectangle","line","pencil"],zimagedit.lastSelectedId)||"ellipse"!==this._selectedTool&&"rectangle"!==this._selectedTool&&"line"!==this._selectedTool&&"polyline"!==this._selectedTool||(svgObj["stroke-opacity"]=zimagedit.lastSelectedStrokeOpacity,svgObj["stroke-width"]=zimagedit.lastSelectedStrokeWidth,svgObj["fill-opacity"]=zimagedit.previousOpacity/100,svgObj.fill=zimagedit.previousFillColor,svgObj.stroke=zimagedit.lastSelectedStrokeColor,$("#zimageedit__triangle").attr("stroke",zimagedit.lastSelectedStrokeColor).attr("fill",zimagedit.lastSelectedStrokeColor),$("#zimageedit__triangle1").attr("stroke",zimagedit.lastSelectedStrokeColor).attr("fill",zimagedit.lastSelectedStrokeColor),svgObj["stroke-dasharray"]=zimagedit.lastSelectedStrokeDashArray,"none"!==zimagedit.lastSelectedStrokeDashArray&&(svgObj["stroke-linecap"]="round",svgObj["stroke-linejoin"]="round")),void 0!==zimagedit.lastSelectedId&&zimagedit.checkForSelectedElement(["marker"],zimagedit.lastSelectedId)&&"marker"===this._selectedTool&&(svgObj["stroke-opacity"]=zimagedit.lastSelectedStrokeOpacity,svgObj["stroke-width"]=zimagedit.lastSelectedStrokeWidth,svgObj.stroke=zimagedit.lastSelectedStrokeColor,svgObj["stroke-dasharray"]=zimagedit.lastSelectedStrokeType),("polyline"===this._selectedTool||"marker"===this._selectedTool)&&(svgObj.fill="none","marker"===this._selectedTool?(svgObj.stroke="#"+zimagedit.markerColor,svgObj["stroke-opacity"]=zimagedit.markerColorOpacity,svgObj["stroke-width"]=20):$("#zimageedit__triangle").attr({"stroke-width":svgObj["stroke-width"]>4?svgObj["stroke-width"]-5:svgObj["stroke-width"]/4,"stroke-opacity":svgObj["stroke-opacity"],"fill-opacity":svgObj["stroke-opacity"]})),zimagedit._elem=this._svgElements(shape,svgObj),$(this._elem).addClass("zimageedit_svg_obj_"+shape),"line"===this._selectedTool&&($("#zimageedit__triangle").attr({"stroke-width":svgObj["stroke-width"]>4?svgObj["stroke-width"]-5:svgObj["stroke-width"]/4,"stroke-opacity":svgObj["stroke-opacity"],"fill-opacity":svgObj["stroke-opacity"]}),$("#zimageedit__triangle1").attr({"stroke-width":svgObj["stroke-width"]>4?svgObj["stroke-width"]-5:svgObj["stroke-width"]/4,"stroke-opacity":svgObj["stroke-opacity"],"fill-opacity":svgObj["stroke-opacity"]}))}var addon="";zimagedit.isIEBrowser===!0&&(addon="--IE");var cursorType="brush";return"polyline"===zimagedit._selectedTool&&(cursorType=zimagedit._arrowPolyline?"crosshair":"pencil"),("polyline"===zimagedit._selectedTool||"marker"===zimagedit._selectedTool)&&$(zimagedit._elem).attr("class","zimageedit__"+zimagedit._selectedTool+" zimageedit__"+cursorType+"--cursor"+addon),zimagedit.cursorHandling({type:"beforeDraw",tool:zimagedit._selectedTool}),("textarea"===this._selectedTool||"numbering_"===this._selectedTool||"blur"===this._selectedTool)&&(this.temp_id="zimageedit__shapes--"+randomNum),start},findPointOnACircle:function(cx,cy,angleInDegrees,r){var radian=angleInDegrees*Math.PI/180;return[Math.round(cx+r*Math.cos(radian)),Math.round(cy+r*Math.sin(radian))]},moveNumberinngBeack:function(id,e,check_flag){var len=id.length;id=parseFloat(id.substr(len-1,len));var cx,cy,selectedID,angle,points,temp,trans;if(selectedID=zimagedit._noOfIdSelected[0].substr(1,zimagedit._noOfIdSelected[0].length),zimagedit._idSelected=selectedID,cx=parseFloat($("#"+selectedID+"--circle").attr("cx")),cy=parseFloat($("#"+selectedID+"--circle").attr("cy")),7>=id&&check_flag===!1)angle=id=45*id,points=zimagedit.findPointOnACircle(cx,cy-7,id,15),trans="translate("+points[0]+","+points[1]+") rotate("+id+" 0 7.5)",$("#"+selectedID+"--path").attr("transform",trans);else{points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse());var clentX=points.x,clentY=points.y;if(Math.abs(clentX-cx)>16||Math.abs(clentY-cy)>16){angle=Math.atan2(clentY-cy,clentX-cx)*(180/Math.PI);var pointy=cy-Math.sqrt(Math.abs(clentX-cx)*Math.abs(clentX-cx)+Math.abs(clentY-cy)*Math.abs(clentY-cy));angle=2*Math.atan2(clentY-pointy,clentX-cx)*180/Math.PI,90>angle?angle+=270:angle-=90,22.5>angle?angle=0:67.5>angle?angle=45:112.5>angle?(angle=90,cx+=1.15):angle=157.5>angle?135:202.5>angle?180:247.5>angle?225:292.5>angle?270:337.5>angle?315:0,points=zimagedit.findPointOnACircle(cx,cy-7,angle,15),trans="translate("+points[0]+","+points[1]+") rotate("+angle+" 0 7.5)",$("#"+selectedID+"--path").attr("transform",trans)}}temp=angle/45,$("#zimageedit__active--numbering--8").attr({cx:$("#zimageedit__active--numbering--"+temp).attr("cx"),cy:$("#zimageedit__active--numbering--"+temp).attr("cy")})},keypressevents:function(e){if(27===e.keyCode){if(zimagedit.mousedown===!0&&"draw"===zimagedit.lastAction){zimagedit._drag=!1;var elementType=zimagedit.typeOfElement(zimagedit._idSelected);return"numbering"===elementType?$("#"+zimagedit._idSelected).parent().remove():"line"===elementType?($("#zimageedit__triangle").css("visibility","hidden"),$("#zimageedit__triangle1").css("visibility","hidden"),zimagedit.dragOnly=!1):"pencil"===elementType&&(zimagedit.polyline_points=""),$("#"+zimagedit._idSelected).remove(),zimagedit.resetProperties(),void(zimagedit.actionDone="none")}if("blur"===zimagedit._selectedTool&&"createcanvas"===zimagedit.lastAction&&"create"===zimagedit.actionDone)return $("#"+zimagedit._idSelected).remove(),zimagedit.actionDone=zimagedit.lastAction="none",void(zimagedit._drag=zimagedit.hasBlurred=!1);"line"===zimagedit._selectedTool&&(zimagedit._stLine=!1,zimagedit._doubleArrow=!1,zimagedit._arrowPolyline=!1),document.getElementById("zimageedit__dragselect-MultiSelect")&&($("#zimageedit__dragselect-MultiSelect,#zimageedit__dragselect-MultiSelect2").remove(),zimagedit.selectOnDrag=[],zimagedit.resetMultiSelect(),$(zimagedit.editorSVG).trigger("mouseup")),zimagedit.removeBorderFocus(),zimagedit.multiSelectFlag===!0?zimagedit.resetMultiSelect():1===zimagedit._noOfIdSelected.length&&"numbering"===zimagedit.typeOfElement(zimagedit._noOfIdSelected[0].substr(1,zimagedit._noOfIdSelected[0].length))&&$(zimagedit._noOfIdSelected[0]).blur(),zimagedit.resetProperties(),zimagedit._selectedTool="select",zimagedit.setPropertiesForSelectedTool(zimagedit._selectedTool),zimagedit.checkForContinuousDrawing(!0),zimagedit._noOfIdSelected.length=0,zimagedit._idSelected=void 0,$(".zimageeditor__btns--active").removeClass("zimageeditor__btns--active"),$("#zimageeditor__btns--select").addClass("zimageeditor__btns--active")}(46===e.keyCode||8===e.keyCode)&&zimagedit.deleteElements(e,!0);var flag=!1;if($("#"+zimagedit._idSelected).is(":focus")&&(flag=!0),67===e.keyCode&&(e.metaKey===!0||zimagedit.ctrlKeyPressed===!0&&zimagedit.isWindowsOS===!0)&&flag===!1?zimagedit.copyElements():86===e.keyCode&(e.metaKey===!0||zimagedit.ctrlKeyPressed===!0&&zimagedit.isWindowsOS===!0)&&flag===!1&&(zimagedit.showBorderFocus(),zimagedit.pasteElements()),27===e.keyCode&&zimagedit.cropSelected===!0&&zimagedit.onCropCancel(),!zimagedit.cropCreated&&(zimagedit.commandKeyPressed===!0&&!zimagedit.ctrlKeyPressed&&65===e.keyCode||zimagedit.ctrlKeyPressed===!0&&65===e.keyCode&&zimagedit.isWindowsOS===!0)){if($("#"+zimagedit._idSelected).is(":focus")===!0)return;zimagedit.selectAll(),e.preventDefault()}if(zimagedit.commandKeyPressed&&e.shiftKey&&65===e.keyCode||zimagedit.ctrlKeyPressed&&e.shiftKey&&65===e.keyCode&&zimagedit.isWindowsOS===!0){if($("#"+zimagedit._idSelected).is(":focus")===!0)return;zimagedit.resetMultiSelect(),zimagedit.multiSelectFlag=!1,zimagedit.setPropertiesForSelectedTool(zimagedit._selectedTool),e.preventDefault()}if(flag=!1,e.metaKey&&e.shiftKey===!1&&90===e.keyCode&&flag===!1||zimagedit.ctrlKeyPressed===!0&&zimagedit.shiftKeyPressed===!1&&90===e.keyCode&&flag===!1){var typeOfElement=zimagedit.typeOfElement(zimagedit._idSelected);if(zimagedit.multiSelectFlag===!1&&"textarea"===typeOfElement&&$("#"+zimagedit._idSelected).is(":focus"))return;zimagedit.removeBorderFocus(),zimagedit.removeBorderForNumbering(),zimagedit.removeShadowForMarker(),zimagedit.undoFunc(),zimagedit._idSelected=void 0,flag=!0}if(e.metaKey&&e.shiftKey&&90===e.keyCode&&flag===!1||zimagedit.ctrlKeyPressed===!0&&89===e.keyCode&&flag===!1){var typeOfElement=zimagedit.typeOfElement(zimagedit._idSelected);if(zimagedit.multiSelectFlag===!1&&"textarea"===typeOfElement&&$("#"+zimagedit._idSelected).is(":focus"))return;zimagedit.redoFunc(),zimagedit.removeShadowForMarker(),flag=!0}flag===!0&&(e.preventDefault(),zimagedit.resetMultiSelect());var moveBy,arr;if((37===e.keyCode||39===e.keyCode||40===e.keyCode||38===e.keyCode)&&zimagedit._noOfIdSelected.length>0){moveBy=1,zimagedit.shiftKeyPressed===!0&&(moveBy=10);var len=zimagedit._noOfIdSelected.length-1;for(len;len>=0;len--){var temp=zimagedit._noOfIdSelected[len];if(temp=temp.substr(1,temp.length),this._idSelected=temp,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len),$("#"+zimagedit._idSelected).is(":focus")===!1||zimagedit.multiSelectFlag===!0){var elementType=zimagedit.typeOfElement(zimagedit._idSelected);if("numbering"===elementType)zimagedit.moveNumbering(37===e.keyCode||39===e.keyCode?(e.keyCode-38)*moveBy:0,40===e.keyCode||38===e.keyCode?(e.keyCode-39)*moveBy:0);else if("pencil"===elementType||"marker"==elementType){var transX,transY;transX=transY=0,e.keyCode%2===1?transX=e.keyCode-38:transY=e.keyCode-39,transX*=moveBy,transY*=moveBy;var id=document.getElementById(zimagedit._idSelected),length=Object.keys(id.points).length;for(void 0!==id.points.numberOfItems&&(length=id.points.numberOfItems),$("#"+zimagedit._idSelected).css("transform","none"),--length;length>=0;length--){var temp2=id.points.getItem(length);temp2.x+=transX,temp2.y+=transY}var transform=$("#"+zimagedit._idSelected+"--shadowblack").css("transform");"none"==transform&&void 0!==transform?$("#"+zimagedit._idSelected+"--shadowblack").css("transform","translate("+transX+"px,"+transY+"px)"):void 0!==transform&&(transX=parseFloat(transform.substr(10,transform.length).split(" ")[3])+transX,transY=parseFloat(transform.substr(10,transform.length).split(" ")[4])+transY,$("#"+zimagedit._idSelected+"--shadowblack, #"+zimagedit._idSelected+"--shadow").css("transform","translate("+transX+"px,"+transY+"px)")),(zimagedit._arrowPolyline||$("#"+zimagedit._idSelected).attr("data-arrowPoly"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected)}else{arr=zimagedit.getValuesOfObject("#"+zimagedit._idSelected);var position="left";e.keyCode%2===0&&(position="top"),arr[position]=arr[position]+(e.keyCode-(e.keyCode%2===1?38:39))*moveBy,"textarea"===arr.tool?$("#"+zimagedit._idSelected).blur():"line"===arr.tool&&(arr[e.keyCode%2===1?"width":"height"]=arr[e.keyCode%2===1?"width":"height"]+(e.keyCode-(e.keyCode%2===1?38:39))*moveBy),zimagedit.moveElements(arr,"keymove"),"ellipse"!==arr.tool&&"rectangle"!==arr.tool||1!==zimagedit._noOfIdSelected.length||zimagedit.showPlusMenu(zimagedit._idSelected)}zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len+1),e.preventDefault(),zimagedit.setBoundaryValues("#"+zimagedit._idSelected,zimagedit.getValuesOfObject("#"+zimagedit._idSelected))}}zimagedit.copyFromTempToUndoStack()}},createBorderForNumbering:function(){var loop,svgCircle,angle=0;for(loop=0;8>=loop;loop++,angle+=45)svgCircle=document.createElementNS(zimagedit.svgPath,"circle"),zimagedit.setAttributeForObj(svgCircle,["id","zimageedit__active--numbering--"+loop,"class","zimageedit__focus--numbering","r",2.5,"stroke","#7f7f7f","fill","#7f7f7f"]),$(svgCircle).appendTo("#zimageeditor__svgeditor"),8===loop&&zimagedit.setAttributeForObj(svgCircle,["stroke","#11bf58","fill","white","r",4,"stroke-width",3]);svgCircle=document.createElementNS(zimagedit.svgPath,"circle"),zimagedit.setAttributeForObj(svgCircle,["id","zimageedit__active--numbering--9","class","zimageedit__focus--numbering","r",33,"stroke","blue"]),zimagedit.setAttributeForObj(svgCircle,["stroke-width","15","fill","none","stroke-opacity","0"]),$(svgCircle).insertBefore("#zimageedit__active--numbering--0")},updateBorderForNumbering:function(cx,cy,radius,id){zimagedit.removeBorderFocus();var loop,points,angle=0;for(loop=0;8>loop;loop++,angle+=45)points=zimagedit.findPointOnACircle(cx,cy,angle,radius),$("#zimageedit__active--numbering--"+loop).attr({cx:points[0]+.5,cy:points[1]+.5});points=zimagedit.findPointOnACircle(cx,cy,90,radius),$("#zimageedit__active--numbering--8").css("visibility",$("#"+id+"--path").css("visibility")).attr({cx:points[0]+.5,cy:points[1]+.5});var transform=$("#"+id+"--path").attr("transform");if(void 0!==transform){var position=transform.indexOf("rotate("),roateteAngle=transform.slice(position+7,transform.length);roateteAngle=roateteAngle.split(" "),roateteAngle[0]=roateteAngle[0]/45,$("#zimageedit__active--numbering--8").attr({cx:$("#zimageedit__active--numbering--"+roateteAngle[0]).attr("cx"),cy:$("#zimageedit__active--numbering--"+roateteAngle[0]).attr("cy")})}},showBroderForNumbering:function(cx,cy,id){$("#zimageeditor__svgcontainer .zimageedit__focus--numbering").show();var loop,angle=0;for(loop=0;8>=loop;loop++,angle+=45){var borderElement=document.getElementById("zimageedit__active--numbering--"+loop),points=zimagedit.findPointOnACircle(cx,cy,angle,32);zimagedit.setAttributeForObj(borderElement,["cx",points[0]+.5,"cy",points[1]+.5])}$("#zimageedit__active--numbering--9").attr({cx:cx,cy:cy}),zimagedit.updateBorderForNumbering(cx,cy,32,id)},removeBorderForNumbering:function(){$("#zimageeditor__svgcontainer .zimageedit__focus--numbering").hide()},removeTextSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},mouseupFunction:function(base,e){if(zimagedit.isDraw===!0&&zimagedit.dragOnly===!0&&"blur"!==zimagedit._selectedTool&&"smudge"!==zimagedit._selectedTool&&(zimagedit.resetMultiSelect(),zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected),zimagedit.checkForPlusDisplay($("#"+zimagedit._idSelected).attr("class"),e,zimagedit._idSelected)),"blur"===zimagedit._selectedTool&&"createcanvas"===zimagedit.lastAction&&"create"===zimagedit.actionDone||zimagedit.hasBlurred===!0){zimagedit.hasBlurred=!1,zimagedit.blurPosition[zimagedit.blurPosition.length]=new Array(6),zimagedit.blurPositionLength++;var canvasDifference,element=$("#"+zimagedit.hasBlurredID),width=parseFloat(element.attr("width")),height=parseFloat(element.attr("height")),top=parseFloat(element.css("top")),left=parseFloat(element.css("left")),percentage=zimagedit.fitToWidthZoomValue/100,difference=zimagedit._imageWidth/zimagedit.actualWidth;"none"===zimagedit._imageCanvas.css("display")?(element=document.getElementById("zimageditCropCanvas"),canvasDifference=parseFloat(zimagedit._imageCropCanvas.attr("width"))/parseFloat(zimagedit._imageCropCanvas.css("width"))):(canvasDifference=difference,element=document.getElementById("zimageedit-ele-canvas"));var drawn_canvas=document.getElementById(zimagedit.hasBlurredID),create_canvas=$("<canvas>").attr({width:width*difference,height:height*difference,id:"zimageedit__tempCanvas","class":"zimageedit__blurCanvas"}).css({position:"absolute",visibility:"hidden",top:(top-80)*difference,left:(left-110)*difference});width/=percentage,height/=percentage,top-=80,left-=110,top/=percentage,left/=percentage,$("#zimageeditor__image").append(create_canvas),zimagedit.blurPosition[zimagedit.blurPosition.length-1]=[top,left,width*difference,height*difference,zimagedit.actualWidth,zimagedit.actualHeight];var element_Ctx=element.getContext("2d"),final_canvas=document.getElementById("zimageedit__tempCanvas"),final_canvas_Ctx=final_canvas.getContext("2d");final_canvas_Ctx.drawImage(element,left*difference*percentage,top*difference*percentage,width*difference*percentage,height*difference*percentage,0,0,width*difference*percentage,height*difference*percentage),element_Ctx.drawImage(drawn_canvas,left*canvasDifference*percentage,top*canvasDifference*percentage,width*canvasDifference*percentage,height*canvasDifference*percentage),$("#"+zimagedit.hasBlurredID).remove(),$("#zimageedit__tempCanvas").attr("id",zimagedit.hasBlurredID).css("visibility","hidden"),$(create_canvas).css("display","none")}if(zimagedit.dragOnly===!0&&"none"!==zimagedit._selectedTool){if("line"===base._selectedTool){var group=document.createElementNS(zimagedit.svgPath,"g");group.setAttribute("id",zimagedit._idSelected+"--group"),$(group).insertBefore("#zimageedit__focus--shape"),$("#"+zimagedit._idSelected).appendTo("#"+zimagedit._idSelected+"--group"),$("#zimageedit__triangle").clone().attr({id:zimagedit._idSelected+"--line","class":"zimageedit__line"}).css("visibility","visible").appendTo("#"+zimagedit._idSelected+"--group"),$("#"+zimagedit._idSelected+"--group").attr("class","zimageedit__line"),$("#zimageedit__triangle").attr({points:"2,7 0,0 11,7 0,14","class":"zimageedit--triangle"}).css("visibility","hidden"),zimagedit._doubleArrow&&($("#zimageedit__triangle1").clone().attr({id:zimagedit._idSelected+"--line1","class":"zimageedit__line"}).css("visibility","visible").appendTo("#"+zimagedit._idSelected+"--group"),$("#"+zimagedit._idSelected+"--group").attr("class","zimageedit__line"),$("#zimageedit__triangle1").attr({points:"-2,7 0,0 -11,7 0,14","class":"zimageedit--triangle"}).css("visibility","hidden")),"true"===$("#"+zimagedit._idSelected+"--line").attr("data-stline")&&$("#"+zimagedit._idSelected+"--line").css("visibility","hidden")}var clsss=$("#"+zimagedit._idSelected).attr("class");void 0!==clsss&&-1!=clsss.indexOf("zimageedit__line")&&(zimagedit.idSelected=$("#"+zimagedit._idSelected).parent().attr("id"),zimagedit.idSelected=zimagedit._idSelected.substr(0,zimagedit._idSelected.length-7)),"draw"===zimagedit.lastAction&&"marker"!==zimagedit._selectedTool&&"blur"!==zimagedit._selectedTool&&("textarea"!==zimagedit._selectedTool&&zimagedit.elementSelect("#"+zimagedit._idSelected,"return","color_select"),$(this._elem).removeClass(zimagedit.isIEBrowser!==!0?"zimageedit__brush--cursor":"zimageedit__brush--cursor--IE")),("polyline"===base._selectedTool||"marker"===base._selectedTool)&&(zimagedit.polyline_points="",$("#zimageedit__triangle").attr({points:"2,7 0,0 11,7 0,14","class":"zimageedit--triangle"}).css("visibility","hidden")),zimagedit.shiftKeyPressed===!1&&zimagedit.resetMultiSelect(),void 0!==zimagedit._idSelected&&zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected)}zimagedit.dragOnly=!1},_drawSvgElements:function(e,tool,startVal,startOffset){"textarea"!==tool&&(zimagedit._idSelected=$(this._elem).attr("id"));var x,y,l,t,wid,heit,left,top,width,height,points,eleTop=startVal[1];points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,zimagedit.lastDrawnId=zimagedit._idSelected,zimagedit.drawObject=!0,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse());var endVal=[points.x,points.y];startVal[1]>endVal[1]&&(eleTop=endVal[1]);var eleLeft=startVal[0];startVal[0]>endVal[0]&&(eleLeft=endVal[0]);var eleHeight=Math.abs(startVal[1]-endVal[1]),eleWidth=Math.abs(startVal[0]-endVal[0]);if("ellipse"===tool?(l="cx",t="cy",wid="rx",heit="ry",left=eleLeft+eleWidth/2,top=eleTop+eleHeight/2,width=eleWidth/2,height=eleHeight/2,zimagedit.shiftKeyPressed&&(startVal[1]>points.y&&startVal[0]>points.x?(left=startVal[0]-width,top=startVal[1]-width):startVal[0]>points.x?top=startVal[1]+width:startVal[1]>points.y?top=startVal[1]-width:(left=startVal[0]+width,top=startVal[1]+width),height=width)):"smudge"===tool?zimagedit.makeSmudge(e,tool,startVal):"rectangle"===tool||"textarea"===tool||"crop"===tool?(l="x",t="y",wid="width",heit="height",left=eleLeft,top=eleTop,width=eleWidth,height=eleHeight,zimagedit.shiftKeyPressed&&"rectangle"===tool&&(startVal[1]>endVal[1]&&(top=startVal[1]-width),height=width)):"line"===tool?(l="x1",t="y1",wid="x2",heit="y2",left=startVal[0],top=startVal[1],width=endVal[0],height=endVal[1]):("polyline"===tool||"marker"===tool)&&(x=endVal[0],y=endVal[1],zimagedit.polyline_points.length<5&&(zimagedit.previousXPoint=startVal[0],zimagedit.previousYPoint=startVal[1]),x=(zimagedit.previousXPoint+x)/2,y=(zimagedit.previousYPoint+y)/2,zimagedit.previousXPoint=(x+zimagedit.previousXPoint)/2,zimagedit.previousYPoint=(y+zimagedit.previousYPoint)/2,zimagedit.polyline_points+="marker"===tool&&zimagedit.shiftKeyPressed?x+","+startVal[1]+" ":x+","+y+" ",this._elem.setAttributeNS(null,"points",zimagedit.polyline_points),$(this._elem).insertBefore("#zimageedit__focus--shape"),zimagedit._arrowPolyline&&($("#zimageedit__triangle").css("visibility","visible"),zimagedit.changeArrowHeadValues("zimageedit__triangle",zimagedit._idSelected,!1))),"textarea"===tool&&(l="left",t="top"),this._toolSelected!==!0||"rectangle"!==tool&&"ellipse"!==tool){if("line"===tool){if(width-=2,height-=2,zimagedit.shiftKeyPressed){var angle=zimagedit.findLineAngle(startOffset,e);if(angle>0&&30>angle||0>angle&&-60>angle)height=top;else if(angle>30&&60>angle||-30>angle&&angle>-60){var diagnol=zimagedit.diagnolCoordinates(left,top,width,height);width=diagnol[0],height=diagnol[1]}else width=left}points="M"+left+" "+top+", "+width+" "+height,this._elem.setAttributeNS(null,"d",points),$(this._elem).insertBefore("#zimageedit__focus--shape"),$("#zimageedit__triangle").css("visibility","visible"),zimagedit.changeArrowHeadValues("zimageedit__triangle",zimagedit._idSelected,!1),zimagedit._doubleArrow&&($("#zimageedit__triangle1").css("visibility","visible"),zimagedit.changeArrowHeadValues("zimageedit__triangle1",zimagedit._idSelected,!0))}}else this._elem.setAttributeNS(null,l,left),this._elem.setAttributeNS(null,t,top),this._elem.setAttributeNS(null,wid,width),this._elem.setAttributeNS(null,heit,height),$(this._elem).insertBefore("#zimageedit__focus--shape")},makeSmudge:function(e,tool,startVal){{var points;startVal[1]}points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse());var viewBox=([points.x,points.y],[]);viewBox[0]=viewBox[1]=0,viewBox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/);var percentage=zimagedit._imageWidth/zimagedit.actualWidth,c=(zimagedit.fitToWidthZoomValue/100,points.x),d=points.y;if(c*=zimagedit._aspectRatio,d*=zimagedit._aspectRatio,"none"===zimagedit._imageCanvas.css("display")){viewBox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/),percentage=parseFloat(zimagedit._imageCropCanvas.attr("width"))/parseFloat(zimagedit._imageCropCanvas.css("width"));var ele=document.getElementById("zimageeditor__svgeditor"),dim=ele.getBoundingClientRect(),c=(e.clientX-dim.left)*percentage,d=(e.clientY-dim.top)*percentage}c-=10,d-=10;var ele;ele="none"===zimagedit._imageCanvas.css("display")?document.getElementById("zimageditCropCanvas"):zimagedit.mainCanvas;var ct=ele.getContext("2d"),length1=zimagedit.smudgeStackPosition;if(zimagedit.smudgeStackFlag===!1){zimagedit.smudgeStack[length1]=[],zimagedit.smudgeStack[length1][0]=percentage,zimagedit.smudgeStackFlag=!0;var obj={idSelected:"blurr"+length1};zimagedit.undoStack[zimagedit.undoStack.length]=obj}var position;position=zimagedit.smudgeStack[length1].length,zimagedit.smudgeStack[length1][position]=c,zimagedit.smudgeStack[length1][position+1]=d;var imageData=ct.getImageData(c,d,zimagedit.smudgeBrushSize*percentage,zimagedit.smudgeBrushSize*percentage);imageData=zimagedit._blur(imageData,1),ct.putImageData(imageData,c,d),zimagedit._idSelected=void 0},createTextarea:function(top,left,width,height,temp_id){zimagedit.textareaSelected=zimagedit.dragOnly=!0,zimagedit.textID=temp_id;var textarea;if(zimagedit.isIEBrowser===!1){var foreignObject=document.createElementNS(zimagedit.svgPath,"foreignObject");zimagedit.setAttributeForObj(foreignObject,["id",temp_id+"--fobject","class","zimageedit__textarea--fobject"]),zimagedit.setAttributeForObj(foreignObject,["x",left,"y",top,"width",width,"height",height]),textarea=document.createElementNS("http://www.w3.org/1999/xhtml","textarea"),$(foreignObject).insertBefore("#zimageedit__focus--shape"),$(foreignObject).append(textarea),this._idSelected=temp_id,textarea.setAttribute("id",temp_id),textarea.setAttribute("class","zimageedit__textarea"),textarea.setAttribute("data-resized",!1),textarea.setAttribute("wrap","soft")}else{zimagedit.textareaCreatedElements.push(zimagedit.temp_id);var viewBox=zimagedit.editorSVG.getAttribute("viewBox").split(" "),tempp=$("<div/>",{id:temp_id+"--fobject",position:"absolute",x:left,y:top,width:width,height:height}).css({left:left-parseFloat(viewBox[0])+110,top:top+80-parseFloat(viewBox[1]),width:width,height:height,"z-index":4});zimagedit.svgContainer.append(tempp);var tem=$("<textarea/>",{id:temp_id,"class":"zimageedit__textarea","data-resized":!1,tabindex:-1});$("#"+temp_id+"--fobject").css("position","absolute"),this._idSelected=temp_id,$(tempp).append(tem)}textarea=document.getElementById(temp_id),_textarea=$(textarea),_textarea.css({"font-size":zimagedit.textFontSize,color:zimagedit.textFontColor}),zimagedit.applyTextShadow(temp_id,zimagedit.textFontShadow),textarea.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/xmlns"),textarea.onkeydown=function(event){_textarea.is(":focus")!==!0||8!==event.keyCode&&46!==event.keyCode||(event.stopPropagation(),zimagedit.textareaAlignment(temp_id)),27===event.keyCode&&($("#"+zimagedit._idSelected).blur(),zimagedit.removeBorderFocus())},textarea.oninput=function(){zimagedit.textareaAlignment(temp_id)},textarea.onfocus=function(){return zimagedit.multiSelectFlag===!0?void $(this).blur():($(this).removeAttr("readonly"),zimagedit.focussedTextareaID=temp_id,zimagedit.multiSelectFlag===!1&&$(this).addClass("zimageedit__text--cursor"),void $(this).parent().attr("class","zimageedit__textarea--fobject zimageedit__text--cursor"))},textarea.focusout=function(){_textarea.attr("readonly","readonly").removeClass("zimageedit__text--cursor").removeClass("zimageedit__move--cursor"),_textarea.parent().attr("class","zimageedit__textarea--fobject zimageedit__move--cursor"),$("#"+zimagedit.focussedTextareaID).attr("readonly","readonly").removeClass("zimageedit__text--cursor").removeClass("zimageedit__move--cursor")},$("#"+temp_id).on("blur",function(){$("#"+temp_id).attr("readonly","readonly").removeClass("zimageedit__text--cursor").removeClass("zimageedit__move--cursor"),window.getSelection().removeAllRanges(),$("#"+temp_id).parent().attr("class","zimageedit__textarea--fobject zimageedit__move--cursor")}),zimagedit.textareaList.push(temp_id),zimagedit.drawBorder("textarea",top,left-4,width+8,height),zimagedit.cursorHandling({tool:void 0,type:"toolSelect"})},textareaDisabled:function(toDisable){for(var loop=0;loop<zimagedit.textareaList.length;loop++){var id=zimagedit.textareaList[loop];toDisable===!0?$("#"+id).attr("disabled",toDisable).addClass("zimagedit__noselect"):$("#"+id).attr("disabled",toDisable).removeClass("zimagedit__noselect")}},checkTextareaOverflow:function(id){var viewBoxWidth,viewBoxHeight,element,viewBox,textareaTop,textareaLeft,textareaHeight,textareaWidth;viewBox=zimagedit.editorSVG.getAttribute("viewBox"),element=$("#"+id).parent(),viewBox=viewBox.split(" "),viewBoxWidth=parseFloat(viewBox[2]),viewBoxHeight=parseFloat(viewBox[3]),textareaTop=parseFloat(element.attr("y")),textareaLeft=parseFloat(element.attr("x")),textareaHeight=parseFloat(element.attr("height")),textareaWidth=parseFloat(element.attr("width")),textareaTop-parseFloat(viewBox[1])+textareaHeight>viewBoxHeight&&element.attr({height:viewBoxHeight-(textareaTop-parseFloat(viewBox[1]))}),textareaLeft-parseFloat(viewBox[0])+textareaWidth>viewBoxWidth&&element.attr({width:viewBoxWidth-(textareaLeft-parseFloat(viewBox[0]))})},applyTextShadow:function(id,flag){var fontSize=parseFloat($("#"+id).css("font-size"));if(flag===!0){var type;type=14>=fontSize?"xs":20>=fontSize?"small":36>=fontSize?"medium":"large",$("#"+id).attr("class","zimageedit__textarea zimagedit__textshadow--"+type),zimagedit.textFontShadow=!0}else $("#"+id).attr("class","zimageedit__textarea"),zimagedit.textFontShadow=!1},setPropertiesForSelectedObject:function(tool){zimagedit.cropCreated===!1&&zimagedit.showBorderFocus(),"textarea"===tool||"polyline"===tool||zimagedit._noOfIdSelected.length>1?(zimagedit.borderElement.css("visibility","hidden"),"textarea"===tool&&($("#zimageeditor__svgeditor .zimageedit__active--shape, #zimageeditor__svgeditor .zimageedit__focus--shape").css("visibility","hidden"),$("#zimageeditor__svgeditor .zimageedit__active--text--right, #zimageeditor__svgeditor .zimageedit__active--text--left, #zimageeditor__svgeditor .zimageedit__active--text--leftWhite").css("visibility","visible"),$("#zimageeditor__svgeditor .zimageedit__active--text--rightWhite, #zimageeditor__svgeditor .zimageedit__active--r1c3, #zimageeditor__svgeditor .zimageedit__active--r1c1").css("visibility","visible"))):"line"===tool?($("#zimageeditor__svgeditor .zimageedit__active--shape, #zimageeditor__svgeditor .zimageedit__focus--shape").css("visibility","hidden"),$(".zimageedit__active--c1c1, .zimageedit__active--c1c2").css("visibility","visible")):"crop"!==tool&&zimagedit.cropCreated===!1?($("#zimageeditor__svgeditor .zimageedit__active--shape, #zimageeditor__svgeditor .zimageedit__focus--shape").css("visibility","visible"),zimagedit.borderElement.css("visibility","visible"),$(".zimageedit__active--c1c1, .zimageedit__active--c1c2").css("visibility","hidden"),$("#zimageeditor__svgeditor .zimageedit__active--text--right, #zimageeditor__svgeditor .zimageedit__active--text--left, #zimageeditor__svgeditor .zimageedit__active--text--leftWhite,  #zimageeditor__svgeditor .zimageedit__active--text--rightWhite").css("visibility","hidden")):"crop"===tool&&zimagedit.cropCreated===!0&&($("#zimageeditor__svgeditor .zimageedit__active--text--right, #zimageeditor__svgeditor .zimageedit__active--text--left, #zimageeditor__svgeditor .zimageedit__active--text--leftWhite,  #zimageeditor__svgeditor .zimageedit__active--text--rightWhite").css("visibility","hidden"),$(".zimageedit__active--c1c1, .zimageedit__active--c1c2").css("visibility","hidden"),zimagedit.borderElement.css("visibility","visible"))},drawBorder:function(tool,eleTop,eleLeft,eleWidth,eleHeight,param1,param2){if(zimagedit.multiSelectFlag)return tool="rect",0;var top,left,width,height;top=parseFloat(eleTop),left=parseFloat(eleLeft),width=Math.abs(parseFloat(eleWidth)),height=Math.abs(parseFloat(eleHeight));var temp=zimagedit.borderElement,count=0;if("line"===tool){$("#zimageeditor .zimageedit__focus--shape").hide(),$(temp).hide(),$(temp).eq(12).attr({cx:left,cy:top}).show();var pos=[];if(void 0!==param2)pos[0]=param1,pos[1]=param2;else{pos=zimagedit.getArrowEndPosition(zimagedit._idSelected),pos=pos.split(",");var transx,transy,str=$("#"+zimagedit._idSelected).css("transform");-1!==str.indexOf("matrix")&&void 0!==str&&"none"!==str&&(str=str.split("(")[1].split(")")[0].split(","),transx=parseFloat(str[4]),transy=parseFloat(str[5]),pos[0]=parseFloat(pos[0]),pos[1]=parseFloat(pos[1]),pos[0]+=transx,pos[1]+=transy)}if($("#"+zimagedit._idSelected+"--line1").attr("data-dlbline")){var angl=Math.atan2(pos[1]-top,pos[0]-left),siz=zimagedit.previousBorderThickness;$(temp).eq(12).attr({cx:left-Math.cos(angl)*siz,cy:top-Math.sin(angl)*siz})}$(temp).eq(13).attr({cx:pos[0],cy:pos[1]}).show()}else if("textarea"===tool){height=height>31?height:31,isNaN(width)&&(width=31),isNaN(height)&&(height=31),$("#zimageeditor__svgeditor .zimageedit__focus--shape").css("visibility","hidden");var points=left+4+","+top+","+left+","+top+","+left+","+(top+height)+","+(left+4)+","+(top+height);$("#zimageeditor__svgeditor .zimageedit__active--text--left").attr("points",points).css("visibility","visible"),points=left+5+","+top+","+left+","+top+","+left+","+(top+height)+","+(left+5)+","+(top+height),$("#zimageeditor__svgeditor .zimageedit__active--text--leftWhite").attr("points",points).css("visibility","visible"),points=left+width-4+","+top+","+(left+width)+","+top+","+(left+width)+","+(top+height)+","+(left+width-4)+","+(top+height),$("#zimageeditor__svgeditor .zimageedit__active--text--right").attr("points",points).css("visibility","visible"),points=left+width-5+","+top+","+(left+width)+","+top+","+(left+width)+","+(top+height)+","+(left+width-5)+","+(top+height),$("#zimageeditor__svgeditor .zimageedit__active--text--rightWhite").attr("points",points).css("visibility","visible"),$("#zimageeditor__svgeditor .zimageedit__active--r1c1").css("visibility","visible").attr({x:left-8,y:top+height/2-4}).css("cursor","ew-resize"),$("#zimageeditor__svgeditor .zimageedit__active--r1c3").css("visibility","visible").attr({x:left+width,y:top+height/2-4}).css("cursor","ew-resize")}else{var brc_thickness=zimagedit.borderWidth;(void 0===brc_thickness||isNaN(brc_thickness)===!0)&&(brc_thickness=1),$("#zimageeditor__svgeditor .zimageedit__active--r1c1").css("cursor","nwse-resize"),$("#zimageeditor__svgeditor .zimageedit__active--r1c3").css("cursor","nesw-resize"),"crop_element"!==tool?(top-=brc_thickness/1.9,left-=brc_thickness/1.9,width+=brc_thickness/1.9*2,height+=brc_thickness/1.9*2,count=4):(count=14,$("#zimageeditor__svgeditor .zimageedit__focus--shape").css("visibility","hidden"),$("#zimageedit__focus--crop").css("visibility","visible")),isNaN(width)===!0&&(width=0,height=0,top="-1000000",left="-1000000"),$(temp).eq(count+4).attr({x:left-5,y:top-5}),$(temp).eq(count+5).attr({x:left+width-3,y:top-5}),$(temp).eq(count+6).attr({x:left-5,y:top+height-3}),$(temp).eq(count+7).attr({x:left+width-3,y:top+height-3}),$(temp).eq(count+0).attr({x:left+width/2-6,y:top-2}),$(temp).eq(count+1).attr({x:left-2,y:top-6+height/2}),$(temp).eq(count+2).attr({x:left+width-2,y:top-6+height/2}),$(temp).eq(count+3).attr({x:left+width/2-6,y:top+height-2}),"crop_element"===tool&&($("#zimageedit__focus--crop").attr({width:width,x:left,y:top,height:height}),width-=6,height-=6,left+=3,top+=3),zimagedit.focusElementRectWhite.attr({width:Math.abs(width),x:left,y:top,height:Math.abs(height)}),zimagedit.focusElementRectBlack.attr({width:Math.abs(width),x:left,y:top,height:Math.abs(height)})}},changeArrowHeadValues:function(arrow_id,path_id,dblA){var arrow=document.getElementById(arrow_id);this._drag&&(zimagedit._stLine?($(arrow).css("visibility","hidden"),$(arrow).attr("data-stline",!0),$(arrow).attr("data-dlbline",!1)):zimagedit._doubleArrow?($(arrow).css("visibility","visible"),$(arrow).attr("data-stline",!1),$(arrow).attr("data-dlbline",!0)):($(arrow).css("visibility","visible"),$(arrow).attr("data-stline",!1),$(arrow).attr("data-dlbline",!1)));var sizee=zimagedit.previousBorderThickness+5,arr=zimagedit.arrowCalculatePosition(path_id,arrow_id,sizee),line=document.getElementById(path_id),linePoints=line.getAttribute("d"),regex=/[+-]?\d+(\.\d+)?/g;if(zimagedit._arrowPolyline||$("#"+path_id).attr("data-arrowPoly")){var linePoints=line.points.length-1;if(dblA){var transV=[],style=window.getComputedStyle(line);if(style){var transform=style.transform||style.webkitTransform||style.mozTransform||style.msTransform,transfVal=transform.match(/^matrix3d\((.+)\)$/);transfVal||(transfVal=transform.match(/^matrix\((.+)\)$/),transV.push(transfVal?parseFloat(transfVal[1].split(", ")[4]):0),transV.push(transfVal?parseFloat(transfVal[1].split(", ")[5]):0)),arrow.setAttribute("points","2,7 0,0 11,7 0,14"),arrow.setAttribute("transform","translate("+(line.points[linePoints].x+transV[0])+" "+(line.points[linePoints].y+transV[1])+") rotate("+arr[3]+" 0 0) translate(-2 -7)")}}else arrow.setAttribute("points","2,7 0,0 11,7 0,14"),arrow.setAttribute("transform","translate("+line.points[linePoints].x+" "+line.points[linePoints].y+") rotate("+arr[3]+" 0 0) translate(-2 -7)")}else linePoints.length>5&&void 0!==linePoints&&(linePoints=linePoints.match(regex).map(function(v){return parseFloat(v)}),dblA?(arrow.setAttribute("points","-2,7 0,0 -11,7 0,14"),arrow.setAttribute("transform","translate("+linePoints[0]+" "+linePoints[1]+") rotate("+arr[3]+" 0 0) translate(7 -7)")):(arrow.setAttribute("points","2,7 0,0 11,7 0,14"),arrow.setAttribute("transform","translate("+linePoints[2]+" "+linePoints[3]+") rotate("+arr[3]+" 0 0) translate(-2 -7)")))},getArrowEndPosition:function(path_id){var sizee=parseInt($("#"+path_id).attr("stroke-width"))+6;return"true"===$("#"+path_id+"--line").attr("data-stline")&&(sizee-=6),zimagedit.arrowCalculatePosition(path_id,path_id+"--line",sizee)[0]},arrowCalculatePosition:function(path_id,arrow_id,Size){var path=document.getElementById(path_id),totalLength=path.getTotalLength(),startPoint=path.getPointAtLength(totalLength-Size),endPoint=path.getPointAtLength(totalLength),angle=Math.atan2(endPoint.y-startPoint.y,endPoint.x-startPoint.x),angleOfInclination=180*angle/Math.PI,pointOnCircle=function(endPoint,angleOfInclination,ang){var newAngle=(angleOfInclination+ang)*Math.PI/180;return endPoint.x+Math.cos(newAngle)*Size+","+(endPoint.y+Math.sin(newAngle)*Size)};return[pointOnCircle(endPoint,angleOfInclination,0),pointOnCircle(endPoint,angleOfInclination,135),pointOnCircle(endPoint,angleOfInclination,-135),angleOfInclination]},returnDifferenceArrowHead:function(values){var temp1,temp2,pos1_x,pos2_x,pos3_x,pos1_y,pos2_y,pos3_y;return temp1=values.split(" "),temp2=temp1[0].split(","),pos1_x=temp2[0],pos1_y=temp2[1],temp2=temp1[1].split(","),pos2_x=temp2[0],pos2_y=temp2[1],temp2=temp1[2].split(","),pos3_x=temp2[0],pos3_y=temp2[1],pos2_x=pos2_x>pos3_x?pos2_x:pos3_x,pos2_y=pos2_y>pos3_y?pos2_y:pos3_y,{x:Math.abs(pos1_x-pos2_x),y:Math.abs(pos2_y-pos1_y)}},resizeElementsFunc:function(start,e,pos){var points,changeInX,changeInY,width,height,viewBox,left,top,d,rowColValues,currentRow,currentColumn,svgHeight,argument=zimagedit.element_attr;rowColValues=zimagedit.boundaryClicked[pos].split(" "),currentRow=rowColValues[0],currentColumn=rowColValues[1],points=zimagedit.editorSVG.createSVGPoint();var object=zimagedit.getValuesOfObject("#"+zimagedit._idSelected);if("crop_element"===object.tool&&(points=zimagedit.cropSVGElement.createSVGPoint()),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),"ellipse"===object.tool)width=object.width,left=object.left,changeInX=zimagedit.previousX-points.x,0!==changeInX&&("r1"===currentRow&&"c3"===currentColumn||"r3"===currentRow&&"c3"===currentColumn||"r2"===currentRow&&"c3"===currentColumn?(width=object.width-changeInX/2,left=object.left-changeInX/2):("r1"===currentRow&&"c1"===currentColumn||"r3"===currentRow&&"c1"===currentColumn||"r2"===currentRow&&"c1"===currentColumn)&&(width=object.width+changeInX/2,left=object.left-changeInX/2),0>=width&&("c3"===currentColumn?currentColumn="c1":"c1"===currentColumn&&(currentColumn="c3"),zimagedit.boundaryClicked[pos]=currentRow+" "+currentColumn,width=Math.abs(width)),$("#"+this._idSelected).attr({rx:width,cx:left}),zimagedit.funcForCalc(object)),changeInY=zimagedit.previousY-points.y,0!==changeInY&&(height=object.height,top=object.top,"r1"===currentRow&&"c3"===currentColumn||"r1"===currentRow&&"c1"===currentColumn||"r1"===currentRow&&"c2"===currentColumn?(zimagedit.dragSelect&&(zimagedit.sta=$("#"+this._idSelected)[0].getBBox().y+2*object.height,zimagedit.dragSelect=!1),height=object.height+changeInY/2,"r2"!==currentRow&&"c2"!==currentColumn&&(height=Math.abs(zimagedit.sta-points.y)/2),top=object.top-changeInY/2):("r3"===currentRow&&"c1"===currentColumn||"r3"===currentRow&&"c2"===currentColumn||"r3"==currentRow&&"c3"===currentColumn)&&(zimagedit.dragSelect&&(zimagedit.sta=$("#"+this._idSelected)[0].getBBox().y,zimagedit.dragSelect=!1),height=object.height-changeInY/2,top=object.top-changeInY/2,"r2"!==currentRow&&"c2"!==currentColumn&&(height=Math.abs(zimagedit.sta-points.y)/2)),0>=height&&("r3"===currentRow?currentRow="r1":"r1"===currentRow&&(currentRow="r3"),zimagedit.boundaryClicked[pos]=currentRow+" "+currentColumn,height=Math.abs(height)),"r2"!==currentRow&&"c2"!==currentColumn&&(top=zimagedit.sta>points.y?zimagedit.sta-height:zimagedit.sta+height),zimagedit.shiftKeyPressed&&"r2"!==currentRow&&"c2"!==currentColumn&&(top=zimagedit.sta>points.y?zimagedit.sta-width:zimagedit.sta+width,height=width),$("#"+this._idSelected).attr({ry:height,cy:top}),zimagedit.funcForCalc(object));else if("rectangle"===object.tool||"textarea"===object.tool||"crop_element"===object.tool){if(object=zimagedit.getValuesOfObject("#"+zimagedit._idSelected),width=object.width,changeInX=parseFloat(zimagedit.previousX-points.x)*zimagedit.zoomScaleValue,top=object.top,left=object.left,0!==changeInX){if("r1"===currentRow&&"c1"===currentColumn||"r3"===currentRow&&"c1"===currentColumn||"r2"===currentRow&&"c1"===currentColumn){if(width=object.width+changeInX,left=object.left-changeInX,"textarea"===object.tool&&points.x-left>0&&0>changeInX);else if("crop_element"===object.tool&&points.x<0)return 0}else if("r1"===currentRow&&"c3"===currentColumn||"r3"===currentRow&&"c3"===currentColumn||"r2"===currentRow&&"c3"===currentColumn)if(width=object.width-changeInX,"textarea"===object.tool&&points.x-(left+width)<0);else if("crop_element"===object.tool){var cropSVG=document.getElementById("zimageedit__crop__svg");viewBox=cropSVG.getAttribute("viewBox"),viewBox=viewBox.split(" ")}if(0>=width&&("c3"===currentColumn&&"textarea"!==object.tool?currentColumn="c1":"c1"===currentColumn&&"textarea"!==object.tool&&(currentColumn="c3"),zimagedit.boundaryClicked[pos]=currentRow+" "+currentColumn,width=Math.abs(width),left-=width),"rectangle"===object.tool)$("#"+zimagedit._idSelected).attr({x:left,width:Math.abs(width)});else if("textarea"==object.tool&&width>50){if($("#"+this._idSelected).css({height:0,overflow:"visible"}),height=$("#"+this._idSelected)[0].scrollHeight,$("#"+this._idSelected).css({overflow:"hidden",height:height}),0>=left)return;$("#"+this._idSelected).data("resized",!0).parent().attr({width:width,x:left,height:height}),zimagedit.isIEBrowser&&(svgHeight=parseFloat(zimagedit.SVGElement.attr("height")),top+height>svgHeight&&(height=svgHeight-top,$("#"+this._idSelected).css({height:height})),$("#"+this._idSelected).parent().css({width:width,left:left+110,height:height}))}else if("crop_element"===object.tool){0>left&&(left=0,width=object.width);var svgWidth=parseFloat(zimagedit.SVGElement.attr("width"));left+width>svgWidth&&(width=svgWidth-left),zimagedit.cropAreaLock=!0,$("#"+zimagedit._idSelected).attr({x:left,width:width}),zimagedit.modifyTheCropAreaValues(object.top,left,width,object.height)}object.width=width,object.left=left,"textarea"===object.tool?zimagedit.textareaAlignment(this._idSelected):zimagedit.funcForCalc(object)}if(changeInY=(zimagedit.previousY-points.y)*zimagedit.zoomScaleValue,0!==changeInY&&"textarea"!==object.tool){if(height=parseFloat(object.height),top=parseFloat(object.top),"r1"===currentRow&&"c1"===currentColumn||"r1"===currentRow&&"c2"===currentColumn||"r1"===currentRow&&"c3"===currentColumn){if(zimagedit.dragSelect&&(zimagedit.sta=object.top+object.height,zimagedit.dragSelect=!1),height=parseFloat(object.height+parseFloat(changeInY)),"rectangle"===object.tool&&"r2"!==currentRow&&"c2"!==currentColumn&&(height=Math.abs(zimagedit.sta-points.y)),top=object.top-changeInY,"crop_element"===object.tool&&points.y<0)return 0}else if(("r3"===currentRow&&"c1"===currentColumn||"r3"===currentRow&&"c2"===currentColumn||"r3"===currentRow&&"c3"===currentColumn)&&(zimagedit.dragSelect&&(zimagedit.sta=object.top,zimagedit.dragSelect=!1),height=parseFloat(object.height-parseFloat(changeInY)),"rectangle"===object.tool&&"r2"!==currentRow&&"c2"!==currentColumn&&(height=Math.abs(zimagedit.sta-points.y)),"crop_element"===object.tool)){var svgElement=document.getElementById("zimageedit__crop__svg");viewBox=svgElement.getAttribute("viewBox"),viewBox=viewBox.split(" ")}0>=height&&("r3"===currentRow&&"textarea"!==object.tool?currentRow="r1":"r1"===currentRow&&"textarea"!==object.tool&&(currentRow="r3"),zimagedit.boundaryClicked[pos]=currentRow+" "+currentColumn,height=Math.abs(height),top-=height),void 0===height&&(height=object.height),"rectangle"===object.tool?(zimagedit.shiftKeyPressed&&"r2"!==currentRow&&"c2"!==currentColumn&&(height=width),"r2"!==currentRow&&"c2"!==currentColumn&&(top=zimagedit.sta>points.y?zimagedit.sta-height:zimagedit.sta),$("#"+zimagedit._idSelected).attr({y:top,height:height})):"crop_element"===object.tool&&(0>top&&(top=0,height=object.height),svgHeight=parseFloat(zimagedit.SVGElement.attr("height")),top+height>svgHeight&&(height=svgHeight-top),zimagedit.cropAreaLock=!0,$("#"+zimagedit._idSelected).attr({y:top,height:height}),zimagedit.modifyTheCropAreaValues(top,object.left,object.width,height)),object.top=top,object.height=height,zimagedit.funcForCalc(object)}}else if("line"===object.tool){var xPoint=points.x;if(zimagedit.previousX-points.x!==0){var point=$("#"+zimagedit._idSelected+"--line").attr("points");if(point=zimagedit.returnDifferenceArrowHead(point),"c1"===currentRow&&"c1"===currentColumn){var angle=zimagedit.findLineAngle($(".zimageedit__active--c1c2").offset(),e);if(zimagedit.shiftKeyPressed)if(angle>0&&30>angle||0>angle&&-60>angle)argument[0]=argument[3];else if(angle>30&&60>angle||-30>angle&&angle>-60){var diagnol=zimagedit.diagnolCoordinates(argument[2],argument[3],xPoint,argument[0]);xPoint=diagnol[0]}else xPoint=argument[2];d="M"+xPoint+" "+argument[0]+", "+argument[2]+" "+argument[3],$("#"+this._idSelected).attr({d:d}),zimagedit.element_attr[1]=xPoint,zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line1",zimagedit._idSelected,!0)}else{argument[1]<xPoint?xPoint-=point.x:xPoint+=point.x;var angle=zimagedit.findLineAngle($(".zimageedit__active--c1c1").offset(),e);if(zimagedit.shiftKeyPressed)if(angle>0&&30>angle||0>angle&&-60>angle)argument[3]=argument[0];else if(angle>30&&60>angle||-30>angle&&angle>-60){var diagnol=zimagedit.diagnolCoordinates(argument[1],argument[0],xPoint,argument[3]);xPoint=diagnol[0]}else xPoint=argument[1];d="M"+argument[1]+" "+argument[0]+", "+xPoint+" "+argument[3],$("#"+this._idSelected).attr({d:d}),zimagedit.element_attr[2]=xPoint,zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected,!1),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line1",zimagedit._idSelected,!0)}}var yPoint=points.y;if(zimagedit.previousY-points.y!==0){if(points=$("#"+zimagedit._idSelected+"--line").attr("points"),points=zimagedit.returnDifferenceArrowHead(points),"c1"===currentRow&&"c1"===currentColumn){var angle=zimagedit.findLineAngle($(".zimageedit__active--c1c2").offset(),e);if(zimagedit.shiftKeyPressed)if(angle>0&&angle>60||0>angle&&angle>-30)argument[1]=argument[2];else if(angle>30&&60>angle||-30>angle&&angle>-60){var diagnol=zimagedit.diagnolCoordinates(argument[2],argument[3],argument[1],yPoint);yPoint=diagnol[1]}else yPoint=argument[3];d="M"+argument[1]+" "+yPoint+", "+argument[2]+" "+argument[3],$("#"+this._idSelected).attr({d:d}),zimagedit.element_attr[0]=yPoint,zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected,!1),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line1",zimagedit._idSelected,!0)}else{argument[0]>yPoint?yPoint+=points.y:yPoint-=points.y;var angle=zimagedit.findLineAngle($(".zimageedit__active--c1c1").offset(),e);if(zimagedit.shiftKeyPressed)if(angle>0&&angle>60||0>angle&&angle>-30)argument[2]=argument[1];else if(angle>30&&60>angle||-30>angle&&angle>-60){var diagnol=zimagedit.diagnolCoordinates(argument[1],argument[0],argument[2],yPoint);yPoint=diagnol[1]}else yPoint=argument[0];d="M"+argument[1]+" "+argument[0]+", "+argument[2]+" "+yPoint,$("#"+this._idSelected).attr({d:d}),zimagedit.element_attr[3]=yPoint}zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line1",zimagedit._idSelected,!0)}var object=zimagedit.getValuesOfObject("#"+this._idSelected);zimagedit.funcForCalc(object),"true"===$("#"+zimagedit._idSelected+"--line").attr("data-stline")&&$("#"+zimagedit._idSelected+"--line").css("visibility","hidden")}},findLineAngle:function(offset,e){var angle=Math.atan2(e.clientY-offset.top,e.clientX-offset.left);return angle*=180/Math.PI,angle=0>angle?-angle:angle,angle>90&&(angle=-angle%90),angle},diagnolCoordinates:function(x1,y1,x2,y2){var dist=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),newAngle=Math.atan2(y2-y1,x2-x1),shiftedAngle=Math.round(newAngle/Math.PI*4)/4*Math.PI;return[x1+dist*Math.cos(shiftedAngle),y1+dist*Math.sin(shiftedAngle)]},changeStrokeWidth:function(strokeWidth,isDashed){var stackSize,elementType;stackSize=zimagedit._noOfIdSelected.length,strokeWidth=strokeWidth>16?16:strokeWidth,strokeWidth=0>strokeWidth?1:strokeWidth;for(var loop=0;stackSize>loop;loop++){var elementID,elementClass;elementID=zimagedit._noOfIdSelected[loop].substr(1,zimagedit._noOfIdSelected[loop].length),this._idSelected=elementID,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*loop),zimagedit.pushIntoStack("resize"),elementClass=$("#"+this._idSelected).attr("class"),elementType=zimagedit.typeOfElement(this._idSelected),zimagedit.previousBorderThickness=strokeWidth,-1!=elementClass.indexOf("zimageedit__line")&&($("#"+this._idSelected+"--line").attr("stroke-width",strokeWidth>4?strokeWidth-5:strokeWidth/4),$("#"+this._idSelected+"--line1").attr("stroke-width",strokeWidth>4?strokeWidth-5:strokeWidth/4)),void 0!==this._idSelected&&-1==elementClass.indexOf("zimageedit__textarea")?($("#"+this._idSelected).attr(isDashed?{"stroke-dasharray":2*strokeWidth+","+2*strokeWidth,"stroke-linejoin":"round","stroke-linecap":"round"}:{"stroke-dasharray":"none","stroke-linejoin":"none"}),$("#"+this._idSelected).attr("stroke-width",strokeWidth)):-1!=elementClass.indexOf("zimageedit__textarea")&&$("#"+this._idSelected).css("border-width",strokeWidth),zimagedit.pushIntoTempStack(zimagedit._idSelected,2*loop+1),zimagedit.elementSelect("#"+this._idSelected,"a")}"rectangle"===elementType||"ellipse"===elementType?zimagedit.showPlusMenu(zimagedit._idSelected):"pencil"===elementType&&zimagedit.multiSelectFlag===!1&&((zimagedit._arrowPolyline||$("#"+this._idSelected).attr("data-arrowPoly"))&&$("#"+this._idSelected+"--line").attr("stroke-width",strokeWidth>4?strokeWidth-5:strokeWidth/4),zimagedit.createShadowForMarker(zimagedit._idSelected)),zimagedit.copyFromTempToUndoStack()},copyElements:function(){return zimagedit._noOfIdSelected.length?(zimagedit.isElementCopied=!0,this._copiedObjects=[],void(this._copiedObjects=zimagedit._noOfIdSelected.concat())):0},cMenuPasteProperty:function(state){zimagedit.rightClickMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__cmenu--paste"],"disabled",state)},cMenuUndoProperty:function(state){zimagedit.rightClickMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__cmenu--undo"],"disabled",state)},cMenuRedoProperty:function(state){zimagedit.rightClickMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__cmenu--redo"],"disabled",state)},cMenuZoomInProperty:function(state){zimagedit.rightClickMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__cmenu--zoomIn"],"disabled",state)},cMenuZoomOutProperty:function(state){zimagedit.rightClickMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__cmenu--zoomOut"],"disabled",state)},cMenuSelectallProperty:function(state){zimagedit.rightClickMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__cmenu--selectall"],"disabled",state)},cMenuDeselectallProperty:function(state){zimagedit.rightClickMenu.zmenu("setMenuItemsAttribute",["#zimageeditor__cmenu--deselectall"],"disabled",state)},pasteElements:function(){if(zimagedit.isElementCopied===!0){zimagedit.removeBorderFocus(),zimagedit.removePlusAttributes(),zimagedit.removeShadowForMarker(),zimagedit.removeBorderForNumbering();for(var i=0;i<zimagedit._copiedObjects.length;i++){zimagedit.copied_Elements=zimagedit._copiedObjects[i],zimagedit.copied_Elements=zimagedit.copied_Elements.substr(1),zimagedit._idSelected=zimagedit.copied_Elements;var value,id,element=zimagedit.getValuesOfObject("#"+zimagedit.copied_Elements),randomNum=Math.round(1e7*Math.random());if("textarea"===element.tool){var top,left,width,height,fobject=$("#"+zimagedit.copied_Elements+"--fobject");top=parseFloat(fobject.attr("y")),left=parseFloat(fobject.attr("x")),width=parseFloat(fobject.attr("width")),height=parseFloat(fobject.attr("height")),top+=10,left+=10,value=$("#"+zimagedit.copied_Elements).val();var lastColor=element.borderColor,lastFontSize=$("#"+zimagedit.copied_Elements).css("font-size");zimagedit.createTextarea(top+10,left+10,width,height,"zimageedit__shapes--"+randomNum),zimagedit.textareaSelected=!0,$("#"+zimagedit.textID).val(value),$("#"+zimagedit.textID).blur(),$("#"+zimagedit.textID).css({"font-size":lastFontSize,color:lastColor}),$("#"+zimagedit.textID).attr("class",$("#"+zimagedit.copied_Elements).attr("class")),zimagedit.drawBorder("textarea",top+10,left+10,width,height,"1"),zimagedit.resetMultiSelect(),zimagedit._idSelected=zimagedit.copied_Elements="zimageedit__shapes--"+randomNum}else if("line"===element.tool){id="zimageedit__shapes--"+randomNum,$("#"+zimagedit.copied_Elements).parent().clone().attr("id",id+"--group").insertBefore("#zimageedit__focus--shape").show(),$("#"+id+"--group").children().eq(0).attr("id",id),$("#"+id+"--group").children().eq(1).attr("id",id+"--line"),$("#"+id+"--group").children().eq(2).attr("id",id+"--line1");var x1,y1,x2,y2,value2;value=$("#"+id).attr("d").split(","),value2=value[0].split(" "),x1=parseFloat(value2[0].substr(1,value2[0].length))+20,y1=parseFloat(value2[1].substr(0,value2[1].length))+20,value2=value[1].split(" "),x2=parseFloat(value2[1].substr(0,value2[1].length))+20,y2=parseFloat(value2[2].substr(0,value2[2].length))+20,value2="M"+x1+" "+y1+", "+x2+" "+y2,$("#"+id).attr("d",value2),zimagedit.changeArrowHeadValues(id+"--line",id),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(id+"--line1",id,!0),zimagedit._idSelected=zimagedit.copied_Elements=id,zimagedit.drawBorder("line",y1,x1,x2,y2),zimagedit.resetMultiSelect()}else if("numbering"===element.tool){$("#"+zimagedit.copied_Elements+"--group").clone().attr("id","zimageedit__shapes--"+randomNum+"--group").insertBefore("#zimageedit__focus--shape");for(var appendValue,len=$("#zimageedit__shapes--"+randomNum+"--group").children().length,loop=0;len>loop;loop++){var lastIndex;id=$("#zimageedit__shapes--"+randomNum+"--group").children().eq(loop).attr("id"),lastIndex=id.lastIndexOf("--"),appendValue=id.slice(lastIndex,id.length);var indexOf=id.indexOf("__shapes--")+10;id=id.slice(0,indexOf)+randomNum+appendValue,$("#zimageedit__shapes--"+randomNum+"--group").children().eq(loop).attr("id",id)}var trans=$("#zimageedit__shapes--"+randomNum+"--path").attr("transform"),temp=trans;temp=temp.slice(temp.indexOf("rotate"),temp.length),trans=trans.slice(10,trans.indexOf(" rotate")-1).split(","),trans[0]=parseFloat(trans[0])+10,trans[1]=parseFloat(trans[1])+10;var translate="translate("+trans[0]+","+trans[1]+") "+temp;zimagedit._idSelected="zimageedit__shapes--"+randomNum,zimagedit.copied_Elements=zimagedit._idSelected,$("#zimageedit__shapes--"+randomNum+"--fobject").children().eq(0).attr("id","zimageedit__shapes--"+randomNum),zimagedit.drawObj(element.tool,zimagedit._idSelected,element.left+10,element.top+10,element.width,element.height,void 0,element.borderColor,element.borderStroke),$("#zimageedit__shapes--"+randomNum+"--path").attr("transform",translate),$("#zimageedit__shapes--"+randomNum+"--path").parent().css("display",""),zimagedit.blurNumberingTool($("#"+zimagedit.copied_Elements),zimagedit.copied_Elements),zimagedit.showBroderForNumbering(trans[0],trans[1],zimagedit._idSelected),zimagedit.multiSelectFlag===!0&&(zimagedit.resetMultiSelect(),zimagedit.multiSelectFlag=!1)}else if(void 0!==element.tool&&"textarea"!==element.tool){$("#"+zimagedit.copied_Elements).clone().attr("id","zimageedit__shapes--"+randomNum).insertBefore("#zimageedit__focus--shape").show(),zimagedit.copied_Elements="zimageedit__shapes--"+randomNum;var object=zimagedit.getValuesOfObject("#"+zimagedit.copied_Elements);if(object.top+=10,object.left+=10,zimagedit._idSelected=zimagedit.copied_Elements,"line"===element.tool)object.top+=5,object.left+=5,object.width+=15,object.height+=15;else if("polyline"===element.tool){var polyline=document.getElementById(zimagedit._idSelected);if(id="zimageedit__shapes--"+randomNum,$("#"+zimagedit.copied_Elements).attr("data-arrowPoly")){var group=document.createElementNS(zimagedit.svgPath,"g");group.setAttribute("id",id+"--group"),$(group).insertBefore("#zimageedit__focus--shape"),$(group).attr("class","zimageedit__move--cursor"),$(polyline).appendTo($(group));var pointsLength=polyline.points.length;for(pointsLength--;pointsLength>=0;pointsLength--)polyline.points[pointsLength].y+=10,polyline.points[pointsLength].x+=10;$("#zimageedit__triangle").clone().attr({id:id+"--line","class":"zimageedit__line"}).css("visibility","visible").appendTo($(group)),zimagedit.changeArrowHeadValues(id+"--line",id)}else{var pointsLength=polyline.points.length;for(pointsLength--;pointsLength>=0;pointsLength--)polyline.points[pointsLength].y+=10,polyline.points[pointsLength].x+=10}zimagedit.removeShadowForMarker(),zimagedit.createShadowForMarker("zimageedit__shapes--"+randomNum)}zimagedit.moveElements(object);var obj={};obj.target={},obj.target.id=zimagedit._idSelected,zimagedit.multiSelectFlag===!0&&(zimagedit.resetMultiSelect(),zimagedit.multiSelectFlag=!1),zimagedit.setPropertiesForSelectedObject(element.tool),zimagedit.elementSelect("#zimageedit__shapes--"+randomNum),zimagedit.checkForPlusDisplay($("#zimageedit__shapes--"+randomNum).attr("class"),obj,"zimageedit__shapes--"+randomNum)}void 0!==element.tool&&(zimagedit._noOfIdSelected.length=0,zimagedit._noOfIdSelected.push("#"+zimagedit._idSelected)),zimagedit._copiedObjects[i]="#"+zimagedit.copied_Elements,zimagedit.drawnElements.push("zimageedit__shapes--"+randomNum),zimagedit.isDraw=!0,zimagedit.pushIntoStack("create")}zimagedit._copiedObjects.length>1&&(zimagedit.undoStack[zimagedit.undoStack.length]=zimagedit._copiedObjects.length,zimagedit.selectAll(!0,zimagedit._copiedObjects))}},moveElements:function(element){if("ellipse"===element.tool)$("#"+zimagedit._idSelected).attr({cx:element.left,cy:element.top,rx:element.width,ry:element.height}),zimagedit.drawBorder("ellipse",element.top-element.height,element.left-element.width,element.width+element.width,element.height+element.height);else if("rectangle"===element.tool||"crop_element"===element.tool){if($("#"+zimagedit._idSelected).attr({x:element.left,y:element.top,width:element.width,height:element.height}),"crop_element"===element.tool&&(zimagedit.cropAreaLock=!0,element.top=element.top<=0?1:element.top,element.left=element.left<=0?0:element.left,element.width+element.left>zimagedit.cropAreaWidth&&(element.left=zimagedit.cropAreaWidth-element.width),element.height+element.top>zimagedit.cropAreaHeight&&(element.top=zimagedit.cropAreaHeight-element.height),element.top=element.top<=0?0:element.top,element.left=element.left<=0?0:element.left,zimagedit.modifyTheCropAreaValues(element.top,element.left,element.width,element.height),$("#zimageedit__crop").attr({x:element.left,y:element.top,width:element.width,height:element.height})),"smudge"===$("#"+zimagedit._idSelected).attr("ctype")){var id=$("#"+zimagedit._idSelected).attr("cid");zimagedit.putValuesIntoCanvas(id,element.left,element.top,element.width,element.height)}zimagedit.drawBorder(element.tool,element.top,element.left,element.width,element.height)}else if("textarea"===element.tool)$("#"+zimagedit._idSelected).is(":focus")||($("#"+zimagedit._idSelected).parent().attr({x:element.left,y:element.top}).css({left:element.left,top:element.top}),zimagedit.isIEBrowser&&$("#"+zimagedit._idSelected).parent().css({left:element.left,top:element.top}),zimagedit.multiSelectFlag===!1&&zimagedit.drawBorder("textarea",element.top,element.left,element.width,element.height));else if("line"===element.tool){var temp_var="M"+element.left+" "+element.top+", "+element.width+" "+element.height;$("#"+zimagedit._idSelected).attr({d:temp_var}),zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line1",zimagedit._idSelected,!0),zimagedit.drawBorder("line",element.top,element.left,element.width,element.height)}},deleteElements:function(e,keypress){if(!$("#zimageeditor textarea").is(":focus")){if(1===zimagedit._noOfIdSelected.length&&-1!==$(zimagedit._noOfIdSelected[0]).attr("class").indexOf("zimageedit__numbering--input")&&$(zimagedit._noOfIdSelected[0]).prop("readOnly")===!1)return;keypress&&e.preventDefault();for(var length_orginal=zimagedit._noOfIdSelected.length,len=length_orginal;len>0;len--){var temp=zimagedit._noOfIdSelected.pop();zimagedit.removeMultiSelectBoundary(temp),zimagedit.multiSelectFlag=!1,temp=temp.substr(1,temp.length),this._idSelected=temp;var elementClass=$("#"+this._idSelected).attr("class"),elementType=zimagedit.typeOfElement(zimagedit._idSelected);elementClass=elementClass.slice(12,elementClass.length),"marker"===elementType||"pencil"===elementType?("pencil"===elementType&&$("#"+this._idSelected).attr("data-arrowPoly")?$("#"+this._idSelected).parent().hide():$("#"+this._idSelected).hide(),zimagedit.removeShadowForMarker()):("rectangle"===elementType||"ellipse"===elementType)&&zimagedit.removePlusAttributes(),"line"===elementType||"textarea"===elementType?$("#"+this._idSelected).parent().hide():-1!==$("#"+this._idSelected).attr("class").indexOf("zimageedit__numbering")?(zimagedit.removeBorderForNumbering(),zimagedit.isIEBrowser&&$("#"+this._idSelected+"--fobject").hide(),parseFloat($("#"+this._idSelected).val())===zimagedit.currentValueForNumbering-1&&(zimagedit.currentValueForNumbering-=1),$("#"+this._idSelected+"--group").hide()):$("#"+this._idSelected).hide(),zimagedit.pushIntoStack("delete")}length_orginal>1&&(zimagedit.undoStack[zimagedit.undoStack.length]=length_orginal),zimagedit.removeBorderFocus(zimagedit._selectedTool)}$("#"+zimagedit._idSelected).is(":focus")===!1&&(zimagedit.removeBorderForNumbering(),zimagedit.hideProperties(),zimagedit._idSelected=void 0)},elementMouseMove:function(e,start){var points,diff_x,diff_y,trans,x,y,element;points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),zimagedit.element_attr[1]+=(points.x-zimagedit.previousX)*zimagedit.zoomScaleValue,zimagedit.element_attr[0]+=(points.y-zimagedit.previousY)*zimagedit.zoomScaleValue,"line"===zimagedit.element_attr[4]&&(zimagedit.element_attr[2]+=points.x-zimagedit.previousX,zimagedit.element_attr[3]+=points.y-zimagedit.previousY),diff_x=points.x-zimagedit.previousX,diff_y=points.y-zimagedit.previousY;var object=zimagedit.getValuesOfObject("#"+zimagedit._idSelected);if(zimagedit.element_attr[4]=object.tool,"polyline"===object.tool||"ellipse"===object.tool)if(x=points.x-start[0],y=points.y-start[1],trans="translate("+x+"px,"+y+"px)",element=$("#"+zimagedit._idSelected),"ellipse"===object.tool?$("#"+zimagedit._idSelected).attr({cx:object.left+diff_x,cy:object.top+diff_y}):($(element).css({transform:trans}),(zimagedit._arrowPolyline||$("#"+zimagedit._idSelected).attr("data-arrowPoly"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected,!0)),"polyline"!==object.tool&&zimagedit.multiSelectFlag===!1)zimagedit.drawBorder(object.tool,object.top+diff_y-object.height,object.left+diff_x-object.width,2*object.width,2*object.height);else if(zimagedit.multiSelectFlag===!1)$("#"+zimagedit._idSelected+"--shadow, #"+zimagedit._idSelected+"--shadowblack").css({transform:trans});else{if("ellipse"===object.tool)object.top=object.top-object.height+diff_y-2,object.left=object.left-object.width+diff_x-2,object.width+=object.width+4,object.height+=object.height+4;else{var val=$("#"+zimagedit._idSelected)[0].getBBox();object.top=val.y+y,object.left=val.x+x}zimagedit.setBoundaryValuesMultiSelect("#"+zimagedit._idSelected,object.top,object.left,object.width,object.height,object)}else if("textarea"===object.tool)x=parseFloat($("#"+zimagedit._idSelected).parent().attr("x")),y=parseFloat($("#"+zimagedit._idSelected).parent().attr("y")),$("#"+zimagedit._idSelected).parent().attr({x:x+diff_x,y:y+diff_y}),zimagedit.isIEBrowser&&$("#"+zimagedit._idSelected).parent().css({left:x+diff_x+110,top:y+diff_y+80}),zimagedit.multiSelectFlag===!1?zimagedit.drawBorder(object.tool,y+diff_y,x+diff_x,object.width,object.height):zimagedit.setBoundaryValuesMultiSelect("#"+zimagedit._idSelected,y+diff_y,x+diff_x,object.width,object.height,object);else if("rectangle"===object.tool)x=parseFloat($("#"+zimagedit._idSelected).attr("x")),y=parseFloat($("#"+zimagedit._idSelected).attr("y")),$("#"+zimagedit._idSelected).attr({x:x+diff_x,y:y+diff_y}),zimagedit.multiSelectFlag===!1?zimagedit.drawBorder(object.tool,object.top+diff_y,object.left+diff_x,object.width,object.height):zimagedit.setBoundaryValuesMultiSelect("#"+zimagedit._idSelected,y+diff_y-2,x+diff_x-2,object.width+4,object.height+4,object);else if("numbering"===object.tool)zimagedit.moveNumbering(diff_x,diff_y);else if("line"===object.tool)if(object.top+=diff_y,object.height+=diff_y,object.left+=diff_x,object.width+=diff_x,$("#"+zimagedit._idSelected).attr("d","M"+object.left+" "+object.top+", "+object.width+" "+object.height),zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line",zimagedit._idSelected),(zimagedit._doubleArrow||$("#"+zimagedit._idSelected+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(zimagedit._idSelected+"--line1",zimagedit._idSelected,!0),zimagedit.multiSelectFlag===!0){var id=document.getElementById(zimagedit._idSelected+"--group"),boundingBoxValue=id.getBBox();br_w=parseFloat($("#"+zimagedit._idSelected).css("stroke-width")),xr=boundingBoxValue.width+br_w/2,yr=boundingBoxValue.height+br_w/2,points.y=boundingBoxValue.y*id.getScreenCTM().a,points.x=boundingBoxValue.x*id.getScreenCTM().a,zimagedit.setBoundaryValuesMultiSelect("#"+zimagedit._idSelected,points.y,points.x,xr,yr,object)}else zimagedit.drawBorder("line",object.top,object.left,object.width,object.height);else zimagedit.previousX-points.x!=0&&(object.left+=points.x-zimagedit.previousX),zimagedit.previousY-points.y!=0&&(object.top+=points.y-zimagedit.previousY),zimagedit.moveElements(object,e)},moveNumbering:function(diff_x,diff_y){var top,left,type;if(type=$("#"+zimagedit._idSelected).attr("type-contains"),top=parseFloat($("#"+zimagedit._idSelected+"--fobject").attr("y")),left=parseFloat($("#"+zimagedit._idSelected+"--fobject").attr("x")),$("#"+zimagedit._idSelected+"--fobject").attr({y:top+diff_y,x:left+diff_x}),zimagedit.isIEBrowser&&$("#"+zimagedit._idSelected+"--fobject").css({top:top+diff_y+80,left:left+diff_x+110}),"wrong"===type){var x1,y1,x2,y2;element=$("#"+zimagedit._idSelected+"--wrong1"),x1=parseFloat(element.attr("x1")),y1=parseFloat(element.attr("y1")),y2=parseFloat(element.attr("y2")),x2=parseFloat(element.attr("x2")),element.attr({x1:x1+diff_x,y1:y1+diff_y,x2:x2+diff_x,y2:y2+diff_y}),$("#"+zimagedit._idSelected+"--wrong2").attr({x2:x1+diff_x,y1:y1+diff_y,x1:x2+diff_x,y2:y2+diff_y})}else if("tick"===type){var final_value;element=$("#"+zimagedit._idSelected+"--tick"),points=element.attr("points").split(","),final_value=parseFloat(parseFloat(points[0])+diff_x),temp=points[1].split(" "),final_value=final_value+","+parseFloat(parseFloat(temp[0])+diff_y)+" ",final_value+=parseFloat(parseFloat(temp[1])+diff_x),temp=points[2].split(" "),final_value=final_value+","+parseFloat(parseFloat(temp[0])+diff_y),final_value+=" "+parseFloat(parseFloat(temp[1])+diff_x),final_value+=","+parseFloat(parseFloat(points[3])+diff_y),element.attr("points",final_value)}else if("question"===type){var translate_x,translate_y;element=$("#"+zimagedit._idSelected+"--question1"),temp=element.attr("transform"),temp=temp.substr(10,temp.length).split(zimagedit.isIEBrowser===!1?",":" "),translate_x=parseFloat(temp[0])+diff_x,translate_y=parseFloat(temp[1])+diff_y,element.attr("transform","translate("+translate_x+","+translate_y+")"),element=$("#"+zimagedit._idSelected+"--question2"),translate_x=parseFloat(element.attr("cx")),translate_y=parseFloat(element.attr("cy")),$("#"+zimagedit._idSelected+"--question3, #"+zimagedit._idSelected+"--question2").attr({cx:translate_x+diff_x,cy:translate_y+diff_y})}var element=$("#"+zimagedit._idSelected+"--circle");top=parseFloat(element.attr("cy")),left=parseFloat(element.attr("cx")),element.attr({cx:left+diff_x,cy:top+diff_y}),trans=$("#"+zimagedit._idSelected+"--path").attr("transform"),trans=trans.match(/[+-]?\d+(\.\d+)?/g),trans[0]=parseFloat(trans[0])+diff_x,trans[1]=parseFloat(trans[1])+diff_y;var resultantTransform="translate("+trans[0]+","+trans[1]+") rotate("+trans[2]+" "+trans[3]+" "+trans[4]+")";$("#"+zimagedit._idSelected+"--path").attr("transform",resultantTransform),zimagedit.multiSelectFlag===!1?zimagedit.updateBorderForNumbering(left+diff_x,top+diff_y,32,zimagedit._idSelected):zimagedit.setBoundaryValuesMultiSelect("#"+zimagedit._idSelected,top+diff_y-24,left+diff_x-24,50,50,zimagedit.getValuesOfObject("#"+zimagedit._idSelected))},smoothenPolylLine:function(){},setValuesFromTranslate:function(){var transx,transy,id,elementClass=$("#"+zimagedit._idSelected).attr("class");if(id=document.getElementById(zimagedit._idSelected),-1==elementClass.indexOf("zimageedit__textarea")){var str=document.getElementById(zimagedit._idSelected).style.transform;void 0!==str&&"none"!==str&&(str=str.split("(")[1].split(")")[0].split(","),transx=parseFloat(str[0]),transy=parseFloat(str[1]))}if(("number"!=typeof transx||"number"!=typeof transy)&&(transy=transx=0),-1!==elementClass.indexOf("zimageedit__polyline")||-1!==elementClass.indexOf("zimageedit__marker")){id=document.getElementById(zimagedit._idSelected);var length=Object.keys(id.points).length;for(void 0!==id.points.numberOfItems&&(length=id.points.numberOfItems),$("#"+zimagedit._idSelected).css("transform","none"),--length;length>=0;length--){var temp2=id.points.getItem(length);temp2.x+=transx,temp2.y+=transy}}zimagedit.createShadowForMarker(zimagedit._idSelected);var previousElement=$("#"+zimagedit._idSelected).prev();$("#"+zimagedit._idSelected).insertAfter(previousElement)},borders:function(){var returnedElement=zimagedit.initObjects("rect","2",void 0,void 0,"borderRect");zimagedit.focusElementRectWhite=$(returnedElement);var returnedElement=zimagedit.initObjects("rect","1",void 0,void 0,"borderRect");zimagedit.focusElementRectBlack=$(returnedElement),zimagedit.initObjects("polyline","zimageedit__active--text--leftWhite",zimagedit.textareaBorderWidth,1),zimagedit.initObjects("polyline","zimageedit__active--text--rightWhite",zimagedit.textareaBorderWidth,1),zimagedit.initObjects("polyline","zimageedit__active--text--left",zimagedit.textareaBorderWidth),zimagedit.initObjects("polyline","zimageedit__active--text--right",zimagedit.textareaBorderWidth),zimagedit.initObjects("rect","zimageedit__active--r1c2",12,4),zimagedit.initObjects("rect","zimageedit__active--r2c1",4,12),zimagedit.initObjects("rect","zimageedit__active--r2c3",4,12),zimagedit.initObjects("rect","zimageedit__active--r3c2",12,4),zimagedit.initObjects("rect","zimageedit__active--r1c1",8,8),zimagedit.initObjects("rect","zimageedit__active--r1c3",8,8),zimagedit.initObjects("rect","zimageedit__active--r3c1",8,8),zimagedit.initObjects("rect","zimageedit__active--r3c3",8,8),zimagedit.initObjects("circle","zimageedit__active--c1c1",5,4),zimagedit.initObjects("circle","zimageedit__active--c1c2",5,4)},initObjects:function(obj,cls,width,height,type){var element=document.createElementNS(zimagedit.svgPath,obj),mobileDevice=zimagedit.isMobileBrowser();if("borderRect"===type)element=document.createElementNS(zimagedit.svgPath,"rect"),zimagedit.setAttributeForObj(element,["stroke","white","fill","none","stroke-width",2,"id","zimageedit__focus--shape","class","zimageedit__focus--shape"]),"1"===cls&&zimagedit.setAttributeForObj(element,["stroke","black","stroke-dasharray","4,4"]);else if("rect"===obj)zimagedit.setAttributeForObj(element,["fill","none","width",width,"height",height,"stroke","black","fill","white","class","zimageedit__active--shape "+cls,"stroke-width",1.4]),mobileDevice&&(width===height?element.setAttribute("class","zimageedit__active--shape "+cls+" resize--cornerpoints"):element.setAttribute("class","zimageedit__active--shape "+cls+" resize--centerpoints"));else if("polyline"===obj){var color="black",fill="transparent";1===height&&(color="white",width=zimagedit.textareaBorderWidth+3),zimagedit.setAttributeForObj(element,["fill",fill,"stroke-width",width,"stroke",color,"class","zimageedit__active--shape "+cls])}else"circle"===obj&&(zimagedit.setAttributeForObj(element,["fill","none","r",width,"stroke-width",height,"stroke","#2acf7a","fill","white","class","zimageedit__active--shape "+cls]),mobileDevice&&element.setAttribute("class","zimageedit__active--shape "+cls+" resize--arrowpoints"));return zimagedit.editorSVG.appendChild(element),$(element)},setAttributeForObj:function(obj,arr){for(var len=arr.length,loop=0;len>loop;loop+=2)obj.setAttribute(arr[loop],arr[loop+1])},isMobileBrowser:function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1},pushIntoStack:function(action,flag){if(void 0===this._idSelected)return 0;$("#zimageeditor .zimageeditor__cancel").attr("disabled",!1);var length=zimagedit.undoStack.length,obj={},object=zimagedit.getValuesOfObject("#"+this._idSelected);if("number"==typeof action&&zimagedit.undoStack.push(action),isNaN(object.left)!==!0&&this.isDraw===!0&&"delete"!==action&&"number"!=typeof action){if(obj.action=action,obj.idSelected=this._idSelected,obj.object=object.tool,"polyline"===object.tool){var temp_var=document.getElementById(this._idSelected);obj.x1=temp_var.getAttribute("points")}else obj.x1=object.left;if(obj.y1=object.top,obj.x2=object.width,obj.y2=object.height,obj.fill=object.fill,obj.brc=object.borderColor,obj.brs=object.borderStroke,obj.brw=object.borderWidth,obj.fillOpacity=object.fillOpacity,obj.strokeOpacity=object.strokeOpacity,"zimageedit__crop"===obj.idSelected){var percentage;percentage="none"===zimagedit._imageCanvas.css("display")?parseFloat(zimagedit._imageCanvas.attr("width"))/parseFloat(zimagedit._imageCanvas.css("width")):parseFloat(zimagedit._imageCropCanvas.attr("width"))/parseFloat(zimagedit._imageCropCanvas.css("width")),obj.percentage=percentage,obj.crop_create=0===zimagedit.cropCaptureCount?!0:!1,obj.crop_create===!0?zimagedit.cropAreaCanvasPosition=[obj.x1,obj.y1,obj.x2,obj.y2,parseFloat(zimagedit._imageCanvas.attr("width"))/parseFloat(zimagedit._imageCanvas.css("width"))]:1===flag&&(zimagedit.cropAreaCanvasPosition=[zimagedit.cropAreaCanvasPosition[0]+obj.x1,zimagedit.cropAreaCanvasPosition[1]+obj.y1,obj.x2,obj.y2,parseFloat(zimagedit._imageCropCanvas.attr("width"))/parseFloat(zimagedit._imageCropCanvas.css("width"))]),obj.canvasPosition=[zimagedit.cropAreaCanvasPosition[0],zimagedit.cropAreaCanvasPosition[1],zimagedit.cropAreaCanvasPosition[2],zimagedit.cropAreaCanvasPosition[3],zimagedit.cropAreaCanvasPosition[4]],obj.zoomValue=zimagedit.fitToWidthZoomValue,obj.cropCount=zimagedit.cropCaptureCount,zimagedit.cropCreated=!0}"resize"!==obj.action&&"zimageedit__crop"===obj.idSelected?zimagedit.undoStack[length]=obj:"zimageedit__crop"!==obj.idSelected&&(zimagedit.undoStack[length]=obj),JSON.stringify(zimagedit.undoStack[length])===JSON.stringify(zimagedit.undoStack[length-1])&&"zimageedit__crop"!==zimagedit.undoStack[length].idSelected&&"zimageedit__crop"!==zimagedit.undoStack[length-1].idSelected&&zimagedit.undoStack.pop()}if("delete"===action&&void 0!==this._idSelected&&(obj.action=action,obj.idSelected=this._idSelected,obj.object=object.tool,obj.x1=object.left,obj.y1=object.top,obj.x2=object.width,obj.y2=object.height,obj.fill=object.fill,obj.brc=object.borderColor,obj.brs=object.borderStroke,obj.brw=object.borderWidth,obj.fillOpacity=object.fillOpacity,obj.strokeOpacity=object.strokeOpacity,zimagedit.undoStack[length]=obj,zimagedit.undoStack[length]===zimagedit.undoStack[length-1]&&zimagedit.undoStack.pop()),length=zimagedit.redoStack.length,length>0)for(length--;length>=0;length--)delete zimagedit.redoStack[length]},pushIntoUndoStack:function(action){action&&zimagedit.undoStack.push(action)},pushIntoTempStack:function(id,pos){if("zimageedit__crop"===id)return 0;0>=pos&&(pos=0);var objectValues=zimagedit.getValuesOfObject("#"+this._idSelected),obj={action:"resize",idSelected:this._idSelected,object:objectValues.tool};if("polyline"===objectValues.tool){var element=document.getElementById(this._idSelected);obj.x1=element.getAttribute("points")}else obj.x1=objectValues.left;obj.y1=objectValues.top,obj.x2=objectValues.width,obj.y2=objectValues.height,obj.fill=objectValues.fill,obj.brc=objectValues.borderColor,obj.brs=objectValues.borderStroke,obj.brw=objectValues.borderWidth,obj.fillOpacity=objectValues.fillOpacity,obj.strokeOpacity=objectValues.strokeOpacity,zimagedit.tempStack[pos]=obj},copyFromTempToUndoStack:function(){var loop,tempStackLength=zimagedit.tempStack.length;for(loop=0;tempStackLength>loop;loop++)zimagedit.pushIntoUndoStack(zimagedit.tempStack[loop]);tempStackLength>2&&(zimagedit.undoStack[zimagedit.undoStack.length]=tempStackLength/2),zimagedit.tempStack.length=0},pushIntoRedoStack:function(values){zimagedit.redoStack.push(values)},undoFunc:function(){zimagedit.removeBorderFocus(),zimagedit.removeBorderForNumbering(),zimagedit.removeShadowForMarker(),zimagedit.hideProperties(),zimagedit.removePlusAttributes(),zimagedit.removeMultiSelectBoundary(),zimagedit.multiSelectFlag=!1;var undoStackSize,temp1,temp2,temp;if(undoStackSize=zimagedit.undoStack.length,undoStackSize=1>=undoStackSize?undoStackSize:undoStackSize-1,undoStackSize>0){temp1=zimagedit.undoStack[undoStackSize];var temp4,loop=1;for("number"==typeof temp1&&(loop=temp1,zimagedit.undoStack.pop()),temp4=loop,loop;loop>0;loop--){temp1=zimagedit.undoStack.pop(),"blur"===temp1.idSelected.substr(0,4)&&(zimagedit.smudgeStackPosition-=1,zimagedit.redrawCanvas(temp1.idSelected,"undo")),zimagedit.pushIntoRedoStack(temp1);var action=temp1.action;if("create"===action){var object=temp1.object;temp2=temp1.idSelected,temp=$("#"+temp2),void 0!==object&&"canvasDraw"===object&&(zimagedit.canvasBlurEditUndoRedo(temp1),zimagedit.blurPositionLength--);var classs=$(temp).attr("class");if(void 0!==classs&&"zimageedit__numbering--input"===classs.substr(0,28)){$("#"+temp2+"--group").hide();var numberingValue=$("#"+temp2).val();numberingValue==zimagedit.currentValueForNumbering-1&&(zimagedit.currentValueForNumbering-=1),zimagedit.isIEBrowser&&$("#"+temp2+"--fobject").toggle()}else void 0!==classs&&-1!=classs.indexOf("zimageedit__line")?$("#"+temp2+"--group").hide():void 0!==classs&&-1!=classs.indexOf("zimageedit__textarea")?$("#"+temp2+"--fobject").hide():void 0!==classs&&-1!=classs.indexOf("zimageedit__polyline")&&temp.attr("data-arrowPoly")?temp.parent().hide():temp.hide();if("zimageedit__crop"===temp1.idSelected&&(zimagedit.removeCssFromCrop(),temp1=zimagedit.undoStack.pop(),void 0!==temp1&&"zimageedit__crop"===temp1.idSelected))if(zimagedit.isImageCropped=!1,zimagedit.cropCaptureCount--,zimagedit.pushIntoRedoStack(temp1),temp1.crop_create===!0){zimagedit._imageCanvas.css("display","inherit"),zimagedit._imageCropCanvas.css("display","none");var width=parseFloat(zimagedit._imageCanvas.attr("width")),height=parseFloat(zimagedit._imageCanvas.attr("height"));width>$(window).width()-220&&(width=$(window).width()-220),height>$(window).height()-150&&(height=$(window).height()-150);var ratio=Math.min(width/zimagedit._imageWidth,height/zimagedit._imageHeight);width=zimagedit._imageWidth*ratio,height=zimagedit._imageHeight*ratio,zimagedit.SVGElement.attr({width:width*zimagedit.fitToWidthZoomValue/100,height:height*zimagedit.fitToWidthZoomValue/100}),zimagedit._imageCanvas.css({width:width*zimagedit.fitToWidthZoomValue/100,height:height*zimagedit.fitToWidthZoomValue/100}),zimagedit.finalCropPosition=[0,0,0,0,0],zimagedit.editorSVG.setAttribute("viewBox","0 0 "+width+" "+height),zimagedit.placeCropAreaInCenter(0,0,zimagedit.actualWidth,zimagedit.actualHeight),zimagedit.removeCssFromCrop(),zimagedit.cropAreaCanvasPosition=[0,0],zimagedit.zoomFunction(zimagedit.currentZoomValue)}else zimagedit.extractValuesdForCropFromStack(temp1,"undo")}else if("resize"===action)temp2=zimagedit.undoStack.pop(),void 0!==temp2&&(action===temp2.action&&temp1.idSelected===temp2.idSelected?(zimagedit.pushIntoRedoStack(temp2),temp1=temp2):zimagedit.pushIntoUndoStack(temp2)),zimagedit.extractValuesFromUndoStack(temp1);else if("delete"===action){temp2=temp1.idSelected;var typeOfObject=zimagedit.typeOfElement(temp2);"line"===typeOfObject||"textarea"===typeOfObject?$("#"+temp2).parent().toggle():($("#"+temp2).toggle(),temp=$("#"+temp2),"pencil"===typeOfObject&&temp.attr("data-arrowPoly")&&temp.parent().toggle(),"numbering"===typeOfObject&&(zimagedit.isIEBrowser===!0&&$("#"+temp2+"--fobject").toggle(),$("#"+temp2+"--group").toggle(),$("#"+temp2).toggle()))}}temp4>1&&zimagedit.pushIntoRedoStack(temp4)}},redrawCanvas:function(value,action){var loop2,check,element,img,loop1=0;check=parseInt(value.substr(5,value.length)),element="none"===zimagedit._imageCanvas.css("display")?document.getElementById("zimageditCropCanvas"):zimagedit.mainCanvas;var ctx=element.getContext("2d");"redo"===action?check+=1:img=document.getElementById(zimagedit.inputImageId),loop1=check;var percentage=zimagedit.smudgeStack[loop1][0],currentPercentage=zimagedit._imageWidth/zimagedit.actualWidth;for("none"===zimagedit._imageCanvas.css("display")&&(viewBox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/),currentPercentage=parseFloat(zimagedit._imageCropCanvas.attr("width"))/parseFloat(zimagedit._imageCropCanvas.css("width"))),loop2=1;loop2<=zimagedit.smudgeStack[loop1].length-2;loop2+=2){var posx,posy;posx=parseInt(zimagedit.smudgeStack[loop1][loop2]),posy=parseInt(zimagedit.smudgeStack[loop1][loop2+1]),ctx.drawImage(img,posx+zimagedit.finalCropPosition[0]*zimagedit.finalCropPosition[4],posy+zimagedit.finalCropPosition[1]*zimagedit.finalCropPosition[4],zimagedit.smudgeBrushSize*percentage,zimagedit.smudgeBrushSize*percentage,posx,posy,zimagedit.smudgeBrushSize*percentage,zimagedit.smudgeBrushSize*percentage)}},changeOpacity:function(type,value){$("#zimageeditor__colorpalatte--menu .zimageeditor__opacity span").css("opacity",value);var len=zimagedit._noOfIdSelected.length;for(len--;len>=0;len--){var temp=zimagedit._noOfIdSelected[len];temp=temp.substr(1,temp.length),this._idSelected=temp,temp=$("#"+temp);var clss=zimagedit.typeOfElement(zimagedit._idSelected);"fill"!==type||"ellipse"!==clss&&"rectangle"!==clss?"stroke"===type&&("numbering"!==clss&&temp.attr({"stroke-opacity":value}),"line"===clss&&($("#"+this._idSelected+"--line").attr({"fill-opacity":value,"stroke-opacity":value}),$("#"+this._idSelected+"--line1").attr({"fill-opacity":value,"stroke-opacity":value})),"pencil"===clss&&(zimagedit._arrowPolyline||$("#"+this._idSelected).attr("data-arrowPoly"))&&$("#"+this._idSelected+"--line").attr({"fill-opacity":value,"stroke-opacity":value})):temp.attr({"fill-opacity":value}),zimagedit.isDraw=!1}},changeFillColor:function(color){"none"!==color&&(color="#"+color),zimagedit.changeIconColorProperties(color,void 0);var len=zimagedit._noOfIdSelected.length-1;for(zimagedit.isDraw=!0,zimagedit.previousFillColor=color,len;len>=0;len--){zimagedit.previousFillColor=color;var temp=zimagedit._noOfIdSelected[len];temp=temp.substr(1,temp.length),this._idSelected=temp,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len),temp=$("#"+temp);var clss=temp.attr("class").slice(12,temp.attr("class").length);"textarea"!==clss&&"line"!==clss&&"marker"!==clss&&"polyline"!==clss&&$("#"+this._idSelected).attr("fill",color),zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len+1)}zimagedit.copyFromTempToUndoStack(),zimagedit.isDraw=!1},canvasBlurEditUndoRedo:function(obj){var orginalPercentage,currentPercentage;orginalPercentage=obj.brw,currentPercentage=zimagedit._imageWidth/zimagedit.actualWidth;var tleft,ttop,twidth,theight,ele=$("#"+obj.idSelected);tleft=parseFloat($(ele).css("left")),ttop=parseFloat($(ele).css("top")),twidth=parseFloat($(ele).attr("width")),theight=parseFloat($(ele).attr("height")),$("#"+obj.idSelected).clone().attr("id","zimageedit__canvasBlur--temp").appendTo("#zimageeditor__image");var canvas=zimagedit.mainCanvas;"none"===zimagedit._imageCanvas.css("display")&&(canvas=document.getElementById("zimageditCropCanvas"));var targetCanvas=document.getElementById(obj.idSelected),tempCanvas=document.getElementById("zimageedit__canvasBlur--temp"),ctxCanvas=canvas.getContext("2d"),ctxTargetCanvas=targetCanvas.getContext("2d"),ctxTempCanvas=tempCanvas.getContext("2d");ctxTempCanvas.drawImage(canvas,tleft,ttop,twidth,theight,0,0,twidth,theight),ctxCanvas.drawImage(targetCanvas,tleft,ttop,twidth,theight),ctxTargetCanvas.drawImage(tempCanvas,0,0,twidth,theight),$("#zimageedit__canvasBlur--temp").remove()},changeBorderColor:function(color){color="none"!==color?"#"+color:"transparent",zimagedit.changeIconColorProperties(void 0,color),zimagedit.previousBorderColor=color;var len=zimagedit._noOfIdSelected.length-1;for(len;len>=0;len--){var temp=zimagedit._noOfIdSelected[len];temp=temp.substr(1,temp.length),this._idSelected=temp,zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len),temp=$("#"+temp);var clss=temp.attr("class");$("#zimageedit__triangle").attr("stroke",color).attr("fill",color),$("#zimageedit__triangle1").attr("stroke",color).attr("fill",color),-1!=clss.indexOf("zimageedit__line")&&($("#"+this._idSelected+"--line").attr("stroke",color).attr("fill",color),$("#"+this._idSelected+"--line1").attr("stroke",color).attr("fill",color)),-1!=clss.indexOf("zimageedit__polyline")&&$("#"+this._idSelected+"--line").attr("stroke",color).attr("fill",color),"zimageedit__numbering--input zimageedit__numbering"===clss&&"numbering"===$("#"+zimagedit._idSelected).attr("type-contains")?(zimagedit.previousNumberingColor=color,$("#"+this._idSelected+"--circle, #"+this._idSelected+"--path").attr("stroke",color),$("#"+this._idSelected+"--path").attr("fill",color)):zimagedit.previousBorderColor=color,clss=clss.slice(11,clss.length),"textarea"!==clss&&$("#"+this._idSelected).attr("stroke",color),clss=clss.slice(8,clss.length),zimagedit.pushIntoTempStack(zimagedit._idSelected,2*len+1)}zimagedit.copyFromTempToUndoStack()},extractValuesdForCropFromStack:function(temp1,caller){zimagedit.isImageCropped=!0;var x,y,width,height,zoomValue,percentage;zoomValue=temp1.zoomValue;var ratio=temp1.percentage;percentage=zimagedit.fitToWidthZoomValue/zoomValue,ratio=zimagedit.fitToWidthZoomValue/zoomValue,x=Math.abs(temp1.x1)*percentage,y=Math.abs(temp1.y1)*percentage,width=temp1.x2*percentage,height=temp1.y2*percentage,zimagedit._crop_arr=[x,y,width,height];var positionX1,positionY1,positionX2,positionY2,cropElement=document.getElementById("zimageditCropCanvas"),orginalCanvas=zimagedit.mainCanvas,cropElementCtx=cropElement.getContext("2d");positionX1=temp1.canvasPosition[0]*temp1.canvasPosition[4],positionY1=temp1.canvasPosition[1]*temp1.canvasPosition[4],positionX2=temp1.canvasPosition[2]*temp1.canvasPosition[4],positionY2=temp1.canvasPosition[3]*temp1.canvasPosition[4],zimagedit.updateFinalCropPosition(temp1.canvasPosition[0],temp1.canvasPosition[1],temp1.canvasPosition[2],temp1.canvasPosition[3],temp1.canvasPosition[4]),zimagedit._imageCropCanvas.attr({width:positionX2,height:positionY2}).css({display:"block",width:positionX2/temp1.canvasPosition[4]*ratio,height:positionY2/temp1.canvasPosition[4]*ratio}),"redo"===caller?(zimagedit.cropAreaCanvasPosition=[temp1.canvasPosition[0],temp1.canvasPosition[1],temp1.canvasPosition[2],temp1.canvasPosition[3]],cropElementCtx.drawImage(orginalCanvas,positionX1,positionY1,positionX2,positionY2,0,0,positionX2,positionY2),zimagedit._imageCanvas.css("display","none")):"undo"===caller&&(cropElementCtx.drawImage(orginalCanvas,positionX1,positionY1,positionX2,positionY2,0,0,positionX2,positionY2),zimagedit._imageCanvas.css("display","none")),zimagedit.SVGElement.attr({width:positionX2/temp1.canvasPosition[4]*ratio,height:positionY2/temp1.canvasPosition[4]*ratio}),$("#zimageedit__crop--tempElement").remove(),zimagedit.placeCropAreaInCenter(y-85,x-100,width-110,height-85),zimagedit.editorSVG.setAttribute("viewBox",x+" "+y+" "+width+" "+height),zimagedit.zoomFunction(zimagedit.currentZoomValue)},redoFunc:function(){zimagedit.removeBorderFocus(),zimagedit.removeBorderForNumbering(),zimagedit.removeShadowForMarker(),zimagedit.hideProperties(),zimagedit.removePlusAttributes(),zimagedit.removeMultiSelectBoundary();var temp1,temp2,temp,redoStackSize=zimagedit.redoStack.length;if(redoStackSize=1>=redoStackSize?redoStackSize:redoStackSize-1,redoStackSize>0){var temp4,loop=1;for(temp1=zimagedit.redoStack[redoStackSize],"number"==typeof temp1&&(loop=temp1,zimagedit.redoStack.pop()),temp4=loop,loop;loop>0;loop--)if(temp1=zimagedit.redoStack.pop(),void 0!==temp1){var action=temp1.action;if(zimagedit.pushIntoUndoStack(temp1),"create"===action){"canvasDraw"===temp1.object&&zimagedit.canvasBlurEditUndoRedo(temp1),temp2=zimagedit.redoStack.pop(),void 0!==temp2&&("resize"===temp2.action&&temp1.idSelected===temp2.idSelected?(zimagedit.pushIntoUndoStack(temp2),temp1=temp2):zimagedit.pushIntoRedoStack(temp2)),temp2=temp1.idSelected,$("#"+temp2).show();var classs=$("#"+temp2).attr("class");if(void 0!==classs&&"zimageedit__numbering--input"===classs.substr(0,28)){$("#"+temp2+"--group").show();var numberingValue=parseInt($("#"+temp2).val());numberingValue===zimagedit.currentValueForNumbering&&(zimagedit.currentValueForNumbering+=1),zimagedit.isIEBrowser&&$("#"+temp2+"--fobject").show()}void 0!==classs&&-1!=classs.indexOf("zimageedit__line")&&$("#"+temp2+"--group").show(),void 0!==classs&&-1!=classs.indexOf("zimageedit__textarea")&&$("#"+temp2+"--fobject").show(),void 0!==classs&&-1!=classs.indexOf("zimageedit__polyline")&&$("#"+temp2).attr("data-arrowPoly")&&$("#"+temp2+"--group").show(),temp=$("#"+temp2),"zimageedit__crop"===temp1.idSelected&&(temp1=zimagedit.redoStack.pop(),zimagedit.pushIntoUndoStack(temp1),void 0!==temp1&&"zimageedit__crop"===temp1.idSelected&&(zimagedit.cropCaptureCount++,zimagedit.extractValuesdForCropFromStack(temp1,"redo")))}else if("resize"===action)temp2=zimagedit.redoStack.pop(),void 0!==temp2&&("resize"===temp2.action&&temp1.idSelected===temp2.idSelected?(zimagedit.pushIntoUndoStack(temp2),temp1=temp2):zimagedit.pushIntoRedoStack(temp2)),temp=temp1,zimagedit.extractValuesFromUndoStack(temp);else if("delete"===action){temp2=temp1.idSelected,temp=$("#"+temp2);var typeOfObject=zimagedit.typeOfElement(temp2);"line"===typeOfObject?$("#"+temp2+"--group").toggle():"textarea"===typeOfObject?$("#"+temp2+"--fobject").toggle():("numbering"===typeOfObject&&(zimagedit.isIEBrowser===!0&&$("#"+temp2+"--fobject").toggle(),$("#"+temp2+"--group").toggle(),$("#"+temp2).toggle()),"pencil"===typeOfObject&&temp.attr("data-arrowPoly")&&temp.parent().toggle(),temp.toggle())}}temp4>1&&zimagedit.pushIntoUndoStack(temp4)}},removeCssFromCrop:function(){zimagedit.cropPosition[0]="none",zimagedit._imageCanvas.css({clip:""}),$("#zimageedit__canvas--blur, #zimageeditor__svgeditor").css({clip:""}),this._canvasContainer.css({clip:""})},extractID:function(id){var typeOfElement=zimagedit.typeOfElement(id);if("line"===typeOfElement||"rectangle"===typeOfElement||"ellipse"===typeOfElement||"pencil"===typeOfElement||"marker"===typeOfElement||"textarea"===typeOfElement||"numbering"===typeOfElement){var numberPattern=/\d+/g;return"zimageedit__shapes--"+id.match(numberPattern)}return id},extractValuesFromUndoStack:function(temp){this.drawObj(temp.object,temp.idSelected,temp.x1,temp.y1,temp.x2,temp.y2,temp.fill,temp.brc,temp.brs,temp.brw,temp.fillOpacity,temp.strokeOpacity)},drawObj:function(obj,id,x1,y1,x2,y2,fill,brc,brs,brw,fillOpacity,strokeOpacity){if(void 0===brs&&(brs="none"),"ellipse"===obj)$("#"+id).attr({cx:x1,cy:y1,rx:x2,ry:y2,fill:fill,stroke:brc,"stroke-width":brw,"stroke-dasharray":brs,"stroke-opacity":strokeOpacity,"fill-opacity":fillOpacity}),zimagedit.previousFillColor=fill,zimagedit.previousBorderColor=brc;else if("rectangle"===obj){$("#"+id).attr({x:x1,y:y1,width:x2,height:y2,fill:fill,stroke:brc,"stroke-width":brw,"stroke-dasharray":brs,"stroke-opacity":strokeOpacity,"fill-opacity":fillOpacity});var ctype=$("#"+id).attr("ctype"),cid=$("#"+id).attr("cid");"smudge"===ctype&&zimagedit.putValuesIntoCanvas(cid,x1,y1,x2,y2)}else if("line"===obj){var value="M"+x1+" "+y1+", "+x2+" "+y2;$("#"+id).attr({d:value,fill:fill,stroke:brc,"stroke-width":brw,"stroke-dasharray":brs,"stroke-opacity":strokeOpacity}),$("#"+id+"--line").attr({fill:brc,stroke:brc,"stroke-width":brw>4?brw-5:brw/4,"stroke-opacity":strokeOpacity,"fill-opacity":strokeOpacity}),$("#"+id+"--line1").attr({fill:brc,stroke:brc,"stroke-width":brw>4?brw-5:brw/4,"stroke-opacity":strokeOpacity,"fill-opacity":strokeOpacity}),zimagedit.changeArrowHeadValues(id+"--line",id),(zimagedit._doubleArrow||$("#"+id+"--line1").attr("data-dlbline"))&&zimagedit.changeArrowHeadValues(id+"--line1",id,!0),zimagedit.previousFillColor=fill,zimagedit.previousBorderColor=brc}else if("textarea"===obj)$("#"+id).css({color:brc,"font-size":brw}).attr("class",fill.shadow).blur(),$("#"+id).parent().attr({x:x1,y:y1,left:x1,top:y1,width:x2,height:y2}).attr({x:x1,y:y1,width:x2,height:y2}),zimagedit.isIEBrowser&&$("#"+id).parent().css({left:x1+110,top:y1+80,width:x2,height:y2}),$("#"+id).val(brs);else if("polyline"===obj){var temp_id=document.getElementById(id);temp_id.setAttribute("points",x1),$("#"+id).attr({fill:fill,stroke:brc,"stroke-width":brw,"stroke-opacity":strokeOpacity}),$(temp_id).attr("data-arrowPoly")&&(zimagedit.changeArrowHeadValues(id+"--line",id),$("#"+id+"--line").attr({fill:brc,stroke:brc,"stroke-width":brw>4?brw-5:brw/4,"stroke-opacity":strokeOpacity,"fill-opacity":brc}))}else if("numbering"===obj){$("#"+id+"--fobject").attr({y:y1+9,x:x1+5}),zimagedit.isIEBrowser&&$("#"+id+"--fobject").css({top:y1+9+80,left:x1+5+110}),$("#"+id+"--path").attr({transform:brc}),$("#"+id+"--circle").attr({cx:x1+21,cy:y1+25});var type=$("#"+id).attr("type-contains");if("numbering"===type)$("#"+id+"--path").attr({fill:brs,stroke:brs}),$("#"+id+"--circle").attr({stroke:brs});else if("wrong"===type)$("#"+id+"--wrong1").attr({x1:x1+16,y1:y1+20,x2:x1+26,y2:y1+30}),$("#"+id+"--wrong2").attr({x1:x1+26,y1:y1+20,x2:x1+16,y2:y1+30});else if("question"===type){var posx,posy;posx=x1+17,posy=y1+18,$("#"+id+"--question1").attr({transform:"translate("+posx+","+posy+")"}),$("#"+id+"--question2, #"+id+"--question3").attr({cx:x1+21,cy:y1+32})}else if("tick"===type){var pointx,pointy;pointx=x1+15,pointy=y1+26.5;var points=""+pointx+","+pointy+" ";pointx+=3.5,pointy+=3.4,points+=+pointx+","+pointy+" ",pointx+=8.5,pointy-=8.4,points=points+pointx+","+pointy,$("#"+id+"--tick").attr({points:points})}}},elementSelect:function(target,check_condtion,color){var element=zimagedit.getValuesOfObject(target);zimagedit.funcForCalc(element),"color_select"===color&&("textarea"===element.tool?(element.borderColor=zimagedit.regtohex_convert(element.fill.border),element.fill=element.fill.bck_color,"rgb"===element.fill.substr(0,3)&&(element.fill="none"),"#000000"===element.borderColor&&(element.borderColor="none")):"numbering"===element.tool&&(element.borderColor=element.borderStroke),zimagedit.strokeWidthSelected=element.borderWidth,zimagedit.strokeDasharraySelected=element.borderStroke,zimagedit.changeIconColorProperties(element.fill,element.borderColor,element.borderStroke,element.borderWidth,element.fillOpacity))},multiSelect:function(target,event){var tval,c=$("#zimageeditor__svgeditor");tval=$(target).hasClass("zimageedit__textarea")?$(target).parent()[0].getBBox():$(target).hasClass("zimageedit__numbering")?$(target).parent().parent()[0].getBBox():$(target)[0].getBBox();var tw=tval.width,th=tval.height,cw=c.width(),ch=c.height(),tl=$(target).offset().left,tp=$(target).offset().top,cl=c.offset().left,cp=c.offset().top;if(!(cl>tl&&cl>tl+tw||cp>tp&&cp>tp+th||tl>cl+cw||tp>cp+ch)){zimagedit.removeBorderFocus(),zimagedit.removeShadowForMarker(),zimagedit.removePlusAttributes();var fillColor,borderColor,length,flag,returnValue,id,type,element;for(element=this.getValuesOfObject(target),length=zimagedit._noOfIdSelected.length,flag=0,length--;length>=0;--length){if(zimagedit._noOfIdSelected[length]===target){flag=1;break}id=zimagedit._noOfIdSelected[length];var property=zimagedit.getValuesOfObject(id);if(returnValue=zimagedit.createBoundary(id),1===returnValue){if(zimagedit.setBoundaryValues(id,property),"polyline"===property.tool){var elementType=zimagedit.typeOfElement(id.substr(1,id.length));"marker"===elementType&&(property.tool="marker")}else"numbering"===property.tool&&(type=$(target).attr("type-contains"));zimagedit.checkPropertiesAvailableForMultiSelect(property.tool,type)}}if(0===flag){zimagedit._noOfIdSelected.push(target),id=target;var properties=zimagedit.getValuesOfObject(id);if(zimagedit.createBoundary(id),zimagedit.setBoundaryValues(id,properties),"polyline"===properties.tool){var elementType=zimagedit.typeOfElement(id.substr(1,id.length));"marker"===elementType&&(properties.tool="marker")}else"numbering"===properties.tool&&(type=$(target).attr("type-contains"));zimagedit.checkPropertiesAvailableForMultiSelect(properties.tool,type)}else{var index=length;zimagedit.removeMultiSelectBoundary(zimagedit._noOfIdSelected[index]),zimagedit._noOfIdSelected.splice(index,1),zimagedit.PropertiesAvailableForMultiSelect=[!0,!0,!0,!0,!0,!0,!0];for(var loop=0;loop<zimagedit._noOfIdSelected.length;loop++){var property=zimagedit.getValuesOfObject(zimagedit._noOfIdSelected[loop]);if("polyline"===property.tool){var elementType=zimagedit.typeOfElement(zimagedit._noOfIdSelected[loop].substr(1,zimagedit._noOfIdSelected[loop].length));"marker"===elementType&&(property.tool="marker")}else"numbering"===property.tool&&(type=$(target).attr("type-contains"));zimagedit.checkPropertiesAvailableForMultiSelect(property.tool,type)}}zimagedit.hideProperties(),zimagedit._noOfIdSelected.length>0&&zimagedit.showProperties(event.target.id,"multiSelect"),1===zimagedit._noOfIdSelected.length&&("textarea"===element.tool?(element.borderColor=zimagedit.regtohex_convert(element.fill.border),element.fill=element.fill.bck_color,"rgb"===element.fill.substr(0,3)&&(element.fill="none"),"#000000"===element.borderColor&&(element.borderColor="none")):"numbering"===element.tool&&(element.borderColor=element.borderStroke),zimagedit.fillIconColor=element.fill,zimagedit.borderIconColor=element.borderColor,zimagedit.strokeWidthSelected=element.borderWidth,zimagedit.strokeDasharraySelected=element.borderStroke,zimagedit.changeIconColorProperties(element.fill,element.borderColor,element.borderStroke,element.borderWidth,element.fillOpacity)),zimagedit._noOfIdSelected.length>1&&("textarea"===element.tool?(element.borderColor=zimagedit.regtohex_convert(element.fill.border),element.fill=element.fill.bck_color,"rgb"===element.fill.substr(0,3)&&(element.fill="none"),"#000000"===element.borderColor&&(element.borderColor="none")):"numbering"===element.tool&&(element.borderColor=element.borderStroke),fillColor=element.fill,zimagedit.fillIconColor!==element.fill&&(fillColor="#7F7F7F",zimagedit.fillIconColor=fillColor),borderColor=element.borderColor,zimagedit.borderIconColor!==element.borderColor&&(borderColor="#7F7F7F",zimagedit.borderIconColor=borderColor),zimagedit.changeIconColorProperties(fillColor,borderColor,element.borderStroke,element.borderWidth,element.fillOpacity),element.borderStroke===zimagedit.strokeDasharraySelected||void 0===element.borderWidth&&"none"===element.borderWidth||$("#zimageeditor__strokewidth--menu").zmenu("uncheckMenuItems")),zimagedit.setPropertiesForSelectedObject()}},selectAll:function(paste,ids){var elements=zimagedit.drawnElements;zimagedit.resetMultiSelect(),zimagedit.removeBorderForNumbering(),zimagedit.removeShadowForMarker(),$("#zimageeditor__svgeditor").children();var elements=$("#zimageedit__focus--shape").prevAll();paste&&(elements=ids);for(var loop=0;loop<elements.length;loop++){if(paste)var extractID=elements[loop],extractID=extractID.substr(1);else var extractID=zimagedit.extractID(elements[loop].id);$("#"+extractID).children()&&$("#"+extractID).children().first().attr("data-arrowPoly")&&(extractID=$("#"+extractID).children().first().attr("id"));var elementType=zimagedit.typeOfElement(extractID);"hidden"!==$("#"+extractID).css("visibility")&&"none"!==$("#"+extractID).css("display")&&void 0!==extractID&&(void 0===$("#"+extractID).attr("class")||-1==$("#"+extractID).attr("class").indexOf("zimageedit__numbering")||"none"!==$("#"+extractID+"--fobject").css("display")&&"none"!==$("#"+extractID+"--group").css("display"))&&("line"!==elementType||"hidden"!==$("#"+extractID+"--group").css("visibility")&&"none"!==$("#"+extractID+"--group").css("display"))&&(zimagedit.multiSelectFlag=!0,zimagedit.multiSelect("#"+extractID,{target:{id:extractID}}))}if(zimagedit.isIEBrowser)for(var loop=0;loop<zimagedit.textareaCreatedElements.length;loop++){var extractID=zimagedit.textareaCreatedElements[loop];"none"!==$("#"+extractID).css("display")&&(zimagedit.multiSelectFlag=!0,zimagedit.multiSelect("#"+extractID,{target:{id:extractID}}))}},createBoundary:function(id){var returnedElement;return $(id+"-MultiSelect").length>0?0:(id=id.substr(1,id.length),returnedElement=zimagedit.initObjects("rect","2",void 0,void 0,"borderRect"),returnedElement.attr({id:id+"-MultiSelect","class":"zimageedit__focus--multiselect"}),returnedElement=zimagedit.initObjects("rect","1",void 0,void 0,"borderRect"),returnedElement.attr({id:id+"-MultiSelect2","class":"zimageedit__focus--multiselect"}),1)},setBoundaryValuesMultiSelect:function(id,top,left,width,height,element){if("line"===element.tool){var parent=document.getElementById(id.substr(1,id.length)+"--group"),val=parent.getBBox();left=val.x-2,top=val.y-2,width=val.width+2,height=val.height+2}else if("polyline"===element.tool){var bw=element.borderWidth;left-=bw/2,top-=bw/2,width+=bw,height+=bw}else if("numbering"===element.tool){var parent=document.getElementById(id.substr(1,id.length)+"--group"),val=parent.getBBox();left=val.x-2,top=val.y-2,width=val.width+4,height=val.height+4}else("rectangle"===element.tool||"ellipse"===element.tool)&&(left-=1,top-=1,width+=2,height+=2);$(""+id+"-MultiSelect ,"+id+"-MultiSelect2").attr({x:left,y:top,width:width,height:height})},removeMultiSelectBoundary:function(id){$(id+"-MultiSelect").remove(),$(id+"-MultiSelect2").remove()},funcForCalc:function(element){var top,left,xr,yr,tool;left=element.left,top=element.top,xr=element.width,yr=element.height,tool=element.tool,"ellipse"===element.tool&&(top-=yr,left-=xr,xr+=xr,yr+=yr),"polyline"!==element.tool&&zimagedit.multiSelectFlag===!1&&"numbering"!==element.tool&&this.drawBorder(tool,top,left,xr,yr),"numbering"!==element.tool&&zimagedit.removeBorderForNumbering()},resetMultiSelect:function(){if(!zimagedit.selectOnDrag.length){var length=zimagedit._noOfIdSelected.length;for(length--;length>=0;length--){var id=zimagedit._noOfIdSelected.pop();zimagedit.removeMultiSelectBoundary(id)}zimagedit.PropertiesAvailableForMultiSelect=[!0,!0,!0,!0,!0,!0,!0]}},checkPropertiesAvailableForMultiSelect:function(object,type){var position;"ellipse"===object?position=0:"rectangle"===object?position=1:"polyline"===object?position=2:"marker"===object?position=3:"numbering"===object?position=4:"line"===object?position=5:"textarea"===object&&(position=6),"numbering"===object&&"numbering"!==type&&(position=3),zimagedit.PropertiesAvailableForMultiSelect[0]&=zimagedit.propertiesOfObjects[position][1],zimagedit.PropertiesAvailableForMultiSelect[1]&=zimagedit.propertiesOfObjects[position][2],zimagedit.PropertiesAvailableForMultiSelect[2]&=zimagedit.propertiesOfObjects[position][3],zimagedit.PropertiesAvailableForMultiSelect[3]&=zimagedit.propertiesOfObjects[position][4],zimagedit.PropertiesAvailableForMultiSelect[4]&=zimagedit.propertiesOfObjects[position][5],zimagedit.PropertiesAvailableForMultiSelect[5]&=zimagedit.propertiesOfObjects[position][6],zimagedit.PropertiesAvailableForMultiSelect[6]&=zimagedit.propertiesOfObjects[position][7]},setBoundaryValues:function(target,element){var top,left,xr,yr,object;if(left=element.left,top=element.top,xr=element.width,yr=element.height,object=element.tool,"ellipse"===object)top=top-yr-element.borderWidth/2,left=left-xr-element.borderWidth/2,xr=xr+xr+element.borderWidth,yr=yr+yr+element.borderWidth;else if("line"===object){var id=document.getElementById(target.substr(1,target.length)+"--group"),boundingBoxValue=id.getBBox();br_w=parseFloat($(target).css("stroke-width")),xr=boundingBoxValue.width+br_w/2,yr=boundingBoxValue.height+br_w/2,top=boundingBoxValue.y*id.getScreenCTM().a,left=boundingBoxValue.x*id.getScreenCTM().a;var d=$(target).attr("d"),regex=/[+-]?\d+(\.\d+)?/g;if(void 0!==d){if(d=d.match(regex).map(function(v){return parseFloat(v)}),left=parseFloat(d[0]),top=parseFloat(d[1]),xr=parseFloat(d[2]),yr=parseFloat(d[3]),left>xr){var temp;temp=xr,xr=left,left=temp}if(top>yr){var temp;temp=yr,yr=top,top=temp}xr-=left,yr-=top,xr+=br_w,yr+=br_w}}else if("numbering"===object)left-=2;else if("rectangle"===object)top-=element.borderWidth/2,left-=element.borderWidth/2,xr+=element.borderWidth,yr+=element.borderWidth;else if("polyline"===object){var val=$(target)[0].getBBox();left=val.x,top=val.y,xr=val.width,yr=val.height}zimagedit.setBoundaryValuesMultiSelect(target,top,left,xr,yr,element)},handleZoomCases:function(value){var width,orginalWidth=zimagedit.orginalCanvasFitToWidth;"none"!==zimagedit._imageCanvas.css("display")?width=zimagedit._imageWidth:(width=parseFloat(zimagedit._imageCropCanvas.attr("width")),orginalWidth=zimagedit.cropImageWidth),zimagedit.previousZoomValue=zimagedit.currentZoomValue,"zoomin"===value&&zimagedit.currentZoomValue<=175?(zimagedit.currentZoomValue<10&&(zimagedit.currentZoomValue=10),zimagedit.currentZoomValue<25?zimagedit.currentZoomValue=25:zimagedit.currentZoomValue<50?zimagedit.currentZoomValue=50:zimagedit.currentZoomValue<75?zimagedit.currentZoomValue=75:zimagedit.currentZoomValue<100?zimagedit.currentZoomValue=100:zimagedit.currentZoomValue<125?zimagedit.currentZoomValue=125:zimagedit.currentZoomValue<150?zimagedit.currentZoomValue=150:zimagedit.currentZoomValue<175&&(zimagedit.currentZoomValue=200)):"zoomout"===value&&zimagedit.currentZoomValue>=10?zimagedit.currentZoomValue<=25?zimagedit.currentZoomValue=10:zimagedit.currentZoomValue<=50?zimagedit.currentZoomValue=25:zimagedit.currentZoomValue<=75?zimagedit.currentZoomValue=50:zimagedit.currentZoomValue<=100?zimagedit.currentZoomValue=75:zimagedit.currentZoomValue<=125?zimagedit.currentZoomValue=100:zimagedit.currentZoomValue<=150?zimagedit.currentZoomValue=125:zimagedit.currentZoomValue<=175?zimagedit.currentZoomValue=150:zimagedit.currentZoomValue<=200&&(zimagedit.currentZoomValue=175):zimagedit.currentZoomValue=value,width*=zimagedit.currentZoomValue/100;var percentage=width/orginalWidth;zimagedit.fitToWidthZoomValue=100*percentage,zimagedit.zoomFunction()},zoomFunction:function(){var zoomedHeight,zoomedWidth,windowWidth,windowHeight,CanvasDisplay,canvasContainer,canvasElement,cropCanvasElement;if(canvasElement=zimagedit._imageCanvas,cropCanvasElement=zimagedit._imageCropCanvas,CanvasDisplay="none"===canvasElement.css("display"),canvasContainer=$("#zimageeditor__image"),CanvasDisplay===!1)zimagedit.actualWidth=zimagedit._imageWidth*(zimagedit.currentZoomValue/100),zimagedit.actualHeight=zimagedit._imageHeight*(zimagedit.currentZoomValue/100),canvasElement.css({width:zimagedit.actualWidth,height:zimagedit.actualHeight});else{var percentage=zimagedit.fitToWidthZoomValue/100;zimagedit.actualWidth=parseFloat(cropCanvasElement.attr("width"))*percentage,zimagedit.actualHeight=parseFloat(cropCanvasElement.attr("height"))*percentage}zoomedWidth=zimagedit.actualWidth,zoomedHeight=zimagedit.actualHeight,windowWidth=$(window).width(),windowHeight=$(window).height();var top=(windowHeight-zoomedHeight)/2,left=(windowWidth-zoomedWidth)/2;zimagedit.addorRemoveTopBand(windowHeight,zoomedHeight),$("#zimageeditor__btns--zoomOut, #zimageeditor__btns--zoomIn").attr("disabled","disabled"),zimagedit.currentZoomValue>10&&$("#zimageeditor__btns--zoomOut").removeAttr("disabled"),zimagedit.currentZoomValue<200&&$("#zimageeditor__btns--zoomIn").removeAttr("disabled"),canvasContainer.css({left:0>left-110?0:left-110,top:0>top-85?0:top-85,width:zoomedWidth,height:zoomedHeight}),CanvasDisplay===!1?canvasElement.css({width:zoomedWidth,height:zoomedHeight}):cropCanvasElement.css({width:zoomedWidth,height:zoomedHeight}),zimagedit.svgContainer.css({left:0>left-110?0:left-110,top:0>top-85?0:top-85,width:zoomedWidth,height:zoomedHeight}),zimagedit.SVGElement.attr({width:zoomedWidth,height:zoomedHeight}),$("#zimageedit__canvas--blur").css({width:zoomedWidth,height:zoomedHeight}),zimagedit._imageTop=top,zimagedit._imageLeft=left,$("#zimageeditor__container").css("overflow","auto");var ele=document.getElementById("zimageeditor__container"),scrollTop=ele.scrollHeight-ele.offsetHeight,scrollLeft=ele.scrollWidth-ele.offsetWidth;scrollTop/=2,scrollLeft/=2,$("#zimageeditor__container").scrollTop(scrollTop).scrollLeft(scrollLeft),zimagedit.changeZoomTextValue(zimagedit.currentZoomValue),zimagedit.cropCreated===!0&&(zimagedit.zoomScaleValue=zimagedit.fitToWidthZoomValue/100,zimagedit.resizeCropBoundaries(Math.round(zoomedWidth),Math.round(zoomedHeight)))},addorRemoveTopBand:function(windowHeight,canvasHeight){canvasHeight>windowHeight-85?$("#zimageeditor .zimageeditor__header").addClass("zimageeditor__header--bgdark"):$("#zimageeditor .zimageeditor__header").removeClass("zimageeditor__header--bgdark")},getValuesOfObject:function(target){zimagedit.valuesOfObject={};var top,left,xr,yr,tool,br_w,br_c,br_s,fill,fillOpacity,strokeOpacity,targetid,clss=$(target).attr("class"),type=$(target).prop("tagName");if((void 0===target||void 0===clss)&&"CANVAS"!==type)return 0;if(clss=clss||"","CANVAS"===type&&(targetid=$(target),top=parseFloat(targetid.css("top")),left=parseFloat(targetid.css("left")),xr=parseFloat(targetid.attr("width")),yr=parseFloat(targetid.attr("height")),tool="canvasDraw",br_w=zimagedit._imageWidth/zimagedit.actualWidth,top-=85,left-=110),-1!=clss.indexOf("zimageedit__rectangle")||"zimageedit__crop"===clss)targetid=$(target),top=parseFloat(targetid.attr("y")),left=parseFloat(targetid.attr("x")),xr=parseFloat(targetid.attr("width")),yr=parseFloat(targetid.attr("height")),br_w=parseFloat(targetid.attr("stroke-width")),br_c=targetid.attr("stroke"),strokeOpacity=targetid.attr("stroke-opacity"),br_s=targetid.attr("stroke-dasharray"),fill=targetid.attr("fill"),fillOpacity=targetid.attr("fill-opacity"),tool="rectangle","zimageedit__crop"===clss&&(tool="crop_element");else if(-1!=clss.indexOf("zimageedit__ellipse"))targetid=$(target),top=parseFloat(targetid.attr("cy")),left=parseFloat(targetid.attr("cx")),xr=parseFloat(targetid.attr("rx")),yr=parseFloat(targetid.attr("ry")),br_w=parseFloat(targetid.attr("stroke-width")),br_c=targetid.attr("stroke"),strokeOpacity=targetid.attr("stroke-opacity"),br_s=targetid.attr("stroke-dasharray"),fill=targetid.attr("fill"),fillOpacity=targetid.attr("fill-opacity"),tool="ellipse";else if(-1!=clss.indexOf("zimageedit__line")){if(void 0!==target&&void 0!==$(target).attr("points")){var idd=target.substr(0,target.length-6);target=idd,zimagedit._idSelected=idd.substr(1,idd.length)}targetid=$(target);var d=targetid.attr("d"),regex=/[+-]?\d+(\.\d+)?/g;void 0!==d&&(d=d.match(regex).map(function(v){return parseFloat(v)}),left=parseFloat(d[0]),top=parseFloat(d[1]),xr=parseFloat(d[2]),yr=parseFloat(d[3])),br_w=parseFloat(targetid.attr("stroke-width")),br_c=targetid.attr("stroke"),strokeOpacity=targetid.attr("stroke-opacity"),br_s=targetid.attr("stroke-dasharray"),fill=targetid.attr("fill"),tool="line"}else if(-1!=clss.indexOf("zimageedit__textarea")){targetid=target.substr(1,target.length)+"--fobject",targetid=$("#"+targetid),top=parseFloat(targetid.attr("y")),left=parseFloat(targetid.attr("x")),xr=parseFloat(targetid.attr("width")),yr=parseFloat(targetid.attr("height"));var border=zimagedit.regtohex_convert($("#"+target.substr(1,target.length)).css("border-color"));br_w=$("#"+target.substr(1,target.length)).css("font-size"),br_c=zimagedit.regtohex_convert($("#"+target.substr(1,target.length)).css("color")),br_s=$("#"+target.substr(1,target.length)).val();var text_shadow=$("#"+target.substr(1,target.length)).attr("class"),bck=zimagedit.regtohex_convert($("#"+target.substr(1,target.length)).css("background-color"));fill={shadow:text_shadow,bck_color:bck,border:border},tool="textarea"}else if("zimageedit__numbering--input zimageedit__numbering"===clss){targetid=target.substr(1,target.length)+"--fobject";var temp_id=target.substr(1,target.length);targetid=$("#"+targetid),top=parseFloat(targetid.attr("y"))-9,left=parseFloat(targetid.attr("x"))-5,tool="numbering",xr=parseFloat($(targetid).attr("width"))+19,yr=parseFloat($(targetid).attr("height"))+21,br_c=$("#"+temp_id+"--path").attr("transform"),br_s=zimagedit.regtohex_convert($("#"+temp_id+"--path").attr("stroke"))}else if("zimageedit__blur--canvas"===clss)targetid=$(target),top=parseFloat(targetid.css("top")),left=parseFloat(targetid.css("left")),xr=parseFloat($(targetid).attr("width")),yr=parseFloat($(targetid).attr("height")),tool="smudge";else if(-1!==clss.indexOf("zimageedit__polyline")||-1!=clss.indexOf("zimageedit__marker")){targetid=$(target);var filter=targetid.attr("filter");void 0!==filter&&targetid.removeAttr("filter");var display=targetid.css("display"),id=document.getElementById(target.substr(1,target.length));targetid.css("display","inline");var boundingBoxValue=id.getBBox();targetid.css("display",display),xr=boundingBoxValue.width,yr=boundingBoxValue.height;var points={};points=zimagedit.editorSVG.createSVGPoint(),points.y=boundingBoxValue.y*id.getScreenCTM().a,points.x=boundingBoxValue.x*id.getScreenCTM().a,top=points.y,left=points.x,tool="polyline",br_w=parseFloat(targetid.css("stroke-width")),yr+=br_w/2,top-=br_w/2,top+=2,top/=zimagedit.fitToWidthZoomValue/100,left/=zimagedit.fitToWidthZoomValue/100,br_c=zimagedit.regtohex_convert(targetid.attr("stroke")),strokeOpacity=zimagedit.regtohex_convert(targetid.attr("stroke-opacity")),br_s=targetid.attr("stroke-dasharray"),fill=zimagedit.regtohex_convert(targetid.attr("fill")),void 0!==filter&&targetid.attr("filter",filter)}return zimagedit.valuesOfObject={top:top,left:left,width:xr,height:yr,tool:tool,fill:fill,borderColor:br_c,borderStroke:br_s,borderWidth:br_w,fillOpacity:fillOpacity,strokeOpacity:strokeOpacity},zimagedit.borderWidth=-1==clss.indexOf("zimageedit__textarea")?zimagedit.valuesOfObject.borderWidth:1,zimagedit.valuesOfObject},_close:function(){zimagedit.options.annotatorType?(zimagedit._createCanvas(),$("#zimageeditor .zimageeditor__tools").removeClass("zimageeditor__tools--animationShow")):($("#zimageeditor .zimageeditor__cancel").off("click"),$(window).off("resize.zimageedit"),$(window).off("mouseup"),$("body").off("keyup.zimageeditor keydown.zimageeditor mouseup.zimageeditor mousemove.zimageeditor"),$(document).off("dragstart.zimageeditor zmenusubmenuitemclick.zimageeditor zmenuitemclick.ze"),$("#zimageeditor__shapes--menu, #zimageeditor__textarea--menu, #zimageeditor__numbering--menu, #zimageeditor__colorpalatte--menu").remove(),$("#zimageeditCanvasCreate, #zimageedit__svg--Icon,#zimageeditor__zoom--menu, #zimageeditor__blur--menu, #zimageeditor__context--menu ,#zimageeditor__marker--menu, #zimageeditor__linearrow--menu, #zimageeditor__plus--menu, #zimageditCanvasIE, #zimageeditor__strokewidth--menu").remove(),zimagedit._imageContainer.remove(),$("#zimageeditCanvasCreate, #zimageeditor, #zimageeditTempCropCanvas").remove(),$("#zimageeditor__sourceImage").remove()),zimagedit.undoStack.length=0,zimagedit.redoStack.length=0},close:function(){zimagedit.undoStack.length>=1?ZAlertDialog.open({type:"warning",position:"center",className:"zimageedit__alertDialog",overlayClassName:"zimageedit__alertDialog",primaryMessage:zimagedit._getString("closeWarningMessgae.label"),secondaryMessage:zimagedit._getString("closeWarningMessgae2.label"),buttons:[{text:zimagedit._getString("discardChanges.label"),appearance:"primary",action:function(){$("#zimageeditor__btns--select").trigger("click"),zimagedit._close(),zimagedit.cancelEdit(),ZAlertDialog.close()}},{text:zimagedit._getString("cancel.label"),appearance:"secondary",id:"zimageedit__savealert--cancel",actions:function(){}}],defaultActionButton:"#zimageedit__savealert--cancel"}):($("#zimageeditor__btns--select").trigger("click"),zimagedit._close(),zimagedit.cancelEdit())},getValuesForFunc:function(){if(void 0===zimagedit._idSelected)return 0;var object=zimagedit.getValuesOfObject("#"+zimagedit._idSelected);zimagedit.element_attr=[object.top,object.left,object.width,object.height,object.tool]},_getString:function(key,module,stringArray){return FCUtil.getI18NString("zannotator",key,stringArray,this.options.keys)},functionForBlur:function(e,base,startVal){var left,top,width,height,points;if(points=zimagedit.editorSVG.createSVGPoint(),points.x=e.clientX,points.y=e.clientY,points=points.matrixTransform(zimagedit.editorSVG.getScreenCTM().inverse()),points.x<0||points.y<0)return 0;zimagedit.hasBlurred=!0;var viewBox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/),endVal=[points.x,points.y],eleTop=startVal[1];startVal[1]>endVal[1]&&(eleTop=endVal[1]);var eleLeft=startVal[0];startVal[0]>endVal[0]&&(eleLeft=endVal[0]),0>eleLeft&&(eleLeft=0),0>eleTop&&(eleTop=0);var eleHeight=Math.abs(startVal[1]-endVal[1]),eleWidth=Math.abs(startVal[0]-endVal[0]);eleLeft-=viewBox[0],eleTop-=viewBox[1];var orginalWidth=zimagedit.orginalCanvasFitToWidth;width=zimagedit._imageWidth,width*=zimagedit.currentZoomValue/100;var percentage=width/orginalWidth;left=eleLeft*percentage,top=eleTop*percentage,width=eleWidth*percentage,height=eleHeight*percentage;var imageWidth,imageHeight,imageCssWidth,imageCssHeight;"none"!==zimagedit._imageCanvas.css("display")?(imageWidth=parseFloat(zimagedit._imageCanvas.attr("width")),imageCssWidth=parseFloat(zimagedit._imageCanvas.css("width")),imageHeight=parseFloat(zimagedit._imageCanvas.attr("height")),imageCssHeight=parseFloat(zimagedit._imageCanvas.css("height"))):(imageWidth=parseFloat(zimagedit._imageCropCanvas.attr("width")),imageCssWidth=parseFloat(zimagedit._imageCropCanvas.css("width")),imageHeight=parseFloat(zimagedit._imageCropCanvas.attr("height")),imageCssHeight=parseFloat(zimagedit._imageCropCanvas.css("height"))),zimagedit.hasBlurredID=zimagedit._idSelected=zimagedit.temp_id,left+width>imageCssWidth&&(width=imageCssWidth-left),top+height>imageCssHeight&&(height=imageCssHeight-top),$("#"+zimagedit.temp_id).attr({width:width,height:height}).css({position:"absolute",left:left+110,top:top+80,"z-index":"3"}),left=(eleLeft+parseFloat(viewBox[0]))*zimagedit.orginalRatio,top=(eleTop+parseFloat(viewBox[1]))*zimagedit.orginalRatio,$("#zimageedit__focus--shape, .zimageedit__active--shape").show();var cropWidth=eleWidth*zimagedit.orginalRatio,cropHeight=eleHeight*zimagedit.orginalRatio;width=0===width?1:width,height=0===height?1:height,eleLeft*zimagedit.orginalRatio+cropWidth>imageWidth&&(cropWidth=imageWidth-eleLeft*zimagedit.orginalRatio),eleTop*zimagedit.orginalRatio+cropHeight>imageHeight&&(cropHeight=imageHeight-eleTop*zimagedit.orginalRatio);var blur_canvas=document.getElementById("zimageedit__canvas--blur");zimagedit.secCanvas.drawImage(blur_canvas,Math.max(1,left),Math.max(1,top),Math.max(1,cropWidth),Math.max(1,cropHeight),0,0,Math.max(1,width),Math.max(1,height))},_blur:function(a,b){var c,d,e,f,step,jump,inner,outer,arr,g=a.width,h=a.height,i=a.data,j=b||0,k=step=jump=inner=outer=arr=0;for(f=0;j>f;f++)for(var l=0;2>l;l++)for(l?(outer=g,inner=h,step=4*g):(outer=h,inner=g,step=4),c=0;outer>c;c++)for(jump=0===l?c*g*4:4*c,e=0;3>e;e++){for(k=jump+e,arr=0,arr=i[k]+i[k+step]+i[k+2*step],i[k]=Math.floor(arr/3),arr+=i[k+3*step],i[k+step]=Math.floor(arr/4),arr+=i[k+4*step],i[k+2*step]=Math.floor(arr/5),d=3;inner-2>d;d++)arr=Math.max(0,arr-i[k+(d-2)*step]+i[k+(d+2)*step]),i[k+d*step]=Math.floor(arr/5);arr-=i[k+(d-2)*step],i[k+d*step]=Math.floor(arr/4),arr-=i[k+(d-1)*step],i[k+(d+1)*step]=Math.floor(arr/3)}return a},create_canvas:function(){var temp=$("<canvas/>",{id:zimagedit.temp_id,position:"absolute","z-index":3,"class":"zimageedit__blur--canvas"});this._canvasContainer.append(temp);var c=document.getElementById(zimagedit.temp_id);zimagedit.secCanvas=c.getContext("2d"),zimagedit._idSelected=zimagedit.temp_id},putValuesIntoCanvas:function(id,left,top,width,height){if($("#"+id).attr({width:width,height:height}).css({left:left,top:top}),id=id.toString(),void 0!==id){var temp_var=document.getElementById(id),canvas=temp_var.getContext("2d"),e=zimagedit._ctx2.getImageData(left,top,width+1,height+1);canvas.putImageData(e,0,0)}},layeringFunction:function(condition,id1){var prevCount,nextCount,id,last,temp,noOfElementsBeforeTriangle=$("#zimageedit__triangle").index(),totalChildren=zimagedit.SVGElement.children().length,borderElementLength=$("#zimageedit__focus--shape").index(),clss=$("#"+id1).attr("class");id=-1!=clss.indexOf("zimageedit__textarea")?$("#"+id1).parent().attr("id"):"zimageedit__numbering"===clss||"zimageedit__numbering--input zimageedit__numbering"===clss||-1!=clss.indexOf("zimageedit__line")?id1+"--group":id1,id=$("#"+id),prevCount=id.prevAll().length,nextCount=id.nextAll().length,"bringForward"===condition?nextCount>totalChildren-borderElementLength&&(temp=zimagedit.SVGElement.children().eq(prevCount+1).attr("id"),$(id).insertAfter("#"+temp)):"bringToFront"===condition?(last=$("#zimageeditor  .zimageedit__focus--shape").eq(0),$(id).insertBefore(last)):"sendToBack"===condition?$(id).insertAfter("#zimageedit__triangle1"):"moveBackward"===condition&&prevCount>=noOfElementsBeforeTriangle+3&&(temp=zimagedit.SVGElement.children().eq(prevCount-1).attr("id"),$(id).insertBefore("#"+temp));var type=zimagedit.typeOfElement(id1);("pencil"===type||"marker"==type)&&zimagedit.createShadowForMarker(id1)},saveFromCropToOrginalCanvas:function(){if("none"===zimagedit._imageCanvas.css("display")){var cropCanvas,left,top,width,height,ratio,orginalCanvas,orginalCanvasCtx;orginalCanvas=zimagedit.mainCanvas,cropCanvas=document.getElementById("zimageditCropCanvas"),ratio=zimagedit.finalCropPosition[4],zimagedit.isIEBrowser&&(ratio=1),left=Math.round(zimagedit.finalCropPosition[0]*ratio),top=Math.round(zimagedit.finalCropPosition[1]*ratio),width=Math.round(zimagedit.finalCropPosition[2]*ratio),height=Math.round(zimagedit.finalCropPosition[3]*ratio),orginalCanvasCtx=orginalCanvas.getContext("2d"),orginalCanvasCtx.drawImage(cropCanvas,0,0,width,height,left,top,width,height)}},saveFunction:function(uid){function imageGeneration(){try{"extension"!==zimagedit.options.annotatorType&&$(svgElement).remove();var source;if(zimagedit.isImageCropped===!0){var left,top,width,height,percentage,destCanvas;percentage=zimagedit.finalCropPosition[4],left=Math.round(zimagedit.finalCropPosition[0]*percentage),top=Math.round(zimagedit.finalCropPosition[1]*percentage),width=Math.round(zimagedit.finalCropPosition[2]*percentage),height=Math.round(zimagedit.finalCropPosition[3]*percentage),destCanvas=document.getElementById("zimageeditCanvasCreate");var destCanvasCTX=destCanvas.getContext("2d");destCanvasCTX.drawImage(destCanvas,left,top,width,height,0,0,width,height);var tempCropCanvas=document.getElementById("zimageditCropCanvas");if("extension"===zimagedit.options.annotatorType)var tempCropCanvas=$("#zimageditCropCanvas").clone()[0];var tempCropCanvaCTX=tempCropCanvas.getContext("2d");tempCropCanvaCTX.drawImage(canvas,0,0,width,height,0,0,width,height),source=tempCropCanvas.toDataURL(zimagedit.imageType,1)}else source=canvas.toDataURL(zimagedit.imageType,1);zimagedit.onSuccess(source,uid),zimagedit.editorSVG.setAttribute("viewBox",viewBoxValue),"extension"===zimagedit.options.annotatorType&&($(foreignObjects).css("display","block"),$("#zimageeditor__svgcontainer").css("display","block"))}catch(error){zimagedit.imageGenerationError(error,uid)}}function drawInlineSVG(svgElement,ctx){zimagedit.imageEdited=$(svgElement).children().length;var svgURL=(new XMLSerializer).serializeToString(svgElement);if(zimagedit.isIEBrowser===!1){var img=new Image;img.src="data:image/svg+xml;charset=utf8, "+encodeURIComponent(svgURL),img.onload=function(){var length,loop,resultText,top,left,fontColor,fontSize,textShadow;for(length=text.length,ctx.drawImage(this,0,0),loop=0;length>loop;loop++){resultText=text[loop][0],top=text[loop][1]*zimagedit.orginalRatio,left=text[loop][2]*zimagedit.orginalRatio,fontColor=text[loop][5],fontSize=parseFloat(text[loop][6]),textShadow=text[loop][7],ctx.font="numbering"===text[loop][8]?"400 "+fontSize*zimagedit.orginalRatio+'px "Montserrat"':"700 "+fontSize*zimagedit.orginalRatio+'px "Montserrat"';var shadowBlur,shadowBlur=14,lineWidth=10;14>=fontSize?(lineWidth=4,shadowBlur=4):20>=fontSize?(lineWidth=6,shadowBlur=8):36>=fontSize?(lineWidth=8,shadowBlur=12):(lineWidth=12,shadowBlur=14),textShadow===!0&&(ctx.shadowColor="#00000080",ctx.shadowBlur=shadowBlur,ctx.lineWidth=lineWidth,ctx.lineJoin="round",ctx.strokeStyle="white",ctx.strokeText(resultText,left,top)),ctx.shadowBlur=0,ctx.fillStyle=fontColor,ctx.fillText(resultText,left,top)}imageGeneration()}}else{var canvasTemp=document.createElement("canvas");canvasTemp.id="zimageditCanvasIE",canvasTemp.width=zimagedit._imageWidth,canvasTemp.height=zimagedit._imageHeight,canvasTemp.style.position="absolute",canvasTemp.style.border="1px solid",canvasTemp.style.visibility="hidden",$("body").append(canvasTemp),canvg(document.getElementById("zimageditCanvasIE"),svgURL),ctx.drawImage(document.getElementById("zimageditCanvasIE"),0,0);var length,loop,resultText,top,left,fontColor,fontSize,textShadow;for(length=text.length,loop=0;length>loop;loop++)resultText=text[loop][0],top=text[loop][1]*zimagedit.orginalRatio,left=text[loop][2]*zimagedit.orginalRatio,fontColor=text[loop][5],fontSize=parseFloat(text[loop][6])*zimagedit.orginalRatio,textShadow=text[loop][7],ctx.font=fontSize+'px "Montserrat"',textShadow===!0&&(ctx.shadowColor="black",ctx.shadowBlur=7,ctx.lineWidth=7,ctx.strokeStyle="white",ctx.strokeText(resultText,left,top),ctx.shadowBlur=0),ctx.fillStyle=fontColor,ctx.fillText(resultText,left,top);imageGeneration()}}zimagedit._visibleSVGEle=$("#zimageeditor__svgeditor").children(":visible"),zimagedit.imageEdited=!1;try{zimagedit.removeShadowForMarker(),zimagedit.resetMultiSelect();for(var foreignObjects=$("foreignObject"),text="",loop=0;loop<foreignObjects.length;loop++){var element=$(foreignObjects.eq(loop)),children=element.children().eq(0);-1!==children.attr("class").indexOf("zimageedit__numbering--input")&&(children=element.parent()),-1!==element.attr("class").indexOf("zimageedit__textarea--fobject")&&(children=element),"none"===children.css("display")&&$("#"+element.attr("id")).remove()}foreignObjects=$("foreignObject");var ele=zimagedit.convertTextArea();zimagedit.saveFromCropToOrginalCanvas();var createCanvas=$("<canvas>").attr({id:"zimageeditCanvasCreate",width:zimagedit._imageWidth,height:zimagedit._imageHeight}).css({width:zimagedit._imageWidth,height:zimagedit._imageHeight,visibility:"hidden"});$("body").append(createCanvas);var canvasImage=document.getElementById("zimageeditCanvasCreate"),canvasCtx=canvasImage.getContext("2d"),orginalImage=zimagedit.mainCanvas;canvasCtx.drawImage(orginalImage,0,0);var canvas=document.getElementById("zimageeditCanvasCreate");$("#zimageeditor__svgcontainer").css("display","none"),"extension"===this.options.annotatorType&&$("body").css("overflow","hidden"),zimagedit.SVGElement.attr({width:zimagedit._imageWidth,height:zimagedit._imageHeight}).css({width:zimagedit._imageWidth,height:zimagedit._imageHeight}),zimagedit.removeCssFromCrop(),text=ele,"extension"!==this.options.annotatorType&&($(foreignObjects).remove(),$("#zimageeditor .zimageedit__active--shape, #zimageeditor .zimageedit__focus--numbering, #zimageedit__triangle, #zimageedit__triangle1, #zimageeditor .zimageedit__focus--shape, #zimageedit__plus").remove()),$(foreignObjects).css("display","none");var svgElement=zimagedit.editorSVG,viewBoxValue=svgElement.getAttribute("viewBox");svgElement.setAttribute("viewBox","0 0 "+zimagedit._imageWidth/zimagedit.orginalRatio+" "+zimagedit._imageHeight/zimagedit.orginalRatio);var myCanvas=document.getElementById("zimageeditCanvasCreate"),ctxt=myCanvas.getContext("2d");zimagedit.resetProperties();{/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}drawInlineSVG(zimagedit.editorSVG,ctxt)}catch(error){zimagedit.imageGenerationError(error)}},cancelEdit:function(){this.options.onCancel&&this.options.onCancel({change:!1,error:!1})},imageGenerationError:function(){ZAlertDialog.open({type:"error",title:zimagedit._getString("unexpectedError.label"),secondaryMessage:zimagedit._getString("imageSaveAlert.label"),className:"zimageedit__alertDialog",overlayClassName:"zimageedit__alertDialog",buttons:[{text:zimagedit._getString("ok.label"),appearance:"primary"}],close:function(){zimagedit.onError("Image Save Error")}})},onSuccess:function(imageData){var id,stack=JSON.stringify(zimagedit.undoStack),visibleEle=zimagedit._visibleSVGEle.filter(function(i){return id=$(zimagedit._visibleSVGEle[i]).attr("id"),id&&-1!==stack.indexOf(id.replace("--fobject",""))});"function"==typeof zimagedit.options.onSuccess&&zimagedit.options.onSuccess({change:0===zimagedit.undoStack.length&&0===zimagedit.imageEdited?!1:!0,imageSource:imageData,visibleElements:visibleEle}),"extension"===this.options.annotatorType?($("#zimageeditor__btns--select").trigger("click"),zimagedit._imageContainer.css("display","none")):zimagedit._close()},onError:function(errorMessage){this.options.onError&&this.options.onError({success:!1,error:!0,message:errorMessage}),zimagedit._close()},createDashedIconSVG:function(){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");$(svg).css({display:"none"}).attr({width:"45px",height:"45px"}),svg.setAttribute("id","zimageedit__svg--Icon");var path1,path2,svgNS=svg.namespaceURI,path3=document.createElementNS(svgNS,"path");zimagedit.setAttributeForObj(path3,["class","zimageedit__icon--dashedbig","fill","white","d","M15,8H4C1.8,8,0,6.2,0,4v0c0-2.2,1.8-4,4-4h11c2.2,0,4,1.8,4,4v0C19,6.2,17.2,8,15,8z"]),path2=document.createElementNS(svgNS,"path"),zimagedit.setAttributeForObj(path2,["class","zimageedit__icon--dashedbig","fill","white","d","M38,8H27c-2.2,0-4-1.8-4-4v0c0-2.2,1.8-4,4-4h11c2.2,0,4,1.8,4,4v0C42,6.2,40.2,8,38,8z"]),path1=document.createElementNS(svgNS,"path"),zimagedit.setAttributeForObj(path1,["class","zimageedit__icon--dashedbig","fill","white","d","M61,8H50c-2.2,0-4-1.8-4-4v0c0-2.2,1.8-4,4-4h11c2.2,0,4,1.8,4,4v0C65,6.2,63.2,8,61,8z"]);var symbol=document.createElementNS(svgNS,"symbol");symbol.setAttribute("id","zimageedit__icon--dashedbig"),$(symbol).append(path3).append(path2).append(path1),$(svg).append(symbol),$("body").append(svg),symbol=document.createElementNS(svgNS,"symbol"),symbol.setAttribute("id","zimageedit__icon--dashedsmall"),path3=document.createElementNS(svgNS,"path"),zimagedit.setAttributeForObj(path3,["class","zimageedit__icon--dashedsmall","fill","white","d","M11,4H2C0.9,4,0,3.1,0,2v0c0-1.1,0.9-2,2-2h9c1.1,0,2,0.9,2,2v0C13,3.1,12.1,4,11,4z"]),path2=document.createElementNS(svgNS,"path"),zimagedit.setAttributeForObj(path2,["class","zimageedit__icon--dashedsmall","fill","white","d","M28,4h-9c-1.1,0-2-0.9-2-2v0c0-1.1,0.9-2,2-2h9c1.1,0,2,0.9,2,2v0C30,3.1,29.1,4,28,4z"]),path1=document.createElementNS(svgNS,"path"),zimagedit.setAttributeForObj(path1,["class","zimageedit__icon--dashedsmall","fill","white","d","M45,4h-9c-1.1,0-2-0.9-2-2v0c0-1.1,0.9-2,2-2h9c1.1,0,2,0.9,2,2v0C47,3.1,46.1,4,45,4z"]),$(symbol).append(path3).append(path2).append(path1),$(svg).append(symbol)},createShadowForMarker:function(id){if(!zimagedit.multiSelectFlag){zimagedit.markerSelected=!0,$("#"+zimagedit._idSelected+"--shadow").length>0&&$("#"+zimagedit._idSelected+"--shadow, #"+zimagedit._idSelected+"--shadowblack").remove(),zimagedit.markerSelectedId=zimagedit._idSelected+"--shadow";var width=parseFloat($("#"+id).attr("stroke-width"));$("#"+id).clone().attr({id:id+"--shadowblack",stroke:"#7f7f7f","stroke-opacity":.5,"stroke-width":width+6,"class":" ","stroke-linecap":"round"}).insertBefore("#"+id),$("#"+id).clone().attr({id:id+"--shadow",stroke:"white","stroke-opacity":.5,"stroke-width":width,"class":"","stroke-linecap":"round"}).insertBefore("#"+id)}},removeShadowForMarker:function(){$("#"+zimagedit.markerSelectedId).remove(),$("#"+zimagedit.markerSelectedId+"black").remove()},createCropDiv:function(){zimagedit.onCropDone=void 0,zimagedit.cropAreaLock=!1,zimagedit.cropCaptureCount>0&&(zimagedit.cropAreaLock=!0),zimagedit.cropCreated=!0,zimagedit.removeBorderFocus(),zimagedit.removeBorderForNumbering(),zimagedit.zoomScaleValue=zimagedit.fitToWidthZoomValue/100;var main_div=zimagedit.createDiv("zimaggeditor__crop--container","zimaggeditor__crop--container");$(main_div).appendTo(zimagedit.svgContainer);var canvasTop,imageHeight=Math.round(parseFloat(zimagedit.SVGElement.css("height"))),imageWidth=Math.round(parseFloat(zimagedit.SVGElement.css("width")));main_div.css({width:imageWidth,height:imageHeight}),$(".zimageedit__active--r3c1, .zimageedit__active--r3c3").css({visibility:"visible",display:"block"}),$(".zimageedit__active--r1c3").css("cursor","nesw-resize"),$(".zimageedit__active--r1c1").css("cursor","nwse-resize"),$(".zimageedit__active--shape").css("visibility","visible"),zimagedit.removePlusAttributes(),zimagedit.removeShadowForMarker(),zimagedit.cropAreaHeight=Math.round(imageHeight),zimagedit.cropAreaWidth=Math.round(imageWidth),zimagedit._svgRendering("zimageedit__crop__svg","zimageedit__crop__svg",$("#zimageeditor .zimaggeditor__crop--container")[0]),document.getElementById("zimageedit__crop__svg").setAttribute("viewBox","0 0 "+imageWidth+" "+imageHeight),zimagedit.focusElementRectWhite.clone().attr({id:"zimageedit__focus--crop","stroke-opacity":1,stroke:"black","stroke-dasharray":"4,4"}).appendTo(".zimageedit__crop__svg"),$("#zimageeditor__container .zimageedit__active--shape").not("polyline").clone().appendTo(".zimageedit__crop__svg"),zimagedit.cropSVGElement=document.getElementById("zimageedit__crop__svg");var temp_var1,temp_var2,temp_var3,temp_var4;temp_var1=imageWidth/90,temp_var2=temp_var1,temp_var3=imageWidth-2*temp_var1,temp_var4=imageHeight-2*temp_var2,temp_var1=(imageWidth-temp_var3)/2,zimagedit.fitToWidthZoomValue>100&&(temp_var3=temp_var3/zimagedit.fitToWidthZoomValue*100,temp_var4=temp_var4/zimagedit.fitToWidthZoomValue*100,temp_var1=(imageWidth-temp_var3)/2,temp_var2=(imageHeight-temp_var4)/2);var temp_div=zimagedit.createDiv("zimageedit__crop--left","zimageedit__crop--left");$(main_div).append(temp_div),temp_div=zimagedit.createDiv("zimageedit__crop--top","zimageedit__crop--top"),$(main_div).append(temp_div),temp_div=zimagedit.createDiv("zimageedit__crop--right","zimageedit__crop--right"),$(main_div).append(temp_div),temp_div=zimagedit.createDiv("zimageedit__crop--bottom","zimageedit__crop--bottom"),$(main_div).append(temp_div),zimagedit.modifyTheCropAreaValues(temp_var2,temp_var1,temp_var3,temp_var4),zimagedit.borderElement=$("#zimageeditor .zimageedit__active--shape"),zimagedit.drawBorder("crop_element",temp_var2,temp_var1,temp_var3,temp_var4);var svgObj={stroke:"white",fill:"white","fill-opacity":0,"stroke-width":2,id:"zimageedit__crop","class":"ui_obj_svg_"+zimagedit._selectedTool};zimagedit._elem=zimagedit._svgElements("rect",svgObj),$(zimagedit._elem).insertBefore("#zimageedit__focus--crop");var id=$(zimagedit._elem).attr("id");$("#"+id).css({position:"absolute",cursor:"move"}).attr({"class":"zimageedit__crop",x:temp_var1,y:temp_var2,width:temp_var3,height:temp_var4}),zimagedit.cropAnimationHandle(),zimagedit.isDraw=!0,zimagedit.pushIntoStack("create"),zimagedit.isDraw=!1;var canvasLeft,canvasElement;canvasElement=$("#zimageeditor__image"),canvasLeft=parseFloat(canvasElement.css("left")),canvasTop=parseFloat(canvasElement.css("top")),-85>canvasTop&&(canvasTop=0),-110>canvasLeft&&(canvasLeft=0),canvasElement.css({top:canvasTop,left:canvasLeft}),zimagedit.svgContainer.css({top:canvasTop,left:canvasLeft}),$("#zimageeditor__container").scrollLeft(temp_var1)},resizeCropBoundaries:function(zoomedWidth,zoomedHeight){var cropTop,cropLeft,cropWidth,cropHeight,cropElement;if(cropElement=$("#zimageedit__crop"),cropTop=parseFloat(cropElement.attr("y")),cropLeft=parseFloat(cropElement.attr("x")),cropWidth=parseFloat(cropElement.attr("width")),cropHeight=parseFloat(cropElement.attr("height")),zimagedit.cropAreaLock===!1)zimagedit.previousZoomValue>=100&&zimagedit.fitToWidthZoomValue>100?(cropTop=(zoomedHeight-cropHeight)/2,cropLeft=(zoomedWidth-cropWidth)/2):(cropTop=zoomedHeight/12,cropLeft=zoomedWidth/12,cropWidth=zoomedWidth-cropLeft,cropHeight=zoomedHeight-cropTop,cropTop/=2,cropLeft/=2);else{var percentage=zimagedit.currentZoomValue/zimagedit.previousZoomValue;cropTop*=percentage,cropLeft*=percentage,cropWidth*=percentage,cropHeight*=percentage}var svgCrop=document.getElementById("zimageedit__crop__svg");svgCrop.setAttribute("viewBox","0 0 "+zoomedWidth+" "+zoomedHeight),$("#zimageeditor__container .zimageedit__crop").attr({y:cropTop,x:cropLeft,width:cropWidth,height:cropHeight}),$("#zimaggeditor__crop--container").css({width:zoomedWidth,height:zoomedHeight}),zimagedit.cropAreaWidth=Math.round(zoomedWidth),zimagedit.cropAreaHeight=Math.round(zoomedHeight),zimagedit.modifyTheCropAreaValues(cropTop,cropLeft,cropWidth,cropHeight),zimagedit.drawBorder("crop_element",cropTop,cropLeft,cropWidth,cropHeight)},cropAnimationHandle:function(){var tempFlag=!1;zimagedit.toolBarMoved===!0?(tempFlag=!0,$("#zimageeditor .zimageeditor__tools").removeClass("zimageeditor__transistionToolShow"),$("#zimageeditor .zimageeditor__tools").removeClass("zimageeditor__tools--animationShow").css("visibility","visible"),$("#zimageeditor .zimageeditor__tools").addClass("zimageeditor__tools--animationHide")):($("#zimageeditor .zimageeditor__tools").addClass("zimageeditor__transistionToolHide"),$("#zimageeditor .zimageeditor__transistionToolHide").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("zimageeditor__transistionToolHide"),$("#zimageeditor .zimageeditor__tools").css("visibility","hidden")})),zimagedit.propertiesBarMoved===!0?(tempFlag=!0,zimagedit.propertiesMenu.addClass("zimageeditor__tools--animationHide")):zimagedit.propertiesMenu.addClass("zimageeditor__transistionHeaderHide"),tempFlag===!0&&$(".zimageeditor__tools--animationHide").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){"zimageeditor__textarea--menu"===$(this).attr("id")?$(this).removeClass("zimageeditor__tools--animationHide"):$(this).removeClass("zimageeditor__tools--animationHide").css("visibility","hidden")}),$(".zimageeditor__tools--animationHide").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("zimageeditor__tools--animationHide"),"zimageeditor__textarea--menu"===$(this).attr("id")&&zimagedit.hideProperties()}),0===$("#zimageeditor .zimageeditor__crop--done").length&&($("#zimageeditor .zimageeditor__done, #zimageeditor .zimageeditor__cancel").addClass("zimageeditor__transistionHeaderHide"),$("#zimageeditor .zimageeditor__cancel").addClass("zimageeditor__crop--cancel")),$(".zimageeditor__transistionHeaderHide").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){if("zimageeditor__textarea--menu"===$(this).attr("id")?zimagedit.hideProperties():$(this).addClass("zimageeditor__transistionHeaderShow").removeClass("zimageeditor__transistionHeaderHide"),$("#zimageeditor .zimageeditor__done").addClass("zimageeditor__crop--done"),$("#zimageeditor .zimageeditor__crop--done").html(zimagedit._getString("crop.label")),"extension"===zimagedit.options.annotatorType&&$("#zimageeditor .zimageeditor__crop--cancel").html(zimagedit._getString("cancel.label")),$("#zimageeditor .zimageeditor__crop--done").off("click",zimagedit.CropDone),$("#zimageeditor .zimageeditor__crop--cancel").off("click",zimagedit.onCropCancel),$("#zimageeditor .zimageeditor__crop--done").on("click",zimagedit.CropDone),$("#zimageeditor .zimageeditor__crop--cancel").on("click",zimagedit.onCropCancel),zimagedit.onCropDone===!1||zimagedit.onCropDone===!0){$("#zimageeditor__tools .zimageeditor__tools").hasClass("zimageeditor__transistionToolShow")===!1&&(zimagedit.toolBarMoved===!0?$("#zimageeditor .zimageeditor__tools").addClass("zimageeditor__tools--animationShow").css("visibility","visible"):($("#zimageeditor .zimageeditor__tools").addClass("zimageeditor__transistionToolShow"),$(".zimageeditor__transistionToolShow").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$("#zimageeditor .zimageeditor__tools").css("visibility","visible")})),$("#zimageeditor .zimageeditor__transistionToolShow").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("zimageeditor__transistionToolShow"),$("#zimageeditor .zimageeditor__tools").css("visibility","visible")})),$("#zimageeditor .zimageeditor__crop--done").off("click",zimagedit.CropDone),$("#zimageeditor .zimageeditor__crop--cancel").off("click",zimagedit.onCropCancel);var doneBtnLabel=zimagedit._getString("done.label");zimagedit.options.finishButton&&zimagedit.options.finishButton.text&&(doneBtnLabel=zimagedit.options.finishButton.text),"extension"===zimagedit.options.annotatorType&&$("#zimageeditor .zimageeditor__cancel").html(zimagedit._getString("discardChanges.label")),$("#zimageeditor .zimageeditor__done").html(doneBtnLabel).removeClass("zimageeditor__crop--done"),$("#zimageeditor .zimageeditor__cancel").removeClass("zimageeditor__crop--cancel"),$(".zimageeditor__transistionHeaderShow").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("zimageeditor__transistionHeaderShow")})}})},cropCancelAnimationHandle:function(){zimagedit.toolBarMoved===!0&&$("#zimageeditor .zimageeditor__tools").addClass("zimageeditor__tools--animationShow").css("visibility","visible"),$("#zimageeditor .zimageeditor__done, #zimageeditor .zimageeditor__cancel").addClass("zimageeditor__transistionHeaderHide")},resetToDefaultAfterCrop:function(){zimagedit.cropCreated=!1,zimagedit.zoomScaleValue=1,$("#zimageeditor .zimageeditor__imgname, #zimageeditor .zimageeditor__done, #zimageeditor .zimageeditor__cancel").removeClass("zimageeditor__transistionHeaderShow"),zimagedit._selectedTool=zimagedit.previousSelectedTool,$("#zimageeditor .zimageeditor__crop--done").off("click",zimagedit.CropDone),$("#zimageeditor .zimageeditor__crop--cancel").off("click",zimagedit.onCropCancel),$("#zimageedit__crop").remove(),$("#zimageeditor .zimageeditor__cancel").removeClass("zimageeditor__crop--cancel"),$("#zimageeditor .zimageeditor__done").removeClass("zimageeditor__crop--done"),zimagedit.cropSelected=!1,zimagedit.resetMultiSelect(),zimagedit.propertiesMenu.removeClass("zimageeditor__transistionHeaderHide"),$("#zimageeditor .zimageeditor__footer").css({visibility:"visible"}),zimagedit.borderElement=$("#zimageeditor .zimageedit__active--shape"),zimagedit.cursorHandling({type:"toolSelect",tool:zimagedit._selectedTool})},showProperties:function(id,check){zimagedit.multiSelectFlag===!1&&zimagedit.hideProperties(),zimagedit.PropertiesMenuVisible=!0;var shadow=$("#"+id).css("text-shadow"),count=0;if(zimagedit.numberingStrokeSelected=!1,zimagedit.propertiesMenu.zmenu("hideMenuItems"),"multiSelect"===check)zimagedit.PropertiesAvailableForMultiSelect[0]&&(count++,zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageedit__icon--cfill"])),zimagedit.PropertiesAvailableForMultiSelect[1]&&(count++,zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageedit__icon--cstroke"])),zimagedit.PropertiesAvailableForMultiSelect[2]&&(count++,zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageedit__icon--cstrokWidth"])),zimagedit.PropertiesAvailableForMultiSelect[3]&&(count+=3,zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageeditor--fontsize--slider","#zimageeditor__text--fontcolor","#zimageedit__icon--textglow"])),zimagedit.PropertiesAvailableForMultiSelect[6]&&(0===count&&(zimagedit.numberingStrokeSelected=!0),count++,zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageedit__icon--cstroke"])),count>0&&(count++,zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageeditor--propertiesTool--header"]));else if("textarea"===check){zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageeditor--propertiesTool--header","#zimageeditor--fontsize--slider","#zimageeditor__text--fontcolor","#zimageedit__icon--textglow"]),count=4;var element=$(zimagedit._noOfIdSelected[0]),fontSize=parseFloat(element.css("font-size")),fontColor=element.css("color");$("#zimageeditor__text--fontcolor .zimageedit__fontcolor").css("background-color",fontColor),$("#zimageeditor__fontsize--slider").zslider("setValue",fontSize)}else if("ellipse"===check)$("#zimageedit__icon--cstroke").attr("title",zimagedit._getString("borderColor.label")),$("#zimageedit__icon--cstrokWidth").attr("title",zimagedit._getString("borderWidth.label")),zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageeditor--propertiesTool--header","#zimageedit__icon--cfill","#zimageedit__icon--cstroke","#zimageedit__icon--cstrokWidth"]),count=4;else if("line"===check)$("#zimageedit__icon--cstroke").attr("title",zimagedit._getString("lineColor.label")),$("#zimageedit__icon--cstrokWidth").attr("title",zimagedit._getString("lineWidth.label")),zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageeditor--propertiesTool--header","#zimageedit__icon--cstroke","#zimageedit__icon--cstrokWidth"]),count=3;else if("numbering"===check){$("#zimageedit__icon--cstroke").attr("title",zimagedit._getString("borderColor.label")),zimagedit.numberingStrokeSelected=!0;var numberingColor=zimagedit.getValuesOfObject(zimagedit._noOfIdSelected[0]).borderStroke;zimagedit.changeIconColorProperties(void 0,numberingColor),zimagedit.propertiesMenu.zmenu("showMenuItems",["#zimageeditor--propertiesTool--header","#zimageedit__icon--cstroke"]),count=2}return zimagedit.propertiesMenu.zmenu("setMenuItemsAttribute",["#zimageedit__icon--textglow"],"checked","none"!==shadow),zimagedit.propertiesMenu.on("zmenubeforefocus",function(){return!1}),8===count?(zimagedit.propertiesMenu.zmenu("hideMenuItems"),void(count=0)):void(0!==count&&(zimagedit.propertiesMenu.zmenu("setAttribute","columnCount",count),zimagedit.propertiesMenu.is(":visible")?zimagedit.propertiesMenu.on("zmenuhide",function(){zimagedit.PropertiesMenuVisible===!0&&zimagedit.propertiesMenu.zmenu("show",{forElement:"#zimageeditor__svgcontainer",direction:"bottom-left",position:{top:zimagedit.propertiesTop,left:zimagedit.propertiesLeft}})}):zimagedit.propertiesMenu.zmenu("show",{forElement:"#zimageeditor__svgcontainer",direction:"bottom-left",position:{top:zimagedit.propertiesTop,left:zimagedit.propertiesLeft}})))},createPlusMenu:function(append_element){if(!$("#zimageedit__plus").length){var group=document.createElementNS(zimagedit.svgPath,"g");zimagedit.setAttributeForObj(group,["id","zimageedit__plus","class","zimageedit__plus","data-objectmenu","plus"]);var circle=document.createElementNS(zimagedit.svgPath,"circle");zimagedit.setAttributeForObj(circle,["class","zimageedit__plus","id","zimageedit__plus--cirlce","cx",8,"cy",8,"r","8"]),$(group).append(circle);var polygon=document.createElementNS(zimagedit.svgPath,"path");zimagedit.setAttributeForObj(polygon,["d","M12,7H9V4c0-0.6-0.4-1-1-1h0C7.4,3,7,3.4,7,4v3H4C3.4,7,3,7.4,3,8v0c0,0.6,0.4,1,1,1h3v3c0,0.6,0.4,1,1,1h0c0.6,0,1-0.4,1-1V9h3c0.6,0,1-0.4,1-1v0C13,7.4,12.6,7,12,7z","class","zimageedit__plus","id","zimageedit__plus--polygon"]),$(group).append(polygon),$(append_element).append(group),$("#zimageedit__plus").on("mousedown",function(orgEvent){orgEvent.preventDefault(),orgEvent.stopPropagation(),zimagedit.lastHover=$(this),void 0!==zimagedit.lastHover.data("objectmenu")&&(menuToBeOpen=$("#zimageeditor__"+zimagedit.lastHover.data("objectmenu")+"--menu")),setTimeout(function(){zimagedit.handleMenuOpen(orgEvent,menuToBeOpen)},100)})}},showPlusMenu:function(id){if(zimagedit.multiSelectFlag===!0)return!0;var values=zimagedit.calculateElementPosition(id),orginal={left:values.left,right:values.right};values.top=values.top+values.height/2-8,values.left=values.left+values.width+values.borderWidth/2+6;var viewbox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/);parseFloat(viewbox[2])<values.left+15-parseFloat(viewbox[0])&&(values.left=orginal.left-30),$("#zimageedit__plus").attr({transform:"translate("+values.left+","+values.top+")"}).css("visibility","visible")},calculateElementPosition:function(id){var element=zimagedit.getValuesOfObject("#"+id);return"ellipse"===element.tool&&(element.top-=element.height,element.left-=element.width,element.width*=2,element.height*=2),element},hideProperties:function(){zimagedit.propertiesMenu.is(":visible")===!0&&(zimagedit.PropertiesMenuVisible=!1,zimagedit.propertiesMenu.zmenu("hide"),$("#zimageedit__done--splitMenu").is(":visible")===!0&&$("#zimageedit__done--splitMenu").zmenu("hide"))},hidePlusMenu:function(){$("#zimageeditor__plus--menu").is(":visible")===!0&&$("#zimageeditor__plus--menu").zmenu("hide")},removePlusAttributes:function(){$("#zimageedit__plus").css("visibility","hidden")},catureButtonClickFunction:function(){var sourceCanvas,$sourceCanvas,x,y,width,height,viewbox=zimagedit.editorSVG.getAttribute("viewBox").split(/\s+|,/),cropCanvas=document.getElementById("zimageditCropCanvas"),cropElement=$("#zimageedit__crop");x=parseInt(cropElement.attr("x")),y=parseInt(cropElement.attr("y")),width=parseInt(cropElement.attr("width")),height=parseInt(cropElement.attr("height"));var cropCanvasCtx=cropCanvas.getContext("2d");if("none"===zimagedit._imageCanvas.css("display")){sourceCanvas=document.getElementById("zimageditCropCanvas"),$sourceCanvas=zimagedit._imageCropCanvas,zimagedit._imageCropCanvas.clone().attr("id","zimageedit__crop--tempElement").appendTo("#zimageeditor__image");var tempCtx=document.getElementById("zimageedit__crop--tempElement").getContext("2d");tempCtx.drawImage(sourceCanvas,0,0),sourceCanvas=document.getElementById("zimageedit__crop--tempElement")}else sourceCanvas=zimagedit.mainCanvas,$sourceCanvas=zimagedit._imageCanvas;var ratio=parseFloat($sourceCanvas.attr("width"))/parseFloat($sourceCanvas.css("width"));zimagedit._imageCropCanvas.attr({width:width*ratio,height:height*ratio}).css({display:"block",width:width,height:height}),cropCanvasCtx.drawImage(sourceCanvas,Math.round(x*ratio),Math.round(y*ratio),Math.round(width*ratio),Math.round(height*ratio),0,0,Math.round(width*ratio),Math.round(height*ratio));var viewBox=x/zimagedit.fitToWidthZoomValue*100+parseFloat(viewbox[0])+" "+(y/zimagedit.fitToWidthZoomValue*100+parseFloat(viewbox[1]))+" "+width/zimagedit.fitToWidthZoomValue*100+" "+height/zimagedit.fitToWidthZoomValue*100;zimagedit.editorSVG.setAttribute("viewBox",viewBox),zimagedit.SVGElement.attr({width:width,height:height}),$("#zimageeditor__svgcontainer").css({width:width,height:height}),zimagedit._idSelected="zimageedit__crop",zimagedit._imageCanvas.css("display","none"),zimagedit.isDraw=!0,zimagedit.pushIntoStack("create",1);var obj=zimagedit.undoStack[zimagedit.undoStack.length-1];zimagedit.updateFinalCropPosition(obj.canvasPosition[0],obj.canvasPosition[1],obj.canvasPosition[2],obj.canvasPosition[3],obj.canvasPosition[4]),zimagedit.isDraw=!1,zimagedit.addorRemoveTopBand($(window).height(),height),zimagedit.placeCropAreaInCenter(y,x,width,height),x+=110,y+=85,zimagedit.cropImageWidth=width*ratio,zimagedit._crop_arr=[x,y,width,height,zimagedit._imageWidth/zimagedit.actualWidth,zimagedit.fitToWidthZoomValue],width=x+width,height=y+height,$("#zimageedit__crop--tempElement").remove(),$("#zimageditor__zoom--fitToScreen").trigger("mouseup")},updateFinalCropPosition:function(x,y,width,height,percentage){zimagedit.finalCropPosition=[x,y,width,height,percentage]},placeCropAreaInCenter:function(y,x,width,height){var windowWidth,windowHeight;windowHeight=$(window).height(),windowWidth=$(window).width();var top=(windowHeight-height)/2,left=(windowWidth-width)/2,canvasElement=$("#zimageeditor__image");canvasElement.css({left:0>left-110?0:left-110,top:0>top-85?0:top-85}),zimagedit.svgContainer.css({left:0>left-110?0:left-110,top:0>top-85?0:top-85}),$("#zimageeditor .zimageeditor__container").scrollLeft(width>windowHeight?(width-windowWidth)/2:0),$("#zimageeditor .zimageeditor__container").scrollTop(height>windowHeight?(height-windowHeight)/2:0)},createDiv:function(classs,id){var temp=$("<div>",{"class":classs,id:id});return temp},modifyTheCropAreaValues:function(top,left,width,height){height=Math.round(height),top=Math.round(top);var x1=top<zimagedit.cropAreaHeight?top:zimagedit.cropAreaHeight,xDiff=height+top<zimagedit.cropAreaHeight?height:zimagedit.cropAreaHeight-top;$("#zimaggeditor__crop--container .zimageedit__crop--top").css({height:x1}),$("#zimaggeditor__crop--container .zimageedit__crop--right").css({top:x1,height:xDiff,width:zimagedit.cropAreaWidth-(left+width)}),$("#zimaggeditor__crop--container .zimageedit__crop--left").css({top:x1,height:xDiff,width:left}),$("#zimaggeditor__crop--container   .zimageedit__crop--bottom").css({height:zimagedit.cropAreaHeight-(top+height)<=0?1:zimagedit.cropAreaHeight-(top+height)})},checkForSelectedElement:function(items,id){var loop,clss;if(("undefined"==typeof id||0!==id.length)&&(clss=$("#"+id).attr("class"),"undefined"!=typeof clss)){for(loop=0;loop<items.length;loop++)if("smudge"===items[loop]){var check1,check2;if(check1=$("#"+id).attr("class"),check2=$("#"+id).attr("ctype"),"zimageedit__blur--canvas"===check1)return!0;if(void 0!==check2&&"smudge"===check2)return!0}else if("crop"===items[loop]){if("zimageedit__crop"===clss||"zimaggeditor__crop--container"===$("#"+id).parent().attr("class"))return!0}else if("numbering"===items[loop]){if("zimageedit__numbering--input zimageedit__numbering"===clss||"zimageedit__numbering"===clss||"zimagedit__numbering--fobject"===clss)return!0}else if("svg"===items[loop]){if(-1!=clss.indexOf("zimageeditor__svgeditor"))return!0}else if("ellipse"===items[loop]){if(-1!=clss.indexOf("zimageedit__ellipse"))return!0}else if("rectangle"===items[loop]){if(-1!=clss.indexOf("zimageedit__rectangle"))return!0}else if("line"===items[loop]){if(-1!=clss.indexOf("zimageedit__line"))return!0}else if("marker"===items[loop]){if(-1!=clss.indexOf("zimageedit__marker"))return!0}else if("pencil"===items[loop]){if(-1!=clss.indexOf("zimageedit__polyline"))return!0}else if("textarea"===items[loop]&&-1!=clss.indexOf("zimageedit__textarea"))return!0;return!1}},typeOfElement:function(id){if("undefined"!=typeof id&&0===id.length)return"none";var object,clss=$("#"+id).attr("class");return void 0===clss?"none":(-1!=clss.indexOf("zimageedit__textarea")?object="textarea":-1!=clss.indexOf("zimageedit__ellipse")?object="ellipse":-1!=clss.indexOf("zimageedit__marker")?object="marker":-1!=clss.indexOf("zimageedit__rectangle")?object="rectangle":-1!==clss.indexOf("zimageedit__polyline")?object="pencil":-1!=clss.indexOf("zimageedit__line")?object="line":"zimageeditor__svgeditor"===clss?object="svg":"zimageedit__numbering--input zimageedit__numbering"===clss||-1!=clss.indexOf("zimageedit__numbering")||"zimagedit__numbering--fobject"===clss?object="numbering":("zimageedit__crop"===clss||"zimaggeditor__crop--container"===$("#"+id).parent().attr("class"))&&(object="crop"),object)},convertTextArea:function(){var length,value,fobj,spli,fontColor,fontSize,textShadow,count,textPosition,_ele="",loop1=1;for(textPosition=[[]],fobj=$("#zimageeditor__svgeditor foreignObject"),zimagedit.isIEBrowser&&(fobj=$("#zimageeditor__svgcontainer div")),length=fobj.length,count=0;length>=loop1;){var id=fobj[loop1-1].id,className=$("#"+id).attr("class");loop1++;var ele=$("#"+id).children().eq(0);ele=$(ele).attr("id"),ele=$("#"+ele),ele[0].tagName&&"textarea"===ele[0].tagName.toLowerCase()&&zimagedit.insertLineBreaksTorginalTextarea(id),value=$(ele).val(),"zimagedit__numbering--fobject"===className&&(ele=$("#zimageeditor__svgeditor .zimageedit__numbering")),fontColor=$(ele).css("color"),fontSize=$(ele).css("font-size"),textShadow=ele.css("text-shadow").length>10,ele=$("#"+id);var top,left,width,height,tagN;top=parseFloat($(ele).attr("y")),left=parseFloat($(ele).attr("x")),-1!==ele.attr("class").indexOf("zimagedit__numbering--fobject")?(tagN="numbering",left+=14,top+=5,value.length<=1&&"1"!==value&&(left-=4),"1"===value?left-=1:"2"===value||"3"===value||parseInt(value)>10?left+=2:parseInt(value)>=5&&parseInt(value)<=10&&(left+=1),value.length>1&&(left-=7,top+=1,zimagedit.isIEBrowser&&(left+=5),parseInt(value)>=20&&parseInt(value)<=30&&(left-=2))):left+=2,width=$(ele).attr("width"),height=$(ele).attr("height"),void 0!==value?spli=value.split("\n"):value=" ",spli=value.split("\n");var loop,tmp=document.createElement("div");for(top+=parseFloat(fontSize),loop=0;loop<spli.length;loop++){var text=document.createElementNS(zimagedit.svgPath,"text");$(text).attr("font-family","Montserrat").css("font-family","Montserrat"),zimagedit.setAttributeForObj(text,["x",left+5,"y",top-3,"fill","#0c9","font-size","22px"]);var textNode=document.createTextNode(spli[loop]);text.appendChild(textNode),tmp.appendChild(text),textPosition[count]=[spli[loop],top,left,width,height,fontColor,fontSize,textShadow,tagN],top+=parseFloat(fontSize)+4,count++}_ele+=tmp.innerHTML}return textPosition},insertLineBreaksTorginalTextarea:function(id){var a="--fobject";id=id.substr(0,id.length-a.length);var orginalTextarea=document.getElementById(id);if(orginalTextarea.setAttribute("wrap","off"),!orginalTextarea.wrap){var newArea=orginalTextarea.cloneNode(!0);newArea.value=orginalTextarea.value,orginalTextarea.parentNode.replaceChild(newArea,orginalTextarea),orginalTextarea=newArea}var orginalTextValue=orginalTextarea.value;orginalTextarea.value="";for(var emptyTextareaWidth=orginalTextarea.scrollWidth,nLastWrappingIndex=-1,i=0;i<orginalTextValue.length;i++){var currentCharacter=orginalTextValue.charAt(i);if((" "==currentCharacter||"-"==currentCharacter||"+"==currentCharacter)&&(nLastWrappingIndex=i),orginalTextarea.value+=currentCharacter,orginalTextarea.scrollWidth>emptyTextareaWidth){var buffer="";if(nLastWrappingIndex>=0){for(var j=nLastWrappingIndex+1;i>j;j++)buffer+=orginalTextValue.charAt(j);nLastWrappingIndex=-1}buffer+=currentCharacter,orginalTextarea.value=orginalTextarea.value.substr(0,orginalTextarea.value.length-buffer.length),orginalTextarea.value+="\n"+buffer}}orginalTextarea.setAttribute("wrap","")},_touchInit:function(){var editorSVG=document.getElementById("zimageeditor__svgcontainer");editorSVG.addEventListener("touchstart",zimagedit._touchHandler,!0),editorSVG.addEventListener("touchmove",zimagedit._touchHandler,!0),editorSVG.addEventListener("touchend",zimagedit._touchHandler,!0),editorSVG.addEventListener("touchcancel",zimagedit._touchHandler,!0);var toolbar=document.getElementById("zimageeditor__tools--header");toolbar.addEventListener("touchstart",zimagedit._touchHandler,!0),toolbar.addEventListener("touchmove",zimagedit._touchHandler,!0),toolbar.addEventListener("touchend",zimagedit._touchHandler,!0),toolbar.addEventListener("touchcancel",zimagedit._touchHandler,!0)},_touchHandler:function(event){var touches=event.changedTouches,first=touches[0],type="";switch(event.type){case"touchstart":type="mousedown";break;case"touchmove":type="mousemove";break;case"touchend":type="mouseup";break;default:return}var simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,null),first.target.dispatchEvent(simulatedEvent),event.preventDefault()},_doubleTouchHandler:function(event){if("mouseup"===event.type&&("textarea"===event.target.type||"text"===event.target.type)){if(zimagedit.tapped)return clearTimeout(zimagedit.tapped),zimagedit.tapped=!1,void $("#"+event.target.id).trigger("dblclick");zimagedit.tapped=setTimeout(function(){zimagedit.tapped=!1},300),zimagedit.tapped=!0}},_triggerEvent:function(orgEvent,_ui){var ui=_ui;void 0===_ui&&(ui=$.extend(ui,_ui)),$("body").trigger(this.widgetEventPrefix+orgEvent,ui)}};return{init:function(options){zimagedit._create(options)},open:function(options){zimagedit._create(options)},close:function(){zimagedit._close()},updateOptions:function(options){zimagedit._create(options)},isDrawn:function(){return"undefined"!=typeof zimagedit.undoStack?zimagedit.undoStack.length>=1:!1}}}(window.jQuery);