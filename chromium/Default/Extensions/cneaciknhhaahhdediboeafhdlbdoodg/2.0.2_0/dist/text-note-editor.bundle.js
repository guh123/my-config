!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"h",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"i",(function(){return l}));chrome.extension,chrome.storage;var r=chrome.storage.local,o=chrome.runtime,i=chrome.tabs,a=chrome.browserAction,c=chrome.cookies,s=chrome.webNavigation,u=chrome.contextMenus,d=chrome.i18n,l=chrome.windows;chrome.webRequest},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(7),o=n(2);function i(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,s,"next",e)}function s(e){i(a,r,o,c,s,"throw",e)}c(void 0)}))}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=r.a.getDomain();this.urlPrefix="".concat(t,"/api/v1/"),this.accountPrefix="".concat(r.a.getAccountDomain(),"/"),this.noPrepend=!1,this.responseType=void 0}var t,n,i;return t=e,(n=[{key:"setNoPrepend",value:function(e){return this.noPrepend=e,this}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"ajaxWithoutData",value:function(e,t,n,r){var i=this;return new Promise(function(){var c=a(regeneratorRuntime.mark((function a(c,s){var u,d;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(u=new XMLHttpRequest).onload=function(){r||"blob"===this.responseType?c(this.response):c(this.responseText)},u.onerror=function(e){s(e)},u.open(e,i.prependUrl(t,n,r)),a.next=6,Object(o.c)("znbcsr");case 6:if(d=a.sent){a.next=10;break}return s(),a.abrupt("return");case 10:r&&(u.responseType="blob",u.setRequestHeader("processData",!1),u.setRequestHeader("contentType",!1)),i.responseType&&(u.responseType=i.responseType),u.setRequestHeader("X-ZCSRF-TOKEN","znbrcsr="+d.znbcsr),u.send();case 14:case"end":return a.stop()}}),a)})));return function(e,t){return c.apply(this,arguments)}}())}},{key:"ajaxWithData",value:function(e,t,n){var r=this;return new Promise(function(){var i=a(regeneratorRuntime.mark((function i(a,c){var s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return(s=new XMLHttpRequest).onload=function(e){a(this.responseText)},s.onerror=function(e){c(e)},s.open(e,r.prependUrl(t)),i.next=6,Object(o.c)("znbcsr");case 6:if(u=i.sent){i.next=10;break}return c(),i.abrupt("return");case 10:s.setRequestHeader("X-ZCSRF-TOKEN","znbrcsr="+u.znbcsr),s.send(n);case 12:case"end":return i.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}())}},{key:"prependUrl",value:function(e,t,n){return n||this.noPrepend?e:t?"".concat(this.accountPrefix).concat(e):"".concat(this.urlPrefix).concat(e)}}])&&c(t.prototype,n),i&&c(t,i),e}()},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"g",(function(){return a})),n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return d}));var r=n(0);function o(e){return new Promise((function(t,n){try{r.a.get(e,(function(e){t(e)}))}catch(e){t(void 0)}}))}function i(e){return new Promise((function(t,n){try{r.e.get(e,(function(e){t(e)}))}catch(e){t(void 0)}}))}function a(e){return new Promise((function(t,n){try{r.e.set(e,(function(){t(!0)}))}catch(e){t(!1)}}))}function c(e){return new Promise((function(t,n){try{r.e.remove(e,(function(){t(!0)}))}catch(e){t(!1)}}))}function s(e){return new Promise((function(t,n){try{r.i.create(e,(function(e){t(e)}))}catch(e){t(void 0)}}))}function u(e){return new Promise((function(t,n){try{r.f.sendMessage(e,(function(e){t(e)}))}catch(e){t(void 0)}}))}function d(e,t){return new Promise((function(n,o){try{r.g.sendMessage(e,t,(function(e){n(e)}))}catch(e){n(void 0)}}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={SEND_ANALYTICS:1e3,SIGN_IN:1001,USER_WINDOW:1002,DOWNLOAD_BOOK_LIST:1003,INIT_WINDOW:1004,GET_TAB_ID:1005,GET_DOCUMENT:1006,INIT_READER_VIEW:1007,DISPLAY_READER_FRAME:1008,GET_STATUS:1009,CREATE_TAG:1010,SEARCH_TAG:1011,SEND_FEEDBACK:1012,SIGN_OUT:1013,GET_ALL_TAGS:1014,SEARCH_TAG_FROM_LIST:1015,FETCH_ANNOUNCEMENT:1016,SHOW_MEETING_NOTE:1017,SAVE_MEETING_NOTE:1018,SHOW_RECIPE_POPUP:1019,CLOSE_RECIPE_POPUP:1020,SHOW_PDF_POPUP:1021,RESET_TOOLBAR_ICON:1022,SHOW_TOAST:1023,HIDE_TOAST:1024,GET_LOGIN_STATUS:1025,APP_LOADING:1026,PARTIAL_CAPTURE:1027,GET_USER_IMAGE:1028,PART_PAGE_SCREENSHOT:1029,FOCUSED_PAGE_SCREENSHOT:1030,GET_NB_DOMAIN:1031,PARTIAL_ANNOTATION_FUNC:1032,TAKE_SCREENSHOT:1033,GET_CURRENT_TAB:1034,SAVE_POSITION:1035,FETCH_NOTEBOOK_IMAGE:1036,FLUSH_CACHED_CARD:1037,FULL_PAGE_SCREENSHOT:1038,OPEN_ANNOTATOR:1039,SHOW_LOADING_IFRAME:1040,HIDE_LOADING_IFRAME:1041,DOWNLOAD_FROM_URL:1042}},function(e,t,n){"use strict";function r(e,t){return function(e,t){var n=e.getDate(),r=e.getMonth(),i=r+1,a=e.getFullYear(),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r],s=e.getHours(),u=e.getMinutes(),d=e.getSeconds(),l="AM";s>=12&&(l="PM");s>12&&(s-=12);switch(t){case"dd-MMM, yyyy":return o(n)+"-"+c+", "+a;case"YYYY-MM-DDTHH:mm:SS+0530":return a+"-"+o(i)+"-"+o(n)+"T"+o(s)+":"+o(u)+":"+o(d)+"+0530";case"YYYY-MM-DDTHH:mm:SS+0000":return a+"-"+o(i)+"-"+o(n)+"T"+o(s)+":"+o(u)+":"+o(d)+"+0000";case"dd/MM/YYYY":return o(n)+"/"+o(i)+"/"+a;case"HH:mm:SS":return o(s)+":"+o(u)+":"+o(d);case"HH:mm M, MMM dd, yyyy":return o(s)+":"+o(u)+" "+l+", "+c+" "+o(n)+", "+a;default:return n+" "+c+" "+a}}(new Date(e),t)}function o(e){return e<10?"0"+e:""+e}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}))},function(e,t,n){"use strict";n.d(t,"j",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"p",(function(){return p})),n.d(t,"u",(function(){return f})),n.d(t,"t",(function(){return h})),n.d(t,"l",(function(){return m})),n.d(t,"r",(function(){return v})),n.d(t,"q",(function(){return g})),n.d(t,"g",(function(){return b})),n.d(t,"s",(function(){return y})),n.d(t,"k",(function(){return w})),n.d(t,"m",(function(){return x})),n.d(t,"y",(function(){return T})),n.d(t,"f",(function(){return E})),n.d(t,"o",(function(){return S})),n.d(t,"w",(function(){return k})),n.d(t,"c",(function(){return O})),n.d(t,"h",(function(){return C})),n.d(t,"v",(function(){return _})),n.d(t,"x",(function(){return N})),n.d(t,"z",(function(){return R})),n.d(t,"a",(function(){return P})),n.d(t,"i",(function(){return L})),n.d(t,"d",(function(){return A})),n.d(t,"b",(function(){return D})),n.d(t,"n",(function(){return M}));var r=n(2),o=n(3),i=n(0),a=n(4),c=n(8);n(9);function s(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){s(i,r,o,a,c,"next",e)}function c(e){s(i,r,o,a,c,"throw",e)}a(void 0)}))}}function d(){var e,t,n=navigator.userAgent,r=(navigator.appName,""+parseFloat(navigator.appVersion)),o=parseInt(navigator.appVersion,10);-1!=(e=n.indexOf("Chrome"))?("Chrome",r=n.substring(e+7)):n.lastIndexOf(" ")+1<(e=n.lastIndexOf("/"))&&(r=n.substring(e+1)),-1!=(t=r.indexOf(";"))&&(r=r.substring(0,t)),-1!=(t=r.indexOf(" "))&&(r=r.substring(0,t)),o=parseInt(""+r,10),isNaN(o)&&(r=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10));var a={platformVersion:r,deviceName:navigator.userAgent,deviceType:"Web"},c=i.f.getManifest().version;return a.appVersion=c,a.appName="Chrome Extension - "+c,a.platformName="Chrome",a}function l(){return(new Date).getTime()}function p(){var e=navigator.language;return"zh"===e||"zh-CN"===e||"zh-TW"===e}function f(e,t){document.createElement(e).constructor===HTMLElement&&customElements.define(e,t)}function h(e){return new Promise((function(t,n){for(var r=[],o=0,i=0;i<e.length;i++){var a=new FileReader;a.onload=c,a.readAsDataURL(e[i])}function c(){r.push(this.result),++o===e.length&&t(r)}}))}function m(){return new Promise(function(){var e=u(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(r.c)("notebookList");case 2:(a=e.sent)&&a.length||i.f.sendMessage({action:o.a.DOWNLOAD_BOOK_LIST},(function(e){var n=[];e&&(e=JSON.parse(e))&&g(e.code)&&(n=e.notebooks),t(n)}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function v(e){return new Promise((function(t,n){if(fileMap[e])t(!0);else{var r=document.createElement("script");document.head.appendChild(r),r.onload=function(){fileMap[e]=!0,t(!0)},r.onerror=function(){n(!1)},r.src=e}}))}function g(e){return 200===e||201===e}function b(e){e&&(e.focus(),e.innerText&&y(e))}function y(e){var t,n;document.createRange?((t=document.createRange()).selectNodeContents(e),t.collapse(!1),(n=window.getSelection()).removeAllRanges(),n.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(e),t.collapse(!1),t.select())}function w(){var e,t,n,r,o=new Date;return o.getFullYear()+"-"+Object(a.b)(o.getMonth()+1)+"-"+Object(a.b)(o.getDate())+"T"+(Object(a.b)(o.getHours())+":"+Object(a.b)(o.getMinutes())+":"+Object(a.b)(o.getSeconds()))+(e=o.getTimezoneOffset()/60,t=e<0?"+":"-",n=Math.floor(Math.abs(e)),r=Math.floor(60*Math.abs(e)%60),t+Object(a.b)(n)+""+Object(a.b)(r))}function x(){return new Promise(function(){var e=u(regeneratorRuntime.mark((function e(t,n){var o,i,a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(r.c)("userprofile");case 2:o=e.sent,i=void 0,o&&(i=o.userprofile)&&i.default_notecard_color&&"random"!==i.default_notecard_color.toLowerCase()&&t(i.default_notecard_color),c=(a=["#FFB47A","#FFEE8A","#FFC96C","#FFFFFF","#FF9575","#FF8785","#E9FF9D","#B3FFE8","#83D2FF","#CDC2FF","#F9D3FF","#D9E8F0"]).length,0,t(a[Math.floor(Math.random()*(c-0)+0)]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function T(e){if(-1!==e.indexOf("rgb")){var t=(e=e.substring(e.indexOf("(")+1,e.indexOf(")"))).split(",");return"#"+(16777216+(t[2]|t[1]<<8|t[0]<<16)).toString(16).slice(1)}return e}function E(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),o=r.length,i=new Uint8Array(o);o--;)i[o]=r.charCodeAt(o);return new Blob([i],{type:n})}function S(e,t){for(var n=0;n<e.length;n++){var r=e[n];r.is_read=!1;for(var o=0;o<t.length;o++){var i=t[o];if(i.announcement_id===r.announcement_id){r.is_read=i.is_read;break}}}return e}function k(e,t,n){return e?(e=(e=(e=(e=e.replace(/<article/g,"<div").replace(/<\/article>/g,"</div>")).replace(/<main/g,"<div").replace(/<\/main>/g,"</div>")).replace(/<section/g,"<div").replace(/<\/section>/g,"</div>")).replace(/<br>/g,"<br/>").replace(/<hr>/g,"<hr/>"),"true"===t&&function(e){e=Object(c.a)(e)}(e),e=(e=e.replace(/[\u2028\u2029]/gim,"<br />")).replace(/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/gim,""),"true"===n&&(e=e.replace(/"/g,"\\'")),e):e}function O(){return new Promise(function(){var e=u(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(r.d)("znbcsr");case 2:t(!0);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function C(e){if(e&&e.length){for(var t=document.createDocumentFragment(),n=0;n<e.length;n++){var r=document.createElement("div");r.id=e[n].notebook_id,r.classList.add("each-book"),r.innerText=e[n].name,t.appendChild(r)}return t}}function _(e,t){for(var n=(new DOMParser).parseFromString(e,"text/html"),r=n.querySelectorAll("script"),o=0;o<r.length;o++)r[o].parentElement.removeChild(r[o]);for(var i=n.querySelectorAll("iframe"),a=0;a<i.length;a++)i[a].parentElement.removeChild(i[a]);for(var c=n.querySelectorAll("style"),s=0;s<c.length;s++)c[s].parentElement.removeChild(c[s]);for(var u=n.querySelectorAll("button"),d=0;d<u.length;d++)u[d].parentElement.removeChild(u[d]);for(var l=n.querySelectorAll("input"),p=0;p<l.length;p++)l[p].parentElement.removeChild(l[p]);for(var f=n.querySelectorAll("textarea"),h=0;h<f.length;h++)f[h].parentElement.removeChild(f[h]);for(var m=n.querySelectorAll(".clipper-space"),v=0;v<m.length;v++){var g=document.createElement("div");g.innerHTML=m[v].innerHTML,m[v].parentElement.appendChild(g),m[v].parentElement.removeChild(m[v])}if(!t){for(var b=n.querySelectorAll("image-view"),y=0;y<b.length;y++)b[y].parentElement.removeChild(b[y]);for(var w=n.querySelectorAll("p"),x=0;x<w.length;x++)w[x].innerText&&w[x].innerText.trim()||w[x].querySelector("img")||w[x].parentElement.removeChild(w[x]);for(var T=n.querySelectorAll("br"),E=0;E<T.length;E++)T[E].innerText&&T[E].innerText.trim()||T[E].querySelector("img")||T[E].parentElement.removeChild(T[E]);for(var S=n.querySelectorAll("div"),k=0;k<S.length;k++)S[k].innerText&&S[k].innerText.trim()||S[k].querySelector("img")||S[k].parentElement.removeChild(S[k])}return n.body.innerHTML}function N(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelectorAll("image-view"),r=0;r<n.length;r++){var o=document.createTextNode("-()-");n[r].parentElement.replaceChild(o,n[r])}return"undefined"===t.body.innerHTML?"":t.body.innerHTML}function R(e,t){return new Promise(function(){var n=u(regeneratorRuntime.mark((function n(o,i){var a,c,s,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(r.c)("analyticsShown");case 2:for(a=n.sent,s=!0,a&&a.analyticsShown?c=a.analyticsShown:(c="[]",s=!0),c=JSON.parse(c),u=0;u<c.length;u++)c[u].zuid===t&&(c[u].shown=e,s=!1);return s&&c.push({shown:e,zuid:t}),n.next=10,Object(r.g)({analyticsShown:JSON.stringify(c)});case 10:o(!0);case 11:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}function P(e){return new Promise(function(){var t=u(regeneratorRuntime.mark((function t(n,o){var i,a,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(r.c)("analyticsShown");case 2:i=t.sent,a=i&&i.analyticsShown?i.analyticsShown:"[]",a=JSON.parse(a),c=0;case 6:if(!(c<a.length)){t.next=13;break}if(a[c].zuid!==e){t.next=10;break}return n(!1),t.abrupt("return");case 10:c++,t.next=6;break;case 13:n(!0);case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}function L(e){return new Promise(function(){var t=u(regeneratorRuntime.mark((function t(n,o){var i,a,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(r.c)("analyticsShown");case 2:i=t.sent,a=i&&i.analyticsShown?i.analyticsShown:"[]",a=JSON.parse(a),c=0;case 6:if(!(c<a.length)){t.next=13;break}if(a[c].zuid!==e){t.next=10;break}return n(a[c].shown),t.abrupt("return");case 10:c++,t.next=6;break;case 13:n(!1);case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}function A(e){return new Promise((function(t,n){var r=e.querySelectorAll("img");if(r&&r.length)for(var a=function(e){var n=r[e].src;if(!n)return"continue";i.f.sendMessage({action:o.a.DOWNLOAD_FROM_URL,data:{url:n}},(function(n){var o=document.createElement("image-view");o.setAttribute("image-data",n),o.setAttribute("dont_load_annotator",!0),o.id="image-view_"+l();var i=document.createElement("div"),a=document.createElement("div");a.innerHTML="<div class='clipper-space'><br></div>",i.appendChild(a),i.appendChild(o);var c=document.createElement("div");c.innerHTML="<div class='clipper-space'><br></div>",i.appendChild(c);var s=r[e].parentElement;s.removeChild(r[e]),s.appendChild(i),t(!0)}))},c=0;c<r.length;c++)a(c)}))}function D(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelectorAll("img"),r=0;r<n.length;r++)if(n[r].src&&-1===n[r].src.indexOf("http"))if(-1!==n[r].src.indexOf("moz-extension://")||-1!==n[r].src.indexOf("chrome-extension://")){var o=new URL(n[r].src);n[r].src=currentTab.url+o.pathname}else n[r].src=currentTab.url+n[r].src;return t.body.innerHTML}function M(e){if(!e||!e.trim())return"#212121";var t,n,r;if(e.match(/#/))t=function(e){return e=j(e),parseInt(e.substring(0,2),16)}(e),n=function(e){return e=j(e),parseInt(e.substring(2,4),16)}(e),r=function(e){return e=j(e),parseInt(e.substring(4,6),16)}(e);else{var o=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/);t=o[0],n=o[1],r=o[2]}return Math.round((299*parseInt(t)+587*parseInt(n)+114*parseInt(r))/1e3)>125?"#212121":"#FFFFFF"}function j(e){return"#"===e.charAt(0)?e.substring(1,7):e}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return o}));var o=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventListeners={}}var t,n,o;return t=e,(n=[{key:"addListener",value:function(e,t,n,r){if(t){var o=this.eventListeners[e];o||(this.eventListeners[e]=[],o=this.eventListeners[e]),o.push({element:t,type:n,func:r}),t.addEventListener(n,r)}}},{key:"clearAllListeners",value:function(e){var t=this.eventListeners[e];if(t)for(;t.length;){var n=t.pop();n&&n.element&&n.element.removeEventListener(n.type,n.func)}}}])&&r(t.prototype,n),o&&r(t,o),e}())},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return o}));var o=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setup="https://notebook.zoho",this.accountsSetup="https://accounts.zoho",this.topLevelDomain=".com"}var t,n,o;return t=e,(n=[{key:"setSetup",value:function(e){return this.setup=e,this}},{key:"setTopLevelDomain",value:function(e){return this.topLevelDomain=e,this}},{key:"getTopLevelDomain",value:function(){return this.topLevelDomain}},{key:"getAccountsSetup",value:function(){return this.accountsSetup}},{key:"getSetup",value:function(){return this.setup}},{key:"getDomain",value:function(){return this.setup+""+this.topLevelDomain}},{key:"getAccountDomain",value:function(){return this.accountsSetup+""+this.topLevelDomain}}])&&r(t.prototype,n),o&&r(t,o),e}())},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r={elements:["a","b","br","caption","cite","code","col","colgroup","dd","dl","dt","em","h1","h2","h3","h4","h5","h6","i","img","li","ol","p","q","small","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","tr","u","ul","div","span","figure","article","section"],attributes:{a:["href"],img:["type","height","src","width","duration","class","remotesrc","org-width","org-height","consumers","local-id"],col:["span","width"],colgroup:["span","width"],ol:["start","type"],q:["cite"],table:["summary","width"],td:["abbr","axis","colspan","rowspan","width"],th:["abbr","axis","colspan","rowspan","scope","width"],ul:["type"]},protocols:{a:{href:["http","https","mailto","tel"]},img:{src:["http","https","zresource"]}}};function o(e){for(var t=e.getElementsByTagName("style"),n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n]);return e}function i(e){var t=document.createElement("div");t.innerHTML=e,t=o(t);var n=new Sanitize(r).clean_node(t),i=document.createElement("div");i.appendChild(n.cloneNode(!0));var a=i.innerHTML;return a=(a=a.replace(/[\u2028\u2029]/gim,"<br />")).replace(/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/gim,"")}},function(e,t,n){"use strict";n.d(t,"e",(function(){return u})),n.d(t,"k",(function(){return d})),n.d(t,"j",(function(){return l})),n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f})),n.d(t,"o",(function(){return h})),n.d(t,"l",(function(){return m})),n.d(t,"c",(function(){return v})),n.d(t,"n",(function(){return g})),n.d(t,"q",(function(){return b})),n.d(t,"r",(function(){return y})),n.d(t,"p",(function(){return w})),n.d(t,"g",(function(){return x})),n.d(t,"m",(function(){return T})),n.d(t,"h",(function(){return E})),n.d(t,"i",(function(){return O})),n.d(t,"d",(function(){return C})),n.d(t,"f",(function(){return _}));var r=n(1),o=n(5),i=n(7),a=n(2);function c(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){c(i,r,o,a,s,"next",e)}function s(e){c(i,r,o,a,s,"throw",e)}a(void 0)}))}}function u(){return(new r.a).ajaxWithoutData("GET","notebooks?sort_column=-Notebook.LastModifiedTime&offset=0&limit=100")}function d(){return new Promise(function(){var e=s(regeneratorRuntime.mark((function e(t,n){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new r.a,e.next=3,o.ajaxWithoutData("GET","userprofile/accounts/status");case 3:i=e.sent,t(i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function l(){return new Promise(function(){var e=s(regeneratorRuntime.mark((function e(t,n){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new r.a,e.next=3,o.ajaxWithoutData("GET","userprofile");case 3:i=e.sent,t(i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function p(e){return new Promise(function(){var t=s(regeneratorRuntime.mark((function t(n,o){var i,a,c,s,u,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("note/file"!==e.type){t.next=10;break}return t.next=3,S(e.fileUrl);case 3:return i=t.sent,t.next=6,k(e.notebook_id,i,"");case 6:a=t.sent,n(a),t.next=19;break;case 10:return c=new r.a,(s=new FormData).append("attachment",e.znml),u="notebooks/".concat(e.notebook_id,"/notecards"),e.notebook_id&&"undefined"!==e.notebook_id||(u="notecards"),t.next=17,c.ajaxWithData("POST",u,s);case 17:d=t.sent,n(d);case 19:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}function f(e,t,n,i){return new Promise(function(){var a=s(regeneratorRuntime.mark((function a(c,s){var u,d,l,p,f;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return u=new r.a,d=Object(o.f)(n),(l=new FormData).append("attachment",d,i),p="notebooks/".concat(e,"/notecards/").concat(t,"/resources"),a.next=7,u.ajaxWithData("POST",p,l);case 7:f=a.sent,c(f);case 9:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())}function h(e,t,n){return new Promise(function(){var o=s(regeneratorRuntime.mark((function o(i,a){var c,s,u,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=new r.a,(s=new FormData).append("JSONString",JSON.stringify({reminders:[{type:"reminder/time",reminder_time:n,created_time:(new Date).getTime()}]})),u="notebooks/".concat(e,"/notecards/").concat(t,"/reminders"),o.next=6,c.ajaxWithData("POST",u,s);case 6:d=o.sent,i(d);case 8:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}())}function m(e){return new Promise(function(){var t=s(regeneratorRuntime.mark((function t(n,o){var i,a,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new r.a,a="tags/search?query=".concat(e,"&limit=5"),t.next=4,i.ajaxWithData("GET",a);case 4:c=t.sent,n(c);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}function v(e,t){return new Promise(function(){var n=s(regeneratorRuntime.mark((function n(o,i){var a,c,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=new r.a,"tags",(c=new FormData).append("JSONString",JSON.stringify({name:e,created_time:(new Date).getTime(),resource_id:t})),n.next=6,a.ajaxWithData("POST","tags",c);case 6:s=n.sent,o(s);case 8:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}function g(e){var t=e.sender,n=e.content,i=e.base64,a=e.imageName;return new Promise(function(){var e=s(regeneratorRuntime.mark((function e(c,s){var u,d,l,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new r.a,"feedback",d=new FormData,i&&(l=Object(o.f)(i),d.append("attachment",l,a)),"Notebook - Chrome Extension Feedback",d.append("JSONString",JSON.stringify({subject:"Notebook - Chrome Extension Feedback",sender:t,content:n})),e.next=8,u.ajaxWithData("POST","feedback",d);case 8:p=e.sent,c(p);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function b(){return new Promise(function(){var e=s(regeneratorRuntime.mark((function e(t,n){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new r.a,"logout",e.next=4,o.ajaxWithoutData("GET","logout",!0);case 4:i=e.sent,t(i);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function y(e,t,n){return new Promise(function(){var o=s(regeneratorRuntime.mark((function o(i,a){var c,s,u,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=new r.a,s="notebooks/".concat(e,"/notecards/").concat(t),(u=new FormData).append("attachment",n),o.next=6,c.ajaxWithData("PUT",s,u);case 6:d=o.sent,i(d);case 8:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}())}function w(e,t,n){return new Promise(function(){var o=s(regeneratorRuntime.mark((function o(i,a){var c,s,u,d,l,p;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:for(c=[],s=0;s<n.length;s++)c.push(n[s].tag_id);return u=new r.a,d="notebooks/".concat(e,"/notecards/").concat(t,"/tags"),(l=new FormData).append("JSONString",JSON.stringify({tag_ids:c})),o.next=8,u.ajaxWithData("PUT",d,l);case 8:p=o.sent,i(p);case 10:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}())}function x(){return new Promise(function(){var e=s(regeneratorRuntime.mark((function e(t,n){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new r.a,"tags?offset=0&limit=1000",e.next=4,o.ajaxWithData("GET","tags?offset=0&limit=1000");case 4:i=e.sent,t(i);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function T(e,t){return new Promise((function(n,r){var o=[];t=t.toLowerCase(),e.map((function(e){e.name.toLowerCase().startsWith(t)&&o.push(e)})),n(JSON.stringify({code:200,tags:o}))}))}function E(){return new Promise(function(){var e=s(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"chromeClipper",(r=new XMLHttpRequest).onload=function(){t(this.responseText)},r.onerror=function(e){n(e)},r.open("GET","https://notebook.zoho.com/api/v1/announcements?last_announcement_time=1&platform=chromeClipper"),e.next=7,Object(a.c)("znbcsr");case 7:if(o=e.sent){e.next=11;break}return n(),e.abrupt("return");case 11:r.setRequestHeader("X-ZCSRF-TOKEN","znbrcsr="+o.znbcsr),r.send();case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function S(e){return new Promise(function(){var t=s(regeneratorRuntime.mark((function t(n,o){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new r.a,t.next=3,i.ajaxWithoutData("GET",e,!1,!0);case 3:a=t.sent,n(a);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}function k(e,t,n){return new Promise(function(){var o=s(regeneratorRuntime.mark((function o(i,a){var c,s,u,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=new r.a,s=new FormData,u={name:"Untitled.pdf",notecard_name:"Untitled"},e&&"undefined"!==e&&(u.notebook_id=e),s.append("attachment",t,n||"Untitled.pdf"),s.append("JSONString",JSON.stringify(u)),"cards/file",o.next=9,c.ajaxWithData("POST","cards/file",s);case 9:d=o.sent,i(d);case 11:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}())}function O(){return new Promise(function(){var e=s(regeneratorRuntime.mark((function e(t,n){var o,c,s,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new r.a).setNoPrepend(!0),o.setResponseType("blob"),c=i.a.getTopLevelDomain(),e.next=6,Object(a.c)("userprofile");case 6:if((s=e.sent)&&s.userprofile){e.next=10;break}return t(void 0),e.abrupt("return");case 10:return u="https://contacts.zoho".concat(c,"/file?t=user&ID=").concat(s.userprofile.zuid,"&fs=thumb"),e.next=13,o.ajaxWithoutData("GET",u);case 13:d=e.sent,t(d);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}function C(e){return new Promise(function(){var t=s(regeneratorRuntime.mark((function t(n,o){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=new r.a).setResponseType("blob"),t.next=4,i.ajaxWithoutData("GET","covers/".concat(e,"/thumbnail?size=m"));case 4:a=t.sent,n(a);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}function _(e){return new Promise(function(){var t=s(regeneratorRuntime.mark((function t(n,o){var c,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(c=new r.a).setNoPrepend(!0),c.setResponseType("blob"),i.a.getTopLevelDomain(),t.next=6,Object(a.c)("userprofile");case 6:if((s=t.sent)&&s.userprofile){t.next=10;break}return n(void 0),t.abrupt("return");case 10:return t.next=12,c.ajaxWithoutData("GET",e);case 12:u=t.sent,n(u);case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}},,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return y}));var r=n(5),o=n(6),i=n(0),a=n(3),c=n(8);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,c,"next",e)}function c(e){u(i,r,o,a,c,"throw",e)}a(void 0)}))}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){var t="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,g(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,e)})(e)}function h(e,t,n){return(h=m()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&v(o,n.prototype),o}).apply(null,arguments)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=document.createElement("template");b.innerHTML='<style>\n    #text-editor-wrap {\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n        padding: 16px 24px 16px 24px;\n        color: #212121;\n    }\n\n    #note-title {\n        position: relative;\n        font-size: 18px;\n        height: 36px;\n        line-height: 36px;\n        display: inline-block;\n        width: 78%;\n        /* padding-left: 8px; */\n        font-weight: 600;\n        border: none;\n        background-color: inherit;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        outline: none;\n        color: inherit;\n    }\n\n    #note-title::placeholder {\n        color: inherit;\n        opacity: 0.25;\n    }\n\n    #done {\n        position: absolute;\n        top: 25px;\n        right: 24px;\n        display: inline-block;\n        font-size: 16px;\n        cursor: pointer;\n    }\n\n    #notebook-list {\n        position: relative;\n        height: 40px;\n        width: 100%;\n        border-bottom: 1px solid;\n    }\n\n    #note-editor {\n        position: absolute;\n        top: 84px;\n        bottom: 48px;\n        left: 16px;\n        right: 16px;\n        font-size: 16px;\n        outline: none;\n        padding: 0px 8px 0 8px;\n        margin-top: 12px;\n        overflow-y: auto;\n        overflow-x: hidden;\n        line-height: 1.5;\n        font-family: sans-serif;\n    }\n\n    #note-editor img {\n        display : none;\n    }\n\n    #editor-footer {\n        position: absolute;\n        height: 48px;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        display: flex;\n        justify-content: space-between;\n        padding: 0 22px;\n        border-top: 1px solid rgba(0, 0, 0, 0.1);\n    }\n\n    .note-option-wrap {\n        position: relative;\n        height: 24px;\n        width: 24px;\n        top: 50%;\n        cursor: pointer;\n        -ms-transform: translateY(-50%);\n        -webkit-transform: translateY(-50%);\n        transform: translateY(-50%);\n    }\n\n    .note-option {\n        position: absolute;\n        left: 0;\n        right: 0;\n        width: 24px;\n        height: 24px;\n        margin: auto;\n    }\n\n    \n\n    [placeholder]:empty:before {\n        content: attr(placeholder);\n        color: inherit;\n        opacity: 0.25;\n    }\n\n    #reminder-date {\n        position: absolute;\n        width: 56px;\n        left: 30px;\n        top: -4px;\n    }\n\n    #save-as-wrap {\n        position: absolute;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        color: #FFFFFF;\n        height: 48px;\n        background-color: #212121;\n    }\n\n    #save-as-text {\n        position: relative;\n        line-height: 48px;\n        margin-left: 26px;\n        font-size: 15px;\n        display: inline;\n        vertical-align: middle;\n    }\n\n    #yes-link,\n    #no-link {\n        position: relative;\n        margin-left: 14px;\n        height: 22px;\n        width: 22px;\n        line-height: 48px;\n        vertical-align: middle;\n        display: inline-block;\n        cursor: pointer;\n    }\n\n    #no-link {\n        top: -13px;\n    }\n\n    .checked-tick {\n        -webkit-filter: invert(1);\n        filter: invert(1);\n        background-image: url("../assets/icons/checked.png");\n        background-size: contain;\n    }\n\n    #no-link.iclose:before {\n        font-size: 22px;\n    }\n\n</style>\n\n<div id="text-editor-wrap">\n    <input type="text" id="note-title" value="" placeholder="Title" autocomplete="off"></input>\n    <div id="done">\n        Close\n    </div>\n    <div id="booklist-wrap">\n    </div>\n    <div id="note-editor" contenteditable="true" placeholder="Take notes"></div>\n    <div id="screenshot-overlay" class="editor-overlay"></div>\n    <div id="screenshot-options-wrap" class="editor-screenshot">\n        <div id="part-page" class="screenshot-options transition-all">\n            Part of the page\n        </div>\n        <div id="focused-page" class="screenshot-options transition-all">\n            Focused Area\n        </div>\n        <div id="full-page" class="screenshot-options transition-all">\n            Full page\n        </div>\n        <div id="full-screen" class="screenshot-options transition-all">\n            Visible Area of the Page\n        </div>\n    </div>\n    <div id="editor-footer">\n\n        \x3c!-- <div class="note-option-wrap" title="Private Share">\n            <div class="note-option iprivate-share"></div>\n        </div> --\x3e\n        \n        <div id="screenshot" class="note-option-wrap" title="screenshot">\n            <div class="note-option iscreenshot"></div>\n        </div>\n        \n        <div id="tag" class="note-option-wrap" title="Tag">\n            <div class="note-option itag"></div>\n        </div>\n        \n        <div id="reminder" class="note-option-wrap" title="Reminder">\n            <div class="note-option ireminder"></div>\n        </div>\n        \n        <div id="color-picker" class="note-option-wrap" title="Color Picker">\n            <div class="note-option icolor-picker"></div>\n        </div>\n    </div>\n</div>';var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(T,e);var t,n,s,u,f,h,y,w,x=(t=T,n=m(),function(){var e,r=g(t);if(n){var o=g(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return p(this,e)});function T(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,T),(e=x.call(this)).port=void 0,e.imageCaches=[],e.tags=[],e.reminder=void 0,e}return s=T,(u=[{key:"connectedCallback",value:function(){var e=this;this.appendChild(b.content.cloneNode(!0)),this.processAttributes(),this.populateBookList(),this.port=i.f.connect({name:""+currentTabId}),o.a.addListener("TextNoteEditor",this.querySelector("#screenshot"),"click",this.showScreenshotOptions.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#done"),"click",this.closeNoteEditor.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#note-title"),"keyup",this.titleChanged.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#note-title"),"keydown",this.titleKeyDown.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#note-editor"),"keyup",this.contentChanged.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#note-editor"),"paste",this.contentPaste.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#color-picker"),"click",this.toggleColorPicker.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#reminder"),"click",this.toggleReminder.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#tag"),"click",this.showTagContainer.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector(".editor-overlay"),"click",this.hideScreenshotOptions.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#part-page"),"click",this.partPageScreenshot.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#focused-page"),"click",this.focusedPageScreenshot.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#full-page"),"click",this.fullPageScreenshot.bind(this)),o.a.addListener("TextNoteEditor",this.querySelector("#full-screen"),"click",this.takeScreenshot.bind(this)),setTimeout((function(){o.a.addListener("TextNoteEditor",e.querySelector("#note-editor"),"dragenter",e.allowDrop.bind(e)),o.a.addListener("TextNoteEditor",e.querySelector("#note-editor"),"dragexit",e.allowDrop.bind(e)),o.a.addListener("TextNoteEditor",e.querySelector("#note-editor"),"dragover",e.allowDrop.bind(e)),o.a.addListener("TextNoteEditor",e.querySelector("#note-editor"),"drop",e.dropOnTextEditor.bind(e))}),1e3),this.port.onMessage.addListener((function(e,t){})),Object(r.r)("../../dist/nb-color-picker.bundle.js"),Object(r.r)("../../dist/choose-reminder.bundle.js"),Object(r.r)("../../dist/tag-container.bundle.js"),Object(r.r)("../../dist/image-view.bundle.js"),o.a.addListener("TextNoteEditor",window,"changeNotecardColor",(function(t){var n=t.detail;if(n&&n.cardColor){var r=e.querySelector("#text-editor-wrap");r&&(r.style.backgroundColor=n.cardColor,r.style.color="#212121",e.textColorObserver())}})),o.a.addListener("TextNoteEditor",window,"selectNotebook",(function(t){var n=t.detail;n&&n.notebook_id&&e.port.postMessage({tab_id:currentTabId,unsaved_textcard:{notebook_id:n.notebook_id}})})),o.a.addListener("TextNoteEditor",window,"setReminder",(function(t){var n=t.detail;if(n&&n.reminder_time){var r=e.querySelector("#reminder");r&&r.classList.add("highlight"),e.port.postMessage({tab_id:currentTabId,unsaved_textcard:{reminder_time:n.reminder_time}}),e.reminder=n.reminder_time}else e.reminder=void 0,e.removeReminderMeta()})),o.a.addListener("TextNoteEditor",window,"addTag",(function(t){var n=t.detail;n&&n.tag_id&&(e.tags.push({tagName:n.tagName,tag_id:n.tag_id}),e.port.postMessage({tab_id:currentTabId,unsaved_textcard:{tags:e.tags}})),e.canHighlightTags()})),o.a.addListener("TextNoteEditor",window,"removeTag",(function(t){var n=t.detail;if(n&&n.tag_id){for(var r=0;r<e.tags.length;r++)if(e.tags[r].tag_id===n.tag_id){e.tags.splice(r,1);break}e.port.postMessage({tab_id:currentTabId,unsaved_textcard:{tags:e.tags}})}e.canHighlightTags()})),o.a.addListener("TextNoteEditor",window,"message",this.eventerCallback.bind(this)),o.a.addListener("TextNoteEditor",window,"image-changed",(function(t){e.bgCacheImages()})),o.a.addListener("TextNoteEditor",window,"image-deleted",(function(t){e.bgCacheImages(),e.isReachedLimit()})),i.f.sendMessage({action:a.a.SEND_ANALYTICS,data:{category:"NOTE_TEXT",action:"NEW"}}),parent.postMessage({action:"minimizeNbDrag"},"*"),d(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.querySelector("#text-editor-wrap"))){t.next=7;break}return t.next=4,Object(r.m)();case 4:n.style.backgroundColor=t.sent,o=Object(r.n)(n.style.backgroundColor),n.style.color=o;case 7:e.textColorObserver();case 8:case"end":return t.stop()}}),t)})))()}},{key:"disconnectedCallback",value:function(){parent.postMessage({action:"maximizeNbDrag"},"*"),o.a.clearAllListeners("TextNoteEditor")}},{key:"removeReminderMeta",value:function(){var e=this.querySelector("#reminder");e&&e.classList.remove("highlight")}},{key:"textColorObserver",value:(w=d(regeneratorRuntime.mark((function e(){var t,n,r,o,i,a,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.querySelector("#text-editor-wrap")){e.next=3;break}return e.abrupt("return");case 3:"#FFFFFF"===(n=t.style.color)||"rgb(255, 255, 255)"===n?((r=document.querySelector(".loading-wrap"))&&r.classList.add("white-dots"),(o=document.querySelector("#selected-book"))&&(o.style.borderBottomColor="#CCCCCC94"),(i=document.querySelector("#editor-footer"))&&(i.style.borderTopColor="#CCCCCC94")):((a=document.querySelector(".loading-wrap"))&&a.classList.remove("white-dots"),(c=document.querySelector("#selected-book"))&&(c.style.borderBottomColor="rgba(0, 0, 0, 0.25)"),(s=document.querySelector("#editor-footer"))&&(s.style.borderTopColor="rgba(0, 0, 0, 0.1)"));case 5:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"partPageScreenshot",value:function(e){e&&e.stopPropagation(),this.hideScreenshotOptions(),i.f.sendMessage({action:a.a.PART_PAGE_SCREENSHOT}),parent.postMessage({action:"hideClipper"},"*"),i.f.sendMessage({action:a.a.SEND_ANALYTICS,data:{category:"NOTE_TEXT",action:"PART_PAGE_SCREENSHOT"}})}},{key:"focusedPageScreenshot",value:function(e){e&&e.stopPropagation(),this.hideScreenshotOptions(),i.f.sendMessage({action:a.a.FOCUSED_PAGE_SCREENSHOT}),parent.postMessage({action:"hideClipper"},"*"),i.f.sendMessage({action:a.a.SEND_ANALYTICS,data:{category:"NOTE_TEXT",action:"FOCUSED_PAGE_SCREENSHOT"}})}},{key:"fullPageScreenshot",value:function(e){e&&e.stopPropagation(),this.hideScreenshotOptions(),i.f.sendMessage({action:a.a.FULL_PAGE_SCREENSHOT,step:"intialScrollPos"}),parent.postMessage({action:"hideClipper"},"*"),i.f.sendMessage({action:a.a.SEND_ANALYTICS,data:{category:"NOTE_TEXT",action:"FULL_PAGE_SCREENSHOT"}})}},{key:"showScreenshotOptions",value:function(e){e&&e.stopPropagation();var t=this.querySelector(".editor-screenshot");if(t){t.style.display="block";var n=this.querySelector(".editor-overlay");n&&(n.style.display="block")}}},{key:"hideScreenshotOptions",value:function(e){e&&e.stopPropagation();var t=this.querySelector(".editor-screenshot");if(t){t.style.display="none";var n=this.querySelector(".editor-overlay");n&&(n.style.display="none")}}},{key:"eventerCallback",value:function(e){var t=this,n=e.data;if(n)switch(n.action){case"hideClipperResponse":n.isTakeScreenshot&&i.f.sendMessage({action:a.a.TAKE_SCREENSHOT},(function(e){parent.postMessage({action:"openAnnotator",componentName:"text-note-editor",base64:e},"*")}));break;case"openAnnotatorResponse":if("text-note-editor"!==n.componentName)return!0;for(n.detail&&n.detail.base64&&this.imageCaches.push(n.detail.base64);this.imageCaches.length;){var o=this.imageCaches.pop();this.addImageInView(o,!0,!0)}this.bgCacheImages();break;case"webImageDrop":if(parent.postMessage({action:"showClipper"},"*"),n.base64)return this.addImageInView(n.base64,!0,!0),void this.bgCacheImages();if(!n.blob)return;Object(r.t)([n.blob]).then((function(e){for(var n=0;n<e.length;n++)t.addImageInView(e[n],!1,!1);t.bgCacheImages()}));break;case"webTextDrop":if(!n.text)return;var c=this.querySelector("#note-editor");if(c){var s=document.createElement("div");s.innerText=n.text,c.appendChild(s)}break;case"focusNoteTitle":var u=this.querySelector("#note-title");u&&Object(r.g)(u)}}},{key:"addImageInView",value:function(e,t,n){if(this.isReachedLimit())return!0;var o=document.createElement("image-view");o.setAttribute("image-data",e),o.setAttribute("dont_load_annotator",t),o.id="image-view_"+Object(r.e)();var i=this.querySelector("#note-editor");if(i){n?Object(r.s)(i):i.focus();var a=document.createElement("div"),c=document.createElement("div");c.innerHTML="<div class='clipper-space'><br></div>",a.appendChild(c),a.appendChild(o);var s=document.createElement("div");s.innerHTML="<div class='clipper-space'><br></div>",a.appendChild(s),document.execCommand("insertHtml",!1,a.innerHTML),this.bgCacheImages()}this.isReachedLimit()}},{key:"isReachedLimit",value:function(){var e=this.querySelectorAll("image-view"),t=this.querySelector("#screenshot");return e.length>=15?(t.style.display="none",!0):(t.style.display="block",!1)}},{key:"contentChanged",value:function(e){this.port.postMessage({tab_id:currentTabId,unsaved_textcard:{content:e.target.innerHTML}}),this.closeOrDone()}},{key:"contentPaste",value:(y=d(regeneratorRuntime.mark((function e(t){var n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),t.preventDefault(),n=t.clipboardData||window.clipboardData,""===(o=n.getData("text/html"))?""!==(o=n.getData("text"))&&(0==o.indexOf("http")&&0==o.indexOf("https")||0==this.querySelector("#note-editor").innerText.trim().length?0!=o.indexOf("http")&&0!=o.indexOf("https")||(i=Object(c.a)("<a href="+o+">"+o+"</a>"),document.execCommand("insertHtml",!1,i)):(i=Object(c.a)(o),document.execCommand("insertHtml",!1,i))):(i=Object(c.a)(o),document.execCommand("insertHtml",!1,i)),e.next=7,Object(r.d)(this.querySelector("#note-editor"));case 7:this.port.postMessage({tab_id:currentTabId,unsaved_textcard:{content:t.target.innerHTML}}),this.bgCacheImages();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"allowDrop",value:function(e){return e.stopPropagation(),e.preventDefault(),!1}},{key:"titleChanged",value:function(e){this.port.postMessage({tab_id:currentTabId,unsaved_textcard:{title:e.target.value}}),this.closeOrDone()}},{key:"titleKeyDown",value:function(e){if(13===e.keyCode)return Object(r.g)(this.querySelector("#note-editor")),e.preventDefault(),e.stopPropagation(),!1}},{key:"closeNoteEditor",value:function(){var e=!1;if(!this.isEditorEmpty())if(this.hasOnlyLink()){var t=document.createDocumentFragment(),n=document.createElement("div");n.id="save-as-wrap";var r=document.createElement("div");r.id="save-as-text",r.innerText="Create as Link Card";var i=document.createElement("div");i.id="yes-link",i.classList.add("checked-tick");var a=document.createElement("div");a.id="no-link",a.classList.add("iclose"),n.appendChild(r),n.appendChild(i),n.appendChild(a),t.appendChild(n);var c=this.querySelector("#text-editor-wrap");c&&c.appendChild(t),o.a.addListener("TextNoteEditor",i,"click",this.saveAsLinkCard.bind(this)),o.a.addListener("TextNoteEditor",a,"click",this.saveAsTextCard.bind(this)),e=!0}else this.saveAsTextCard();e||document.dispatchEvent(new CustomEvent("closeEditor"))}},{key:"saveAsLinkCard",value:function(){document.dispatchEvent(new CustomEvent("closeEditor")),this.port.postMessage({tab_id:currentTabId,reset:!0}),Object(r.r)("../../dist/bookmark-card.bundle.js").then((function(){window.dispatchEvent(new CustomEvent("addComponent",{detail:{componentName:"bookmark-card",parentElement:document.body}}))}))}},{key:"saveAsTextCard",value:function(){var e=this.querySelector("#text-editor-wrap");e&&e.style.backgroundColor,this.bgCacheImages(),this.port.postMessage({tab_id:currentTabId,unsaved_textcard:{color:e.style.backgroundColor,content:this.querySelector("#note-editor").innerHTML},save:!0}),this.closeOrDone(),document.dispatchEvent(new CustomEvent("closeEditor")),i.f.sendMessage({action:a.a.SEND_ANALYTICS,data:{category:"NOTE_TEXT",action:"CREATE",label:"TEXT_CARD"}})}},{key:"isEditorEmpty",value:function(){var e=this.querySelector("#note-title"),t=this.querySelector("#note-editor"),n=this.querySelectorAll("image-view");return!(e&&e.value&&e.value.trim()||t&&t.innerText&&t.innerText.trim()||n&&n.length)}},{key:"takeScreenshot",value:function(e){e&&e.stopPropagation(),Object(r.r)("../../dist/image-view.bundle.js").then((function(){parent.postMessage({action:"hideClipper",isTakeScreenshot:!0},"*")})),this.hideScreenshotOptions(),i.f.sendMessage({action:a.a.SEND_ANALYTICS,data:{category:"NOTE_TEXT",action:"VISIBLE_AREA_SCREENSHOT"}})}},{key:"populateBookList",value:function(){var e=this;Object(r.r)("../../dist/notebook-list.bundle.js").then((function(){window.dispatchEvent(new CustomEvent("addComponent",{detail:{componentName:"notebook-list",parentElement:e.querySelector("#booklist-wrap")}}))}))}},{key:"toggleColorPicker",value:function(e){window.dispatchEvent(new CustomEvent("addComponent",{detail:{componentName:"nb-color-picker",parentElement:this.querySelector("#text-editor-wrap")}}))}},{key:"showTagContainer",value:function(){var e=this;Object(r.r)("../../dist/tag-container.bundle.js").then((function(){window.dispatchEvent(new CustomEvent("addComponent",{detail:{componentName:"tag-container",attributes:{tags:JSON.stringify(e.tags)},parentElement:e.querySelector("#text-editor-wrap")}}))}))}},{key:"toggleReminder",value:function(){window.dispatchEvent(new CustomEvent("addComponent",{detail:{componentName:"choose-reminder",attributes:{reminder:this.reminder},parentElement:this.querySelector("#text-editor-wrap")}}))}},{key:"dropOnTextEditor",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.querySelector("#note-editor");if(t){var n=e.dataTransfer.getData("URL");if(n){var r=document.createElement("a");r.href=n,r.innerText=n,t.appendChild(r),o.a.addListener("TextNoteEditor",r,"click",this.openEditorLink.bind(this))}}}},{key:"openEditorLink",value:function(e){"A"===e.target.tagName&&window.open(e.target.href,"_blank"),e.preventDefault()}},{key:"hasOnlyLink",value:function(){var e=this.querySelector("#note-editor");if(!e)return!1;for(var t=!1,n=!1,r=e.childNodes,o=0;o<r.length;o++)if("A"===r[o].tagName&&(t=!0,n&&(t=!1),n=!0),"A"!==r[o].tagName&&r[o].innerText&&r[o].innerText.trim()){t=!1;break}return t}},{key:"setEditorContent",value:(h=d(regeneratorRuntime.mark((function e(t,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=this.querySelector("#note-editor"))){e.next=6;break}return o.innerHTML=n,e.next=5,Object(r.d)(o);case 5:this.bgCacheImages();case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"processAttributes",value:function(){var e=this.getAttribute("intial_text");e&&this.setEditorContent(void 0,e)}},{key:"bgCacheImages",value:function(){for(var e=this.querySelectorAll("image-view"),t=[],n=0;n<e.length;n++)t.push(e[n].getAttribute("image-data"));this.port.postMessage({tab_id:currentTabId,unsaved_textcard:{image:t}}),this.closeOrDone()}},{key:"closeOrDone",value:function(){var e=this.querySelector("#note-title"),t=this.querySelector("#note-editor"),n=this.querySelector("#done");e&&t&&n&&(e.value&&e.value.trim()||t.innerText&&t.innerText.trim()?n.innerText="Done":n.innerText="Close")}},{key:"canHighlightTags",value:function(){var e=this.querySelector("#tag");this.tags&&this.tags.length?e.classList.add("highlight"):e.classList.remove("highlight")}}])&&l(s.prototype,u),f&&l(s,f),T}(f(HTMLElement));Object(r.u)("text-note-editor",y)}]);